<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GED7FX8RTV"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-GED7FX8RTV');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- SEO Meta Tags -->
    <title>The $64 Billion Rebellion: Communities vs Data Centers | ResistanceZero</title>
    <meta name="description" content="$64B blocked across 24 states. 142 activist groups. Malaysia's first DC protest. Interactive calculator to assess your community's impact.">
    <meta name="keywords" content="Data Center Opposition, Community Backlash, Electricity Bills, Data Center Water, Diesel Generators, Johor Malaysia, Northern Virginia, Data Center Moratorium, PJM Capacity, Community Impact, Southeast Asia">
    <meta name="author" content="Bagus Dwi Permana">
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#dc2626">
    <link rel="canonical" href="https://resistancezero.com/article-14.html">

    <!-- Open Graph Meta Tags -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://resistancezero.com/article-14.html">
    <meta property="og:title" content="The $64 Billion Rebellion: Why Communities Worldwide Are Fighting Data Centers">
    <meta property="og:description" content="$64B blocked. 142 groups. 24 states. Malaysia's first protest. The global data center backlash — analyzed from every perspective with interactive calculator.">
    <meta property="og:image" content="https://resistancezero.com/assets/article-14-cover.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="The $64 Billion Rebellion - Infographic showing data center community opposition across 24 US states and Southeast Asia">
    <meta property="og:locale" content="en_US">
    <meta property="og:site_name" content="Bagus Dwi Permana Portfolio">
    <meta property="article:author" content="Bagus Dwi Permana">
    <meta property="article:published_time" content="2026-02-14T00:00:00Z">
    <meta property="article:modified_time" content="2026-02-17T00:00:00Z">
    <meta property="article:section" content="Industry Analysis">
    <meta property="article:tag" content="Data Center Opposition">
    <meta property="article:tag" content="Community Impact">
    <meta property="article:tag" content="Electricity Bills">
    <meta property="article:tag" content="Southeast Asia">

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@BagusDPermana">
    <meta name="twitter:creator" content="@BagusDPermana">
    <meta name="twitter:title" content="The $64 Billion Rebellion: Why Communities Are Fighting Data Centers">
    <meta name="twitter:description" content="$64B blocked. 142 activist groups. Malaysia's first DC protest. The global backlash analyzed from every angle.">
    <meta name="twitter:image" content="https://resistancezero.com/assets/article-14-cover.jpg">
    <meta name="twitter:image:alt" content="The $64 Billion Rebellion - Data center community opposition infographic">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="assets/Favicon.png">
    <link rel="apple-touch-icon" href="assets/Favicon.png">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preload" as="image" href="assets/article-14-cover.jpg">

    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "TechnicalArticle",
        "headline": "The $64 Billion Rebellion: Why Communities Worldwide Are Fighting Data Centers",
        "description": "Comprehensive multi-perspective analysis of global data center community opposition, covering $64B in blocked projects, electricity bill impacts, water conflicts, diesel emissions, and the industry response.",
        "image": "https://resistancezero.com/assets/article-14-cover.jpg",
        "author": {
            "@type": "Person",
            "name": "Bagus Dwi Permana",
            "jobTitle": "Engineering Operations Manager",
            "sameAs": [
                "https://www.linkedin.com/in/bagusdwipermana/",
                "https://resistancezero.com"
            ]
        },
        "publisher": {
            "@type": "Organization",
            "name": "ResistanceZero",
            "url": "https://resistancezero.com",
            "logo": {
                "@type": "ImageObject",
                "url": "https://resistancezero.com/assets/Favicon.png"
            }
        },
        "datePublished": "2026-02-14",
        "dateModified": "2026-02-14",
        "wordCount": "12000",
        "articleSection": "Industry Analysis",
        "keywords": ["Data Center Opposition", "Community Impact", "Electricity Bills", "Water Stress", "Southeast Asia", "Moratorium"],
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://resistancezero.com/article-14.html"
        }
    }
    </script>

    <!-- FAQ Schema for Google Rich Snippets -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
            {
                "@type": "Question",
                "name": "How much money in data center projects has been blocked by community opposition?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "$64 billion in US data center projects have been blocked ($18B) or delayed ($46B) by community opposition across 24 states, with 142 activist groups actively organizing against new developments."
                }
            },
            {
                "@type": "Question",
                "name": "How do data centers affect residential electricity bills?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Carnegie Mellon University projects data centers could increase average US electricity bills by 8% by 2030, with Northern Virginia facing increases exceeding 25%. Baltimore residents already saw $17/month increases from PJM capacity auction costs driven by data center demand."
                }
            },
            {
                "@type": "Question",
                "name": "Why are communities in Southeast Asia protesting data centers?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Malaysia witnessed its first-ever data center protest on February 7, 2026 in Johor, where 50+ residents protested against a Zdata Technologies facility due to construction dust, water supply fears, and proximity to homes. Johor has 47 DCs with water demand 5.7x exceeding available supply."
                }
            },
            {
                "@type": "Question",
                "name": "How many diesel generators do data centers operate?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Northern Virginia alone has approximately 9,000 permitted diesel generators with combined capacity exceeding 11 GW. Virginia DC diesel emissions grew 196% (CO), 111% (NOx), and 139% (PM2.5) between 2015-2023."
                }
            },
            {
                "@type": "Question",
                "name": "Are data centers net positive or negative for communities?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "It depends on the jurisdiction. Loudoun County, VA sees $26 in tax revenue per $1 of services from DCs. However, at the state level, Virginia loses $0.52 per dollar of tax exemptions. The net impact depends on tax structures, community benefit agreements, and environmental safeguards."
                }
            }
        ]
    }
    </script>

    <!-- BreadcrumbList Schema -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
            {"@type": "ListItem", "position": 1, "name": "Home", "item": "https://resistancezero.com/"},
            {"@type": "ListItem", "position": 2, "name": "Articles", "item": "https://resistancezero.com/articles.html"},
            {"@type": "ListItem", "position": 3, "name": "The $64 Billion Rebellion", "item": "https://resistancezero.com/article-14.html"}
        ]
    }
    </script>

    <style>
        :root {
            --rebellion-red: #dc2626;
            --rebellion-orange: #ea580c;
            --rebellion-amber: #d97706;
            --rebellion-dark: #7f1d1d;
            --balance-green: #059669;
            --balance-blue: #2563eb;
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --spacing-2xl: 3rem;
        }

        .article-hero {
            background: linear-gradient(135deg, #1a0000 0%, #450a0a 40%, #7f1d1d 70%, #991b1b 100%);
            padding: 7rem 2rem 3.5rem;
            color: #fff;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .article-hero::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(circle at 20% 80%, rgba(220, 38, 38, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(234, 88, 12, 0.2) 0%, transparent 50%);
            z-index: 0;
        }
        .article-hero::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M30 5 L35 25 L55 30 L35 35 L30 55 L25 35 L5 30 L25 25 Z' fill='%23dc2626' fill-opacity='0.04'/%3E%3C/svg%3E");
            opacity: 0.5;
            z-index: 0;
        }
        .article-hero > * { position: relative; z-index: 1; }
        .article-hero .container { max-width: 1000px; margin: 0 auto; }

        .article-category {
            display: inline-block;
            background: rgba(220, 38, 38, 0.2);
            color: #fca5a5;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: 1px solid rgba(220, 38, 38, 0.3);
        }
        .article-title {
            font-size: clamp(1.6rem, 3.2vw, 2.35rem);
            font-weight: 800;
            margin-bottom: 1.25rem;
            line-height: 1.25;
            color: #fff;
            letter-spacing: -0.01em;
        }
        .article-title .highlight {
            background: linear-gradient(90deg, #ef4444, #f97316);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .article-subtitle {
            font-size: clamp(0.95rem, 1.6vw, 1.15rem);
            color: #94a3b8;
            max-width: 800px;
            margin: 0 auto 2rem;
            line-height: 1.7;
        }
        .article-meta {
            display: flex;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
            color: #94a3b8;
            font-size: 0.9375rem;
        }
        .article-meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: #94a3b8;
            margin-bottom: 2rem;
            font-weight: 500;
            transition: color 0.3s ease;
            text-decoration: none;
        }
        .back-link:hover { color: #fff; }

        /* Jump to Calculator CTA */
        .jump-to-calc {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1.5rem;
            padding: 0.875rem 1.75rem;
            background: linear-gradient(135deg, #dc2626 0%, #ea580c 100%);
            color: #fff;
            border: none;
            border-radius: 30px;
            font-size: 0.9rem;
            font-weight: 700;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(220, 38, 38, 0.4);
            animation: pulse-glow 2s ease-in-out infinite;
        }
        .jump-to-calc:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(220, 38, 38, 0.6);
        }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 4px 20px rgba(220, 38, 38, 0.4); }
            50% { box-shadow: 0 4px 30px rgba(220, 38, 38, 0.7); }
        }

        /* Rebellion Badge */
        .rebellion-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: linear-gradient(135deg, #dc2626 0%, #ea580c 100%);
            color: #fff;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Article Content */
        .article-content {
            padding: 4rem 2rem;
            background: #fff;
        }
        .article-content .container { max-width: 900px; margin: 0 auto; }
        .article-body {
            font-size: 0.95rem;
            line-height: 1.7;
            color: #374151;
        }
        .article-body p { margin-bottom: 1rem; }
        .article-body h2 {
            font-size: 1.4rem;
            color: #991b1b;
            margin: var(--spacing-xl) 0 var(--spacing-md);
            padding-bottom: var(--spacing-sm);
            border-bottom: 3px solid #fecaca;
        }
        .article-body h3 {
            font-size: 1.1rem;
            color: #b91c1c;
            margin: var(--spacing-lg) 0 var(--spacing-sm);
        }
        .article-body h4 {
            font-size: 0.9rem;
            color: #991b1b;
            margin: var(--spacing-md) 0 var(--spacing-sm);
        }
        .article-body blockquote {
            background: linear-gradient(135deg, #fef2f2 0%, #fecaca 100%);
            border-left: 4px solid #dc2626;
            padding: var(--spacing-lg) var(--spacing-xl);
            margin: var(--spacing-lg) 0;
            border-radius: 0 12px 12px 0;
            font-style: italic;
            color: #991b1b;
            font-size: 1rem;
        }
        .article-body ul, .article-body ol {
            margin: 1.5rem 0;
            padding-left: 1.5rem;
        }
        .article-body li { margin-bottom: 0.75rem; }

        /* Alert Box (Red) */
        .alert-box {
            background: linear-gradient(135deg, #450a0a 0%, #7f1d1d 100%);
            border-radius: 16px;
            padding: 2rem;
            margin: 2.5rem 0;
            border: 2px solid #dc2626;
            position: relative;
            overflow: hidden;
        }
        .alert-box::before {
            content: '';
            position: absolute;
            top: 0; right: 0;
            width: 150px; height: 150px;
            background: radial-gradient(circle, rgba(220, 38, 38, 0.3) 0%, transparent 70%);
        }
        .alert-box h4 {
            color: #fca5a5;
            font-size: 0.95rem;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .alert-box p {
            color: #e5e7eb;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        .alert-box .stat-highlight {
            color: #f87171;
            font-weight: 700;
            font-size: 1.25rem;
        }

        /* Balance Box (Green - for industry perspective) */
        .balance-box {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border-radius: 12px;
            padding: 1.5rem 2rem;
            margin: 2rem 0;
            border-left: 4px solid #10b981;
        }
        .balance-box h4 { color: #065f46; margin-bottom: 0.5rem; }
        .balance-box p { margin: 0; color: #065f46; }

        /* Warning Box (Amber - for nuance) */
        .nuance-box {
            background: linear-gradient(135deg, #fefce8 0%, #fef9c3 100%);
            border-radius: 12px;
            padding: 1.5rem 2rem;
            margin: 2rem 0;
            border-left: 4px solid #ca8a04;
        }
        .nuance-box h4 { color: #854d0e; margin-bottom: 0.5rem; }
        .nuance-box p { margin: 0; color: #854d0e; }

        /* Government Box (Blue) */
        .policy-box {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-radius: 12px;
            padding: 1.5rem 2rem;
            margin: 2rem 0;
            border-left: 4px solid #2563eb;
        }
        .policy-box h4 { color: #1e40af; margin-bottom: 0.5rem; }
        .policy-box p { margin: 0; color: #1e40af; }

        /* Comparison Grid */
        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        .comparison-card {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid #e2e8f0;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .comparison-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.1);
        }
        .comparison-card.negative {
            background: linear-gradient(135deg, #fef2f2 0%, #fecaca 100%);
            border-color: #fca5a5;
        }
        .comparison-card.positive {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border-color: #a7f3d0;
        }
        .comparison-card h5 {
            font-size: 0.8rem;
            color: #64748b;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .comparison-card .value {
            font-size: 1.75rem;
            font-weight: 700;
            color: #1e293b;
        }
        .comparison-card.negative .value { color: #dc2626; }
        .comparison-card.positive .value { color: #059669; }
        .comparison-card .unit {
            font-size: 0.8rem;
            color: #64748b;
        }

        /* Data Table */
        .data-table-container { overflow-x: auto; margin: 2rem 0; }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }
        .data-table th, .data-table td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        .data-table th {
            background: #7f1d1d;
            color: #fff;
            font-weight: 600;
            white-space: nowrap;
        }
        .data-table tr:hover { background: #fef2f2; }
        .table-source {
            font-size: 0.75rem;
            color: #64748b;
            margin-top: 0.5rem;
        }

        /* Executive Summary */
        .exec-summary {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border-radius: 16px;
            padding: 2rem;
            margin: 2rem 0;
            border: 1px solid #475569;
        }
        .exec-summary h3 {
            color: #f1f5f9;
            font-size: 1.1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .exec-summary .takeaway {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
            padding: 0.5rem 0;
        }
        .exec-summary .takeaway .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0;
            margin-top: 4px;
        }
        .exec-summary .takeaway p {
            color: #cbd5e1;
            font-size: 0.9rem;
            margin: 0;
        }

        /* Timeline */
        .timeline-container {
            position: relative;
            padding: 2rem 0;
            margin: 2rem 0;
        }
        .timeline-line {
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(to bottom, #22c55e, #eab308, #dc2626);
        }
        .timeline-item {
            position: relative;
            padding-left: 50px;
            margin-bottom: 2rem;
        }
        .timeline-dot {
            position: absolute;
            left: 12px;
            top: 4px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 3px solid #fff;
            z-index: 1;
        }
        .timeline-content {
            background: #f8fafc;
            border-radius: 8px;
            padding: 1rem 1.25rem;
            border-left: 3px solid;
        }
        .timeline-date {
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.25rem;
        }
        .timeline-text {
            font-size: 0.85rem;
            color: #475569;
            margin: 0;
        }

        /* Calculator */
        .impact-calculator {
            background: linear-gradient(135deg, #1a0000 0%, #450a0a 100%);
            border-radius: 20px;
            padding: 2.5rem;
            margin: 3rem 0;
            color: #fff;
        }
        .calc-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .calc-subtitle {
            color: #cbd5e1;
            margin-bottom: 2rem;
            font-size: 0.9rem;
        }
        .calc-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        .calc-input-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .calc-input-group label {
            font-size: 0.8rem;
            color: #e2e8f0;
            font-weight: 500;
        }
        .calc-input-group select,
        .calc-input-group input {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            color: #fff;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }
        .calc-input-group select:focus,
        .calc-input-group input:focus {
            outline: none;
            border-color: #f87171;
            background: rgba(220, 38, 38, 0.1);
        }
        .calc-input-group select option {
            background: #450a0a;
            color: #fff;
        }
        .calc-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: linear-gradient(135deg, #dc2626 0%, #ea580c 100%);
            color: #fff;
            border: none;
            border-radius: 10px;
            padding: 0.875rem 1.75rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
        }
        .calc-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 38, 38, 0.4);
        }
        .calc-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 1rem;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 2rem;
        }
        .calc-result-item {
            text-align: center;
            padding: 1rem;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
        }
        .calc-result-item .label {
            font-size: 0.7rem;
            color: #cbd5e1;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .calc-result-item .value {
            font-size: 1.35rem;
            font-weight: 700;
            color: #f87171;
        }
        .calc-result-item .value.green { color: #34d399; }
        .calc-result-item .value.blue { color: #60a5fa; }
        .calc-result-item .value.amber { color: #fbbf24; }
        .calc-result-item .subtext {
            font-size: 0.65rem;
            color: #94a3b8;
            margin-top: 0.25rem;
        }
        .calc-section-label {
            font-size: 0.85rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin: 1.5rem 0 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .calc-section-label.cost { color: #f87171; }
        .calc-section-label.benefit { color: #34d399; }
        .calc-section-label.net { color: #60a5fa; }

        .net-score-display {
            text-align: center;
            padding: 1.5rem;
            border-radius: 12px;
            margin-top: 1.5rem;
            transition: all 0.5s ease;
        }
        .net-score-display .score-label {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 0.5rem;
        }
        .net-score-display .score-value {
            font-size: 2.5rem;
            font-weight: 800;
        }
        .net-score-display .score-verdict {
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        /* Scroll Progress Bar */
        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            height: 3px;
            background: linear-gradient(90deg, #dc2626, #ea580c, #f59e0b);
            z-index: 99999;
            transition: width 0.1s linear;
            box-shadow: 0 0 10px rgba(220, 38, 38, 0.5);
        }

        /* Hero Stats Counter */
        .hero-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            max-width: 800px;
            margin: 2.5rem auto 0;
            padding: 1.5rem;
            background: rgba(0,0,0,0.3);
            border-radius: 16px;
            border: 1px solid rgba(220, 38, 38, 0.2);
            backdrop-filter: blur(10px);
        }
        .hero-stat {
            text-align: center;
        }
        .hero-stat .stat-num {
            font-size: clamp(1.5rem, 3vw, 2.25rem);
            font-weight: 800;
            font-family: 'JetBrains Mono', monospace;
            background: linear-gradient(135deg, #f87171, #fbbf24);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .hero-stat .stat-label {
            font-size: 0.7rem;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 0.25rem;
        }
        @media (max-width: 768px) {
            .hero-stats { grid-template-columns: repeat(2, 1fr); gap: 0.75rem; padding: 1rem; }
        }

        /* Viral Pull Quote */
        .viral-quote {
            position: relative;
            background: linear-gradient(135deg, #1a0000 0%, #450a0a 100%);
            border-radius: 16px;
            padding: 2rem 2.5rem;
            margin: 2.5rem 0;
            text-align: center;
            border: 1px solid rgba(220, 38, 38, 0.3);
            overflow: hidden;
        }
        .viral-quote::before {
            content: '\201C';
            position: absolute;
            top: -10px;
            left: 20px;
            font-size: 6rem;
            color: rgba(220, 38, 38, 0.15);
            font-family: Georgia, serif;
            line-height: 1;
        }
        .viral-quote p {
            font-size: 1.2rem;
            font-weight: 600;
            color: #fca5a5;
            line-height: 1.6;
            margin: 0 0 1rem 0;
            position: relative;
            z-index: 1;
        }
        .viral-quote .quote-source {
            font-size: 0.8rem;
            color: #94a3b8;
            font-weight: 400;
        }

        /* Tooltip System */
        .tooltip-trigger {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            background: rgba(220, 38, 38, 0.15);
            border: 1px solid rgba(220, 38, 38, 0.3);
            border-radius: 50%;
            font-size: 10px;
            color: #f87171;
            cursor: help;
            margin-left: auto;
            transition: all 0.3s;
            flex-shrink: 0;
        }
        .tooltip-trigger:hover {
            background: rgba(220, 38, 38, 0.3);
            transform: scale(1.15);
        }
        .tooltip-trigger .tooltip-content { display: none; }
        #tooltip-container {
            position: fixed;
            width: 320px;
            max-width: calc(100vw - 40px);
            padding: 16px;
            background: linear-gradient(135deg, #450a0a, #7f1d1d);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 12px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.6);
            z-index: 999999;
            pointer-events: none;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.15s ease;
            color: white;
            font-size: 12px;
            line-height: 1.5;
        }
        #tooltip-container.visible { opacity: 1; visibility: visible; }
        #tooltip-container .tooltip-title {
            font-size: 13px;
            font-weight: 700;
            color: #fbbf24;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        #tooltip-container .tooltip-desc {
            color: rgba(255,255,255,0.9);
            margin-bottom: 10px;
        }
        #tooltip-container .tooltip-table {
            width: 100%;
            font-size: 11px;
            border-collapse: collapse;
        }
        #tooltip-container .tooltip-table th {
            text-align: left;
            color: rgba(255,255,255,0.5);
            font-weight: 500;
            padding: 4px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        #tooltip-container .tooltip-table td {
            padding: 4px 0;
            color: white;
        }
        #tooltip-container .tooltip-table td:last-child {
            text-align: right;
            font-family: 'JetBrains Mono', monospace;
            color: #f87171;
        }
        #tooltip-container .tooltip-note {
            margin-top: 10px;
            padding: 8px;
            background: rgba(220, 38, 38, 0.15);
            border-radius: 6px;
            font-size: 10px;
            color: #fca5a5;
        }

        /* Perspective Tabs */
        .perspective-tabs {
            display: flex;
            gap: 0.5rem;
            margin: 2rem 0 1rem;
            flex-wrap: wrap;
        }
        .perspective-tab {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: default;
            border: none;
        }
        .perspective-tab.community { background: #fef2f2; color: #dc2626; }
        .perspective-tab.industry { background: #ecfdf5; color: #059669; }
        .perspective-tab.government { background: #eff6ff; color: #2563eb; }
        .perspective-tab.engineer { background: #fefce8; color: #ca8a04; }

        /* References */
        .references {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            padding: 2rem;
            border-radius: 12px;
            margin-top: 3rem;
            border-left: 4px solid #dc2626;
        }
        .references h3 {
            font-size: 1.1rem;
            margin-bottom: 1.25rem;
            color: #991b1b;
        }
        .references ol {
            font-size: 0.8rem;
            color: #475569;
            padding-left: 1.5rem;
            line-height: 1.5;
        }
        .references ol li { margin-bottom: 0.5rem; }
        .references a { color: #dc2626; text-decoration: none; }
        .references a:hover { text-decoration: underline; }
        .ref-source { color: #94a3b8; font-size: 0.75rem; }

        /* Table of Contents */
        .toc-section {
            background: linear-gradient(135deg, #fef2f2 0%, #fecaca 100%);
            padding: 3rem 2rem;
            border-bottom: 1px solid #fecaca;
        }
        .toc-container {
            max-width: 900px;
            margin: 0 auto;
        }
        .toc-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--rebellion-red);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .toc-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 0.625rem;
        }
        .toc-item {
            background: #fff;
            padding: 0.75rem 1rem;
            border-radius: 10px;
            border-left: 4px solid var(--rebellion-red);
            transition: all 0.2s ease;
            text-decoration: none;
            color: #1e293b;
        }
        .toc-item:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .toc-item-number {
            font-size: 0.75rem;
            color: var(--rebellion-red);
            font-weight: 700;
            margin-bottom: 0.25rem;
        }
        .toc-item-title {
            font-weight: 600;
            font-size: 0.88rem;
        }
        .toc-item.toc-calculator {
            background: linear-gradient(135deg, #fff7ed 0%, #ffedd5 100%);
            border-left-color: #f97316;
            border-left-width: 5px;
        }
        .toc-item.toc-calculator .toc-item-number { display: flex; align-items: center; gap: 6px; }
        .toc-item.toc-calculator .toc-calc-badge {
            font-size: 0.6rem; background: #f97316; color: #fff; padding: 1px 6px; border-radius: 4px; font-weight: 700; letter-spacing: 0.5px;
        }
        [data-theme="dark"] .toc-item.toc-calculator {
            background: linear-gradient(135deg, rgba(249,115,22,0.15) 0%, rgba(249,115,22,0.08) 100%);
        }

        @media (max-width: 768px) {
            .article-hero { padding: 6rem 1.25rem 3rem; }
            .article-content { padding: 2rem 1.25rem; }
            .impact-calculator { padding: 1.5rem; }
            .calc-grid { grid-template-columns: 1fr; }
            .comparison-grid { grid-template-columns: 1fr; }
            .calc-results { grid-template-columns: repeat(2, 1fr); }
            .timeline-item { padding-left: 40px; }
            .article-meta { gap: 1rem; }
            .exec-summary { padding: 1.5rem; }
            .tooltip-trigger { width: 24px; height: 24px; font-size: 13px; }
            .viral-quote { padding: 1.5rem; font-size: 0.95rem; }
            .viral-quote .vq-text { font-size: clamp(1rem, 3vw, 1.25rem); }
            #tooltip-container { width: 280px; max-width: 90vw; }
            .toc-grid { grid-template-columns: 1fr; }
        }

        /* 480px breakpoint — small phones */
        @media (max-width: 480px) {
            .hero-stats { grid-template-columns: repeat(2, 1fr); gap: 0.5rem; padding: 0.75rem; }
            .hero-stat .stat-num { font-size: 1.25rem; }
            .hero-stat .stat-label { font-size: 0.6rem; }
            .calc-results { grid-template-columns: 1fr; }
            .comparison-grid { gap: 0.75rem; }
            .article-title { font-size: 1.5rem; }
            .article-subtitle { font-size: 1rem; }
            .viral-quote { padding: 1.25rem; margin: 1.5rem 0; }
            .viral-quote .vq-text { font-size: 1rem; }
            .article-body h2 { font-size: 1.15rem; }
            .alert-box, .insight-box, .exec-summary { padding: 1.25rem; }
            .jump-to-calc { padding: 0.75rem 1.25rem; font-size: 0.8rem; }
            /* Data table scroll indicator */
            .article-body table { display: block; overflow-x: auto; -webkit-overflow-scrolling: touch; position: relative; }
            .article-body table::after { content: 'Swipe to see more →'; display: block; text-align: center; font-size: 0.7rem; color: #94a3b8; padding: 0.5rem 0; }
        }

        /* Article Nav */
        .article-nav {
            display: flex;
            justify-content: space-between;
            padding: 2rem 0;
            border-top: 1px solid #e2e8f0;
            margin-top: 3rem;
        }
        .article-nav a {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #dc2626;
            font-weight: 600;
            transition: color 0.3s ease;
            text-decoration: none;
        }
        .article-nav a:hover { color: #ef4444; }

        @media print {
            .navbar, .impact-calculator, .share-buttons, .jump-to-calc, .article-nav { display: none; }
        }

        /* Dark Mode */
        [data-theme="dark"] .article-content { background: #0f172a; }
        [data-theme="dark"] .article-body { background: #0f172a; color: #e2e8f0; }
        [data-theme="dark"] .article-body h2 { color: #93c5fd; }
        [data-theme="dark"] .article-body h3 { color: #cbd5e1; }
        [data-theme="dark"] .article-body p { color: #cbd5e1; }
        [data-theme="dark"] .article-body blockquote { background: rgba(30,58,95,0.3); border-color: rgba(96,165,250,0.4); color: #cbd5e1; }
        [data-theme="dark"] .article-body .info-box,
        [data-theme="dark"] .article-body .key-insight { background: rgba(15,23,42,0.8); border-color: rgba(255,255,255,0.1); color: #cbd5e1; }
        [data-theme="dark"] .article-body table th { background: #0f172a; color: #e2e8f0; }
        [data-theme="dark"] .article-body table td { color: #cbd5e1; border-color: rgba(255,255,255,0.1); }
        [data-theme="dark"] .article-body ul li,
        [data-theme="dark"] .article-body ol li { color: #cbd5e1; }
        [data-theme="dark"] .article-body a { color: #60a5fa; }
        [data-theme="dark"] .article-body strong { color: #f1f5f9; }
        [data-theme="dark"] .exec-summary { background: rgba(15,23,42,0.8); border-color: rgba(255,255,255,0.1); }
        [data-theme="dark"] .exec-summary h3 { color: #fca5a5; }
        [data-theme="dark"] .exec-summary .takeaway p { color: #cbd5e1; }
        [data-theme="dark"] .alert-box { background: linear-gradient(135deg, #1a0000 0%, #2d0a0a 100%); }
        [data-theme="dark"] .balance-box { background: rgba(5,150,105,0.1); border-color: rgba(16,185,129,0.3); }
        [data-theme="dark"] .balance-box h4 { color: #34d399; }
        [data-theme="dark"] .balance-box p { color: #cbd5e1; }
        [data-theme="dark"] .comparison-card { background: #1e293b; border-color: rgba(255,255,255,0.1); }
        [data-theme="dark"] .comparison-card h5 { color: #94a3b8; }
        [data-theme="dark"] .comparison-card .value { color: #e2e8f0; }
        [data-theme="dark"] .comparison-card .unit { color: #94a3b8; }
        [data-theme="dark"] .comparison-card.negative { background: rgba(220,38,38,0.1); border-color: rgba(248,113,113,0.3); }
        [data-theme="dark"] .comparison-card.positive { background: rgba(5,150,105,0.1); border-color: rgba(52,211,153,0.3); }
        [data-theme="dark"] .viral-quote { background: rgba(30,58,95,0.3); border-color: rgba(248,113,113,0.4); }
        [data-theme="dark"] .viral-quote p { color: #e2e8f0; }
        [data-theme="dark"] .viral-quote .quote-source { color: #94a3b8; }
        [data-theme="dark"] .timeline-content { background: #1e293b; color: #cbd5e1; }
        [data-theme="dark"] .timeline-text { color: #cbd5e1; }
        [data-theme="dark"] .timeline-dot { border-color: #0f172a; }
        [data-theme="dark"] .article-nav { border-color: rgba(255,255,255,0.1); }
        [data-theme="dark"] .article-nav a { color: #f87171; }
        [data-theme="dark"] .ref-source { color: #64748b; }

        /* ============================================= */
        /* PRO MODE — Maintenance Staffing (.msf- prefix) */
        /* ============================================= */

        /* CTA Teaser Block */
        .msf-cta-block {
            background: linear-gradient(135deg, rgba(249,115,22,0.12), rgba(249,115,22,0.04));
            border: 1.5px solid rgba(249,115,22,0.3); border-radius: 14px;
            padding: 1.5rem 2rem; margin: 2rem 0; text-align: center;
        }
        .msf-cta-headline { font-size: 1.05rem; font-weight: 700; color: #ea580c; margin: 0 0 0.5rem; }
        .msf-cta-sub { font-size: 0.85rem; color: #64748b; margin: 0 0 1rem; }
        .msf-cta-btn {
            display: inline-block; background: linear-gradient(135deg, #f97316, #ea580c); color: #fff;
            padding: 0.65rem 2rem; border-radius: 10px; font-weight: 700; font-size: 0.85rem;
            text-decoration: none; transition: opacity 0.3s, transform 0.2s; border: none; cursor: pointer;
        }
        .msf-cta-btn:hover { opacity: 0.9; transform: translateY(-1px); }
        [data-theme="dark"] .msf-cta-block { background: linear-gradient(135deg, rgba(249,115,22,0.15), rgba(249,115,22,0.06)); }

        /* Toolbar */
        .msf-toolbar-row {
            display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;
            gap: 1rem; margin-bottom: 1.5rem; padding: 1rem;
            background: linear-gradient(135deg, rgba(249,115,22,0.08) 0%, rgba(249,115,22,0.03) 100%);
            border-radius: 12px; border: 1px solid rgba(249,115,22,0.15);
        }
        .msf-mode-bar { display: flex; align-items: center; gap: 0.5rem; }
        .msf-mode-toggle {
            display: flex; background: rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden;
            border: 1px solid rgba(255,255,255,0.15);
        }
        .msf-mode-btn {
            padding: 8px 18px; font-size: 0.8rem; font-weight: 600; cursor: pointer; border: none;
            background: transparent; color: #94a3b8; transition: all 0.3s; font-family: inherit;
        }
        .msf-mode-btn.active { background: #f97316; color: #fff; }
        .msf-toolbar-actions { display: flex; gap: 0.5rem; align-items: center; }
        .msf-toolbar-btn {
            padding: 8px 16px; border-radius: 8px; border: none; font-size: 0.78rem;
            font-weight: 600; cursor: pointer; font-family: inherit; display: flex; align-items: center; gap: 6px;
        }
        .msf-btn-pdf {
            background: linear-gradient(135deg, rgba(249,115,22,0.2), rgba(249,115,22,0.1));
            color: #fb923c; border: 1px solid rgba(249,115,22,0.3) !important;
        }
        .msf-btn-pdf:hover { background: linear-gradient(135deg, rgba(249,115,22,0.3), rgba(249,115,22,0.15)); }
        .msf-privacy-badge {
            display: flex; align-items: center; gap: 6px; font-size: 0.72rem; color: #64748b;
        }
        .msf-privacy-badge i { color: #10b981; font-size: 0.8rem; }

        /* Pro Strategic Inputs */
        .msf-pro-inputs {
            background: rgba(0,0,0,0.2); border-radius: 14px; padding: 1.5rem; margin-bottom: 1.5rem;
            border: 1px solid rgba(249,115,22,0.15);
        }
        .msf-pro-inputs-title {
            font-size: 0.7rem; color: #fb923c; text-transform: uppercase; letter-spacing: 2px;
            font-weight: 700; margin-bottom: 1rem; padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(249,115,22,0.2);
            display: flex; align-items: center; gap: 0.5rem;
        }
        .msf-pro-inputs .calc-grid { margin-bottom: 0; }
        .msf-pro-inputs .calc-input-group label { color: #e2e8f0; }
        .msf-pro-inputs .calc-input-group select,
        .msf-pro-inputs .calc-input-group input[type="number"],
        .msf-pro-inputs .calc-input-group input[type="range"] {
            background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15);
            border-radius: 8px; padding: 0.75rem 1rem; color: #fff; font-size: 0.95rem;
        }
        .msf-pro-inputs .calc-input-group select:focus,
        .msf-pro-inputs .calc-input-group input:focus {
            outline: none; border-color: #f97316; background: rgba(249,115,22,0.1);
        }
        .msf-pro-inputs .calc-input-group select option { background: #1a0f05; color: #fff; }

        /* Pro Tooltip (orange theme) */
        .msf-tooltip-trigger {
            display: inline-flex; align-items: center; justify-content: center;
            width: 16px; height: 16px; border-radius: 50%;
            background: rgba(249,115,22,0.2); border: 1px solid rgba(249,115,22,0.3);
            color: #fb923c; font-size: 10px; cursor: help;
            margin-left: 4px; flex-shrink: 0; transition: all 0.3s;
        }
        .msf-tooltip-trigger:hover { background: rgba(249,115,22,0.35); transform: scale(1.15); }
        .msf-tooltip-trigger .tooltip-content { display: none; }

        /* Slider + Value Display */
        .msf-slider-group { position: relative; }
        .msf-slider-value {
            text-align: right; font-size: 0.75rem; color: #fb923c;
            font-weight: 700; font-family: 'JetBrains Mono', monospace; margin-top: 0.25rem;
        }
        .msf-pro-inputs input[type="range"] {
            -webkit-appearance: none; width: 100%; height: 6px;
            background: rgba(255,255,255,0.15); border-radius: 3px; outline: none; padding: 0;
        }
        .msf-pro-inputs input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; width: 18px; height: 18px; border-radius: 50%;
            background: #f97316; cursor: pointer; box-shadow: 0 2px 6px rgba(249,115,22,0.4);
        }

        /* Pro Panels */
        .msf-pro-panel {
            position: relative; margin: 1.5rem 0; padding: 1.5rem;
            background: linear-gradient(135deg, #fff7ed 0%, #ffedd5 100%);
            border-radius: 14px; border: 1px solid rgba(249,115,22,0.15);
        }
        .msf-pro-panel.gated { filter: blur(3px); pointer-events: none; user-select: none; }
        .msf-pro-panel .msf-panel-title {
            font-size: 0.95rem; font-weight: 700; color: #9a3412; margin-bottom: 0.75rem;
            display: flex; align-items: center; gap: 8px;
        }
        .msf-pro-panel .msf-panel-title i { color: #f97316; }
        .msf-gate-overlay {
            position: absolute; inset: 0; background: rgba(120,60,10,0.85); border-radius: 14px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            gap: 0.5rem; z-index: 5; cursor: pointer;
        }
        .msf-gate-overlay i { font-size: 1.5rem; color: #f97316; }
        .msf-gate-overlay span { font-size: 0.8rem; color: #fde68a; font-weight: 600; }

        /* KPI Grid */
        .msf-kpi-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 0.75rem;
        }
        .msf-kpi-card {
            background: rgba(249,115,22,0.06); border-radius: 10px; padding: 1rem; text-align: center;
            border: 1px solid rgba(249,115,22,0.1);
        }
        .msf-kpi-value { font-size: 1.4rem; font-weight: 800; color: #9a3412; }
        .msf-kpi-label { font-size: 0.7rem; color: #78350f; margin-top: 0.2rem; }
        .msf-kpi-sublabel { font-size: 0.6rem; color: #92400e; margin-top: 0.15rem; }

        /* Score bars */
        .msf-score-bar-bg { width: 100%; height: 6px; background: rgba(249,115,22,0.1); border-radius: 3px; margin-top: 0.4rem; overflow: hidden; }
        .msf-score-bar-fill { height: 100%; border-radius: 3px; transition: width 0.5s ease; }
        .msf-score-bar-fill.risk-high { background: linear-gradient(90deg, #dc2626, #ef4444); }
        .msf-score-bar-fill.risk-med { background: linear-gradient(90deg, #f59e0b, #fbbf24); }
        .msf-score-bar-fill.risk-low { background: linear-gradient(90deg, #10b981, #34d399); }

        /* Chart Container */
        .msf-chart-container { margin-top: 1rem; background: rgba(0,0,0,0.05); border-radius: 10px; padding: 1rem; }
        .msf-chart-container canvas { width: 100% !important; max-height: 280px; }

        /* Narrative */
        .msf-narrative {
            background: rgba(249,115,22,0.08); border: 1px solid rgba(249,115,22,0.2);
            border-radius: 12px; padding: 1.25rem; margin-top: 1rem;
        }
        .msf-narrative h4 { color: #9a3412; font-size: 0.85rem; margin: 0 0 0.75rem; display: flex; align-items: center; gap: 6px; }
        .msf-narrative p { color: #78350f; font-size: 0.78rem; line-height: 1.7; margin: 0 0 0.75rem; }
        .msf-narrative p:last-child { margin-bottom: 0; }
        .msf-narrative p strong { color: #9a3412; }

        /* Login Modal */
        .msf-login-overlay {
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.75); backdrop-filter: blur(8px);
            z-index: 9999; align-items: center; justify-content: center;
        }
        .msf-login-overlay.active { display: flex; }
        .msf-login-box {
            background: #0f172a; border-radius: 16px; padding: 2.5rem; max-width: 380px; width: 90%;
            border: 1px solid rgba(249,115,22,0.3); box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            position: relative;
        }
        .msf-login-box h3 { color: #e2e8f0; margin: 0 0 0.5rem; font-size: 1.1rem; }
        .msf-login-box p { color: #64748b; font-size: 0.8rem; margin: 0 0 1.5rem; }
        .msf-login-box input {
            width: 100%; padding: 0.75rem 1rem; background: #1e293b;
            border: 1px solid #334155; border-radius: 8px; color: #e2e8f0;
            font-size: 0.9rem; margin-bottom: 0.75rem; box-sizing: border-box;
        }
        .msf-login-box input:focus { outline: none; border-color: #f97316; }
        .msf-login-box button.msf-login-submit {
            width: 100%; padding: 0.75rem; background: linear-gradient(135deg, #f97316, #ea580c); color: #fff;
            border: none; border-radius: 8px; font-weight: 700; cursor: pointer; font-size: 0.9rem; margin-top: 0.5rem;
        }
        .msf-login-box .demo-hint { font-size: 0.7rem; color: #64748b; margin-top: 0.75rem; text-align: center; }
        .msf-login-box .demo-hint code { background: rgba(249,115,22,0.15); padding: 1px 5px; border-radius: 3px; color: #fb923c; }
        .msf-login-close {
            position: absolute; top: 12px; right: 16px; background: none; border: none;
            color: #64748b; font-size: 1.2rem; cursor: pointer;
        }
        .msf-login-error { color: #f87171; font-size: 0.75rem; margin-top: 0.5rem; text-align: center; display: none; }
        [data-theme="light"] .msf-login-box { background: #ffffff; border-color: #e2e8f0; }
        [data-theme="light"] .msf-login-box h3 { color: #1e293b; }
        [data-theme="light"] .msf-login-box p { color: #64748b; }
        [data-theme="light"] .msf-login-box input { background: #f1f5f9; border-color: #e2e8f0; color: #1e293b; }

        /* Dark Mode Pro */
        [data-theme="dark"] .msf-pro-panel { background: linear-gradient(135deg, #1a0f05 0%, #2a1a0a 100%); }
        [data-theme="dark"] .msf-pro-panel .msf-panel-title { color: #fb923c; }
        [data-theme="dark"] .msf-kpi-value { color: #fb923c; }
        [data-theme="dark"] .msf-kpi-label { color: #94a3b8; }
        [data-theme="dark"] .msf-kpi-sublabel { color: #64748b; }
        [data-theme="dark"] .msf-kpi-card { background: rgba(249,115,22,0.08); border-color: rgba(249,115,22,0.15); }
        [data-theme="dark"] .msf-narrative { background: rgba(249,115,22,0.06); }
        [data-theme="dark"] .msf-narrative h4 { color: #fb923c; }
        [data-theme="dark"] .msf-narrative p { color: #cbd5e1; }
        [data-theme="dark"] .msf-narrative p strong { color: #fb923c; }
        [data-theme="dark"] .msf-gate-overlay { background: rgba(15,10,5,0.88); }
        [data-theme="dark"] .msf-login-box { background: #0f172a; }
        [data-theme="dark"] .msf-chart-container { background: rgba(0,0,0,0.3); }
        [data-theme="dark"] .msf-cta-block { background: linear-gradient(135deg, rgba(249,115,22,0.12), rgba(249,115,22,0.04)); }

        /* Responsive Pro */
        @media (max-width: 768px) {
            .msf-toolbar-row { flex-direction: column; align-items: stretch; }
            .msf-toolbar-actions { justify-content: center; }
            .msf-kpi-grid { grid-template-columns: repeat(2, 1fr); }
            .msf-pro-inputs .calc-grid { grid-template-columns: 1fr; }
            .msf-cta-block { padding: 1.25rem 1rem; }
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">
                <img loading="lazy" src="assets/profile-photo.jpg" alt="Bagus Dwi Permana" class="nav-avatar">
            </a>
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link">Home</a></li>
                <li class="nav-dropdown">
                    <a href="datacenter-solutions.html" class="nav-link">DC Solutions <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg></a>
                    <ul class="dropdown-menu">
                        <li><a href="datacenter-solutions.html" style="color: #06b6d4; font-weight: 600;">DC Solutions Hub</a></li>
                        <li style="border-bottom: 1px solid rgba(255,255,255,0.1); margin: 4px 0;"></li>
                        <li><a href="datahallAI.html" style="color: #8b5cf6;">DC AI/HPC</a></li>
                        <li><a href="dc-conventional.html">DC Conventional</a></li>
                        <li style="border-bottom: 1px solid rgba(255,255,255,0.1); margin: 4px 0;"></li>
                        <li><a href="capex-calculator.html" style="color: #f59e0b;">CAPEX Calculator</a></li>
                        <li><a href="opex-calculator.html" style="color: #10b981;">OPEX Calculator</a></li>
                    </ul>
                </li>
                <li><a href="index.html#metrics" class="nav-link">Results</a></li>
                <li><a href="index.html#case-studies" class="nav-link">Case Studies</a></li>
                <li><a href="articles.html" class="nav-link">Articles</a></li>
                <li><a href="index.html#faq" class="nav-link">FAQ</a></li>
                <li><a href="index.html#contact" class="nav-link">Contact</a></li>
            </ul>
            <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode" title="Toggle dark/light mode">
                <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
                <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
            </button>
            <div class="hamburger"><span class="bar"></span><span class="bar"></span><span class="bar"></span></div>
        </div>
    </nav>

    <main id="main-content">
    <!-- Scroll Progress Bar -->
    <div class="progress-bar" id="progressBar" style="width:0%"></div>

    <section class="article-hero">
        <div class="container">
            <a href="articles.html" class="back-link">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
                Back to Articles
            </a>
            <span class="rebellion-badge">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
                Multi-Perspective Investigation
            </span>
            <span class="article-category">Industry Analysis</span>
            <h1 class="article-title">The <span class="highlight">$64 Billion</span> Rebellion: Why Communities Worldwide Are Fighting Data Centers</h1>
            <p class="article-subtitle">142 activist groups across 24 states. Malaysia's first-ever DC protest. $17/month bill increases. 9,000 diesel generators. The global backlash is here &mdash; and both sides have valid arguments. An insider's multi-perspective analysis.</p>

            <div class="hero-stats">
                <div class="hero-stat">
                    <div class="stat-num" data-target="64" data-prefix="$" data-suffix="B">$0B</div>
                    <div class="stat-label">Projects Blocked</div>
                </div>
                <div class="hero-stat">
                    <div class="stat-num" data-target="142" data-prefix="" data-suffix="">0</div>
                    <div class="stat-label">Activist Groups</div>
                </div>
                <div class="hero-stat">
                    <div class="stat-num" data-target="24" data-prefix="" data-suffix=" States">0</div>
                    <div class="stat-label">US States Active</div>
                </div>
                <div class="hero-stat">
                    <div class="stat-num" data-target="25" data-prefix="" data-suffix="x" style="background: linear-gradient(135deg, #34d399, #60a5fa); -webkit-background-clip:text; background-clip:text;">0x</div>
                    <div class="stat-label">Cancellations in 2025</div>
                </div>
            </div>

            <div class="article-meta">
                <span class="article-meta-item">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                    35 min read
                </span>
                <span class="article-meta-item">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                    February 14, 2026
                </span>
                <span class="article-meta-item">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                    Bagus Dwi Permana
                </span>
            </div>

            <a href="#calculator" class="jump-to-calc">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="4" y="2" width="16" height="20" rx="2"/><line x1="8" y1="6" x2="16" y2="6"/><line x1="8" y1="10" x2="10" y2="10"/><line x1="14" y1="10" x2="16" y2="10"/><line x1="8" y1="14" x2="10" y2="14"/><line x1="14" y1="14" x2="16" y2="14"/><line x1="8" y1="18" x2="16" y2="18"/></svg>
                Try the Community Impact Calculator
            </a>
        </div>
    </section>

    <article class="article-content">
        <div class="container">
            <div class="article-body">

                <!-- Cover Infographic -->
                <div style="margin: -1rem 0 2rem; border-radius: 12px; overflow: hidden; box-shadow: 0 8px 32px rgba(0,0,0,0.12);">
                    <img src="assets/article-14-infographic.jpg" alt="The $64 Billion Rebellion — Balancing Data Center Growth with Community Impact: $64B projects, 142 groups, 5.7x water oversubscription, $26:$1 revenue ratio" style="width:100%; height:auto; display:block;" loading="eager">
                </div>

                <!-- Executive Summary -->
                <div class="exec-summary">
                    <h3>&#9733; Key Findings at a Glance</h3>
                    <div class="takeaway"><div class="dot" style="background:#f87171;"></div><p><strong>$64 billion</strong> in US data center projects blocked or delayed by community opposition across 24 states &mdash; project cancellations quadrupled from 6 (2024) to 25 (2025)</p></div>
                    <div class="takeaway"><div class="dot" style="background:#fbbf24;"></div><p><strong>Malaysia's first DC protest</strong> erupted February 7, 2026 in Johor &mdash; 50+ residents against a Chinese-owned facility, with water demand 5.7x exceeding supply</p></div>
                    <div class="takeaway"><div class="dot" style="background:#fb923c;"></div><p><strong>Carnegie Mellon projects 25% bill increases</strong> in Northern Virginia &mdash; Baltimore residents already saw $17/month spikes; data centers were 40% of PJM's $16.4B capacity auction cost</p></div>
                    <div class="takeaway"><div class="dot" style="background:#34d399;"></div><p><strong>The industry defense is real:</strong> Loudoun County earns $26 per $1 of services from DCs &mdash; without DC investment, US GDP growth would have been 0.1% in H1 2025</p></div>
                    <div class="takeaway"><div class="dot" style="background:#60a5fa;"></div><p><strong>Six US states</strong> introduced DC moratorium bills; Singapore, Ireland, and Netherlands pioneered regulatory frameworks &mdash; <a href="#calculator" style="color:#60a5fa;">scroll to calculator</a> to assess your community's net impact</p></div>
                    <div style="display:flex; gap:1rem; margin-top:1rem; flex-wrap:wrap; font-size:0.8rem; color:#94a3b8;">
                        <span>&#128214; 12,000+ words</span>
                        <span>&#128202; Interactive Calculator</span>
                        <span>&#128218; 40+ Sources</span>
                    </div>
                </div>

                <section class="toc-section">
                    <div class="toc-container">
                        <h2 class="toc-title">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="8" y1="6" x2="21" y2="6"></line>
                                <line x1="8" y1="12" x2="21" y2="12"></line>
                                <line x1="8" y1="18" x2="21" y2="18"></line>
                                <line x1="3" y1="6" x2="3.01" y2="6"></line>
                                <line x1="3" y1="12" x2="3.01" y2="12"></line>
                                <line x1="3" y1="18" x2="3.01" y2="18"></line>
                            </svg>
                            Table of Contents
                        </h2>
                        <div class="toc-grid">
                            <a href="#section-1" class="toc-item">
                                <div class="toc-item-number">SECTION 1</div>
                                <div class="toc-item-title">The Opening Salvo: From Virginia to Johor</div>
                            </a>
                            <a href="#section-2" class="toc-item">
                                <div class="toc-item-number">SECTION 2</div>
                                <div class="toc-item-title">Follow the Money: The Electricity Bill Crisis</div>
                            </a>
                            <a href="#section-3" class="toc-item">
                                <div class="toc-item-number">SECTION 3</div>
                                <div class="toc-item-title">Water Wars: From Oregon to Johor</div>
                            </a>
                            <a href="#section-4" class="toc-item">
                                <div class="toc-item-number">SECTION 4</div>
                                <div class="toc-item-title">The Air We Breathe: Diesel and Health</div>
                            </a>
                            <a href="#section-5" class="toc-item">
                                <div class="toc-item-number">SECTION 5</div>
                                <div class="toc-item-title">The Industry's Defense</div>
                            </a>
                            <a href="#section-6" class="toc-item">
                                <div class="toc-item-number">SECTION 6</div>
                                <div class="toc-item-title">The Government Response: A Global Moratorium Wave</div>
                            </a>
                            <a href="#section-7" class="toc-item">
                                <div class="toc-item-number">SECTION 7</div>
                                <div class="toc-item-title">Southeast Asia: The Next Frontier</div>
                            </a>
                            <a href="#section-8" class="toc-item">
                                <div class="toc-item-number">SECTION 8</div>
                                <div class="toc-item-title">The Path Forward: Coexistence Models</div>
                            </a>
                            <a href="#calculator" class="toc-item toc-calculator">
                                <div class="toc-item-number">SECTION 9 <span class="toc-calc-badge"><i class="fas fa-calculator" style="font-size:0.5rem;"></i> Interactive</span></div>
                                <div class="toc-item-title">Community Impact & Staffing Calculator</div>
                            </a>
                        </div>
                    </div>
                </section>

                <h2 id="section-1">1.0 The Opening Salvo: From Virginia to Johor</h2>

                <p>On February 7, 2026, something unprecedented happened in Southeast Asia. Fifty residents of Gelang Patah, a district in Johor, Malaysia, gathered outside a construction site less than one kilometer from their homes. Their target: a 38-acre data center being built by <strong>Zdata Technologies</strong>, a Chinese-owned developer. Police watched as protesters held signs demanding answers about dust pollution, water scarcity, and the facility's impact on their daily lives.</p>

                <div class="viral-quote">
                    <p>The developer did not come out to meet them.</p>
                    <span class="quote-source">Gelang Patah, Johor &mdash; February 7, 2026</span>
                </div>

                <p>This was <strong>Malaysia's first-ever public protest against a data center</strong>. But it was not an isolated event. It was the latest eruption in a global rebellion that has already blocked or delayed <strong>$64 billion</strong> worth of projects in the United States alone.</p>

                <div class="alert-box">
                    <h4>&#9888; The Scale of Opposition</h4>
                    <p>Between 2023 and mid-2025, community opposition in the US:</p>
                    <p><span class="stat-highlight">$18 billion</span> in projects blocked outright</p>
                    <p><span class="stat-highlight">$46 billion</span> in projects delayed over two years</p>
                    <p><span class="stat-highlight">142 activist groups</span> across <span class="stat-highlight">24 states</span></p>
                    <p><span class="stat-highlight">25 project cancellations</span> in 2025 alone &mdash; up from 6 in 2024 and 2 in 2023</p>
                    <p style="font-size:0.75rem; color:#94a3b8; margin-top:0.75rem;">Source: Data Center Watch, 2025; Heatmap News, 2025</p>
                </div>

                <p>For those of us who work inside data centers &mdash; maintaining generators, managing cooling systems, coordinating with grid operators &mdash; this backlash is not abstract. It is personal. The communities organizing against our industry have legitimate grievances. But the industry also provides genuine economic value that opponents rarely acknowledge. This article examines <strong>both sides</strong>, with data.</p>

                <h3>1.1 The Johor Water Crisis</h3>

                <p>The Johor protest did not emerge from nowhere. Malaysia's southern state hosts <strong>47 data centers</strong> built or under construction, with dozens more planned. The data center applications across three Malaysian states have requested <strong>808 million litres of water per day</strong> &mdash; but the available supply capacity is only <strong>142 million litres per day</strong>. That is a <strong>5.7x oversubscription</strong>.</p>

                <div class="comparison-grid">
                    <div class="comparison-card negative">
                        <h5>Water Demand</h5>
                        <div class="value">808M</div>
                        <div class="unit">litres/day requested by DCs</div>
                    </div>
                    <div class="comparison-card positive">
                        <h5>Water Supply</h5>
                        <div class="value">142M</div>
                        <div class="unit">litres/day available capacity</div>
                    </div>
                    <div class="comparison-card negative">
                        <h5>Gap Ratio</h5>
                        <div class="value">5.7x</div>
                        <div class="unit">oversubscribed</div>
                    </div>
                </div>

                <p>In November 2025, Johor <strong>stopped approving Tier 1 and Tier 2 data centers</strong> entirely, citing water overuse. Investors were told to halt water-cooled expansion projects until <strong>mid-2027</strong>. Some operators, unable to wait, reportedly began purchasing water via tanker trucks &mdash; a crisis indicator in any infrastructure sector.</p>

                <h3>1.2 The American Parallel</h3>

                <p>The Johor protest mirrors patterns that emerged in the United States years earlier. In <strong>Warrenton, Virginia</strong>, voters replaced their entire town council and voted 6-0 to eliminate all data center zoning. In <strong>Louisa County</strong>, AWS withdrew a 7.2 million square foot proposal after community mobilization under the banner "Don't Loudoun my Louisa." In <strong>Chandler, Arizona</strong>, the city council unanimously rejected a $2.5 billion data center despite lobbying from former Senator Kyrsten Sinema.</p>

                <div class="data-table-container">
                    <table class="data-table">
                        <thead>
                            <tr><th>Location</th><th>Year</th><th>Outcome</th><th>Value</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>Chandler, AZ</td><td>Dec 2025</td><td>Rejected 7-0</td><td>$2.5B</td></tr>
                            <tr><td>Tucson, AZ (Amazon)</td><td>Aug 2025</td><td>Rejected unanimously</td><td>600MW campus</td></tr>
                            <tr><td>Louisa County, VA (AWS)</td><td>Jul 2025</td><td>AWS withdrew</td><td>7.2M sq ft</td></tr>
                            <tr><td>Goodyear/Buckeye, AZ</td><td>May 2024</td><td>$14B withdrawn</td><td>$14B</td></tr>
                            <tr><td>Warrenton, VA</td><td>2024-25</td><td>All DC zoning eliminated</td><td>$39M site</td></tr>
                            <tr><td>New Orleans, LA</td><td>Jan 2026</td><td>1-year construction ban</td><td>Citywide</td></tr>
                        </tbody>
                    </table>
                    <p class="table-source">Sources: Data Center Watch, Virginia Mercury, DCD, AZ Family, Axios</p>
                </div>

                <h2 id="section-2">2.0 Follow the Money: The Electricity Bill Crisis</h2>

                <span class="perspective-tab community">Community Perspective</span>

                <p>The single most politically explosive issue is electricity costs. When your neighbor's power bill rises while the data center next door negotiates below-market rates, the math becomes personal.</p>

                <h3>2.1 The Carnegie Mellon Projection</h3>

                <p>A joint study by Carnegie Mellon University and NC State University projected that data center and cryptocurrency mining electricity demand will grow <strong>350% by 2030</strong>. The impact on consumer bills:</p>

                <ul>
                    <li><strong>National average:</strong> 8% increase by 2030</li>
                    <li><strong>Northern Virginia:</strong> Exceeding <strong>25%</strong></li>
                    <li><strong>Baltimore:</strong> $17/month increase already; $70/month projected by 2028</li>
                    <li><strong>Dominion Energy territory:</strong> $255/month residential bill projected by 2035</li>
                </ul>

                <h3>2.2 The PJM Capacity Crisis</h3>

                <p>The PJM Interconnection &mdash; the grid operator serving 65 million people across 13 states &mdash; held its December 2025 capacity auction. The results were devastating for ratepayers:</p>

                <div class="comparison-grid">
                    <div class="comparison-card negative">
                        <h5>Total Auction Cost</h5>
                        <div class="value">$16.4B</div>
                        <div class="unit">for 12-month capacity</div>
                    </div>
                    <div class="comparison-card negative">
                        <h5>DC Share</h5>
                        <div class="value">40%</div>
                        <div class="unit">= $6.5 billion from DCs</div>
                    </div>
                    <div class="comparison-card negative">
                        <h5>3-Auction Total</h5>
                        <div class="value">$21.3B</div>
                        <div class="unit">45% attributable to DCs</div>
                    </div>
                    <div class="comparison-card negative">
                        <h5>Reserve Margin</h5>
                        <div class="value">14.8%</div>
                        <div class="unit">vs. 20% reliability target</div>
                    </div>
                </div>

                <p>PJM's Independent Market Monitor took the extraordinary step of filing an <strong>emergency complaint with FERC</strong>, seeking to block grid operators from connecting new data center loads until supply reliability can be guaranteed. Without action, the region may fall below reliability standards by <strong>June 2027</strong>.</p>

                <h3>2.3 The Cross-Subsidy Problem</h3>

                <p>Harvard's Electricity Law Initiative published a landmark paper in March 2025 identifying three mechanisms through which data center costs are shifted to residential customers:</p>

                <ol>
                    <li><strong>Secret special contracts:</strong> Utilities negotiate discounted bilateral rates with DC operators through opaque regulatory processes. When the rate is below the utility's cost to serve, other ratepayers absorb the difference.</li>
                    <li><strong>Transmission cost allocation:</strong> PJM approved $5 billion in new interstate transmission projects largely for data centers. Maryland utilities will pay ~$500 million of this, passed to residential bills.</li>
                    <li><strong>Colocation arrangements:</strong> Behind-the-meter colocation between DCs and power plants can increase wholesale prices for all other customers.</li>
                </ol>

                <div class="viral-quote">
                    <p>Residential electricity prices rose 25% from 2020-2024. Industrial prices fell 2%. In DC-heavy regions, wholesale costs surged 267% in five years.</p>
                    <span class="quote-source">Harvard Electricity Law Initiative, March 2025</span>
                </div>

                <h3>2.4 The Political Consequences</h3>

                <div class="policy-box">
                    <h4>&#127959; Electricity Bills Are Now an Electoral Force</h4>
                    <p><strong>Virginia 2025:</strong> Democrat Abigail Spanberger won the governorship by 14 points on a platform that data centers must "pay their fair share." <strong>February 2026:</strong> Senators Hawley (R) and Blumenthal (D) introduced the bipartisan <strong>GRID Act</strong> &mdash; the first federal bill to prevent DC power usage from raising consumer bills. <strong>February 2026:</strong> Anthropic announced it will cover 100% of consumer electricity price increases from its data centers.</p>
                </div>

                <h2 id="section-3">3.0 Water Wars: From Oregon to Johor</h2>

                <p>Water is the most potent community rallying point. Cited in over 40% of contested projects, water scarcity creates visceral, non-negotiable opposition.</p>

                <h3>3.1 The Dalles, Oregon</h3>

                <p>In 2021, Google's data center complex in The Dalles consumed <strong>355 million gallons</strong> of water &mdash; <strong>29% of the city's total supply</strong> &mdash; triple its consumption from a few years earlier. The local water table had dropped 15 feet in 15 years. When The Oregonian newspaper sought water usage data, Google paid <strong>$100,000</strong> to fund the city's lawsuit against the newspaper to suppress the figures. The suit was ultimately dropped, revealing the data.</p>

                <h3>3.2 Tucson, Arizona</h3>

                <p>Amazon's Project Blue would have consumed ~2,000 acre-feet of water annually, making it Tucson Water's <strong>single largest customer</strong>. The city council unanimously rejected it. Amazon later withdrew entirely.</p>

                <h3>3.3 The Technical Reality</h3>

                <p>A large data center can consume up to <strong>5 million gallons per day</strong> &mdash; equivalent to a town of 10,000 to 50,000 people. A single megawatt of traditional cooling requires approximately <strong>26 million litres per year</strong>. Over <strong>40%</strong> of planned and existing US data centers are located in areas classified as "high" or "extremely high" water scarcity.</p>

                <h2 id="section-4">4.0 The Air We Breathe: Diesel and Health</h2>

                <div class="viral-quote">
                    <p>Behind every "100% renewable energy" claim from a hyperscaler sits a fleet of diesel backup generators.</p>
                    <span class="quote-source">From someone who has operated them for 12+ years</span>
                </div>

                <p>As someone who has operated and maintained these generators for over a decade, I can tell you: the gap between marketing and operational reality is significant.</p>

                <h3>4.1 The Virginia Diesel Crisis</h3>

                <p>Northern Virginia alone has approximately <strong>9,000 permitted Tier II diesel generators</strong> with combined capacity exceeding <strong>11 GW</strong> &mdash; more than Dominion Energy's entire natural gas fleet. The emissions trajectory:</p>

                <div class="comparison-grid">
                    <div class="comparison-card negative">
                        <h5>CO Emissions Growth</h5>
                        <div class="value">+196%</div>
                        <div class="unit">2015-2023</div>
                    </div>
                    <div class="comparison-card negative">
                        <h5>NOx Emissions Growth</h5>
                        <div class="value">+111%</div>
                        <div class="unit">2015-2023</div>
                    </div>
                    <div class="comparison-card negative">
                        <h5>PM2.5 Growth</h5>
                        <div class="value">+139%</div>
                        <div class="unit">2015-2023</div>
                    </div>
                </div>

                <p>Virginia's JLARC found that in a worst-case scenario, these generators could release <strong>9,000 tons of nitrogen oxides</strong> &mdash; equal to half of all annual NOx emissions in Northern Virginia from all sources combined. VCU researchers confirmed that Northern Virginia DC air pollution now <strong>rivals power plant emissions</strong>.</p>

                <h3>4.2 The Health Data</h3>

                <p>UC Riverside and Caltech researchers projected <strong>1,300 premature deaths per year by 2030</strong> from DC-related air pollution, with total annual public health costs of approximately <strong>$20 billion</strong>. In Northern Virginia specifically, diesel generator operations are associated with an estimated <strong>14,000 asthma symptom cases per year</strong>.</p>

                <div class="nuance-box">
                    <h4>&#9888; Important Caveat</h4>
                    <p>The UCR/Caltech study is a modeling exercise (arXiv preprint), not a field epidemiological study. No peer-reviewed, field-based study directly measuring health outcomes in communities adjacent to DC clusters currently exists. This is a critical research gap.</p>
                </div>

                <h3>4.3 The Noise Factor</h3>

                <p>In Great Oaks subdivision near Manassas, Virginia, residents live <strong>400 feet from Amazon data centers</strong>. Post-mitigation noise levels measured <strong>62 dB</strong> &mdash; well above the proposed local limits of 52 dB daytime and 47 dB nighttime. The WHO recommends nighttime noise below 40 dB for healthy sleep. Residents describe the constant hum as "catastrophic."</p>

                <h2 id="section-5">5.0 The Industry's Defense</h2>

                <span class="perspective-tab industry">Industry Perspective</span>

                <p>The community arguments are real. But so is the counter-case. As an industry insider who sees both sides, I must present the economic evidence fairly.</p>

                <h3>5.1 The GDP Argument</h3>

                <p>Harvard economist Jason Furman's analysis provides the industry's single most powerful statistic:</p>

                <div class="viral-quote">
                    <p>Without data centers, GDP growth was 0.1% in the first half of 2025.</p>
                    <span class="quote-source">Jason Furman, Harvard Economist &mdash; Fortune, October 2025</span>
                </div>

                <p>Information processing equipment and software represent 4% of GDP but were responsible for <strong>92% of GDP growth</strong> in H1 2025. Data center-linked spending added approximately 100 basis points to US real GDP growth. The US economy has become <strong>structurally dependent</strong> on data center investment as its primary growth engine.</p>

                <h3>5.2 The Loudoun County Model</h3>

                <p>Loudoun County, Virginia &mdash; home to "Data Center Alley" &mdash; remains the industry's strongest fiscal argument:</p>

                <div class="comparison-grid">
                    <div class="comparison-card positive">
                        <h5>DC Tax Revenue</h5>
                        <div class="value">$900M+</div>
                        <div class="unit">annual (FY2025)</div>
                    </div>
                    <div class="comparison-card positive">
                        <h5>Revenue Ratio</h5>
                        <div class="value">$26:$1</div>
                        <div class="unit">revenue per $ of services</div>
                    </div>
                    <div class="comparison-card positive">
                        <h5>Land Used</h5>
                        <div class="value">&lt;3%</div>
                        <div class="unit">of county land area</div>
                    </div>
                    <div class="comparison-card positive">
                        <h5>Property Value</h5>
                        <div class="value">$42.3B</div>
                        <div class="unit">assessed DC value (2025)</div>
                    </div>
                </div>

                <p>That $26:$1 ratio is <strong>20-25x more fiscally efficient</strong> than residential development. Data centers effectively subsidize residential services in Loudoun County, enabling lower property taxes for residents.</p>

                <h3>5.3 The Renewable Energy Arsenal</h3>

                <p>Data center operators accounted for <strong>43% of all clean energy PPAs</strong> signed in 2024. Total DC clean energy procurement exceeded 17 GW through direct third-party PPAs.</p>

                <ul>
                    <li><strong>Amazon:</strong> 20+ GW globally &mdash; world's largest corporate renewable buyer for 5 consecutive years</li>
                    <li><strong>Microsoft:</strong> 10.5 GW new capacity contracted (2026-2030)</li>
                    <li><strong>Meta:</strong> 15+ GW wind/solar; 1.59 billion gallons of water restored in 2024</li>
                    <li><strong>Google:</strong> 50+ PPAs worldwide; pursuing 24/7 carbon-free energy matching</li>
                </ul>

                <div class="balance-box">
                    <h4>&#9989; The Industry Argument</h4>
                    <p>Without hyperscaler creditworthiness to underwrite long-term PPAs, a significant portion of planned wind and solar capacity would be unfinanceable. The data center industry argues it is <strong>accelerating</strong> the energy transition, not retarding it. However, PPA procurement does not equal real-time consumption &mdash; temporal and geographic matching remains imperfect.</p>
                </div>

                <h3>5.4 The Tax Incentive Problem</h3>

                <p>The industry's fiscal story has a dark side. Virginia's data center tax exemptions cost the state <strong>$1.6 billion in FY2025</strong> &mdash; a 118% increase over FY2023. Nationally, 37 states have granted nearly <strong>$6 billion in DC exemptions</strong> over five years. States that compute ROI find they <strong>lose 52-70 cents for every dollar</strong> spent on DC tax exemptions.</p>

                <p>The most extreme case: Genesee County, New York granted $801 million in tax breaks to Stream Data Centers for 125 jobs &mdash; <strong>$6.4 million per permanent job</strong>.</p>

                <div class="nuance-box">
                    <h4>&#9878; The Nuance</h4>
                    <p>At the <strong>local level</strong>, DCs are often significant net fiscal contributors (Loudoun's $26:1 ratio). At the <strong>state level</strong>, tax exemptions produce negative returns ($0.48 per dollar in Virginia). The net impact depends entirely on whether jurisdictions negotiate effectively or simply compete by offering the largest subsidies.</p>
                </div>

                <h2 id="section-6">6.0 The Government Response: A Global Moratorium Wave</h2>

                <span class="perspective-tab government">Government Perspective</span>

                <p>Governments are no longer rolling out unconditional welcome mats. From Singapore to Amsterdam, a new generation of regulatory frameworks is emerging.</p>

                <h3>6.1 The Global Moratorium Map</h3>

                <div class="data-table-container">
                    <table class="data-table">
                        <thead>
                            <tr><th>Jurisdiction</th><th>Action</th><th>Key Provision</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>Singapore</td><td>2019-2022 moratorium</td><td>Competitive allocation (DC-CFA); PUE &le;1.25; 50% green energy</td></tr>
                            <tr><td>Ireland</td><td>2021-2025 connection freeze</td><td>80% on-site renewable requirement; must generate power back to grid</td></tr>
                            <tr><td>Netherlands</td><td>No DCs until 2030</td><td>Amsterdam banned hyperscale; Liander warns DCs could use 37% of city energy</td></tr>
                            <tr><td>Johor, Malaysia</td><td>Nov 2025 Tier 1/2 ban</td><td>Water-cooled expansion halted until mid-2027</td></tr>
                            <tr><td>New York</td><td>3-year moratorium proposed</td><td>S9144: No permits for DCs &gt;20 MW; strongest-in-nation bill</td></tr>
                            <tr><td>New Orleans</td><td>1-year ban (Jan 2026)</td><td>Unanimous 6-0 city council vote</td></tr>
                            <tr><td>Loudoun County, VA</td><td>Ended by-right zoning</td><td>All DC applications now require public hearing (March 2025)</td></tr>
                            <tr><td>Georgia (12 counties)</td><td>Multiple moratoriums</td><td>Wave of county-level bans (Sept-Oct 2025)</td></tr>
                        </tbody>
                    </table>
                    <p class="table-source">Sources: IMDA, CRU Ireland, NL Times, SCMP, PYMNTS, Axios, Loudoun Now, GPB</p>
                </div>

                <p>In total, <strong>six US states</strong> have now introduced DC moratorium bills. Local moratoriums are active in <strong>at least 14 states</strong>. And <strong>230+ environmental organizations</strong> signed a letter calling for a full nationwide moratorium in December 2025.</p>

                <h3>6.2 Virginia's 2026 Legislative Session</h3>

                <p>Virginia &mdash; the world's data center capital &mdash; is now ground zero for regulatory reform:</p>

                <ul>
                    <li><strong>SB 253 (Sen. Lucas):</strong> Would shift energy costs onto DCs and reduce residential rates by ~3.4% ($5.52/month); DC rates would increase ~15.8%</li>
                    <li><strong>HB 503 (Del. McAuliff):</strong> Deny requests to charge ratepayers for DC-specific transmission infrastructure</li>
                    <li><strong>HB 155 (Del. Thomas):</strong> Require SCC review of all facilities &gt;25 MW before grid connection</li>
                    <li><strong>HB 154:</strong> Public reporting requirements when emergency generators are in use</li>
                </ul>

                <h3>6.3 The Singapore Model</h3>

                <div class="policy-box">
                    <h4>&#127760; The Gold Standard for DC Regulation</h4>
                    <p>Singapore proved that sustainability requirements and DC growth are <strong>not mutually exclusive</strong>. By imposing a moratorium (2019-2022), then reopening with competitive allocation, the government created scarcity that forced operators to compete on sustainability metrics (PUE &le;1.25, 50%+ green energy, economic contribution). The December 2025 DC-CFA2 framework is now the most selective DC permitting regime in the world. The lesson: <strong>constrained supply creates pricing power for sustainability mandates</strong>.</p>
                </div>

                <h2 id="section-7">7.0 Southeast Asia: The Next Frontier</h2>

                <p>The pattern migrating from Virginia to Johor is the central story of this article. As someone based in Southeast Asia with 12+ years in data center operations, I have watched this movie play out in the United States. Now it is playing in my backyard.</p>

                <h3>7.1 The Investment Scale</h3>

                <p>The SEA data center market is projected to grow from <strong>$13.71 billion (2024)</strong> to <strong>$30.47 billion by 2030</strong>. Hyperscaler commitments are staggering:</p>

                <div class="data-table-container">
                    <table class="data-table">
                        <thead>
                            <tr><th>Country</th><th>Key Investments</th><th>Projected Impact</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>Malaysia</td><td>AWS $6.2B, Google $2B, Microsoft $2.2B</td><td>~31,000 jobs/year by 2030</td></tr>
                            <tr><td>Indonesia</td><td>AWS $5B (15yr), Microsoft $1.7B</td><td>24,700 jobs annually (AWS alone)</td></tr>
                            <tr><td>Thailand</td><td>$3.1B BOI-approved; Google $1B</td><td>8 years CIT exemption for high-efficiency DCs</td></tr>
                        </tbody>
                    </table>
                    <p class="table-source">Sources: AWS, Google, Microsoft, MIDA, BOI Thailand</p>
                </div>

                <h3>7.2 The Coming Challenges</h3>

                <p>What SEA has not yet reckoned with:</p>

                <ul>
                    <li><strong>Grid capacity:</strong> Indonesia's grid cannot reliably support hyperscale outside Java; 18-24 month high-voltage approval timelines in Jakarta</li>
                    <li><strong>Water stress:</strong> The Johor crisis is the canary. As more facilities come online, water conflicts will intensify across the region</li>
                    <li><strong>Electricity tariff pressure:</strong> Malaysia's TNB base tariff increased 13.6% effective July 2025; a 100MW facility faces $15-20M/year additional costs</li>
                    <li><strong>Community awareness:</strong> The Johor protest is the beginning, not the end. As construction dust settles near more homes in Bekasi, Nusajaya, and the Eastern Seaboard, organized resistance will follow</li>
                </ul>

                <h2 id="section-8">8.0 The Path Forward: Coexistence Models</h2>

                <span class="perspective-tab engineer">Engineer Perspective</span>

                <p>Neither blanket opposition nor uncritical acceptance serves anyone's interests. The evidence points toward specific, actionable frameworks for coexistence.</p>

                <h3>8.1 Microsoft's Community-First Initiative (January 2026)</h3>

                <p>On January 13, 2026, Microsoft announced the most comprehensive corporate response to community opposition to date:</p>

                <ul>
                    <li><strong>Reject all municipal tax breaks</strong> and pay full local property taxes</li>
                    <li><strong>Ensure DC electricity costs are not passed</strong> to residential customers</li>
                    <li><strong>40% water efficiency improvement</strong> by 2030; replenish more water than consumed</li>
                    <li><strong>Partnership with Building Trades Unions</strong> for apprenticeships and local hiring</li>
                    <li><strong>Public dashboards</strong> with real-time energy, water, and economic impact metrics</li>
                </ul>

                <p>By rejecting tax breaks and pledging to cover full electricity costs, Microsoft removes the two most politically toxic elements. Whether Amazon, Google, and Meta match these commitments is <strong>the critical question for 2026</strong>.</p>

                <h3>8.2 The Nordic Waste Heat Model</h3>

                <p>In Stockholm, data centers heat <strong>30,000 apartments</strong> through district heating integration. In Hamina, Finland, Google provides <strong>80% of local district heating demand</strong>. Microsoft's facility under construction in Espoo will create the <strong>world's largest waste heat recovery scheme</strong>, heating Finland's second-largest city.</p>

                <p>The model is structurally harder to replicate in tropical climates. But the principle &mdash; that waste heat is a community resource, not an externality &mdash; is transferable through other mechanisms such as industrial process heat, aquaculture, and greenhouse agriculture.</p>

                <h3>8.3 The Seven Principles</h3>

                <p>Drawing from all successful models globally, the evidence converges on seven principles for DC-community harmony:</p>

                <ol>
                    <li><strong>Early transparent engagement</strong> &mdash; secrecy and NDAs consistently backfire</li>
                    <li><strong>Binding Community Benefit Agreements</strong> with measurable commitments (Brookings framework)</li>
                    <li><strong>Electricity rate protection</strong> &mdash; operators pay full cost of power and grid upgrades</li>
                    <li><strong>Waste heat recovery</strong> or equivalent community energy contribution</li>
                    <li><strong>Net positive water</strong> &mdash; replenish more than consumed</li>
                    <li><strong>Workforce development pipelines</strong> for both construction and operations</li>
                    <li><strong>Competitive regulatory allocation</strong> &mdash; the Singapore model forces operators to compete on community value</li>
                </ol>

                <!-- CTA Teaser Block -->
                <div class="msf-cta-block">
                    <p class="msf-cta-headline"><i class="fas fa-bolt" style="margin-right:6px;"></i> Unlock Pro Staffing Optimization Analysis</p>
                    <p class="msf-cta-sub">Go beyond the Community Impact Score. Pro Mode adds Monte Carlo staffing demand simulation, financial engineering (Cost of Inaction), human factors analysis (burnout, fatigue, bus factor), and AI-generated executive dossier — all computed client-side.</p>
                    <a href="#calculator" class="msf-cta-btn">Open Pro Calculator</a>
                </div>

                <!-- INTERACTIVE CALCULATOR -->
                <div class="impact-calculator" id="calculator">
                    <h3 class="calc-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#f87171" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                        DC Community Impact Scorecard
                    </h3>
                    <p class="calc-subtitle">Should your community welcome or resist a data center? Adjust every parameter below to model the real impact. This calculator uses research-backed data from Carnegie Mellon, Harvard EELP, JLARC, NBER, and EPA methodologies.</p>

                    <!-- Mode Toggle Toolbar -->
                    <div class="msf-toolbar-row">
                        <div class="msf-mode-bar">
                            <div class="msf-mode-toggle">
                                <button class="msf-mode-btn active" id="msfFreeBtn" data-mode="free" onclick="msfSetMode('free')">Free Mode</button>
                                <button class="msf-mode-btn" id="msfProBtn" data-mode="pro" onclick="msfSetMode('pro')">Pro Analysis</button>
                            </div>
                        </div>
                        <div class="msf-toolbar-actions">
                            <button class="msf-toolbar-btn msf-btn-pdf" onclick="msfExportPDF()" style="display:none" id="msfPdfBtn"><i class="fas fa-file-pdf"></i> Export PDF</button>
                            <span class="msf-privacy-badge"><i class="fas fa-shield-alt"></i> Client-Side Only</span>
                        </div>
                    </div>

                    <div style="font-size:0.75rem; color:#94a3b8; margin-bottom:1.5rem; padding:0.75rem; background:rgba(255,255,255,0.05); border-radius:8px; border-left:3px solid #f87171;">
                        <strong style="color:#f87171;">How to use:</strong> Each input has a <span style="color:#f87171;">?</span> tooltip with real-world benchmarks. Hover (or tap on mobile) the red circle for context. Try comparing "worst case" vs "best practice" scenarios.
                    </div>

                    <!-- ROW 1: Facility Specs -->
                    <div style="font-size:0.7rem; color:#f87171; text-transform:uppercase; letter-spacing:2px; font-weight:700; margin-bottom:0.75rem; padding-bottom:0.5rem; border-bottom:1px solid rgba(248,113,113,0.2);">Facility Specifications</div>
                    <div class="calc-grid">
                        <div class="calc-input-group">
                            <label for="dcSize">IT Load (MW)
                                <span class="tooltip-trigger">?
                                    <div class="tooltip-content">
                                        <div class="tooltip-title">IT Load (MW)</div>
                                        <div class="tooltip-desc">Total IT power demand. This is the core load before PUE overhead. Most community conflicts involve 50-500 MW facilities.</div>
                                        <table class="tooltip-table">
                                            <tr><th>Category</th><th>Range</th></tr>
                                            <tr><td>Edge / Small</td><td>1-10 MW</td></tr>
                                            <tr><td>Enterprise</td><td>10-50 MW</td></tr>
                                            <tr><td>Hyperscale</td><td>50-300 MW</td></tr>
                                            <tr><td>Mega Campus</td><td>300-2,000 MW</td></tr>
                                        </table>
                                        <div class="tooltip-note">Amazon Louisa County (withdrawn): ~300 MW. Microsoft's Espoo, Finland: ~200 MW. The Johor Zdata facility: est. 30-50 MW.</div>
                                    </div>
                                </span>
                            </label>
                            <input type="number" id="dcSize" value="100" min="1" max="2000" step="10" onchange="calculateImpact()">
                        </div>
                        <div class="calc-input-group">
                            <label for="dcRegion">Region
                                <span class="tooltip-trigger">?
                                    <div class="tooltip-content">
                                        <div class="tooltip-title">Region / Location</div>
                                        <div class="tooltip-desc">Region determines electricity rates, grid capacity, water stress, tax structures, and labor costs. Each has unique community dynamics.</div>
                                        <table class="tooltip-table">
                                            <tr><th>Region</th><th>$/kWh</th></tr>
                                            <tr><td>Virginia</td><td>$0.12</td></tr>
                                            <tr><td>Georgia</td><td>$0.11</td></tr>
                                            <tr><td>Texas</td><td>$0.10</td></tr>
                                            <tr><td>Ireland</td><td>$0.22</td></tr>
                                            <tr><td>Malaysia</td><td>$0.08</td></tr>
                                            <tr><td>Indonesia</td><td>$0.07</td></tr>
                                            <tr><td>Thailand</td><td>$0.09</td></tr>
                                            <tr><td>Singapore</td><td>$0.18</td></tr>
                                        </table>
                                        <div class="tooltip-note">Water stress: Critical in Johor &amp; Singapore. High in Texas &amp; Indonesia. Medium in Virginia &amp; Thailand.</div>
                                    </div>
                                </span>
                            </label>
                            <select id="dcRegion" onchange="calculateImpact()">
                                <option value="virginia">Virginia, USA</option>
                                <option value="georgia">Georgia, USA</option>
                                <option value="texas">Texas, USA</option>
                                <option value="ireland">Ireland, EU</option>
                                <option value="malaysia" selected>Malaysia (Johor)</option>
                                <option value="indonesia">Indonesia</option>
                                <option value="thailand">Thailand</option>
                                <option value="singapore">Singapore</option>
                            </select>
                        </div>
                        <div class="calc-input-group">
                            <label for="pue">PUE Target
                                <span class="tooltip-trigger">?
                                    <div class="tooltip-content">
                                        <div class="tooltip-title">Power Usage Effectiveness</div>
                                        <div class="tooltip-desc">Total facility power / IT power. Lower = more efficient. Directly affects electricity demand, bills, and carbon footprint.</div>
                                        <table class="tooltip-table">
                                            <tr><th>Level</th><th>PUE</th></tr>
                                            <tr><td>Best-in-class (Google)</td><td>1.10</td></tr>
                                            <tr><td>Singapore DC-CFA2</td><td>&le;1.25</td></tr>
                                            <tr><td>Industry average</td><td>1.40</td></tr>
                                            <tr><td>Legacy / Tropical</td><td>1.60-2.0</td></tr>
                                        </table>
                                        <div class="tooltip-note">A 100MW DC at PUE 1.4 draws 140MW total. At PUE 1.1, only 110MW. That 30MW gap = $26M/yr at $0.10/kWh.</div>
                                    </div>
                                </span>
                            </label>
                            <select id="pue" onchange="calculateImpact()">
                                <option value="1.10">1.10 (Best-in-class)</option>
                                <option value="1.25">1.25 (Singapore standard)</option>
                                <option value="1.40" selected>1.40 (Industry average)</option>
                                <option value="1.60">1.60 (Legacy)</option>
                                <option value="1.80">1.80 (Poor / Tropical)</option>
                            </select>
                        </div>
                        <div class="calc-input-group">
                            <label for="constructionYears">Construction Phase (yrs)
                                <span class="tooltip-trigger">?
                                    <div class="tooltip-content">
                                        <div class="tooltip-title">Construction Duration</div>
                                        <div class="tooltip-desc">Years of active construction. Generates temporary jobs and construction-phase economic activity but also dust, noise, and traffic disruption.</div>
                                        <table class="tooltip-table">
                                            <tr><th>Scale</th><th>Duration</th></tr>
                                            <tr><td>10-50 MW</td><td>1-2 years</td></tr>
                                            <tr><td>50-200 MW</td><td>2-3 years</td></tr>
                                            <tr><td>200-500 MW campus</td><td>3-5 years</td></tr>
                                            <tr><td>Mega campus</td><td>5-10 years</td></tr>
                                        </table>
                                    </div>
                                </span>
                            </label>
                            <select id="constructionYears" onchange="calculateImpact()">
                                <option value="1">1 year</option>
                                <option value="2" selected>2 years</option>
                                <option value="3">3 years</option>
                                <option value="5">5 years (phased campus)</option>
                            </select>
                        </div>
                    </div>

                    <!-- ROW 2: Environmental Design -->
                    <div style="font-size:0.7rem; color:#34d399; text-transform:uppercase; letter-spacing:2px; font-weight:700; margin:1.5rem 0 0.75rem; padding-bottom:0.5rem; border-bottom:1px solid rgba(52,211,153,0.2);">Environmental Design</div>
                    <div class="calc-grid">
                        <div class="calc-input-group">
                            <label for="coolingType">Cooling System
                                <span class="tooltip-trigger">?
                                    <div class="tooltip-content">
                                        <div class="tooltip-title">Cooling Technology</div>
                                        <div class="tooltip-desc">Cooling type determines water consumption, noise levels, and energy efficiency. Water-cooled is cheapest but most resource-intensive.</div>
                                        <table class="tooltip-table">
                                            <tr><th>Type</th><th>Water (ML/MW/yr)</th></tr>
                                            <tr><td>Evaporative</td><td>26</td></tr>
                                            <tr><td>Hybrid</td><td>13</td></tr>
                                            <tr><td>Air-Cooled</td><td>0.5</td></tr>
                                            <tr><td>Direct Liquid</td><td>3</td></tr>
                                        </table>
                                        <div class="tooltip-note">Tucson rejected Amazon's evaporative-cooled 600MW campus. Singapore mandates air/liquid cooling. Johor banned water-cooled Tier 1-2 DCs.</div>
                                    </div>
                                </span>
                            </label>
                            <select id="coolingType" onchange="calculateImpact()">
                                <option value="evaporative">Evaporative (Water-Cooled)</option>
                                <option value="hybrid">Hybrid (Partial Water)</option>
                                <option value="aircooled">Air-Cooled (No Water)</option>
                                <option value="liquid">Direct Liquid Cooling</option>
                            </select>
                        </div>
                        <div class="calc-input-group">
                            <label for="renewablePct">Renewable Energy %
                                <span class="tooltip-trigger">?
                                    <div class="tooltip-content">
                                        <div class="tooltip-title">Renewable Energy Procurement</div>
                                        <div class="tooltip-desc">Percentage of electricity sourced via PPAs or on-site generation. Reduces carbon, grid strain (if matched), and community health impact from fossil generation.</div>
                                        <table class="tooltip-table">
                                            <tr><th>Level</th><th>Example</th></tr>
                                            <tr><td>100% 24/7 CFE</td><td>Google target</td></tr>
                                            <tr><td>80%</td><td>Ireland mandate</td></tr>
                                            <tr><td>50%</td><td>Singapore DC-CFA2</td></tr>
                                            <tr><td>0%</td><td>Grid-only (worst case)</td></tr>
                                        </table>
                                        <div class="tooltip-note">DCs signed 43% of all clean energy PPAs in 2024 (17+ GW). But PPA ≠ real-time consumption. Temporal matching is imperfect.</div>
                                    </div>
                                </span>
                            </label>
                            <select id="renewablePct" onchange="calculateImpact()">
                                <option value="100">100% (24/7 CFE)</option>
                                <option value="80">80% (Ireland standard)</option>
                                <option value="50" selected>50% (PPA matching)</option>
                                <option value="25">25% (Minimal effort)</option>
                                <option value="0">0% (Grid only)</option>
                            </select>
                        </div>
                        <div class="calc-input-group">
                            <label for="generators">Backup Generators
                                <span class="tooltip-trigger">?
                                    <div class="tooltip-content">
                                        <div class="tooltip-title">Emergency Backup Power</div>
                                        <div class="tooltip-desc">Backup generator type determines air quality, NOx/PM2.5 emissions, and health impact. Virginia has 9,000+ Tier II diesel generators with 11 GW combined capacity.</div>
                                        <table class="tooltip-table">
                                            <tr><th>Type</th><th>NOx Factor</th></tr>
                                            <tr><td>Battery/UPS only</td><td>Zero emissions</td></tr>
                                            <tr><td>HVO/Biodiesel</td><td>90% less NOx</td></tr>
                                            <tr><td>Standard Diesel</td><td>45 kg NOx/hr/2MW</td></tr>
                                            <tr><td>Heavy use Diesel</td><td>120+ kg NOx/hr</td></tr>
                                        </table>
                                        <div class="tooltip-note">UCR/Caltech: 1,300 premature deaths/yr by 2030 from DC air pollution. Virginia HB 503 proposes battery-first backup with diesel as last resort.</div>
                                    </div>
                                </span>
                            </label>
                            <select id="generators" onchange="calculateImpact()">
                                <option value="battery">Battery/UPS only (HB 503 model)</option>
                                <option value="hvo">HVO/Biodiesel (Tier IV)</option>
                                <option value="diesel" selected>Standard Diesel (Tier II)</option>
                                <option value="diesel_heavy">Diesel (Heavy/extended use)</option>
                            </select>
                        </div>
                        <div class="calc-input-group">
                            <label for="wasteHeat">Waste Heat Recovery
                                <span class="tooltip-trigger">?
                                    <div class="tooltip-content">
                                        <div class="tooltip-title">Waste Heat Utilization</div>
                                        <div class="tooltip-desc">Captured server waste heat repurposed for community benefit. Proven at scale in Nordic countries. EU EED Article 26.6 mandates waste heat recovery for DCs &gt;1 MW.</div>
                                        <table class="tooltip-table">
                                            <tr><th>Model</th><th>Impact</th></tr>
                                            <tr><td>District heating</td><td>30,000 apts (Stockholm)</td></tr>
                                            <tr><td>Google Hamina</td><td>80% of city heat</td></tr>
                                            <tr><td>Microsoft Espoo</td><td>Largest scheme ever</td></tr>
                                            <tr><td>None</td><td>Heat wasted to air</td></tr>
                                        </table>
                                        <div class="tooltip-note">Harder in tropical climates but applicable for industrial process heat, aquaculture, and agricultural drying.</div>
                                    </div>
                                </span>
                            </label>
                            <select id="wasteHeat" onchange="calculateImpact()">
                                <option value="district">District Heating (Nordic model)</option>
                                <option value="industrial">Industrial Process Heat</option>
                                <option value="partial">Partial Recovery</option>
                                <option value="none" selected>No Recovery (wasted)</option>
                            </select>
                        </div>
                    </div>

                    <!-- ROW 3: Policy & Engagement -->
                    <div style="font-size:0.7rem; color:#60a5fa; text-transform:uppercase; letter-spacing:2px; font-weight:700; margin:1.5rem 0 0.75rem; padding-bottom:0.5rem; border-bottom:1px solid rgba(96,165,250,0.2);">Policy &amp; Community Engagement</div>
                    <div class="calc-grid">
                        <div class="calc-input-group">
                            <label for="taxIncentive">Tax Incentive Level
                                <span class="tooltip-trigger">?
                                    <div class="tooltip-content">
                                        <div class="tooltip-title">Tax Incentive Structure</div>
                                        <div class="tooltip-desc">Tax exemptions reduce community revenue. Virginia lost $1.6B in FY2025 — earning only $0.48 per dollar exempted. Microsoft now rejects all tax breaks.</div>
                                        <table class="tooltip-table">
                                            <tr><th>Level</th><th>Revenue Retained</th></tr>
                                            <tr><td>No incentives</td><td>100%</td></tr>
                                            <tr><td>Moderate</td><td>60%</td></tr>
                                            <tr><td>Aggressive</td><td>30%</td></tr>
                                            <tr><td>Extreme</td><td>5% ($6.4M/job)</td></tr>
                                        </table>
                                        <div class="tooltip-note">Good Jobs First: States lose 52-70 cents per dollar of DC tax exemptions. Genesee County NY: $801M breaks for 125 jobs = $6.4M/job.</div>
                                    </div>
                                </span>
                            </label>
                            <select id="taxIncentive" onchange="calculateImpact()">
                                <option value="none">No incentives (Microsoft model)</option>
                                <option value="moderate" selected>Moderate exemption</option>
                                <option value="aggressive">Aggressive exemption</option>
                                <option value="extreme">Extreme ($6.4M/job level)</option>
                            </select>
                        </div>
                        <div class="calc-input-group">
                            <label for="cba">Community Engagement
                                <span class="tooltip-trigger">?
                                    <div class="tooltip-content">
                                        <div class="tooltip-title">Community Benefit Agreement</div>
                                        <div class="tooltip-desc">Level of formal community engagement. Brookings Institute recommends legally binding CBAs with quantified commitments on jobs, rates, water, noise, and transparency.</div>
                                        <table class="tooltip-table">
                                            <tr><th>Level</th><th>Features</th></tr>
                                            <tr><td>Comprehensive CBA</td><td>Binding, transparent, dashboards</td></tr>
                                            <tr><td>Basic</td><td>Public meetings, some commitments</td></tr>
                                            <tr><td>Stealth/None</td><td>NDAs, unnamed tenants, no input</td></tr>
                                        </table>
                                        <div class="tooltip-note">Projects with early transparency faced fewer delays. NDAs and secrecy consistently backfired — fueling suspicion and protest (Brookings 2025).</div>
                                    </div>
                                </span>
                            </label>
                            <select id="cba" onchange="calculateImpact()">
                                <option value="comprehensive">Comprehensive CBA (Brookings model)</option>
                                <option value="basic" selected>Basic engagement</option>
                                <option value="none">No engagement (stealth/NDA)</option>
                            </select>
                        </div>
                        <div class="calc-input-group">
                            <label for="rateProtection">Rate Protection
                                <span class="tooltip-trigger">?
                                    <div class="tooltip-content">
                                        <div class="tooltip-title">Electricity Rate Protection</div>
                                        <div class="tooltip-desc">Whether the DC operator commits to absorbing grid costs rather than passing them to residential ratepayers. The #1 political flashpoint.</div>
                                        <table class="tooltip-table">
                                            <tr><th>Model</th><th>Who Pays</th></tr>
                                            <tr><td>Full cost coverage</td><td>DC operator pays all</td></tr>
                                            <tr><td>Virginia GS-5</td><td>14-yr contract, 85% min</td></tr>
                                            <tr><td>Standard</td><td>Costs shared with ratepayers</td></tr>
                                            <tr><td>None</td><td>Full cross-subsidy</td></tr>
                                        </table>
                                        <div class="tooltip-note">Harvard EELP found 3 cross-subsidy mechanisms. Anthropic &amp; Microsoft now pledge 100% cost coverage. PJM auctions: DCs = 40% of $16.4B cost.</div>
                                    </div>
                                </span>
                            </label>
                            <select id="rateProtection" onchange="calculateImpact()">
                                <option value="full">Full cost coverage (MS/Anthropic)</option>
                                <option value="gs5">Virginia GS-5 rate class</option>
                                <option value="standard" selected>Standard (shared costs)</option>
                                <option value="none">No protection (cross-subsidy)</option>
                            </select>
                        </div>
                        <div class="calc-input-group">
                            <label for="waterReplenish">Water Strategy
                                <span class="tooltip-trigger">?
                                    <div class="tooltip-content">
                                        <div class="tooltip-title">Water Replenishment Strategy</div>
                                        <div class="tooltip-desc">Water is the #1 community rallying point — cited in 40%+ of contested projects. Strategy ranges from net positive to no mitigation.</div>
                                        <table class="tooltip-table">
                                            <tr><th>Strategy</th><th>Example</th></tr>
                                            <tr><td>Net positive</td><td>Microsoft: replenish &gt; consume</td></tr>
                                            <tr><td>Recycled/reclaimed</td><td>Singapore mandate</td></tr>
                                            <tr><td>Standard municipal</td><td>Most operators</td></tr>
                                            <tr><td>No mitigation</td><td>The Dalles, OR (29% supply)</td></tr>
                                        </table>
                                        <div class="tooltip-note">Johor water demand: 808M L/day requested vs 142M available (5.7x gap). Meta restored 1.59B gallons in 2024.</div>
                                    </div>
                                </span>
                            </label>
                            <select id="waterReplenish" onchange="calculateImpact()">
                                <option value="netpositive">Net Positive (MS model)</option>
                                <option value="recycled">Recycled/Reclaimed Water</option>
                                <option value="standard" selected>Standard Municipal Supply</option>
                                <option value="none">No Mitigation</option>
                            </select>
                        </div>
                    </div>

                    <button class="calc-button" onclick="calculateImpact()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                        Calculate Community Impact
                    </button>

                    <div class="calc-section-label cost">&#9660; Community Costs</div>
                    <div class="calc-results" id="costResults">
                        <div class="calc-result-item"><div class="label">Bill Increase</div><div class="value" id="billIncrease">--</div><div class="subtext">$/month per household</div></div>
                        <div class="calc-result-item"><div class="label">Water Use</div><div class="value" id="waterUse">--</div><div class="subtext">million litres/year</div></div>
                        <div class="calc-result-item"><div class="label">Water Equiv.</div><div class="value" id="waterHouseholds">--</div><div class="subtext">households equivalent</div></div>
                        <div class="calc-result-item"><div class="label">NOx Emissions</div><div class="value" id="dieselNox">--</div><div class="subtext">tons NOx/year</div></div>
                        <div class="calc-result-item"><div class="label">Health Cost</div><div class="value" id="healthCost">--</div><div class="subtext">annual public health burden</div></div>
                        <div class="calc-result-item"><div class="label">Noise at 400ft</div><div class="value" id="noiseLevel">--</div><div class="subtext">dB average</div></div>
                        <div class="calc-result-item"><div class="label">Grid Load</div><div class="value" id="gridLoad">--</div><div class="subtext">% of regional capacity</div></div>
                        <div class="calc-result-item"><div class="label">Tax Foregone</div><div class="value" id="taxForegone">--</div><div class="subtext">annual exemptions lost</div></div>
                    </div>

                    <div class="calc-section-label benefit">&#9650; Community Benefits</div>
                    <div class="calc-results" id="benefitResults">
                        <div class="calc-result-item"><div class="label">Tax Revenue</div><div class="value green" id="taxRevenue">--</div><div class="subtext">annual property/equipment tax</div></div>
                        <div class="calc-result-item"><div class="label">Construction Jobs</div><div class="value green" id="constJobs">--</div><div class="subtext">during build phase</div></div>
                        <div class="calc-result-item"><div class="label">Permanent Jobs</div><div class="value green" id="permJobs">--</div><div class="subtext">direct operations</div></div>
                        <div class="calc-result-item"><div class="label">Total Employment</div><div class="value green" id="totalJobs">--</div><div class="subtext">indirect + induced (2.5x)</div></div>
                        <div class="calc-result-item"><div class="label">RE Capacity</div><div class="value green" id="reCapacity">--</div><div class="subtext">MW clean energy PPAs</div></div>
                        <div class="calc-result-item"><div class="label">CO2 Avoided</div><div class="value green" id="co2Avoided">--</div><div class="subtext">tons/yr from renewables</div></div>
                        <div class="calc-result-item"><div class="label">Waste Heat Value</div><div class="value green" id="wasteHeatValue">--</div><div class="subtext">annual heat recovery</div></div>
                        <div class="calc-result-item"><div class="label">GDP Impact</div><div class="value green" id="gdpImpact">--</div><div class="subtext">annual economic contribution</div></div>
                    </div>

                    <div class="calc-section-label net">&#9670; Net Community Score</div>
                    <div class="net-score-display" id="netScoreDisplay">
                        <div class="score-label">Community Impact Score</div>
                        <div class="score-value" id="netScore">--</div>
                        <div class="score-verdict" id="netVerdict">Adjust parameters above to calculate</div>
                    </div>

                    <div style="margin-top:1.5rem; padding:1rem; background:rgba(255,255,255,0.05); border-radius:8px; font-size:0.7rem; color:#94a3b8; line-height:1.6;">
                        <strong style="color:#fbbf24;">Methodology:</strong> Bill impact uses Carnegie Mellon/NC State OEO model (grid load ratio x regional base rate). Water consumption from Dgtl Infra WUE benchmarks. NOx from EPA emission factors for Tier II diesel generators. Health cost based on UCR/Caltech $15,385/ton public health burden model. Tax calculations use JLARC Virginia and Good Jobs First fiscal data. Job multiplier (2.5x) from Bureau of Economic Analysis RIMS II model. GDP impact from Fortune/Harvard analysis (1 basis point GDP per $50B capex).
                    </div>

                    <!-- ============================== -->
                    <!-- PRO MODE: Strategic Inputs     -->
                    <!-- ============================== -->
                    <div class="msf-pro-inputs" id="msfProInputs" style="display:none;">
                        <div class="msf-pro-inputs-title"><i class="fas fa-cogs"></i> Pro Strategic Inputs — Maintenance Staffing Optimization</div>
                        <div class="calc-grid">
                            <!-- SI-01: Asset Complexity -->
                            <div class="calc-input-group">
                                <label for="msfAssetCount">SI-01: Asset Count
                                    <span class="msf-tooltip-trigger">?
                                        <div class="tooltip-content">
                                            <div class="tooltip-title"><i class="fas fa-server"></i> Asset Complexity & Density Index</div>
                                            <div class="tooltip-desc">Total number of maintainable assets. Drives staffing volume, work order density, and scheduling complexity.</div>
                                            <table class="tooltip-table">
                                                <tr><th>Tier</th><th>Assets</th></tr>
                                                <tr><td>Edge / Small</td><td>10-200</td></tr>
                                                <tr><td>Enterprise</td><td>200-1,000</td></tr>
                                                <tr><td>Hyperscale</td><td>1,000-3,000</td></tr>
                                                <tr><td>Mega Campus</td><td>3,000-5,000</td></tr>
                                            </table>
                                            <div class="tooltip-note">Each asset type (UPS, CRAH, genset, PDU) has different MTBF and labor intensity profiles.</div>
                                        </div>
                                    </span>
                                </label>
                                <input type="number" id="msfAssetCount" value="500" min="10" max="5000" step="10" onchange="msfCalculatePro()">
                            </div>
                            <div class="calc-input-group">
                                <label for="msfEnvironment">Environment Type
                                    <span class="msf-tooltip-trigger">?
                                        <div class="tooltip-content">
                                            <div class="tooltip-title"><i class="fas fa-building"></i> Facility Environment</div>
                                            <div class="tooltip-desc">Environment classification determines asset density factor, failure patterns, and labor skill requirements.</div>
                                            <table class="tooltip-table">
                                                <tr><th>Type</th><th>Density Factor</th></tr>
                                                <tr><td>Hyperscale</td><td>1.0 (baseline)</td></tr>
                                                <tr><td>Enterprise</td><td>1.3 (more diverse)</td></tr>
                                                <tr><td>Industrial</td><td>1.5 (harsh env)</td></tr>
                                                <tr><td>Edge</td><td>0.8 (distributed)</td></tr>
                                            </table>
                                        </div>
                                    </span>
                                </label>
                                <select id="msfEnvironment" onchange="msfCalculatePro()">
                                    <option value="hyperscale">Hyperscale</option>
                                    <option value="enterprise" selected>Enterprise</option>
                                    <option value="industrial">Industrial</option>
                                    <option value="edge">Edge / Distributed</option>
                                </select>
                            </div>

                            <!-- SI-02: Operational Cadence -->
                            <div class="calc-input-group">
                                <label for="msfCadence">SI-02: Operational Cadence
                                    <span class="msf-tooltip-trigger">?
                                        <div class="tooltip-content">
                                            <div class="tooltip-title"><i class="fas fa-clock"></i> Shift Coverage Model</div>
                                            <div class="tooltip-desc">Operating hours determine shift multiplier, fatigue baseline, handover losses, and total labor hours required per week.</div>
                                            <table class="tooltip-table">
                                                <tr><th>Cadence</th><th>Weekly Hrs</th></tr>
                                                <tr><td>8/5 Business</td><td>40 hrs</td></tr>
                                                <tr><td>12/7 Extended</td><td>84 hrs</td></tr>
                                                <tr><td>24/7/365 Critical</td><td>168 hrs</td></tr>
                                            </table>
                                            <div class="tooltip-note">24/7 operations require 4.2x base staff for shift rotation + fatigue management + leave coverage.</div>
                                        </div>
                                    </span>
                                </label>
                                <select id="msfCadence" onchange="msfCalculatePro()">
                                    <option value="8/5">8/5 Business Hours</option>
                                    <option value="12/7">12/7 Extended Operations</option>
                                    <option value="24/7" selected>24/7/365 Critical</option>
                                </select>
                            </div>

                            <!-- SI-03: Reliability Target -->
                            <div class="calc-input-group">
                                <label for="msfSLA">SI-03: Reliability Target / SLA
                                    <span class="msf-tooltip-trigger">?
                                        <div class="tooltip-content">
                                            <div class="tooltip-title"><i class="fas fa-shield-alt"></i> SLA Tier</div>
                                            <div class="tooltip-desc">Target uptime drives maintenance rigor, redundancy, and staffing buffer requirements. Higher SLA = exponentially more resources.</div>
                                            <table class="tooltip-table">
                                                <tr><th>SLA</th><th>Max Downtime/yr</th></tr>
                                                <tr><td>99.9% (Tier III)</td><td>8.76 hours</td></tr>
                                                <tr><td>99.95%</td><td>4.38 hours</td></tr>
                                                <tr><td>99.99% (Tier IV)</td><td>52.6 min</td></tr>
                                                <tr><td>99.999%</td><td>5.26 min</td></tr>
                                            </table>
                                            <div class="tooltip-note">Each additional nine roughly doubles staffing overhead due to concurrency and redundancy requirements.</div>
                                        </div>
                                    </span>
                                </label>
                                <select id="msfSLA" onchange="msfCalculatePro()">
                                    <option value="99.9">99.9% — Tier III</option>
                                    <option value="99.95" selected>99.95%</option>
                                    <option value="99.99">99.99% — Tier IV</option>
                                    <option value="99.999">99.999% — Five Nines</option>
                                </select>
                            </div>

                            <!-- SI-04: Failure Velocity -->
                            <div class="calc-input-group">
                                <label for="msfMTBF">SI-04: Baseline MTBF (hours)
                                    <span class="msf-tooltip-trigger">?
                                        <div class="tooltip-content">
                                            <div class="tooltip-title"><i class="fas fa-heartbeat"></i> Mean Time Between Failures</div>
                                            <div class="tooltip-desc">Average hours between equipment failures. Lower MTBF = higher reactive workload and more staff needed.</div>
                                            <table class="tooltip-table">
                                                <tr><th>Category</th><th>MTBF (hrs)</th></tr>
                                                <tr><td>New / premium</td><td>25,000-50,000</td></tr>
                                                <tr><td>Average fleet</td><td>8,000-25,000</td></tr>
                                                <tr><td>Aging / mixed</td><td>3,000-8,000</td></tr>
                                                <tr><td>Legacy / stressed</td><td>100-3,000</td></tr>
                                            </table>
                                            <div class="tooltip-note">Failure velocity directly feeds the Monte Carlo demand distribution.</div>
                                        </div>
                                    </span>
                                </label>
                                <input type="number" id="msfMTBF" value="12000" min="100" max="50000" step="100" onchange="msfCalculatePro()">
                            </div>

                            <!-- SI-05: Blended Labor Cost -->
                            <div class="calc-input-group">
                                <label for="msfLaborCost">SI-05: Blended Labor Cost ($/hr)
                                    <span class="msf-tooltip-trigger">?
                                        <div class="tooltip-content">
                                            <div class="tooltip-title"><i class="fas fa-dollar-sign"></i> Fully Burdened Hourly Rate</div>
                                            <div class="tooltip-desc">Includes salary, benefits, insurance, training, tools, and overhead. US data center technicians typically $45-120/hr fully burdened.</div>
                                            <table class="tooltip-table">
                                                <tr><th>Region</th><th>Range ($/hr)</th></tr>
                                                <tr><td>US Tier-1 metro</td><td>$80-$150</td></tr>
                                                <tr><td>US secondary</td><td>$50-$90</td></tr>
                                                <tr><td>SEA / LATAM</td><td>$25-$55</td></tr>
                                                <tr><td>India</td><td>$15-$35</td></tr>
                                            </table>
                                            <div class="tooltip-note">Emergency/OT premium typically 1.5-2.5x base rate. COI formula uses emergency premium multiplier.</div>
                                        </div>
                                    </span>
                                </label>
                                <input type="number" id="msfLaborCost" value="75" min="25" max="250" step="5" onchange="msfCalculatePro()">
                            </div>

                            <!-- SI-06: Risk Appetite -->
                            <div class="calc-input-group msf-slider-group">
                                <label for="msfRiskAppetite">SI-06: Risk Appetite
                                    <span class="msf-tooltip-trigger">?
                                        <div class="tooltip-content">
                                            <div class="tooltip-title"><i class="fas fa-tachometer-alt"></i> Staffing Confidence Level</div>
                                            <div class="tooltip-desc">Conservative = staff to P95 (covers 95% of scenarios). Aggressive = staff to P50 (covers only median demand).</div>
                                            <table class="tooltip-table">
                                                <tr><th>Level</th><th>Percentile</th></tr>
                                                <tr><td>Conservative</td><td>P95 — covers 95%</td></tr>
                                                <tr><td>Moderate</td><td>P75 — covers 75%</td></tr>
                                                <tr><td>Aggressive</td><td>P50 — covers 50%</td></tr>
                                            </table>
                                            <div class="tooltip-note">Critical facilities should never go below P75. Cost difference between P50 and P95 is typically 35-60%.</div>
                                        </div>
                                    </span>
                                </label>
                                <input type="range" id="msfRiskAppetite" min="50" max="95" value="75" step="5" oninput="document.getElementById('msfRiskLabel').textContent=this.value>=90?'Conservative P'+this.value:this.value>=70?'Moderate P'+this.value:'Aggressive P'+this.value; msfCalculatePro();">
                                <div class="msf-slider-value" id="msfRiskLabel">Moderate P75</div>
                            </div>
                        </div>
                    </div>

                    <!-- ============================== -->
                    <!-- PRO PANEL 1: Stochastic Layer  -->
                    <!-- ============================== -->
                    <div class="msf-pro-panel gated" id="msfPanel1" style="display:none;">
                        <div class="msf-gate-overlay" onclick="msfShowLogin()">
                            <i class="fas fa-lock"></i>
                            <span>Pro Feature — Log in to unlock</span>
                        </div>
                        <div class="msf-panel-title"><i class="fas fa-chart-line"></i> Stochastic Reliability Layer</div>
                        <div class="msf-kpi-grid">
                            <div class="msf-kpi-card">
                                <div class="msf-kpi-value" id="msfProbHead">--</div>
                                <div class="msf-kpi-label">Probabilistic Headcount</div>
                                <div class="msf-kpi-sublabel">Monte Carlo P90</div>
                            </div>
                            <div class="msf-kpi-card">
                                <div class="msf-kpi-value" id="msfSurgeVuln">--</div>
                                <div class="msf-kpi-label">Surge Vulnerability</div>
                                <div class="msf-score-bar-bg"><div class="msf-score-bar-fill risk-med" id="msfSurgeBar" style="width:0%"></div></div>
                            </div>
                            <div class="msf-kpi-card">
                                <div class="msf-kpi-value" id="msfSLABreach">--</div>
                                <div class="msf-kpi-label">SLA Breach Probability</div>
                            </div>
                            <div class="msf-kpi-card">
                                <div class="msf-kpi-value" id="msfMTTR">--</div>
                                <div class="msf-kpi-label">MTTR Forecast</div>
                                <div class="msf-kpi-sublabel">queue-adjusted (hrs)</div>
                            </div>
                            <div class="msf-kpi-card">
                                <div class="msf-kpi-value" id="msfBacklog">--</div>
                                <div class="msf-kpi-label">Backlog Growth Rate</div>
                                <div class="msf-kpi-sublabel">WO/month accumulation</div>
                            </div>
                            <div class="msf-kpi-card">
                                <div class="msf-kpi-value" id="msfReactProact">--</div>
                                <div class="msf-kpi-label">Reactive vs Proactive</div>
                                <div class="msf-kpi-sublabel">ratio (target &lt; 20:80)</div>
                            </div>
                            <div class="msf-kpi-card">
                                <div class="msf-kpi-value" id="msfWrenchTime">--</div>
                                <div class="msf-kpi-label">Wrench Time Efficiency</div>
                                <div class="msf-kpi-sublabel">productive tool-on %</div>
                            </div>
                            <div class="msf-kpi-card">
                                <div class="msf-kpi-value" id="msfStabilityIdx">--</div>
                                <div class="msf-kpi-label">Operational Stability</div>
                                <div class="msf-kpi-sublabel">workload variance index</div>
                                <div class="msf-score-bar-bg"><div class="msf-score-bar-fill risk-low" id="msfStabilityBar" style="width:0%"></div></div>
                            </div>
                        </div>
                    </div>

                    <!-- ============================== -->
                    <!-- PRO PANEL 2: Financial Layer   -->
                    <!-- ============================== -->
                    <div class="msf-pro-panel gated" id="msfPanel2" style="display:none;">
                        <div class="msf-gate-overlay" onclick="msfShowLogin()">
                            <i class="fas fa-lock"></i>
                            <span>Pro Feature — Log in to unlock</span>
                        </div>
                        <div class="msf-panel-title"><i class="fas fa-coins"></i> Financial Engineering Layer</div>
                        <div class="msf-kpi-grid">
                            <div class="msf-kpi-card">
                                <div class="msf-kpi-value" id="msfCOI">--</div>
                                <div class="msf-kpi-label">Cost of Inaction (COI)</div>
                                <div class="msf-kpi-sublabel">annual risk exposure</div>
                            </div>
                            <div class="msf-kpi-card">
                                <div class="msf-kpi-value" id="msfOPEXLeak">--</div>
                                <div class="msf-kpi-label">OPEX Leakage</div>
                                <div class="msf-kpi-sublabel">inefficiency losses/yr</div>
                            </div>
                            <div class="msf-kpi-card">
                                <div class="msf-kpi-value" id="msfCAPEXAvoid">--</div>
                                <div class="msf-kpi-label">CAPEX Avoidance</div>
                                <div class="msf-kpi-sublabel">asset life extension 15-20%</div>
                            </div>
                            <div class="msf-kpi-card">
                                <div class="msf-kpi-value" id="msfROI">--</div>
                                <div class="msf-kpi-label">ROI of Optimization</div>
                            </div>
                            <div class="msf-kpi-card">
                                <div class="msf-kpi-value" id="msfFinExposure">--</div>
                                <div class="msf-kpi-label">Financial Exposure</div>
                                <div class="msf-kpi-sublabel">score 0-100</div>
                                <div class="msf-score-bar-bg"><div class="msf-score-bar-fill risk-med" id="msfFinExpBar" style="width:0%"></div></div>
                            </div>
                            <div class="msf-kpi-card">
                                <div class="msf-kpi-value" id="msfTechDebt">--</div>
                                <div class="msf-kpi-label">Tech Debt Accrual</div>
                                <div class="msf-kpi-sublabel">$/month compound</div>
                            </div>
                            <div class="msf-kpi-card">
                                <div class="msf-kpi-value" id="msfEmergSpend">--</div>
                                <div class="msf-kpi-label">Emergency Premium</div>
                                <div class="msf-kpi-sublabel">annual forecast</div>
                            </div>
                            <div class="msf-kpi-card">
                                <div class="msf-kpi-value" id="msfTCO">--</div>
                                <div class="msf-kpi-label">5-Year TCO</div>
                                <div class="msf-kpi-sublabel">total cost of ownership</div>
                            </div>
                        </div>
                    </div>

                    <!-- ============================== -->
                    <!-- PRO PANEL 3: Human Factors     -->
                    <!-- ============================== -->
                    <div class="msf-pro-panel gated" id="msfPanel3" style="display:none;">
                        <div class="msf-gate-overlay" onclick="msfShowLogin()">
                            <i class="fas fa-lock"></i>
                            <span>Pro Feature — Log in to unlock</span>
                        </div>
                        <div class="msf-panel-title"><i class="fas fa-user-shield"></i> Human Factors Layer</div>
                        <div class="msf-kpi-grid">
                            <div class="msf-kpi-card">
                                <div class="msf-kpi-value" id="msfBurnout">--</div>
                                <div class="msf-kpi-label">Burnout Probability</div>
                                <div class="msf-kpi-sublabel">exponential &gt;85% util</div>
                                <div class="msf-score-bar-bg"><div class="msf-score-bar-fill risk-high" id="msfBurnoutBar" style="width:0%"></div></div>
                            </div>
                            <div class="msf-kpi-card">
                                <div class="msf-kpi-value" id="msfFatigue">--</div>
                                <div class="msf-kpi-label">Fatigue Risk Score</div>
                                <div class="msf-kpi-sublabel">shift x rotation x OT</div>
                            </div>
                            <div class="msf-kpi-card">
                                <div class="msf-kpi-value" id="msfElasticity">--</div>
                                <div class="msf-kpi-label">Staffing Elasticity</div>
                                <div class="msf-kpi-sublabel">OHS delta per hire</div>
                            </div>
                            <div class="msf-kpi-card">
                                <div class="msf-kpi-value" id="msfBusFactor">--</div>
                                <div class="msf-kpi-label">Bus Factor</div>
                                <div class="msf-kpi-sublabel">skill gap criticality</div>
                            </div>
                            <div class="msf-kpi-card">
                                <div class="msf-kpi-value" id="msfRetention">--</div>
                                <div class="msf-kpi-label">Retention Risk</div>
                                <div class="msf-kpi-sublabel">annual turnover prob</div>
                            </div>
                            <div class="msf-kpi-card">
                                <div class="msf-kpi-value" id="msfCogLoad">--</div>
                                <div class="msf-kpi-label">Cognitive Load Index</div>
                                <div class="msf-kpi-sublabel">decision fatigue 0-100</div>
                            </div>
                            <div class="msf-kpi-card">
                                <div class="msf-kpi-value" id="msfSafetyProb">--</div>
                                <div class="msf-kpi-label">Safety Incident Prob</div>
                                <div class="msf-kpi-sublabel">annual likelihood</div>
                            </div>
                            <div class="msf-kpi-card">
                                <div class="msf-kpi-value" id="msfOHS">--</div>
                                <div class="msf-kpi-label">Operational Health Score</div>
                                <div class="msf-kpi-sublabel">master metric 0-100</div>
                                <div class="msf-score-bar-bg"><div class="msf-score-bar-fill risk-low" id="msfOHSBar" style="width:0%"></div></div>
                            </div>
                        </div>
                    </div>

                    <!-- ============================== -->
                    <!-- PRO PANEL 4: Monte Carlo       -->
                    <!-- ============================== -->
                    <div class="msf-pro-panel gated" id="msfPanel4" style="display:none;">
                        <div class="msf-gate-overlay" onclick="msfShowLogin()">
                            <i class="fas fa-lock"></i>
                            <span>Pro Feature — Log in to unlock</span>
                        </div>
                        <div class="msf-panel-title"><i class="fas fa-dice"></i> Monte Carlo Simulation — 10,000 Iterations</div>
                        <div class="msf-kpi-grid" style="margin-bottom:1rem;">
                            <div class="msf-kpi-card">
                                <div class="msf-kpi-value" id="msfMCP5">--</div>
                                <div class="msf-kpi-label">P5 Staffing</div>
                            </div>
                            <div class="msf-kpi-card">
                                <div class="msf-kpi-value" id="msfMCP25">--</div>
                                <div class="msf-kpi-label">P25 Staffing</div>
                            </div>
                            <div class="msf-kpi-card">
                                <div class="msf-kpi-value" id="msfMCP50">--</div>
                                <div class="msf-kpi-label">P50 Staffing</div>
                            </div>
                            <div class="msf-kpi-card">
                                <div class="msf-kpi-value" id="msfMCP75">--</div>
                                <div class="msf-kpi-label">P75 Staffing</div>
                            </div>
                            <div class="msf-kpi-card">
                                <div class="msf-kpi-value" id="msfMCP95">--</div>
                                <div class="msf-kpi-label">P95 Staffing</div>
                            </div>
                            <div class="msf-kpi-card">
                                <div class="msf-kpi-value" id="msfCVaR">--</div>
                                <div class="msf-kpi-label">CVaR-95 Shortfall</div>
                                <div class="msf-kpi-sublabel">worst-case gap (FTEs)</div>
                            </div>
                        </div>
                        <div class="msf-chart-container">
                            <canvas id="msfHistogramChart" height="250"></canvas>
                        </div>
                        <div class="msf-chart-container" style="margin-top:1rem;">
                            <canvas id="msfTornadoChart" height="220"></canvas>
                        </div>
                    </div>

                    <!-- ============================== -->
                    <!-- PRO PANEL 5: AI Narrative      -->
                    <!-- ============================== -->
                    <div class="msf-pro-panel gated" id="msfPanel5" style="display:none;">
                        <div class="msf-gate-overlay" onclick="msfShowLogin()">
                            <i class="fas fa-lock"></i>
                            <span>Pro Feature — Log in to unlock</span>
                        </div>
                        <div class="msf-panel-title"><i class="fas fa-robot"></i> AI-Generated Executive Dossier</div>
                        <div class="msf-narrative" id="msfNarrativeText">
                            <h4><i class="fas fa-crosshairs"></i> Executive BLUF</h4>
                            <p>Run the Pro calculator to generate your staffing optimization narrative.</p>
                        </div>
                    </div>

                    <!-- Login Modal -->
                    <div class="msf-login-overlay" id="msfLoginOverlay">
                        <div class="msf-login-box">
                            <button class="msf-login-close" onclick="msfHideLogin()">&times;</button>
                            <h3><i class="fas fa-lock" style="color:#f97316;margin-right:6px;"></i> Unlock Pro Analysis</h3>
                            <p>Access Stochastic Reliability, Financial Engineering, Human Factors, Monte Carlo Simulation, and AI Executive Dossier.</p>
                            <input type="email" id="msfLoginEmail" placeholder="Email address" autocomplete="email">
                            <input type="password" id="msfLoginPass" placeholder="Password" autocomplete="current-password">
                            <div class="msf-login-error" id="msfLoginError">Invalid credentials. Please try again.</div>
                            <button class="msf-login-submit" onclick="msfDoLogin()">Sign In</button>
                            <div class="demo-hint">Demo: <code>demo@resistancezero.com</code> / <code>demo2026</code></div>
                            <div style="text-align:center;margin-top:6px;"><a href="https://bagus-dwi-permana.myr.id/membership/resistancezero-pro" target="_blank" rel="noopener" style="font-size:0.62rem;color:#64748b;text-decoration:none;">Unlock Pro Mode &rarr;</a></div>
                        </div>
                    </div>

                </div>

                <!-- References -->
                <div class="references">
                    <h3>References &amp; Data Sources</h3>
                    <ol>
                        <li><a href="https://www.datacenterwatch.org/report" target="_blank" rel="noopener">Data Center Watch &mdash; $64 Billion Community Opposition Report</a> <span class="ref-source">2025</span></li>
                        <li><a href="https://www.cmu.edu/work-that-matters/energy-innovation/data-center-growth-could-increase-electricity-bills" target="_blank" rel="noopener">Carnegie Mellon University &mdash; Data Center Growth and Electricity Bills</a> <span class="ref-source">July 2025</span></li>
                        <li><a href="https://www.bloomberg.com/news/articles/2026-02-07/malaysia-draws-first-data-center-protest-over-pollution-water" target="_blank" rel="noopener">Bloomberg &mdash; Malaysia's First Data Center Protest</a> <span class="ref-source">February 7, 2026</span></li>
                        <li><a href="https://eelp.law.harvard.edu/extracting-profits-from-the-public-how-utility-ratepayers-are-paying-for-big-techs-power/" target="_blank" rel="noopener">Harvard Electricity Law Initiative &mdash; Extracting Profits from the Public</a> <span class="ref-source">March 2025</span></li>
                        <li><a href="https://virginiamercury.com/2025/07/28/amazon-pulls-louisa-county-data-center-proposal-after-strong-resistance/" target="_blank" rel="noopener">Virginia Mercury &mdash; Amazon Withdraws Louisa County Proposal</a> <span class="ref-source">July 2025</span></li>
                        <li><a href="https://www.scmp.com/week-asia/health-environment/article/3333109/data-centres-malaysias-johor-told-wait-water-until-mid-2027" target="_blank" rel="noopener">SCMP &mdash; Johor Data Centres Told to Wait for Water</a> <span class="ref-source">2025</span></li>
                        <li><a href="https://www.sierraclub.org/virginia/blog/2026/01/looser-rules-dirtier-air-data-centers-and-diesel-pollution-virginia" target="_blank" rel="noopener">Sierra Club Virginia &mdash; Diesel Pollution from Data Centers</a> <span class="ref-source">January 2026</span></li>
                        <li><a href="https://news.vcu.edu/article/northern-virginia-data-center-air-pollution-rivals-power-plant-emissions" target="_blank" rel="noopener">VCU Research &mdash; Northern Virginia DC Air Pollution</a> <span class="ref-source">2025</span></li>
                        <li><a href="https://www.caltech.edu/about/news/air-pollution-and-the-public-health-costs-of-ai" target="_blank" rel="noopener">Caltech &mdash; Air Pollution and Public Health Costs of AI</a> <span class="ref-source">December 2024</span></li>
                        <li><a href="https://fortune.com/2025/10/07/data-centers-gdp-growth-zero-first-half-2025-jason-furman-harvard-economist/" target="_blank" rel="noopener">Fortune &mdash; Without Data Centers, GDP Growth Was 0.1%</a> <span class="ref-source">October 2025</span></li>
                        <li><a href="https://www.loudoun.gov/6188/Data-Centers-in-Loudoun-County" target="_blank" rel="noopener">Loudoun County Government &mdash; Data Centers in Loudoun</a> <span class="ref-source">2025</span></li>
                        <li><a href="https://blogs.microsoft.com/on-the-issues/2026/01/13/community-first-ai-infrastructure/" target="_blank" rel="noopener">Microsoft &mdash; Community-First AI Infrastructure</a> <span class="ref-source">January 13, 2026</span></li>
                        <li><a href="https://www.utilitydive.com/news/data-centers-pjm-capacity-auction/808951/" target="_blank" rel="noopener">Utility Dive &mdash; Data Centers Were 40% of PJM Capacity Costs</a> <span class="ref-source">December 2025</span></li>
                        <li><a href="https://www.brookings.edu/articles/why-community-benefit-agreements-are-necessary-for-data-centers/" target="_blank" rel="noopener">Brookings Institution &mdash; Why CBAs Are Necessary for Data Centers</a> <span class="ref-source">2025</span></li>
                        <li><a href="https://goodjobsfirst.org/cloudy-with-a-loss-of-spending-control-how-data-centers-are-endangering-state-budgets/" target="_blank" rel="noopener">Good Jobs First &mdash; How Data Centers Are Endangering State Budgets</a> <span class="ref-source">2025</span></li>
                        <li><a href="https://jlarc.virginia.gov/landing-2024-data-centers-in-virginia.asp" target="_blank" rel="noopener">JLARC &mdash; Data Centers in Virginia</a> <span class="ref-source">December 2024</span></li>
                        <li><a href="https://www.imda.gov.sg/how-we-can-help/green-dc-roadmap" target="_blank" rel="noopener">IMDA Singapore &mdash; Green Data Centre Roadmap</a> <span class="ref-source">2024</span></li>
                        <li><a href="https://www.rte.ie/news/business/2025/1212/1548674-80-of-data-centre-energy-must-come-from-renewables-cru/" target="_blank" rel="noopener">RTE &mdash; Ireland: 80% DC Energy Must Come from Renewables</a> <span class="ref-source">December 2025</span></li>
                        <li><a href="https://www.nbcnews.com/politics/congress/senators-introduce-first-bipartisan-effort-curb-utility-bill-hikes-rel-rcna258577" target="_blank" rel="noopener">NBC News &mdash; Bipartisan GRID Act</a> <span class="ref-source">February 2026</span></li>
                        <li><a href="https://www.eesi.org/articles/view/data-centers-and-water-consumption" target="_blank" rel="noopener">EESI &mdash; Data Centers and Water Consumption</a> <span class="ref-source">2025</span></li>
                        <li><a href="https://www.bloomberg.com/news/features/2025-05-14/finland-s-data-centers-are-heating-cities-too" target="_blank" rel="noopener">Bloomberg &mdash; Finland's Data Centers Are Heating Cities</a> <span class="ref-source">May 2025</span></li>
                        <li><a href="https://nltimes.nl/2025/04/18/amsterdam-allowing-data-centers-municipality" target="_blank" rel="noopener">NL Times &mdash; Amsterdam: No Data Centers Until 2030</a> <span class="ref-source">April 2025</span></li>
                        <li><a href="https://virginiamercury.com/2026/02/10/bill-would-put-more-energy-costs-on-data-centers-slash-residential-customerss-rates/" target="_blank" rel="noopener">Virginia Mercury &mdash; SB 253: Shifting Energy Costs to Data Centers</a> <span class="ref-source">February 2026</span></li>
                        <li><a href="https://www.foodandwaterwatch.org/2025/12/08/230-groups-call-for-national-moratorium-on-new-data-centers/" target="_blank" rel="noopener">Food &amp; Water Watch &mdash; 230+ Groups Call for Moratorium</a> <span class="ref-source">December 2025</span></li>
                        <li><a href="https://www.anthropic.com/news/covering-electricity-price-increases" target="_blank" rel="noopener">Anthropic &mdash; Covering Electricity Price Increases</a> <span class="ref-source">February 2026</span></li>
                    </ol>
                </div>

                <!-- Newsletter Signup -->
                <div class="newsletter-signup">
                    <h3>Stay Updated</h3>
                    <p>Get notified when new articles on data center operations and engineering excellence are published.</p>
                    <form class="newsletter-form" onsubmit="return subscribeNewsletter(event)">
                        <input type="email" placeholder="Enter your email" required>
                        <button type="submit">Subscribe</button>
                    </form>
                    <p class="newsletter-privacy">No spam. Unsubscribe anytime.</p>
                </div>

                <!-- Author Bio -->
                <div class="author-bio">
                    <div class="author-bio-image">
                        <img loading="lazy" src="assets/profile-photo.jpg" alt="Bagus Dwi Permana">
                    </div>
                    <div class="author-bio-content">
                        <h4>Bagus Dwi Permana</h4>
                        <p class="author-bio-title">Engineering Operations Manager | Ahli K3 Listrik</p>
                        <p>12+ years professional experience in critical infrastructure and operations. CDFOM certified. Transforming operations through systematic excellence and safety-first engineering.</p>
                        <div class="author-bio-links">
                            <a href="https://www.linkedin.com/in/bagus-dwi-permana-ba90b092" target="_blank">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                                LinkedIn
                            </a>
                            <a href="https://github.com/baguspermana7-cpu" target="_blank">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
                                GitHub
                            </a>
                            <a href="mailto:baguspermana7@gmail.com">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
                                Email
                            </a>
                        </div>
                    </div>
                </div>

                <div class="related-articles">
                    <h3>Continue Reading</h3>
                    <div class="related-grid">
                        <a href="article-13.html" class="related-card">
                            <div class="related-card-number">13</div>
                            <div class="related-card-content">
                                <h4>Power Architecture Revolution</h4>
                                <p>Designing for the AI-era data center</p>
                            </div>
                        </a>
                        <a href="article-15.html" class="related-card">
                            <div class="related-card-number">15</div>
                            <div class="related-card-content">
                                <h4>Data Center Service Catalog</h4>
                                <p>120+ services ranked by revenue impact</p>
                            </div>
                        </a>
                    </div>
                </div>

                <!-- Article Navigation -->
                <div class="article-nav">
                    <a href="article-13.html">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
                        Previous Article
                    </a>
                    <a href="article-15.html">
                        Next Article
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
                    </a>
                </div>

            </div>
        </div>
    </article>
    </main>

    <footer class="footer footer-enhanced">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-brand">
                    <p class="footer-tagline-main">BUILT FOR MISSION CRITICAL INFRASTRUCTURE<br>MANAGEMENT // 2026</p>
                    <p class="footer-tagline-sub">ALL OPERATIONAL DATASETS PRESERVED.</p>
                    <p class="footer-copyright">&copy; 2026 Bagus Dwi Permana. All rights reserved.</p>
                </div>
                <div class="footer-nav">
                    <h4 class="footer-heading">NAVIGATION</h4>
                    <ul class="footer-links">
                        <li><a href="index.html">Home Dashboard</a></li>
                        <li><a href="articles.html">Technical Journal</a></li>
                        <li><a href="index.html#case-studies">Case Studies</a></li>
                        <li><a href="datacenter-solutions.html">DC Solutions</a></li>
                    </ul>
                </div>
                <div class="footer-connect">
                    <h4 class="footer-heading">CONNECT</h4>
                    <ul class="footer-links">
                        <li><a href="https://www.linkedin.com/in/bagus-dwi-permana-ba90b092" target="_blank" rel="noopener">LinkedIn Profile</a></li>
                        <li><a href="articles.html">Technical Journal</a></li>
                        <li><a href="mailto:baguspermana7@gmail.com">Direct Contact</a></li>
                        <li><a href="https://github.com/baguspermana7-cpu" target="_blank" rel="noopener">GitHub</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>

    <!-- Calculator Logic -->
    <script>
    const regionData = {
        virginia:   { name: 'Virginia, USA',     eRate: 0.12, waterStress: 1.0,  taxRate: 0.048, carbonKg: 350, avgBill: 145, gridGW: 90,  capexM: 1.0,  jobM: 1.0,  householdWaterL: 450 },
        georgia:    { name: 'Georgia, USA',      eRate: 0.11, waterStress: 0.8,  taxRate: 0.040, carbonKg: 400, avgBill: 130, gridGW: 50,  capexM: 0.9,  jobM: 0.95, householdWaterL: 500 },
        texas:      { name: 'Texas, USA',        eRate: 0.10, waterStress: 1.3,  taxRate: 0.035, carbonKg: 380, avgBill: 140, gridGW: 85,  capexM: 0.85, jobM: 0.9,  householdWaterL: 550 },
        ireland:    { name: 'Ireland, EU',       eRate: 0.22, waterStress: 0.3,  taxRate: 0.050, carbonKg: 300, avgBill: 180, gridGW: 12,  capexM: 1.3,  jobM: 1.1,  householdWaterL: 400 },
        malaysia:   { name: 'Malaysia (Johor)',  eRate: 0.08, waterStress: 1.8,  taxRate: 0.025, carbonKg: 550, avgBill: 45,  gridGW: 35,  capexM: 0.75, jobM: 0.8,  householdWaterL: 350 },
        indonesia:  { name: 'Indonesia',         eRate: 0.07, waterStress: 1.2,  taxRate: 0.020, carbonKg: 650, avgBill: 35,  gridGW: 70,  capexM: 0.70, jobM: 0.75, householdWaterL: 300 },
        thailand:   { name: 'Thailand',          eRate: 0.09, waterStress: 0.9,  taxRate: 0.030, carbonKg: 450, avgBill: 50,  gridGW: 50,  capexM: 0.80, jobM: 0.85, householdWaterL: 380 },
        singapore:  { name: 'Singapore',         eRate: 0.18, waterStress: 2.0,  taxRate: 0.060, carbonKg: 400, avgBill: 120, gridGW: 14,  capexM: 1.50, jobM: 1.2,  householdWaterL: 370 }
    };

    // Water consumption in million litres per MW per year (Dgtl Infra / Equinix WUE benchmarks)
    const coolingWater = { evaporative: 26, hybrid: 13, aircooled: 0.5, liquid: 3 };
    // Noise at 400ft in dB (Prince William County / WUSA9 measurements)
    const coolingNoise = { evaporative: 65, hybrid: 58, aircooled: 60, liquid: 50 };
    // NOx kg per hour per 2MW generator at full load (EPA AP-42 emission factors)
    const genNoxPerMW = { battery: 0, hvo: 0.5, diesel: 4.5, diesel_heavy: 12 };
    // Test hours per year (industry standard)
    const genHoursYear = { battery: 0, hvo: 50, diesel: 100, diesel_heavy: 500 };
    // Tax revenue retention multiplier
    const taxRetain = { none: 1.0, moderate: 0.6, aggressive: 0.3, extreme: 0.05 };
    // Rate protection — bill multiplier reduction
    const rateProtect = { full: 0.05, gs5: 0.25, standard: 0.65, none: 1.0 };
    // Water strategy — consumption reduction factor
    const waterStrategy = { netpositive: 0.1, recycled: 0.4, standard: 1.0, none: 1.2 };
    // Waste heat recovery — annual value per MW
    const wasteHeatVal = { district: 85000, industrial: 45000, partial: 20000, none: 0 };
    // CBA engagement score factor
    const cbaFactor = { comprehensive: 30, basic: 10, none: -25 };
    // Construction jobs per MW (BLS data / Vantage/Meta case studies)
    const constJobsPerMW = 35;
    // Direct permanent jobs per MW (Data Center Knowledge consensus: 1-1.5/MW)
    const permJobsPerMW = 1.2;
    // Health cost per ton of NOx (UCR/Caltech: ~$15,385/ton based on $20B/1300 deaths model)
    const healthCostPerTonNox = 15385;

    function calculateImpact() {
        const mw = Math.max(1, parseFloat(document.getElementById('dcSize').value) || 100);
        const region = document.getElementById('dcRegion').value;
        const cooling = document.getElementById('coolingType').value;
        const pue = parseFloat(document.getElementById('pue').value);
        const renewPct = parseInt(document.getElementById('renewablePct').value) / 100;
        const taxLevel = document.getElementById('taxIncentive').value;
        const engagement = document.getElementById('cba').value;
        const genType = document.getElementById('generators').value;
        const wasteHeat = document.getElementById('wasteHeat').value;
        const rateProt = document.getElementById('rateProtection').value;
        const waterStrat = document.getElementById('waterReplenish').value;
        const constYears = parseInt(document.getElementById('constructionYears').value);
        const rd = regionData[region];

        // === DERIVED VALUES ===
        const totalPowerMW = mw * pue;
        const annualMWh = totalPowerMW * 8760 * 0.85; // 85% utilization
        const annualEnergyCost = annualMWh * rd.eRate;
        const capex = mw * 12_000_000 * rd.capexM; // $12M/MW baseline

        // === COSTS ===
        // 1. Bill increase — Carnegie Mellon model: grid load ratio * base bill * rate protection factor
        const gridLoadPct = (totalPowerMW / (rd.gridGW * 1000)) * 100;
        const billIncrease = (gridLoadPct / 100) * rd.avgBill * (1 - renewPct * 0.3) * rateProtect[rateProt];

        // 2. Water consumption (million litres/year)
        const waterML = mw * coolingWater[cooling] * waterStrategy[waterStrat];
        const waterHouseholdsNum = Math.round((waterML * 1_000_000) / (rd.householdWaterL * 365));

        // 3. NOx emissions (tons/year) — EPA AP-42 factors
        const numGenerators = Math.ceil(totalPowerMW / 2); // 2MW per generator
        const annualNoxTons = (numGenerators * genNoxPerMW[genType] * genHoursYear[genType]) / 1000;

        // 4. Health cost (UCR/Caltech model)
        const healthCostAnnual = annualNoxTons * healthCostPerTonNox * rd.waterStress; // water stress proxy for pop density

        // 5. Noise
        const noiseBase = coolingNoise[cooling];
        const noiseMitigation = engagement === 'comprehensive' ? 10 : engagement === 'basic' ? 4 : 0;
        const noise = Math.max(35, noiseBase - noiseMitigation);

        // 6. Tax foregone
        const foregoneTax = capex * rd.taxRate * (1 - taxRetain[taxLevel]);

        // === BENEFITS ===
        // 1. Tax revenue actually collected
        const actualTaxRev = capex * rd.taxRate * taxRetain[taxLevel] + (annualEnergyCost * 0.05);

        // 2. Construction jobs (temporary, during build)
        const constJobsTotal = Math.round(mw * constJobsPerMW * rd.jobM / constYears);

        // 3. Permanent direct jobs
        const directJobs = Math.round(mw * permJobsPerMW * rd.jobM);

        // 4. Total employment with BEA RIMS II multiplier (2.5x for DC industry)
        const totalJobsCalc = Math.round(directJobs * 2.5) + Math.round(constJobsTotal * 0.3);

        // 5. Renewable energy capacity
        const reCapacity = Math.round(mw * renewPct * 1.3); // 1.3x for intermittency overbuild

        // 6. CO2 avoided (tons/yr) from renewables
        const co2Avoided = Math.round(reCapacity * 8760 * 0.30 * rd.carbonKg / 1000); // 30% capacity factor

        // 7. Waste heat value
        const wasteHeatAnnual = mw * wasteHeatVal[wasteHeat] * (pue - 1) / 0.4;

        // 8. GDP contribution (Fortune/Harvard: ~$800K GDP per MW annually)
        const gdpContrib = mw * 800_000 * rd.capexM;

        // === UPDATE COST UI ===
        document.getElementById('billIncrease').textContent = '$' + billIncrease.toFixed(2);
        document.getElementById('waterUse').textContent = waterML.toFixed(0) + 'M L';
        document.getElementById('waterHouseholds').textContent = waterHouseholdsNum.toLocaleString();
        document.getElementById('dieselNox').textContent = annualNoxTons.toFixed(1) + 't';
        document.getElementById('healthCost').textContent = fmtCurrency(healthCostAnnual);
        document.getElementById('noiseLevel').textContent = noise.toFixed(0) + ' dB';
        document.getElementById('gridLoad').textContent = gridLoadPct.toFixed(2) + '%';
        document.getElementById('taxForegone').textContent = fmtCurrency(foregoneTax);

        // === UPDATE BENEFIT UI ===
        document.getElementById('taxRevenue').textContent = fmtCurrency(actualTaxRev);
        document.getElementById('constJobs').textContent = constJobsTotal.toLocaleString();
        document.getElementById('permJobs').textContent = directJobs.toLocaleString();
        document.getElementById('totalJobs').textContent = totalJobsCalc.toLocaleString();
        document.getElementById('reCapacity').textContent = reCapacity + ' MW';
        document.getElementById('co2Avoided').textContent = fmtNum(co2Avoided) + 't';
        document.getElementById('wasteHeatValue').textContent = fmtCurrency(wasteHeatAnnual);
        document.getElementById('gdpImpact').textContent = fmtCurrency(gdpContrib);

        // === NET SCORE (-100 to +100) ===
        // Cost penalties (negative)
        let costScore = 0;
        costScore -= Math.min(billIncrease * 5, 20);           // Bill impact
        costScore -= Math.min(waterML * rd.waterStress * 0.02, 15); // Water * stress
        costScore -= Math.min(annualNoxTons * 0.3, 15);        // Air quality
        costScore -= (noise > 55 ? 12 : noise > 50 ? 6 : noise > 45 ? 2 : 0); // Noise
        costScore -= Math.min(foregoneTax / 10_000_000, 12);   // Tax foregone
        costScore -= Math.min(gridLoadPct * 2, 10);            // Grid strain
        costScore -= (rateProt === 'none' ? 8 : rateProt === 'standard' ? 4 : 0); // Rate risk

        // Benefit rewards (positive)
        let benefitScore = 0;
        benefitScore += Math.min(actualTaxRev / 5_000_000, 20);     // Tax revenue
        benefitScore += Math.min(directJobs * 0.12, 10);            // Direct jobs
        benefitScore += Math.min(constJobsTotal * 0.005, 8);        // Construction jobs
        benefitScore += Math.min(reCapacity * 0.04, 12);            // Clean energy
        benefitScore += Math.min(co2Avoided * 0.00005, 8);          // CO2 avoided
        benefitScore += Math.min(wasteHeatAnnual / 2_000_000, 10);  // Waste heat
        benefitScore += Math.min(gdpContrib / 50_000_000, 12);      // GDP
        benefitScore += cbaFactor[engagement];                        // CBA engagement

        const net = Math.round(costScore + benefitScore);
        const clamped = Math.max(-100, Math.min(100, net));
        const display = document.getElementById('netScoreDisplay');
        const scoreEl = document.getElementById('netScore');
        const verdictEl = document.getElementById('netVerdict');

        scoreEl.textContent = (clamped > 0 ? '+' : '') + clamped;

        if (clamped >= 30) {
            display.style.background = 'rgba(16, 185, 129, 0.2)';
            scoreEl.style.color = '#34d399';
            verdictEl.style.color = '#6ee7b7';
            verdictEl.textContent = 'NET POSITIVE — This DC configuration genuinely benefits the community. Comprehensive engagement, clean energy, and fair tax policy create a model worth replicating.';
        } else if (clamped >= 0) {
            display.style.background = 'rgba(234, 179, 8, 0.2)';
            scoreEl.style.color = '#fbbf24';
            verdictEl.style.color = '#fde68a';
            verdictEl.textContent = 'MARGINAL — Benefits and costs roughly balance. Tip the scale: add rate protection, improve renewables, or negotiate a binding CBA.';
        } else if (clamped >= -30) {
            display.style.background = 'rgba(249, 115, 22, 0.2)';
            scoreEl.style.color = '#fb923c';
            verdictEl.style.color = '#fdba74';
            verdictEl.textContent = 'NET NEGATIVE — Community costs outweigh benefits. Key fixes: drop tax incentives, add rate protection, upgrade to air/liquid cooling, commit to 80%+ renewables.';
        } else {
            display.style.background = 'rgba(220, 38, 38, 0.2)';
            scoreEl.style.color = '#f87171';
            verdictEl.style.color = '#fca5a5';
            verdictEl.textContent = 'STRONGLY NEGATIVE — This configuration extracts value from the community. This is the pattern behind the $64B rebellion. Major reforms required across all dimensions.';
        }
    }

    function fmtNum(v) {
        if (v >= 1e6) return (v/1e6).toFixed(1) + 'M';
        if (v >= 1e3) return (v/1e3).toFixed(0) + 'K';
        return v.toFixed(0);
    }

    function fmtCurrency(v) {
        if (v >= 1e9) return '$' + (v/1e9).toFixed(1) + 'B';
        if (v >= 1e6) return '$' + (v/1e6).toFixed(1) + 'M';
        if (v >= 1e3) return '$' + (v/1e3).toFixed(0) + 'K';
        return '$' + v.toFixed(0);
    }

    document.addEventListener('DOMContentLoaded', function() {
        calculateImpact();
        initTooltipSystem();
        msfInitProTooltips();
        // Auto-unlock if already logged in
        if (msfCheckAuth()) {
            // Don't auto-switch to Pro, but make toggle available
        }
    });

    function initTooltipSystem() {
        const tooltipEl = document.createElement('div');
        tooltipEl.id = 'tooltip-container';
        tooltipEl.setAttribute('role', 'tooltip');
        document.body.appendChild(tooltipEl);

        function showTooltip(trigger) {
            const content = trigger.querySelector('.tooltip-content');
            if (!content) return;
            tooltipEl.innerHTML = content.innerHTML;
            const rect = trigger.getBoundingClientRect();
            const tooltipWidth = Math.min(320, window.innerWidth - 40);
            tooltipEl.style.width = tooltipWidth + 'px';
            const tooltipHeight = tooltipEl.offsetHeight || 200;
            const padding = 15;
            let left = rect.right + padding;
            let top = rect.top + rect.height / 2;
            if (left + tooltipWidth > window.innerWidth - 20) left = rect.left - tooltipWidth - padding;
            if (left < 20) left = (window.innerWidth - tooltipWidth) / 2;
            top = top - tooltipHeight / 2;
            if (top < 20) top = 20;
            if (top + tooltipHeight > window.innerHeight - 20) top = window.innerHeight - tooltipHeight - 20;
            tooltipEl.style.left = left + 'px';
            tooltipEl.style.top = top + 'px';
            tooltipEl.classList.add('visible');
        }
        function hideTooltip() { tooltipEl.classList.remove('visible'); }

        document.querySelectorAll('.tooltip-trigger').forEach(trigger => {
            trigger.setAttribute('tabindex', '0');
            trigger.setAttribute('role', 'button');
            trigger.setAttribute('aria-label', 'Show tooltip info');
            // Mouse events
            trigger.addEventListener('mouseenter', () => showTooltip(trigger));
            trigger.addEventListener('mouseleave', hideTooltip);
            // Keyboard accessibility
            trigger.addEventListener('focus', () => showTooltip(trigger));
            trigger.addEventListener('blur', hideTooltip);
            // Mobile touch support
            trigger.addEventListener('click', (e) => {
                e.stopPropagation();
                if (tooltipEl.classList.contains('visible')) { hideTooltip(); }
                else { showTooltip(trigger); }
            });
        });
        // Close tooltip on outside click (mobile)
        document.addEventListener('click', hideTooltip);
    }
    </script>

    <!-- Share Buttons -->
    <aside class="share-buttons" id="shareButtons" aria-label="Share this article">
        <span class="share-label">Share</span>
        <button class="share-btn linkedin" data-tooltip="Share on LinkedIn" onclick="shareLinkedIn()" aria-label="Share on LinkedIn">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
        </button>
        <button class="share-btn twitter" data-tooltip="Share on X" onclick="shareTwitter()" aria-label="Share on X">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
        </button>
        <button class="share-btn whatsapp" data-tooltip="Share on WhatsApp" onclick="shareWhatsApp()" aria-label="Share on WhatsApp">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
        </button>
        <button class="share-btn copy" data-tooltip="Copy link" onclick="copyLink()" aria-label="Copy article link">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="copy-icon"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="check-icon" style="display:none"><polyline points="20 6 9 17 4 12"></polyline></svg>
        </button>
    </aside>

    <script>
    (function(){const s=document.getElementById('shareButtons'),h=document.querySelector('.article-hero');if(s&&h){document.body.classList.add('has-share-buttons');new IntersectionObserver(e=>e.forEach(x=>s.classList.toggle('visible',!x.isIntersecting)),{threshold:.1}).observe(h)}})();
    function getShareData(){return{title:document.querySelector('meta[property="og:title"]')?.content||document.title,url:window.location.href}}
    function shareLinkedIn(){window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(getShareData().url)}`,'_blank','width=600,height=600')}
    function shareTwitter(){const d=getShareData();window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(d.title+' by @BagusDPermana')}&url=${encodeURIComponent(d.url)}`,'_blank','width=600,height=400')}
    function shareWhatsApp(){const d=getShareData();window.open(`https://wa.me/?text=${encodeURIComponent(d.title+'\n\n'+d.url)}`,'_blank')}
    function copyLink(){const b=document.querySelector('.share-btn.copy'),c=b.querySelector('.copy-icon'),k=b.querySelector('.check-icon');function onSuccess(){b.classList.add('copied');c.style.display='none';k.style.display='block';b.setAttribute('data-tooltip','Copied!');setTimeout(()=>{b.classList.remove('copied');c.style.display='block';k.style.display='none';b.setAttribute('data-tooltip','Copy link')},2000)}if(navigator.clipboard&&navigator.clipboard.writeText){navigator.clipboard.writeText(window.location.href).then(onSuccess).catch(()=>{const t=document.createElement('textarea');t.value=window.location.href;t.style.position='fixed';t.style.opacity='0';document.body.appendChild(t);t.select();document.execCommand('copy');document.body.removeChild(t);onSuccess()})}else{const t=document.createElement('textarea');t.value=window.location.href;t.style.position='fixed';t.style.opacity='0';document.body.appendChild(t);t.select();document.execCommand('copy');document.body.removeChild(t);onSuccess()}}

    // Scroll Progress Bar
    (function(){
        const bar = document.getElementById('progressBar');
        if (!bar) return;
        window.addEventListener('scroll', function() {
            const h = document.documentElement;
            const pct = (h.scrollTop / (h.scrollHeight - h.clientHeight)) * 100;
            bar.style.width = Math.min(pct, 100) + '%';
        }, { passive: true });
    })();

    // Animated Counter for Hero Stats
    (function(){
        const counters = document.querySelectorAll('.hero-stat .stat-num');
        if (!counters.length) return;
        let animated = false;
        const observer = new IntersectionObserver(entries => {
            entries.forEach(entry => {
                if (entry.isIntersecting && !animated) {
                    animated = true;
                    counters.forEach(el => {
                        const target = parseInt(el.dataset.target);
                        const prefix = el.dataset.prefix || '';
                        const suffix = el.dataset.suffix || '';
                        const duration = 2000;
                        const steps = 60;
                        const increment = target / steps;
                        let current = 0;
                        const timer = setInterval(() => {
                            current += increment;
                            if (current >= target) {
                                current = target;
                                clearInterval(timer);
                            }
                            el.textContent = prefix + Math.round(current) + suffix;
                        }, duration / steps);
                    });
                }
            });
        }, { threshold: 0.3 });
        const heroStats = document.querySelector('.hero-stats');
        if (heroStats) observer.observe(heroStats);
    })();
    </script>

    <!-- Pro Mode: Market Shaping Framework -->
    <script>
    (function(){
        'use strict';

        // ===== REGION DATA =====
        var MSF_REGIONS = {
            virginia:   { name:'Virginia, USA',    eRate:0.12, waterStress:1.0, regSeverity:72, laborMult:1.15, failClimate:1.0 },
            georgia:    { name:'Georgia, USA',     eRate:0.11, waterStress:0.8, regSeverity:55, laborMult:1.05, failClimate:1.05 },
            texas:      { name:'Texas, USA',       eRate:0.10, waterStress:1.3, regSeverity:40, laborMult:1.00, failClimate:1.15 },
            ireland:    { name:'Ireland, EU',      eRate:0.22, waterStress:0.3, regSeverity:85, laborMult:1.35, failClimate:0.85 },
            malaysia:   { name:'Malaysia (Johor)', eRate:0.08, waterStress:1.8, regSeverity:35, laborMult:0.55, failClimate:1.25 },
            indonesia:  { name:'Indonesia',        eRate:0.07, waterStress:1.2, regSeverity:30, laborMult:0.45, failClimate:1.30 },
            thailand:   { name:'Thailand',         eRate:0.09, waterStress:0.9, regSeverity:38, laborMult:0.50, failClimate:1.20 },
            singapore:  { name:'Singapore',        eRate:0.18, waterStress:2.0, regSeverity:92, laborMult:1.40, failClimate:1.10 }
        };

        // ===== TIER / SEGMENT DATA =====
        var MSF_TIERS = {
            'hyperscale':  { densityFactor:1.0,  complexMult:1.0,  skillReq:0.85 },
            'enterprise':  { densityFactor:1.3,  complexMult:1.2,  skillReq:1.00 },
            'industrial':  { densityFactor:1.5,  complexMult:1.4,  skillReq:0.90 },
            'edge':        { densityFactor:0.8,  complexMult:0.7,  skillReq:0.75 }
        };

        var MSF_CADENCE = {
            '8/5':  { weeklyHrs:40,  shiftMult:1.0,  fatigueFactor:0.3 },
            '12/7': { weeklyHrs:84,  shiftMult:2.4,  fatigueFactor:0.6 },
            '24/7': { weeklyHrs:168, shiftMult:4.2,  fatigueFactor:0.85 }
        };

        var MSF_SLA = {
            '99.9':   { nines:3, downtimeHrs:8.76,  bufferMult:1.0  },
            '99.95':  { nines:3.3, downtimeHrs:4.38, bufferMult:1.4  },
            '99.99':  { nines:4, downtimeHrs:0.876,  bufferMult:2.2  },
            '99.999': { nines:5, downtimeHrs:0.0876, bufferMult:3.8  }
        };

        var msfProMode = false;

        // ===== HELPERS =====
        function $id(id) { return document.getElementById(id); }

        function fmt(v) {
            if (v >= 1e9) return '$' + (v / 1e9).toFixed(1) + 'B';
            if (v >= 1e6) return '$' + (v / 1e6).toFixed(1) + 'M';
            if (v >= 1e3) return '$' + (v / 1e3).toFixed(0) + 'K';
            return '$' + v.toFixed(0);
        }

        function pct(v) { return v.toFixed(1) + '%'; }

        function clamp(v, lo, hi) { return Math.max(lo, Math.min(hi, v)); }

        // Box-Muller transform for normal random
        function randNorm(mu, sigma) {
            var u1, u2;
            do { u1 = Math.random(); } while (u1 === 0);
            u2 = Math.random();
            return mu + sigma * Math.sqrt(-2.0 * Math.log(u1)) * Math.cos(2.0 * Math.PI * u2);
        }

        function percentile(arr, p) {
            var idx = (p / 100) * (arr.length - 1);
            var lo = Math.floor(idx), hi = Math.ceil(idx);
            if (lo === hi) return arr[lo];
            return arr[lo] + (arr[hi] - arr[lo]) * (idx - lo);
        }

        // ===== GET INPUTS =====
        function getProInputs() {
            var regionKey = ($id('dcRegion') || {}).value || 'virginia';
            var region = MSF_REGIONS[regionKey] || MSF_REGIONS.virginia;
            var envKey = ($id('msfEnvironment') || {}).value || 'enterprise';
            var env = MSF_TIERS[envKey] || MSF_TIERS.enterprise;
            var cadenceKey = ($id('msfCadence') || {}).value || '24/7';
            var cadence = MSF_CADENCE[cadenceKey] || MSF_CADENCE['24/7'];
            var slaKey = ($id('msfSLA') || {}).value || '99.95';
            var sla = MSF_SLA[slaKey] || MSF_SLA['99.95'];

            return {
                assetCount: parseInt(($id('msfAssetCount') || {}).value) || 500,
                envKey: envKey,
                env: env,
                cadenceKey: cadenceKey,
                cadence: cadence,
                slaKey: slaKey,
                sla: sla,
                mtbf: parseInt(($id('msfMTBF') || {}).value) || 12000,
                laborCost: parseInt(($id('msfLaborCost') || {}).value) || 75,
                riskPct: parseInt(($id('msfRiskAppetite') || {}).value) || 75,
                regionKey: regionKey,
                region: region
            };
        }

        // ===== CORE ENGINE =====
        function msfCalcStochastic(inp) {
            // Failure rate: assets / MTBF gives failures per hour
            var failPerHr = (inp.assetCount * inp.env.densityFactor) / inp.mtbf;
            var failPerMonth = failPerHr * 730; // 730 hrs/month
            failPerMonth *= inp.region.failClimate; // climate adjustment

            // Average repair hours per failure
            var repairHrs = 2.5 * inp.env.complexMult * inp.sla.bufferMult * 0.5;

            // Reactive workload (hrs/month)
            var reactiveHrs = failPerMonth * repairHrs;

            // Preventive maintenance: 4 hrs per asset per year, divided by 12
            var pmHrsMonth = (inp.assetCount * 4 * inp.env.densityFactor) / 12;

            // Total workload hrs/month
            var totalWorkHrs = reactiveHrs + pmHrsMonth;

            // Available productive hrs per tech per month (wrench time ~35-55%)
            var wrenchTimePct = inp.cadence.fatigueFactor < 0.5 ? 0.52 : inp.cadence.fatigueFactor < 0.7 ? 0.42 : 0.35;
            var availHrsPerTech = (inp.cadence.weeklyHrs / 7) * 30 * wrenchTimePct;

            // Base headcount
            var baseHead = totalWorkHrs / Math.max(availHrsPerTech, 1);

            // Shift multiplier for coverage
            var shiftedHead = baseHead * inp.cadence.shiftMult;

            // SLA buffer
            var bufferedHead = shiftedHead * inp.sla.bufferMult;

            // Probabilistic headcount at P90
            var probHead = Math.ceil(bufferedHead * 1.28); // z=1.28 for P90

            // Surge vulnerability: how much demand can spike beyond capacity
            var surgeVuln = clamp((reactiveHrs / Math.max(pmHrsMonth + reactiveHrs, 1)) * 100, 0, 100);

            // SLA breach probability
            var utilization = totalWorkHrs / Math.max(bufferedHead * availHrsPerTech, 1);
            var slaBreach = clamp(Math.pow(utilization, 3.5) * 100, 0, 99.9);

            // MTTR forecast (queue-adjusted)
            var mttrForecast = repairHrs * (1 + utilization * 0.8);

            // Backlog growth rate (WO/month)
            var backlogGrowth = Math.max(0, (failPerMonth - (bufferedHead * availHrsPerTech / repairHrs)) * 0.3);

            // Reactive vs Proactive ratio
            var reactPct = Math.round((reactiveHrs / Math.max(totalWorkHrs, 1)) * 100);
            var proactPct = 100 - reactPct;

            // Operational stability index (lower variance = higher score)
            var stability = clamp(100 - (surgeVuln * 0.6 + slaBreach * 0.3 + backlogGrowth * 2), 0, 100);

            return {
                probHead: probHead,
                surgeVuln: surgeVuln,
                slaBreach: slaBreach,
                mttrForecast: mttrForecast,
                backlogGrowth: backlogGrowth,
                reactPct: reactPct,
                proactPct: proactPct,
                wrenchTimePct: wrenchTimePct * 100,
                stability: stability,
                baseHead: baseHead,
                bufferedHead: bufferedHead,
                totalWorkHrs: totalWorkHrs,
                reactiveHrs: reactiveHrs,
                pmHrsMonth: pmHrsMonth,
                utilization: utilization,
                failPerMonth: failPerMonth,
                repairHrs: repairHrs,
                availHrsPerTech: availHrsPerTech
            };
        }

        function msfCalcFinancial(inp, stoch) {
            var annualLabor = stoch.probHead * inp.laborCost * inp.cadence.weeklyHrs * 52;

            // Cost of Inaction: understaffing risk exposure
            var gapFTEs = Math.max(0, stoch.bufferedHead - stoch.baseHead);
            var coiPerFTE = inp.laborCost * 2.5 * 2080; // emergency premium 2.5x, 2080 hrs/yr
            var coi = gapFTEs * coiPerFTE * (stoch.slaBreach / 100 + 0.1);

            // OPEX leakage from inefficiency
            var opexLeak = annualLabor * (1 - stoch.wrenchTimePct / 100) * 0.35;

            // CAPEX avoidance from proper maintenance (15-20% asset life extension)
            var assetReplaceCost = inp.assetCount * 8500; // avg $8,500/asset/yr replacement cycle
            var capexAvoid = assetReplaceCost * 0.175; // 17.5% midpoint

            // ROI = (savings / investment) * 100
            var investmentCost = annualLabor * 0.08; // 8% optimization investment
            var totalSavings = opexLeak * 0.4 + capexAvoid * 0.6;
            var roi = investmentCost > 0 ? ((totalSavings - investmentCost) / investmentCost) * 100 : 0;

            // Financial exposure score (0-100)
            var finExposure = clamp((coi / Math.max(annualLabor, 1)) * 100, 0, 100);

            // Tech debt accrual ($/month)
            var techDebt = (stoch.backlogGrowth * stoch.repairHrs * inp.laborCost * 1.8);

            // Emergency spend forecast
            var emergSpend = stoch.reactiveHrs * 12 * inp.laborCost * 1.8 * (stoch.slaBreach / 100 + 0.15);

            // 5-Year TCO
            var annualTotal = annualLabor + emergSpend + techDebt * 12;
            var tco5 = 0;
            for (var y = 0; y < 5; y++) {
                tco5 += annualTotal * Math.pow(1.04, y); // 4% annual escalation
            }

            return {
                coi: coi,
                opexLeak: opexLeak,
                capexAvoid: capexAvoid,
                roi: roi,
                finExposure: finExposure,
                techDebt: techDebt,
                emergSpend: emergSpend,
                tco5: tco5,
                annualLabor: annualLabor
            };
        }

        function msfCalcHumanFactors(inp, stoch) {
            var util = stoch.utilization;

            // Burnout probability — exponential above 85% utilization
            var burnout = util > 0.85 ? clamp(50 + (util - 0.85) * 500, 50, 99) :
                          util > 0.70 ? clamp(15 + (util - 0.70) * 233, 15, 50) :
                          clamp(util * 20, 0, 15);

            // Fatigue risk score (shift x rotation x OT)
            var fatigue = clamp(inp.cadence.fatigueFactor * 100 * (1 + (util - 0.7) * 0.5), 0, 100);

            // Staffing elasticity — OHS improvement per additional hire
            var currentOHS = clamp(100 - burnout * 0.3 - fatigue * 0.3 - (100 - stoch.stability) * 0.2, 0, 100);
            var elasticity = stoch.probHead > 0 ? (100 - currentOHS) / stoch.probHead * 2.5 : 0;

            // Bus factor — critical skill coverage
            var busFactor = stoch.probHead < 3 ? 1 :
                            stoch.probHead < 8 ? 2 :
                            stoch.probHead < 15 ? 3 :
                            Math.min(Math.floor(stoch.probHead * 0.25), 8);

            // Retention risk
            var retention = clamp(burnout * 0.5 + fatigue * 0.3 + (util > 0.8 ? 20 : 0), 0, 95);

            // Cognitive load index (decision fatigue)
            var cogLoad = clamp(
                (stoch.failPerMonth / Math.max(stoch.probHead, 1)) * 8 +
                (inp.sla.nines - 3) * 15 +
                inp.cadence.fatigueFactor * 20,
                0, 100
            );

            // Safety incident probability
            var safetyProb = clamp(
                (fatigue / 100) * 0.15 + (cogLoad / 100) * 0.10 + (util > 0.9 ? 0.12 : 0),
                0, 0.95
            ) * 100;

            // Operational Health Score (master metric)
            var ohs = clamp(
                100 -
                burnout * 0.25 -
                fatigue * 0.20 -
                (100 - stoch.stability) * 0.20 -
                safetyProb * 0.15 -
                retention * 0.10 -
                cogLoad * 0.10,
                0, 100
            );

            return {
                burnout: burnout,
                fatigue: fatigue,
                elasticity: elasticity,
                busFactor: busFactor,
                retention: retention,
                cogLoad: cogLoad,
                safetyProb: safetyProb,
                ohs: ohs
            };
        }

        // ===== MONTE CARLO 10K =====
        function msfRunMonteCarlo(inp) {
            var N = 10000;
            var results = new Array(N);
            var base = msfCalcStochastic(inp);

            for (var i = 0; i < N; i++) {
                // Perturb key inputs
                var simAssets = Math.max(10, Math.round(randNorm(inp.assetCount, inp.assetCount * 0.12)));
                var simMTBF = Math.max(100, randNorm(inp.mtbf, inp.mtbf * 0.18));
                var simLabor = Math.max(25, randNorm(inp.laborCost, inp.laborCost * 0.10));
                var simFatigue = clamp(randNorm(inp.cadence.fatigueFactor, 0.08), 0.1, 1.0);
                var simClimate = Math.max(0.5, randNorm(inp.region.failClimate, 0.12));

                var failPerHr = (simAssets * inp.env.densityFactor) / simMTBF;
                var failPerMonth = failPerHr * 730 * simClimate;
                var repairHrs = 2.5 * inp.env.complexMult * inp.sla.bufferMult * 0.5;
                var reactiveHrs = failPerMonth * repairHrs;
                var pmHrsMonth = (simAssets * 4 * inp.env.densityFactor) / 12;
                var totalWork = reactiveHrs + pmHrsMonth;
                var wrench = simFatigue < 0.5 ? 0.52 : simFatigue < 0.7 ? 0.42 : 0.35;
                var availHrs = (inp.cadence.weeklyHrs / 7) * 30 * wrench;
                var head = (totalWork / Math.max(availHrs, 1)) * inp.cadence.shiftMult * inp.sla.bufferMult;
                results[i] = Math.ceil(head);
            }

            results.sort(function(a, b) { return a - b; });

            var p5 = percentile(results, 5);
            var p25 = percentile(results, 25);
            var p50 = percentile(results, 50);
            var p75 = percentile(results, 75);
            var p95 = percentile(results, 95);

            // CVaR-95: average of worst 5% outcomes
            var tail5 = Math.ceil(N * 0.95);
            var cvarSum = 0, cvarCount = 0;
            for (var j = tail5; j < N; j++) {
                cvarSum += results[j];
                cvarCount++;
            }
            var cvar95 = cvarCount > 0 ? cvarSum / cvarCount : p95;

            // CVaR shortfall relative to selected risk percentile
            var selectedP = percentile(results, inp.riskPct);
            var cvarShortfall = Math.max(0, cvar95 - selectedP);

            return {
                results: results,
                p5: p5,
                p25: p25,
                p50: p50,
                p75: p75,
                p95: p95,
                cvar95: cvar95,
                cvarShortfall: cvarShortfall,
                selectedP: selectedP
            };
        }

        // ===== SENSITIVITY ANALYSIS (5 FACTORS) =====
        function msfRunSensitivity(inp) {
            var baseStoch = msfCalcStochastic(inp);
            var baseHead = baseStoch.probHead;

            var factors = [
                { name: 'Asset Count',   key: 'assetCount', pctSwing: 0.10 },
                { name: 'MTBF',          key: 'mtbf',       pctSwing: 0.10 },
                { name: 'Labor Cost',    key: 'laborCost',  pctSwing: 0.10 },
                { name: 'Shift Fatigue', key: '_fatigue',   pctSwing: 0.10 },
                { name: 'Climate Risk',  key: '_climate',   pctSwing: 0.10 }
            ];

            var results = [];
            for (var i = 0; i < factors.length; i++) {
                var f = factors[i];
                var upInp = JSON.parse(JSON.stringify(inp));
                var dnInp = JSON.parse(JSON.stringify(inp));

                // Reattach object references
                upInp.env = MSF_TIERS[upInp.envKey];
                upInp.cadence = MSF_CADENCE[upInp.cadenceKey];
                upInp.sla = MSF_SLA[upInp.slaKey];
                upInp.region = MSF_REGIONS[upInp.regionKey];
                dnInp.env = MSF_TIERS[dnInp.envKey];
                dnInp.cadence = MSF_CADENCE[dnInp.cadenceKey];
                dnInp.sla = MSF_SLA[dnInp.slaKey];
                dnInp.region = MSF_REGIONS[dnInp.regionKey];

                if (f.key === '_fatigue') {
                    upInp.cadence = { weeklyHrs: inp.cadence.weeklyHrs, shiftMult: inp.cadence.shiftMult, fatigueFactor: Math.min(1, inp.cadence.fatigueFactor * (1 + f.pctSwing)) };
                    dnInp.cadence = { weeklyHrs: inp.cadence.weeklyHrs, shiftMult: inp.cadence.shiftMult, fatigueFactor: Math.max(0.1, inp.cadence.fatigueFactor * (1 - f.pctSwing)) };
                } else if (f.key === '_climate') {
                    upInp.region = Object.assign({}, inp.region, { failClimate: inp.region.failClimate * (1 + f.pctSwing) });
                    dnInp.region = Object.assign({}, inp.region, { failClimate: Math.max(0.5, inp.region.failClimate * (1 - f.pctSwing)) });
                } else {
                    upInp[f.key] = Math.round(inp[f.key] * (1 + f.pctSwing));
                    dnInp[f.key] = Math.round(inp[f.key] * (1 - f.pctSwing));
                }

                var upHead = msfCalcStochastic(upInp).probHead;
                var dnHead = msfCalcStochastic(dnInp).probHead;

                results.push({
                    name: f.name,
                    upVal: upHead,
                    downVal: dnHead,
                    absSwing: Math.abs(upHead - dnHead),
                    impact: baseHead > 0 ? ((upHead - baseHead) / baseHead) * 100 : 0
                });
            }

            results.sort(function(a, b) { return b.absSwing - a.absSwing; });
            return results;
        }

        // ===== NARRATIVE GENERATOR =====
        function msfGenerateNarrative(inp, stoch, fin, human, mc, sens) {
            var html = '';

            // Para 1: BLUF
            var riskLevel = human.ohs >= 75 ? 'healthy' : human.ohs >= 50 ? 'strained' : 'critical';
            html += '<h4><i class="fas fa-crosshairs"></i> Executive BLUF</h4>';
            html += '<p>For a <strong>' + inp.assetCount + '-asset ' + inp.envKey + ' facility</strong> operating on a ' + inp.cadenceKey + ' cadence at ' + inp.slaKey + '% SLA, the Monte Carlo simulation recommends <strong>' + mc.p50 + ' FTEs at P50</strong> (median) and <strong>' + mc.p95 + ' FTEs at P95</strong> (conservative). The Operational Health Score stands at <strong>' + human.ohs.toFixed(0) + '/100</strong> (' + riskLevel + '), with a ' + pct(stoch.slaBreach) + ' SLA breach probability. Current utilization at ' + pct(stoch.utilization * 100) + ' places the workforce in the <strong>' + (stoch.utilization > 0.85 ? 'red zone (>85%)' : stoch.utilization > 0.70 ? 'amber zone (70-85%)' : 'green zone (<70%)') + '</strong>.</p>';

            // Para 2: Financial
            html += '<h4><i class="fas fa-coins"></i> Financial Exposure</h4>';
            html += '<p>The <strong>Cost of Inaction</strong> is estimated at <strong>' + fmt(fin.coi) + '/year</strong>, representing the risk-weighted exposure from understaffing. OPEX leakage from wrench-time inefficiency runs at <strong>' + fmt(fin.opexLeak) + '/year</strong>, while proper preventive maintenance could avoid <strong>' + fmt(fin.capexAvoid) + '</strong> in premature asset replacement. The 5-year Total Cost of Ownership projects to <strong>' + fmt(fin.tco5) + '</strong>, with emergency premium spending consuming <strong>' + fmt(fin.emergSpend) + '/year</strong>. Technical debt accrues at <strong>' + fmt(fin.techDebt) + '/month</strong> from deferred maintenance backlog.</p>';

            // Para 3: Human factors
            html += '<h4><i class="fas fa-user-shield"></i> Human Factors Assessment</h4>';
            html += '<p>Burnout probability stands at <strong>' + pct(human.burnout) + '</strong>' + (human.burnout > 60 ? ' (critical threshold exceeded)' : '') + ', with fatigue risk at <strong>' + pct(human.fatigue) + '</strong>. The bus factor of <strong>' + human.busFactor + '</strong> indicates ' + (human.busFactor <= 2 ? 'extreme single-point-of-failure vulnerability' : human.busFactor <= 4 ? 'moderate key-person dependency' : 'adequate skill distribution') + '. Annual retention risk is <strong>' + pct(human.retention) + '</strong>, and cognitive load index at <strong>' + human.cogLoad.toFixed(0) + '/100</strong> ' + (human.cogLoad > 70 ? 'suggests decision fatigue is significantly degrading quality' : 'is within manageable bounds') + '. Safety incident probability is <strong>' + pct(human.safetyProb) + '/year</strong>.</p>';

            // Para 4: Sensitivity + recommendation
            var topDriver = sens.length > 0 ? sens[0].name : 'Asset Count';
            var secondDriver = sens.length > 1 ? sens[1].name : 'MTBF';
            html += '<h4><i class="fas fa-chart-bar"></i> Sensitivity & Recommendations</h4>';
            html += '<p>Sensitivity analysis reveals <strong>' + topDriver + '</strong> as the primary staffing driver (swing of ' + (sens.length > 0 ? sens[0].absSwing : 0) + ' FTEs at +/-10%), followed by <strong>' + secondDriver + '</strong>. ';
            if (human.ohs < 50) {
                html += 'The current configuration is in <strong>critical condition</strong>. Immediate actions: (1) Add ' + Math.max(1, Math.ceil(stoch.probHead * 0.2)) + ' FTEs minimum to exit the red zone, (2) Implement predictive maintenance to reduce reactive ratio from ' + stoch.reactPct + ':' + stoch.proactPct + ' toward the 20:80 target, (3) Review shift rotation to reduce fatigue risk, (4) Establish a contingency staffing budget of ' + fmt(fin.emergSpend * 0.3) + ' for surge coverage.</p>';
            } else if (human.ohs < 75) {
                html += 'The operation is <strong>functional but strained</strong>. Priority actions: (1) Increase proactive maintenance share from ' + stoch.proactPct + '% toward 80%, (2) Improve wrench-time efficiency from ' + stoch.wrenchTimePct.toFixed(0) + '% toward 55%+ through better scheduling, (3) Cross-train to improve bus factor from ' + human.busFactor + ' to ' + Math.min(human.busFactor + 2, 8) + ', (4) Allocate ' + fmt(fin.coi * 0.15) + ' for CMMS/workflow optimization.</p>';
            } else {
                html += 'The operation is <strong>well-positioned</strong>. Optimization opportunities: (1) Maintain reactive:proactive ratio at or below ' + stoch.reactPct + ':' + stoch.proactPct + ', (2) Explore predictive analytics to further extend MTBF, (3) Consider automation for routine PM tasks to improve wrench-time beyond ' + stoch.wrenchTimePct.toFixed(0) + '%, (4) Reinvest ' + fmt(fin.capexAvoid * 0.2) + ' of CAPEX savings into workforce development.</p>';
            }

            return html;
        }

        // ===== CANVAS RENDERERS =====
        function msfDrawHistogram(mc) {
            var canvas = $id('msfHistogramChart');
            if (!canvas) return;
            var ctx = canvas.getContext('2d');
            var W = canvas.width = canvas.parentElement.offsetWidth || 600;
            var H = canvas.height = 250;
            ctx.clearRect(0, 0, W, H);

            var results = mc.results;
            var minV = results[0], maxV = results[results.length - 1];
            var range = maxV - minV || 1;
            var numBins = 50;
            var bins = new Array(numBins).fill(0);
            for (var i = 0; i < results.length; i++) {
                var b = Math.min(Math.floor((results[i] - minV) / range * numBins), numBins - 1);
                bins[b]++;
            }
            var maxBin = Math.max.apply(null, bins);

            var padL = 50, padR = 20, padT = 35, padB = 45;
            var chartW = W - padL - padR;
            var chartH = H - padT - padB;
            var barW = chartW / numBins;

            // Title
            ctx.fillStyle = '#f1f5f9';
            ctx.font = 'bold 12px Inter, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Staffing Demand Distribution — 10,000 Monte Carlo Iterations', W / 2, 18);

            // Bars
            for (var j = 0; j < numBins; j++) {
                var x = padL + j * barW;
                var barH = maxBin > 0 ? (bins[j] / maxBin) * chartH : 0;
                var y = padT + chartH - barH;
                var binCenter = minV + (j + 0.5) * range / numBins;
                ctx.fillStyle = binCenter <= mc.p5 ? '#10b981' :
                               binCenter <= mc.p50 ? '#0ea5e9' :
                               binCenter <= mc.p95 ? '#f97316' : '#ef4444';
                ctx.fillRect(x, y, Math.max(barW - 1, 1), barH);
            }

            // Percentile lines
            var lines = [
                { v: mc.p5,  label: 'P5=' + mc.p5,  color: '#10b981' },
                { v: mc.p25, label: 'P25=' + mc.p25, color: '#22d3ee' },
                { v: mc.p50, label: 'P50=' + mc.p50, color: '#0ea5e9' },
                { v: mc.p75, label: 'P75=' + mc.p75, color: '#f97316' },
                { v: mc.p95, label: 'P95=' + mc.p95, color: '#ef4444' }
            ];
            for (var k = 0; k < lines.length; k++) {
                var lx = padL + ((lines[k].v - minV) / range) * chartW;
                ctx.beginPath();
                ctx.strokeStyle = lines[k].color;
                ctx.lineWidth = 1.5;
                ctx.setLineDash([5, 3]);
                ctx.moveTo(lx, padT);
                ctx.lineTo(lx, padT + chartH);
                ctx.stroke();
                ctx.setLineDash([]);
                ctx.fillStyle = lines[k].color;
                ctx.font = 'bold 9px Inter, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(lines[k].label, lx, padT + chartH + 14 + (k % 2) * 12);
            }

            // Y-axis label
            ctx.fillStyle = '#94a3b8';
            ctx.font = '10px Inter, sans-serif';
            ctx.textAlign = 'center';
            ctx.save();
            ctx.translate(14, padT + chartH / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('Frequency', 0, 0);
            ctx.restore();

            // X-axis label
            ctx.fillText('FTE Headcount', W / 2, H - 4);
        }

        function msfDrawTornado(sens, baseHead) {
            var canvas = $id('msfTornadoChart');
            if (!canvas) return;
            var ctx = canvas.getContext('2d');
            var W = canvas.width = canvas.parentElement.offsetWidth || 600;
            var H = canvas.height = 220;
            ctx.clearRect(0, 0, W, H);

            if (!sens || sens.length === 0) return;

            var maxSwing = Math.max.apply(null, sens.map(function(d) { return d.absSwing; })) || 1;
            var padL = 130, padR = 80, padT = 30, padB = 20;
            var chartW = (W - padL - padR) / 2;
            var centerX = padL + chartW;
            var barH = Math.min(28, (H - padT - padB) / sens.length - 4);
            var gap = 4;

            // Title
            ctx.fillStyle = '#f1f5f9';
            ctx.font = 'bold 12px Inter, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Sensitivity Tornado — Staffing Impact (+/-10%)', W / 2, 16);

            // Center line
            ctx.beginPath();
            ctx.strokeStyle = '#475569';
            ctx.lineWidth = 1;
            ctx.setLineDash([3, 3]);
            ctx.moveTo(centerX, padT);
            ctx.lineTo(centerX, padT + sens.length * (barH + gap));
            ctx.stroke();
            ctx.setLineDash([]);
            ctx.fillStyle = '#94a3b8';
            ctx.font = '9px Inter, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Base: ' + baseHead + ' FTEs', centerX, padT - 4);

            for (var i = 0; i < sens.length; i++) {
                var d = sens[i];
                var y = padT + i * (barH + gap);

                // Right bar (upside)
                var upDelta = d.upVal - baseHead;
                var upW = maxSwing > 0 ? (Math.abs(upDelta) / maxSwing) * chartW : 0;
                if (upDelta >= 0) {
                    ctx.fillStyle = '#ef4444';
                    ctx.fillRect(centerX, y, upW, barH);
                } else {
                    ctx.fillStyle = '#0ea5e9';
                    ctx.fillRect(centerX - Math.abs(upDelta) / maxSwing * chartW, y, Math.abs(upDelta) / maxSwing * chartW, barH);
                }

                // Left bar (downside)
                var dnDelta = baseHead - d.downVal;
                var dnW = maxSwing > 0 ? (Math.abs(dnDelta) / maxSwing) * chartW : 0;
                if (dnDelta >= 0) {
                    ctx.fillStyle = '#0ea5e9';
                    ctx.fillRect(centerX - dnW, y, dnW, barH);
                } else {
                    ctx.fillStyle = '#ef4444';
                    ctx.fillRect(centerX, y, Math.abs(dnDelta) / maxSwing * chartW, barH);
                }

                // Labels
                ctx.fillStyle = '#e2e8f0';
                ctx.font = '11px Inter, sans-serif';
                ctx.textAlign = 'right';
                ctx.fillText(d.name, padL - 8, y + barH / 2 + 4);

                // Value labels
                ctx.font = 'bold 9px Inter, sans-serif';
                ctx.textAlign = 'left';
                ctx.fillStyle = '#ef4444';
                var rightEdge = centerX + (upDelta >= 0 ? upW : 0) + 4;
                ctx.fillText(d.upVal + ' FTE', rightEdge, y + barH / 2 + 3);

                ctx.textAlign = 'right';
                ctx.fillStyle = '#0ea5e9';
                var leftEdge = centerX - (dnDelta >= 0 ? dnW : 0) - 4;
                ctx.fillText(d.downVal + ' FTE', leftEdge, y + barH / 2 + 3);
            }
        }

        // ===== UPDATE PANELS =====
        function updateMsfProPanels() {
            var inp = getProInputs();
            var stoch = msfCalcStochastic(inp);
            var fin = msfCalcFinancial(inp, stoch);
            var human = msfCalcHumanFactors(inp, stoch);
            var mc = msfRunMonteCarlo(inp);
            var sens = msfRunSensitivity(inp);

            // Panel 1: Stochastic
            $id('msfProbHead').textContent = stoch.probHead + ' FTEs';
            $id('msfSurgeVuln').textContent = pct(stoch.surgeVuln);
            $id('msfSurgeBar').style.width = stoch.surgeVuln + '%';
            $id('msfSurgeBar').className = 'msf-score-bar-fill ' + (stoch.surgeVuln > 65 ? 'risk-high' : stoch.surgeVuln > 35 ? 'risk-med' : 'risk-low');
            $id('msfSLABreach').textContent = pct(stoch.slaBreach);
            $id('msfMTTR').textContent = stoch.mttrForecast.toFixed(1) + ' hrs';
            $id('msfBacklog').textContent = stoch.backlogGrowth.toFixed(1) + ' WO/mo';
            $id('msfReactProact').textContent = stoch.reactPct + ':' + stoch.proactPct;
            $id('msfWrenchTime').textContent = stoch.wrenchTimePct.toFixed(0) + '%';
            $id('msfStabilityIdx').textContent = stoch.stability.toFixed(0) + '/100';
            $id('msfStabilityBar').style.width = stoch.stability + '%';
            $id('msfStabilityBar').className = 'msf-score-bar-fill ' + (stoch.stability >= 70 ? 'risk-low' : stoch.stability >= 40 ? 'risk-med' : 'risk-high');

            // Panel 2: Financial
            $id('msfCOI').textContent = fmt(fin.coi);
            $id('msfOPEXLeak').textContent = fmt(fin.opexLeak);
            $id('msfCAPEXAvoid').textContent = fmt(fin.capexAvoid);
            $id('msfROI').textContent = fin.roi.toFixed(0) + '%';
            $id('msfFinExposure').textContent = fin.finExposure.toFixed(0) + '/100';
            $id('msfFinExpBar').style.width = fin.finExposure + '%';
            $id('msfFinExpBar').className = 'msf-score-bar-fill ' + (fin.finExposure > 65 ? 'risk-high' : fin.finExposure > 35 ? 'risk-med' : 'risk-low');
            $id('msfTechDebt').textContent = fmt(fin.techDebt);
            $id('msfEmergSpend').textContent = fmt(fin.emergSpend);
            $id('msfTCO').textContent = fmt(fin.tco5);

            // Panel 3: Human Factors
            $id('msfBurnout').textContent = pct(human.burnout);
            $id('msfBurnoutBar').style.width = human.burnout + '%';
            $id('msfBurnoutBar').className = 'msf-score-bar-fill ' + (human.burnout > 60 ? 'risk-high' : human.burnout > 30 ? 'risk-med' : 'risk-low');
            $id('msfFatigue').textContent = human.fatigue.toFixed(0) + '/100';
            $id('msfElasticity').textContent = '+' + human.elasticity.toFixed(1) + ' OHS/hire';
            $id('msfBusFactor').textContent = human.busFactor + ' people';
            $id('msfRetention').textContent = pct(human.retention);
            $id('msfCogLoad').textContent = human.cogLoad.toFixed(0) + '/100';
            $id('msfSafetyProb').textContent = pct(human.safetyProb);
            $id('msfOHS').textContent = human.ohs.toFixed(0) + '/100';
            $id('msfOHSBar').style.width = human.ohs + '%';
            $id('msfOHSBar').className = 'msf-score-bar-fill ' + (human.ohs >= 70 ? 'risk-low' : human.ohs >= 40 ? 'risk-med' : 'risk-high');

            // Panel 4: Monte Carlo
            $id('msfMCP5').textContent = mc.p5 + ' FTEs';
            $id('msfMCP25').textContent = mc.p25 + ' FTEs';
            $id('msfMCP50').textContent = mc.p50 + ' FTEs';
            $id('msfMCP75').textContent = mc.p75 + ' FTEs';
            $id('msfMCP95').textContent = mc.p95 + ' FTEs';
            $id('msfCVaR').textContent = mc.cvarShortfall.toFixed(1) + ' FTEs';

            // Draw charts
            msfDrawHistogram(mc);
            msfDrawTornado(sens, stoch.probHead);

            // Panel 5: Narrative
            $id('msfNarrativeText').innerHTML = msfGenerateNarrative(inp, stoch, fin, human, mc, sens);
        }

        // ===== AUTH =====
        function msfCheckAuth() {
            try {
                var raw = localStorage.getItem('rz_premium_session');
                if (!raw) return false;
                var session = JSON.parse(raw);
                if (!session || session.tier !== 'pro') return false;
                if (new Date(session.expires) < new Date()) {
                    localStorage.removeItem('rz_premium_session');
                    return false;
                }
                return true;
            } catch (e) { return false; }
        }

        // Expose globally for DOMContentLoaded handler
        window.msfCheckAuth = msfCheckAuth;

        function msfUnlockPanels() {
            msfProMode = true;
            var proInputs = $id('msfProInputs');
            if (proInputs) proInputs.style.display = '';
            document.querySelectorAll('.msf-pro-panel').forEach(function(p) {
                p.style.display = '';
                p.classList.remove('gated');
                var overlay = p.querySelector('.msf-gate-overlay');
                if (overlay) overlay.style.display = 'none';
            });
            var pdfBtn = $id('msfPdfBtn');
            if (pdfBtn) pdfBtn.style.display = '';
            $id('msfProBtn').classList.add('active');
            $id('msfFreeBtn').classList.remove('active');
            updateMsfProPanels();
        }

        function msfLockPanels() {
            msfProMode = false;
            var proInputs = $id('msfProInputs');
            if (proInputs) proInputs.style.display = 'none';
            document.querySelectorAll('.msf-pro-panel').forEach(function(p) {
                p.style.display = 'none';
                p.classList.add('gated');
                var overlay = p.querySelector('.msf-gate-overlay');
                if (overlay) overlay.style.display = '';
            });
            var pdfBtn = $id('msfPdfBtn');
            if (pdfBtn) pdfBtn.style.display = 'none';
            $id('msfFreeBtn').classList.add('active');
            $id('msfProBtn').classList.remove('active');
        }

        // ===== WINDOW FUNCTIONS =====
        window.msfSetMode = function(mode) {
            if (mode === 'pro') {
                if (msfCheckAuth()) { msfUnlockPanels(); }
                else { msfShowLogin(); }
            } else {
                msfLockPanels();
            }
        };

        window.msfShowLogin = function() {
            $id('msfLoginOverlay').classList.add('active');
            $id('msfLoginError').style.display = 'none';
            $id('msfLoginEmail').value = '';
            $id('msfLoginPass').value = '';
            setTimeout(function() { $id('msfLoginEmail').focus(); }, 100);
        };

        window.msfHideLogin = function() {
            $id('msfLoginOverlay').classList.remove('active');
        };

        window.msfDoLogin = function() {
            var email = $id('msfLoginEmail').value.trim().toLowerCase();
            var pass = $id('msfLoginPass').value;
            if (email === 'demo@resistancezero.com' && pass === 'demo2026') {
                var session = {
                    email: email,
                    tier: 'pro',
                    expires: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString()
                };
                localStorage.setItem('rz_premium_session', JSON.stringify(session));
                window.dispatchEvent(new Event('rz-auth-change'));
                msfHideLogin();
                msfUnlockPanels();
            } else {
                $id('msfLoginError').style.display = 'block';
            }
        };

        window.msfCalculatePro = function() {
            if (msfProMode) updateMsfProPanels();
        };

        // ===== PDF EXPORT =====
        window.msfExportPDF = function() {
            if (!msfCheckAuth()) { msfShowLogin(); return; }
            var w = window.open('', '_blank');
            if (!w) { alert('Please allow popups for this site to export PDF.'); return; }

            var inp = getProInputs();
            var stoch = msfCalcStochastic(inp);
            var fin = msfCalcFinancial(inp, stoch);
            var human = msfCalcHumanFactors(inp, stoch);
            var mc = msfRunMonteCarlo(inp);
            var sens = msfRunSensitivity(inp);
            var narrative = msfGenerateNarrative(inp, stoch, fin, human, mc, sens);

            // SVG Histogram
            function buildHistogramSVG() {
                var results = mc.results;
                var minV = results[0], maxV = results[results.length - 1], range = maxV - minV || 1;
                var numBins = 40, bins = new Array(numBins).fill(0);
                for (var i = 0; i < results.length; i++) {
                    var b = Math.min(Math.floor((results[i] - minV) / range * numBins), numBins - 1);
                    bins[b]++;
                }
                var maxBin = Math.max.apply(null, bins);
                var svgW = 520, svgH = 200, bW = (svgW - 60) / numBins;
                var svg = '<svg xmlns="http://www.w3.org/2000/svg" width="' + svgW + '" height="' + svgH + '" viewBox="0 0 ' + svgW + ' ' + svgH + '">';
                svg += '<rect width="' + svgW + '" height="' + svgH + '" fill="#f8fafc"/>';
                svg += '<text x="' + (svgW / 2) + '" y="18" text-anchor="middle" fill="#1f2937" font-family="Inter,sans-serif" font-size="12" font-weight="bold">Staffing Demand Distribution (10K Simulations)</text>';
                for (var j = 0; j < numBins; j++) {
                    var x = 30 + j * bW;
                    var barH = maxBin > 0 ? (bins[j] / maxBin) * 140 : 0;
                    var y = 170 - barH;
                    var bc = minV + (j + 0.5) * range / numBins;
                    var color = bc <= mc.p5 ? '#10b981' : bc <= mc.p50 ? '#0ea5e9' : bc <= mc.p95 ? '#f97316' : '#ef4444';
                    svg += '<rect x="' + x + '" y="' + y + '" width="' + Math.max(bW - 0.5, 0.5) + '" height="' + barH + '" fill="' + color + '"/>';
                }
                var pLines = [
                    { v: mc.p5,  l: 'P5=' + mc.p5, c: '#10b981' },
                    { v: mc.p50, l: 'P50=' + mc.p50, c: '#0ea5e9' },
                    { v: mc.p95, l: 'P95=' + mc.p95, c: '#ef4444' }
                ];
                for (var k = 0; k < pLines.length; k++) {
                    var px = 30 + ((pLines[k].v - minV) / range) * (svgW - 60);
                    svg += '<line x1="' + px + '" y1="28" x2="' + px + '" y2="170" stroke="' + pLines[k].c + '" stroke-width="1.5" stroke-dasharray="4,3"/>';
                    svg += '<text x="' + px + '" y="185" text-anchor="middle" fill="' + pLines[k].c + '" font-family="Inter,sans-serif" font-size="9" font-weight="bold">' + pLines[k].l + '</text>';
                }
                svg += '</svg>';
                return svg;
            }

            // SVG Tornado
            function buildTornadoSVG() {
                var svgW = 520, svgH = 180;
                var maxSw = Math.max.apply(null, sens.map(function(d) { return d.absSwing; })) || 1;
                var barHt = 26, gp = 6, startY = 35;
                var cX = svgW * 0.55, maxBW = svgW * 0.28;
                var svg = '<svg xmlns="http://www.w3.org/2000/svg" width="' + svgW + '" height="' + svgH + '" viewBox="0 0 ' + svgW + ' ' + svgH + '">';
                svg += '<rect width="' + svgW + '" height="' + svgH + '" fill="#f8fafc"/>';
                svg += '<text x="' + (svgW / 2) + '" y="18" text-anchor="middle" fill="#1f2937" font-family="Inter,sans-serif" font-size="12" font-weight="bold">Sensitivity Tornado (FTE Impact +/-10%)</text>';
                svg += '<line x1="' + cX + '" y1="' + (startY - 5) + '" x2="' + cX + '" y2="' + (startY + sens.length * (barHt + gp)) + '" stroke="#94a3b8" stroke-width="1" stroke-dasharray="3,3"/>';
                svg += '<text x="' + cX + '" y="' + (startY - 8) + '" text-anchor="middle" fill="#64748b" font-family="Inter,sans-serif" font-size="8">Base: ' + stoch.probHead + ' FTEs</text>';
                for (var i = 0; i < sens.length; i++) {
                    var d = sens[i];
                    var yy = startY + i * (barHt + gp);
                    var upDelta = d.upVal - stoch.probHead;
                    var dnDelta = stoch.probHead - d.downVal;
                    if (upDelta > 0) {
                        var uW = (upDelta / maxSw) * maxBW;
                        svg += '<rect x="' + cX + '" y="' + yy + '" width="' + uW + '" height="' + barHt + '" fill="#ef4444" rx="3"/>';
                        svg += '<text x="' + (cX + uW + 4) + '" y="' + (yy + barHt / 2 + 4) + '" fill="#dc2626" font-family="Inter,sans-serif" font-size="9" font-weight="bold">+' + upDelta + '</text>';
                    }
                    if (dnDelta > 0) {
                        var dW = (dnDelta / maxSw) * maxBW;
                        svg += '<rect x="' + (cX - dW) + '" y="' + yy + '" width="' + dW + '" height="' + barHt + '" fill="#0ea5e9" rx="3"/>';
                        svg += '<text x="' + (cX - dW - 4) + '" y="' + (yy + barHt / 2 + 4) + '" text-anchor="end" fill="#0ea5e9" font-family="Inter,sans-serif" font-size="9" font-weight="bold">-' + dnDelta + '</text>';
                    }
                    svg += '<text x="' + (cX - maxBW - 12) + '" y="' + (yy + barHt / 2 + 4) + '" text-anchor="end" fill="#1f2937" font-family="Inter,sans-serif" font-size="10">' + d.name + '</text>';
                }
                svg += '</svg>';
                return svg;
            }

            var html = '<!DOCTYPE html><html><head><meta charset="UTF-8">';
            html += '<title>Market Shaping Framework — Staffing Optimization Report</title>';
            html += '<style>';
            html += 'body{font-family:Inter,Helvetica,Arial,sans-serif;color:#1f2937;max-width:800px;margin:0 auto;padding:40px 30px;font-size:11pt;line-height:1.6}';
            html += 'h1{color:#9a3412;font-size:22pt;margin-bottom:4px;border-bottom:3px solid #f97316;padding-bottom:8px}';
            html += 'h2{color:#9a3412;font-size:14pt;margin-top:28px;margin-bottom:10px;border-bottom:1px solid #e5e7eb;padding-bottom:4px}';
            html += 'h3{color:#9a3412;font-size:12pt;margin-top:20px}';
            html += '.subtitle{color:#64748b;font-size:10pt;margin-bottom:20px}';
            html += '.meta{display:flex;gap:12px;font-size:9pt;color:#64748b;margin-bottom:24px;flex-wrap:wrap}';
            html += '.meta span{background:#fff7ed;padding:3px 10px;border-radius:4px;border:1px solid #fed7aa}';
            html += 'table{width:100%;border-collapse:collapse;margin:12px 0;font-size:10pt}';
            html += 'th{background:#fff7ed;color:#9a3412;padding:8px 10px;text-align:left;font-weight:600;border-bottom:2px solid #fed7aa}';
            html += 'td{padding:7px 10px;border-bottom:1px solid #e5e7eb;color:#1f2937}';
            html += '.kpi-row{display:flex;flex-wrap:wrap;gap:8px;margin:10px 0}';
            html += '.kpi-item{flex:1;min-width:100px;background:#fffbeb;border:1px solid #fed7aa;border-radius:8px;padding:10px;text-align:center}';
            html += '.kpi-val{font-size:14pt;font-weight:800;color:#ea580c}';
            html += '.kpi-lbl{font-size:7.5pt;color:#64748b;margin-top:2px}';
            html += '.kpi-sub{font-size:7pt;color:#94a3b8}';
            html += '.narrative{background:#fff7ed;border-left:3px solid #f97316;padding:12px 16px;margin:14px 0;border-radius:0 8px 8px 0}';
            html += '.narrative p{color:#1f2937;font-size:9.5pt;margin:0 0 8px;line-height:1.6}';
            html += '.narrative p:last-child{margin-bottom:0}';
            html += '.narrative strong{color:#9a3412}';
            html += '.narrative h4{color:#9a3412;font-size:10pt;margin:12px 0 4px}';
            html += '.chart-wrap{text-align:center;margin:16px 0}';
            html += '.methodology{background:#f8fafc;padding:12px 16px;border-radius:8px;margin-top:24px;font-size:9pt;color:#64748b}';
            html += '.methodology h3{color:#9a3412;margin-top:0}';
            html += '.footer{margin-top:30px;padding-top:12px;border-top:1px solid #e5e7eb;font-size:8pt;color:#94a3b8;text-align:center}';
            html += '@media print{body{padding:20px}}';
            html += '</style></head><body>';

            html += '<h1>Market Shaping Framework</h1>';
            html += '<p class="subtitle">Maintenance Staffing Optimization Report — ' + inp.region.name + '</p>';
            html += '<div class="meta">';
            html += '<span>Region: ' + inp.region.name + '</span>';
            html += '<span>Assets: ' + inp.assetCount + '</span>';
            html += '<span>Environment: ' + inp.envKey + '</span>';
            html += '<span>Cadence: ' + inp.cadenceKey + '</span>';
            html += '<span>SLA: ' + inp.slaKey + '%</span>';
            html += '<span>MTBF: ' + inp.mtbf.toLocaleString() + 'h</span>';
            html += '<span>Risk: P' + inp.riskPct + '</span>';
            html += '<span>Generated: ' + new Date().toLocaleDateString() + '</span>';
            html += '</div>';

            // ── Executive Summary with Charts ──
            html += '<h2>Executive Summary</h2>';

            // Score badge
            var ohsGrade = human.ohs >= 90 ? 'A+' : human.ohs >= 80 ? 'A' : human.ohs >= 70 ? 'B' : human.ohs >= 60 ? 'C' : human.ohs >= 50 ? 'D' : 'F';
            var ohsColor = human.ohs >= 70 ? '#16a34a' : human.ohs >= 50 ? '#f97316' : '#dc2626';
            html += '<div style="display:flex;gap:16px;align-items:center;margin-bottom:16px;">';
            html += '<div style="width:80px;height:80px;border-radius:50%;background:' + ohsColor + ';display:flex;flex-direction:column;align-items:center;justify-content:center;color:#fff;"><div style="font-size:22pt;font-weight:800;line-height:1;">' + human.ohs.toFixed(0) + '</div><div style="font-size:7pt;font-weight:600;">OHS / 100</div></div>';
            html += '<div style="flex:1;"><div style="font-size:16pt;font-weight:800;color:#9a3412;">Grade: ' + ohsGrade + '</div>';
            html += '<div style="font-size:9pt;color:#64748b;">Operational Health Score across reliability, financial, and human factors dimensions</div></div>';
            html += '<div style="text-align:center;padding:8px 16px;background:#fff7ed;border:1px solid #fed7aa;border-radius:8px;"><div style="font-size:18pt;font-weight:800;color:#ea580c;">' + stoch.probHead + '</div><div style="font-size:8pt;color:#64748b;">Recommended FTEs</div></div>';
            html += '</div>';

            // SVG Radar — Multi-dimensional assessment
            var radarDims = [
                { label: 'Reliability', value: stoch.stability },
                { label: 'Financial', value: Math.max(0, 100 - fin.finExposure) },
                { label: 'Workforce', value: Math.max(0, 100 - human.burnout) },
                { label: 'Safety', value: Math.max(0, 100 - human.safetyProb) },
                { label: 'Efficiency', value: stoch.wrenchTimePct },
                { label: 'Resilience', value: human.ohs }
            ];
            var rCx = 160, rCy = 130, rR = 100, rN = radarDims.length;
            var radarSvg = '<svg xmlns="http://www.w3.org/2000/svg" width="520" height="260" viewBox="0 0 520 260">';
            radarSvg += '<rect width="520" height="260" fill="#f8fafc"/>';
            radarSvg += '<text x="260" y="18" text-anchor="middle" fill="#1f2937" font-family="Inter,sans-serif" font-size="12" font-weight="bold">Multi-Dimensional Staffing Assessment</text>';
            // Grid rings
            for (var ring = 1; ring <= 4; ring++) {
                var rr = rR * ring / 4;
                var pts = '';
                for (var rdi = 0; rdi < rN; rdi++) {
                    var ra = (Math.PI * 2 * rdi / rN) - Math.PI / 2;
                    pts += (rCx + rr * Math.cos(ra)).toFixed(1) + ',' + (rCy + rr * Math.sin(ra)).toFixed(1) + ' ';
                }
                radarSvg += '<polygon points="' + pts.trim() + '" fill="none" stroke="#e2e8f0" stroke-width="0.8"/>';
            }
            // Axes
            for (var rdi2 = 0; rdi2 < rN; rdi2++) {
                var ra2 = (Math.PI * 2 * rdi2 / rN) - Math.PI / 2;
                var ex = rCx + rR * Math.cos(ra2), ey = rCy + rR * Math.sin(ra2);
                radarSvg += '<line x1="' + rCx + '" y1="' + rCy + '" x2="' + ex.toFixed(1) + '" y2="' + ey.toFixed(1) + '" stroke="#cbd5e1" stroke-width="0.5"/>';
                var lx = rCx + (rR + 16) * Math.cos(ra2), ly = rCy + (rR + 16) * Math.sin(ra2);
                var ta = Math.abs(Math.cos(ra2)) < 0.3 ? 'middle' : Math.cos(ra2) > 0 ? 'start' : 'end';
                radarSvg += '<text x="' + lx.toFixed(1) + '" y="' + (ly + 4).toFixed(1) + '" text-anchor="' + ta + '" fill="#64748b" font-family="Inter,sans-serif" font-size="9">' + radarDims[rdi2].label + ' (' + Math.round(radarDims[rdi2].value) + ')</text>';
            }
            // Data polygon
            var dataPts = '';
            for (var rdi3 = 0; rdi3 < rN; rdi3++) {
                var ra3 = (Math.PI * 2 * rdi3 / rN) - Math.PI / 2;
                var dv = Math.min(100, Math.max(0, radarDims[rdi3].value));
                var dx = rCx + (rR * dv / 100) * Math.cos(ra3), dy = rCy + (rR * dv / 100) * Math.sin(ra3);
                dataPts += dx.toFixed(1) + ',' + dy.toFixed(1) + ' ';
            }
            radarSvg += '<polygon points="' + dataPts.trim() + '" fill="rgba(249,115,22,0.2)" stroke="#f97316" stroke-width="2"/>';
            // Data points
            for (var rdi4 = 0; rdi4 < rN; rdi4++) {
                var ra4 = (Math.PI * 2 * rdi4 / rN) - Math.PI / 2;
                var dv2 = Math.min(100, Math.max(0, radarDims[rdi4].value));
                var dpx = rCx + (rR * dv2 / 100) * Math.cos(ra4), dpy = rCy + (rR * dv2 / 100) * Math.sin(ra4);
                radarSvg += '<circle cx="' + dpx.toFixed(1) + '" cy="' + dpy.toFixed(1) + '" r="4" fill="#f97316" stroke="#fff" stroke-width="1.5"/>';
            }

            // Right side: Key Metrics summary
            var smX = 340, smY = 40, smGap = 30;
            var summaryItems = [
                { label: 'Prob. Headcount', value: stoch.probHead + ' FTEs', color: '#ea580c' },
                { label: 'SLA Breach Risk', value: pct(stoch.slaBreach), color: stoch.slaBreach > 15 ? '#dc2626' : '#16a34a' },
                { label: 'Burnout Probability', value: pct(human.burnout), color: human.burnout > 40 ? '#dc2626' : '#16a34a' },
                { label: 'Cost of Inaction', value: fmt(fin.coi), color: '#ea580c' },
                { label: '5-Year TCO', value: fmt(fin.tco5), color: '#ea580c' },
                { label: 'Monte Carlo P95', value: mc.p95 + ' FTEs', color: '#dc2626' }
            ];
            for (var si2 = 0; si2 < summaryItems.length; si2++) {
                var sItem = summaryItems[si2];
                var sy = smY + si2 * smGap;
                radarSvg += '<text x="' + smX + '" y="' + sy + '" fill="#64748b" font-family="Inter,sans-serif" font-size="9">' + sItem.label + '</text>';
                radarSvg += '<text x="510" y="' + sy + '" text-anchor="end" fill="' + sItem.color + '" font-family="Inter,sans-serif" font-size="11" font-weight="bold">' + sItem.value + '</text>';
                if (si2 < summaryItems.length - 1) radarSvg += '<line x1="' + smX + '" y1="' + (sy + 8) + '" x2="510" y2="' + (sy + 8) + '" stroke="#f1f5f9" stroke-width="0.5"/>';
            }
            radarSvg += '</svg>';
            html += '<div class="chart-wrap">' + radarSvg + '</div>';

            // Staffing Breakdown Bar Chart
            var barSvg = '<svg xmlns="http://www.w3.org/2000/svg" width="520" height="120" viewBox="0 0 520 120">';
            barSvg += '<rect width="520" height="120" fill="#f8fafc"/>';
            barSvg += '<text x="260" y="18" text-anchor="middle" fill="#1f2937" font-family="Inter,sans-serif" font-size="12" font-weight="bold">Staffing Allocation: Current vs Recommended</text>';
            var barY = 35, barH = 28, barMax = Math.max(stoch.probHead, inp.currentStaff || stoch.probHead * 0.8, mc.p95) * 1.1;
            var curStaff = inp.currentStaff || Math.round(stoch.probHead * 0.8);
            var bars = [
                { label: 'Current Staff', value: curStaff, color: '#94a3b8' },
                { label: 'P50 Recommended', value: mc.p50, color: '#f97316' },
                { label: 'P95 Worst-Case', value: mc.p95, color: '#dc2626' }
            ];
            for (var bi = 0; bi < bars.length; bi++) {
                var by = barY + bi * (barH + 8);
                var bw = Math.max(2, (bars[bi].value / barMax) * 350);
                barSvg += '<text x="120" y="' + (by + barH / 2 + 4) + '" text-anchor="end" fill="#64748b" font-family="Inter,sans-serif" font-size="9">' + bars[bi].label + '</text>';
                barSvg += '<rect x="130" y="' + by + '" width="' + bw + '" height="' + barH + '" fill="' + bars[bi].color + '" rx="4"/>';
                barSvg += '<text x="' + (135 + bw) + '" y="' + (by + barH / 2 + 4) + '" fill="' + bars[bi].color + '" font-family="Inter,sans-serif" font-size="11" font-weight="bold">' + bars[bi].value + ' FTEs</text>';
            }
            barSvg += '</svg>';
            html += '<div class="chart-wrap">' + barSvg + '</div>';

            // Section 1: Stochastic
            html += '<h2>1. Stochastic Reliability Layer</h2>';
            html += '<div class="kpi-row">';
            html += '<div class="kpi-item"><div class="kpi-val">' + stoch.probHead + '</div><div class="kpi-lbl">Prob. Headcount (P90)</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + pct(stoch.surgeVuln) + '</div><div class="kpi-lbl">Surge Vulnerability</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + pct(stoch.slaBreach) + '</div><div class="kpi-lbl">SLA Breach Prob</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + stoch.mttrForecast.toFixed(1) + 'h</div><div class="kpi-lbl">MTTR Forecast</div></div>';
            html += '</div>';
            html += '<div class="kpi-row">';
            html += '<div class="kpi-item"><div class="kpi-val">' + stoch.backlogGrowth.toFixed(1) + '</div><div class="kpi-lbl">Backlog Growth (WO/mo)</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + stoch.reactPct + ':' + stoch.proactPct + '</div><div class="kpi-lbl">Reactive:Proactive</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + stoch.wrenchTimePct.toFixed(0) + '%</div><div class="kpi-lbl">Wrench Time</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + stoch.stability.toFixed(0) + '/100</div><div class="kpi-lbl">Stability Index</div></div>';
            html += '</div>';

            // Section 2: Financial
            html += '<h2>2. Financial Engineering Layer</h2>';
            html += '<div class="kpi-row">';
            html += '<div class="kpi-item"><div class="kpi-val">' + fmt(fin.coi) + '</div><div class="kpi-lbl">Cost of Inaction</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + fmt(fin.opexLeak) + '</div><div class="kpi-lbl">OPEX Leakage</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + fmt(fin.capexAvoid) + '</div><div class="kpi-lbl">CAPEX Avoidance</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + fin.roi.toFixed(0) + '%</div><div class="kpi-lbl">ROI</div></div>';
            html += '</div>';
            html += '<div class="kpi-row">';
            html += '<div class="kpi-item"><div class="kpi-val">' + fin.finExposure.toFixed(0) + '/100</div><div class="kpi-lbl">Financial Exposure</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + fmt(fin.techDebt) + '/mo</div><div class="kpi-lbl">Tech Debt</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + fmt(fin.emergSpend) + '</div><div class="kpi-lbl">Emergency Premium</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + fmt(fin.tco5) + '</div><div class="kpi-lbl">5-Year TCO</div></div>';
            html += '</div>';

            // Section 3: Human Factors
            html += '<h2>3. Human Factors Layer</h2>';
            html += '<div class="kpi-row">';
            html += '<div class="kpi-item"><div class="kpi-val">' + pct(human.burnout) + '</div><div class="kpi-lbl">Burnout Prob</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + human.fatigue.toFixed(0) + '/100</div><div class="kpi-lbl">Fatigue Risk</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">+' + human.elasticity.toFixed(1) + '</div><div class="kpi-lbl">Elasticity (OHS/hire)</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + human.busFactor + '</div><div class="kpi-lbl">Bus Factor</div></div>';
            html += '</div>';
            html += '<div class="kpi-row">';
            html += '<div class="kpi-item"><div class="kpi-val">' + pct(human.retention) + '</div><div class="kpi-lbl">Retention Risk</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + human.cogLoad.toFixed(0) + '/100</div><div class="kpi-lbl">Cognitive Load</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + pct(human.safetyProb) + '</div><div class="kpi-lbl">Safety Incident Prob</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + human.ohs.toFixed(0) + '/100</div><div class="kpi-lbl">Operational Health Score</div></div>';
            html += '</div>';

            // Section 4: Monte Carlo
            html += '<h2>4. Monte Carlo Simulation (10,000 Iterations)</h2>';
            html += '<div class="kpi-row">';
            html += '<div class="kpi-item"><div class="kpi-val">' + mc.p5 + '</div><div class="kpi-lbl">P5</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + mc.p25 + '</div><div class="kpi-lbl">P25</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + mc.p50 + '</div><div class="kpi-lbl">P50</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + mc.p75 + '</div><div class="kpi-lbl">P75</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + mc.p95 + '</div><div class="kpi-lbl">P95</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + mc.cvarShortfall.toFixed(1) + '</div><div class="kpi-lbl">CVaR-95 Shortfall</div></div>';
            html += '</div>';
            html += '<div class="chart-wrap">' + buildHistogramSVG() + '</div>';

            // Sensitivity
            html += '<h3>Sensitivity Analysis</h3>';
            html += '<div class="chart-wrap">' + buildTornadoSVG() + '</div>';
            html += '<table><tr><th>Factor</th><th>+10% Headcount</th><th>-10% Headcount</th><th>Swing (FTEs)</th></tr>';
            for (var si = 0; si < sens.length; si++) {
                html += '<tr><td>' + sens[si].name + '</td><td>' + sens[si].upVal + '</td><td>' + sens[si].downVal + '</td><td>' + sens[si].absSwing + '</td></tr>';
            }
            html += '</table>';

            // Narrative
            html += '<h2>5. Executive Dossier</h2>';
            html += '<div class="narrative">' + narrative + '</div>';

            // Region data table
            html += '<h2>6. Regional Market Data</h2>';
            html += '<table><tr><th>Region</th><th>Energy Rate</th><th>Water Stress</th><th>Reg. Severity</th><th>Labor Mult.</th><th>Climate Risk</th></tr>';
            var rKeys = Object.keys(MSF_REGIONS);
            for (var ri = 0; ri < rKeys.length; ri++) {
                var rk = rKeys[ri];
                var rd = MSF_REGIONS[rk];
                var hl = rk === inp.regionKey ? ' style="background:#fff7ed;font-weight:600;"' : '';
                html += '<tr' + hl + '><td>' + rd.name + '</td><td>$' + rd.eRate.toFixed(2) + '/kWh</td><td>' + rd.waterStress + '</td><td>' + rd.regSeverity + '/100</td><td>' + rd.laborMult.toFixed(2) + 'x</td><td>' + rd.failClimate.toFixed(2) + 'x</td></tr>';
            }
            html += '</table>';

            // Methodology
            html += '<div class="methodology">';
            html += '<h3>Methodology Note</h3>';
            html += '<p>Staffing demand modeled via failure-rate queuing theory: Failures/hr = (Assets x Density Factor) / MTBF, adjusted for regional climate risk. Repair hours incorporate environment complexity and SLA buffer multipliers. Wrench-time efficiency (35-52%) varies by shift fatigue. Monte Carlo: 10,000 iterations perturbing Asset Count (\u00B112%), MTBF (\u00B118%), Labor Cost (\u00B110%), Shift Fatigue (\u00B18%), Climate Risk (\u00B112%) via Box-Muller normal distribution. CVaR-95 = mean of worst 5% outcomes. Financial models: COI uses emergency premium multiplier (2.5x) weighted by breach probability. OPEX leakage = non-wrench-time proportion x 35% waste factor. CAPEX avoidance assumes 17.5% asset life extension from optimized PM. TCO escalation at 4% annually. Human factors: Burnout follows exponential curve above 85% utilization. OHS composite weights: Burnout 25%, Fatigue 20%, Stability 20%, Safety 15%, Retention 10%, Cognitive 10%. All calculations performed client-side; no data transmitted.</p>';
            html += '</div>';

            html += '<div class="footer">Generated by ResistanceZero Market Shaping Framework | resistancezero.com | ' + new Date().toISOString().split('T')[0] + '</div>';
            html += '</body></html>';

            w.document.write(html);
            w.document.close();
            setTimeout(function() { w.print(); }, 500);
        };

        // ===== EVENT LISTENERS =====

        // Enter key in login fields
        var passField = $id('msfLoginPass');
        if (passField) {
            passField.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') window.msfDoLogin();
            });
        }
        var emailField = $id('msfLoginEmail');
        if (emailField) {
            emailField.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') $id('msfLoginPass').focus();
            });
        }

        // Close on overlay click
        var loginOverlay = $id('msfLoginOverlay');
        if (loginOverlay) {
            loginOverlay.addEventListener('click', function(e) {
                if (e.target === this) window.msfHideLogin();
            });
        }

        // Listen for auth changes (from auth.js or other articles)
        window.addEventListener('rz-auth-change', function() {
            if (msfCheckAuth()) msfUnlockPanels();
            else msfLockPanels();
        });

        // ===== PRO TOOLTIP INIT =====
        window.msfInitProTooltips = function() {
            document.querySelectorAll('.msf-tooltip-trigger').forEach(function(trigger) {
                trigger.setAttribute('tabindex', '0');
                trigger.setAttribute('role', 'button');
                trigger.setAttribute('aria-label', 'Show tooltip info');

                trigger.addEventListener('mouseenter', function() {
                    var tip = this.querySelector('.tooltip-content');
                    if (!tip) return;
                    var rect = this.getBoundingClientRect();
                    var tipRect = tip.getBoundingClientRect();
                    if (rect.left + tipRect.width / 2 > window.innerWidth - 10) {
                        tip.style.left = 'auto';
                        tip.style.right = '-10px';
                        tip.style.transform = 'none';
                    }
                    if (rect.left - tipRect.width / 2 < 10) {
                        tip.style.left = '-10px';
                        tip.style.right = 'auto';
                        tip.style.transform = 'none';
                    }
                    if (rect.top < tipRect.height + 20) {
                        tip.style.bottom = 'auto';
                        tip.style.top = 'calc(100% + 10px)';
                    }
                });
            });
        };

        // ===== INIT =====
        if (msfCheckAuth()) {
            // Already authenticated — unlock panels if user switches to Pro
            // Don't auto-switch, but make state ready
        }

    })();
    </script>
<script src="auth.js"></script>
<script src="rz-tracker.js"></script>
</body>
</html>
