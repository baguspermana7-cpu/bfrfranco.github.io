<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GED7FX8RTV"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-GED7FX8RTV');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- SEO Meta Tags -->
    <title>AI Factories: Why Traditional Data Center Architecture Faces Technical Extinction | ResistanceZero</title>
    <meta name="description" content="130kW rack density, liquid cooling, $600B+ hyperscaler CAPEX. Why traditional DC architecture faces technical extinction. AI Factory Calculator.">
    <meta name="keywords" content="AI Factory, Data Center Architecture, Liquid Cooling, GPU Rack Density, NVIDIA Blackwell, Ultra Ethernet, InfiniBand, Hyperscaler CAPEX, Stranded Assets, AI Infrastructure">
    <meta name="author" content="Bagus Dwi Permana">
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#3b82f6">
    <link rel="canonical" href="https://resistancezero.com/article-18.html">

    <link rel="alternate" hreflang="en" href="https://resistancezero.com/article-18.html">

    <!-- Resource Hints -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="https://www.googletagmanager.com">
    <!-- Open Graph Meta Tags -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://resistancezero.com/article-18.html">
    <meta property="og:title" content="AI Factories: Why Traditional Data Center Architecture Faces Technical Extinction">
    <meta property="og:description" content="Deep analysis: 130kW AI racks, liquid cooling revolution, Ultra Ethernet vs InfiniBand, $700B hyperscaler race, stranded asset risk. Interactive calculator inside.">
    <meta property="og:image" content="https://resistancezero.com/assets/article-18-cover.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="669">
    <meta property="og:image:alt" content="AI Factories - The Rise of AI-Native Data Center Architecture">
    <meta property="og:locale" content="en_US">
    <meta property="og:site_name" content="Bagus Dwi Permana Portfolio">
    <meta property="article:author" content="Bagus Dwi Permana">
    <meta property="article:published_time" content="2026-02-22T00:00:00Z">
    <meta property="article:modified_time" content="2026-02-22T00:00:00Z">
    <meta property="article:section" content="AI Infrastructure">
    <meta property="article:tag" content="AI Factory">
    <meta property="article:tag" content="Data Center Architecture">
    <meta property="article:tag" content="Liquid Cooling">
    <meta property="article:tag" content="GPU Infrastructure">

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@BagusDPermana">
    <meta name="twitter:creator" content="@BagusDPermana">
    <meta name="twitter:title" content="AI Factories: Why Traditional Data Center Architecture Faces Technical Extinction">
    <meta name="twitter:description" content="130kW AI racks, liquid cooling, $700B CAPEX race. Why traditional DC architecture can't survive the AI era. Interactive readiness calculator inside.">
    <meta name="twitter:image" content="https://resistancezero.com/assets/article-18-cover.png">
    <meta name="twitter:image:alt" content="AI Factory Data Center Architecture Analysis">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="assets/Favicon.png">
    <link rel="apple-touch-icon" href="assets/Favicon.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="styles.css">
    <link rel="preload" as="image" href="assets/article-18-cover.png">

    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "TechnicalArticle",
        "headline": "AI Factories: Why Traditional Data Center Architecture Faces Technical Extinction",
        "description": "Deep analysis of AI-native data center design covering rack density evolution to 130kW, liquid cooling revolution, Ultra Ethernet vs InfiniBand networking, $700B hyperscaler CAPEX race, and stranded asset risk assessment.",
        "image": "https://resistancezero.com/assets/article-18-cover.png",
        "author": {
            "@type": "Person",
            "name": "Bagus Dwi Permana",
            "jobTitle": "Engineering Operations Manager",
            "sameAs": ["https://www.linkedin.com/in/bagus-dwi-permana-ba90b092/", "https://resistancezero.com"]
        },
        "publisher": {
            "@type": "Organization",
            "name": "ResistanceZero",
            "url": "https://resistancezero.com",
            "logo": {"@type": "ImageObject", "url": "https://resistancezero.com/assets/Favicon.png"}
        },
        "datePublished": "2026-02-22",
        "dateModified": "2026-02-22",
        "wordCount": "10000",
        "articleSection": "AI Infrastructure",
        "keywords": ["AI Factory", "Data Center Architecture", "Liquid Cooling", "GPU Rack Density", "NVIDIA Blackwell", "Ultra Ethernet", "InfiniBand", "Hyperscaler CAPEX", "Stranded Assets"],
        "mainEntityOfPage": {"@type": "WebPage", "@id": "https://resistancezero.com/article-18.html"}
    }
    </script>

    <!-- FAQ Schema -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
            {
                "@type": "Question",
                "name": "What is an AI Factory?",
                "acceptedAnswer": {"@type": "Answer", "text": "An AI Factory is a purpose-built data center designed to manufacture digital intelligence at scale. Unlike traditional data centers that serve as general-purpose IT hosting facilities, AI factories are optimized for GPU-dense computing with rack densities of 120-130kW, liquid cooling infrastructure, and ultra-low-latency networking. NVIDIA CEO Jensen Huang coined the term, describing facilities where raw data comes in, is refined, and intelligence goes out."}
            },
            {
                "@type": "Question",
                "name": "Why can't traditional data centers support AI workloads?",
                "acceptedAnswer": {"@type": "Answer", "text": "Traditional data centers face three fundamental barriers: power density (designed for 5-10kW per rack vs 120-130kW required for AI), cooling capacity (air cooling reaches thermal limits at approximately 30kW per rack while AI chips generate heat flux exceeding 1000 W/cm2), and structural load (AI racks weigh 2-3 tons vs 1 ton for traditional racks, exceeding floor load capacities of older facilities)."}
            },
            {
                "@type": "Question",
                "name": "What is the difference between Direct-to-Chip and Immersion cooling?",
                "acceptedAnswer": {"@type": "Answer", "text": "Direct-to-Chip (DTC) cooling circulates liquid through cold plates attached directly to processors, handling up to 200kW per rack. It dominates the market with 42.85% of 2025 revenue due to easier maintenance and brownfield retrofit compatibility. Immersion cooling submerges entire servers in dielectric fluid, supporting densities above 300kW, but faces PFAS regulatory risks and operational complexity that limit mass adoption."}
            },
            {
                "@type": "Question",
                "name": "How much does AI data center infrastructure cost?",
                "acceptedAnswer": {"@type": "Answer", "text": "Combined hyperscaler CAPEX for 2026 exceeds $600 billion, with Amazon planning $200B, Alphabet $185B, Microsoft $120B+, and Meta $100B+. Approximately 75% ($450B) is directly tied to AI infrastructure. This represents 45-57% of revenue being reinvested in capital expenditure, a historically unprecedented ratio that reflects the scale of the AI infrastructure buildout."}
            }
        ]
    }
    </script>

    <!-- BreadcrumbList Schema -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
            {"@type": "ListItem", "position": 1, "name": "Home", "item": "https://resistancezero.com/"},
            {"@type": "ListItem", "position": 2, "name": "Articles", "item": "https://resistancezero.com/articles.html"},
            {"@type": "ListItem", "position": 3, "name": "AI Factories", "item": "https://resistancezero.com/article-18.html"}
        ]
    }
    </script>

    <style>
        :root {
            --aif-blue: #3b82f6;
            --aif-cyan: #06b6d4;
            --aif-dark: #1e3a8a;
            --aif-light: #eff6ff;
            --aif-accent: #60a5fa;
            --aif-indigo: #4f46e5;
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --spacing-2xl: 3rem;
        }

        .article-hero {
            background: linear-gradient(135deg, #0c1929 0%, #1e3a8a 30%, #2563eb 60%, #0891b2 100%);
            padding: 7rem 2rem 3.5rem;
            color: #fff;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .article-hero::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(circle at 20% 80%, rgba(59, 130, 246, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(6, 182, 212, 0.2) 0%, transparent 50%);
            z-index: 0;
        }
        .article-hero::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M30 5 L35 25 L55 30 L35 35 L30 55 L25 35 L5 30 L25 25 Z' fill='%233b82f6' fill-opacity='0.04'/%3E%3C/svg%3E");
            opacity: 0.5;
            z-index: 0;
        }
        .article-hero > * { position: relative; z-index: 1; }
        .article-hero .container { max-width: 1000px; margin: 0 auto; }

        .article-category {
            display: inline-block;
            background: rgba(59, 130, 246, 0.2);
            color: #93c5fd;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        .article-title {
            font-size: clamp(1.6rem, 3.2vw, 2.35rem);
            font-weight: 800;
            margin-bottom: 1.25rem;
            line-height: 1.25;
            color: #fff;
            letter-spacing: -0.01em;
        }
        .article-title .highlight {
            background: linear-gradient(90deg, #60a5fa, #06b6d4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .article-subtitle {
            font-size: clamp(0.95rem, 1.6vw, 1.15rem);
            color: #94a3b8;
            max-width: 720px;
            margin: 0 auto 1.75rem;
            line-height: 1.7;
        }
        .article-meta {
            display: flex;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
            color: #94a3b8;
            font-size: 0.9375rem;
        }
        .article-meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: #94a3b8;
            margin-bottom: 2rem;
            font-weight: 500;
            transition: color 0.3s ease;
            text-decoration: none;
        }
        .back-link:hover { color: #fff; }

        .jump-to-calc {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1.5rem;
            padding: 0.875rem 1.75rem;
            background: linear-gradient(135deg, #2563eb 0%, #0891b2 100%);
            color: #fff;
            border: none;
            border-radius: 30px;
            font-size: 0.9rem;
            font-weight: 700;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.4);
            animation: pulse-glow 2s ease-in-out infinite;
        }
        .jump-to-calc:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(59, 130, 246, 0.6);
        }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 4px 20px rgba(59, 130, 246, 0.4); }
            50% { box-shadow: 0 4px 30px rgba(59, 130, 246, 0.7); }
        }

        /* Evidence Block */
        .aif-evidence-block {
            max-width: 1000px;
            margin: -1.5rem auto 0;
            padding: 0 2rem;
            position: relative;
            z-index: 10;
        }
        .aif-evidence-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.6rem;
        }
        .aif-evidence-card {
            background: rgba(30,41,59,0.65);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255,255,255,0.08);
            border-top: 2px solid #3b82f6;
            border-radius: 12px;
            padding: 1rem 0.75rem;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .aif-evidence-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(180deg, rgba(59,130,246,0.06) 0%, transparent 60%);
            pointer-events: none;
        }
        .aif-evidence-card:hover {
            border-color: rgba(59,130,246,0.4);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
        }
        .aif-evidence-value {
            font-size: 1.6rem;
            font-weight: 800;
            background: linear-gradient(135deg, #60a5fa, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
        }
        .aif-evidence-label {
            font-size: 0.7rem;
            font-weight: 700;
            color: #e2e8f0;
            margin-top: 4px;
            letter-spacing: 0.02em;
        }
        .aif-evidence-sub {
            font-size: 0.62rem;
            color: #64748b;
            margin-top: 3px;
            font-weight: 500;
        }

        /* Article Content */
        .article-content {
            padding: 4rem 2rem;
            background: #fff;
        }
        .article-content .container { max-width: 900px; margin: 0 auto; }
        .article-body {
            font-size: 0.95rem;
            line-height: 1.7;
            color: #374151;
        }
        .article-body p { margin-bottom: 1rem; }
        .article-body h2 {
            font-size: 1.4rem;
            color: #1e40af;
            margin: var(--spacing-xl) 0 var(--spacing-md);
            padding-bottom: var(--spacing-sm);
            border-bottom: 3px solid #93c5fd;
        }
        .article-body h3 {
            font-size: 1.1rem;
            color: #2563eb;
            margin: var(--spacing-lg) 0 var(--spacing-sm);
        }
        .article-body h4 {
            font-size: 0.9rem;
            color: #1e40af;
            margin: var(--spacing-md) 0 var(--spacing-sm);
        }
        .article-body blockquote:not(.aif-quote) {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-left: 4px solid #3b82f6;
            padding: var(--spacing-lg) var(--spacing-xl);
            margin: var(--spacing-lg) 0;
            border-radius: 0 12px 12px 0;
            font-style: italic;
            color: #1e40af;
            font-size: 1rem;
        }
        .article-body ul, .article-body ol {
            margin: 1.5rem 0;
            padding-left: 1.5rem;
        }
        .article-body li {
            margin-bottom: 0.5rem;
            color: #374151;
        }
        .article-body a {
            color: #2563eb;
            text-decoration: none;
            border-bottom: 1px solid rgba(37, 99, 235, 0.3);
            transition: all 0.3s ease;
        }
        .article-body a:hover { border-bottom-color: #2563eb; }

        /* Quote Block — self-contained dark element, same in light and dark mode */
        .article-body .aif-quote,
        [data-theme="dark"] .article-body .aif-quote {
            background: linear-gradient(135deg, #0c1929 0%, #1e3a8a 100%);
            border-radius: 16px;
            padding: 2rem;
            margin: 2.5rem 0;
            border-left: 4px solid #60a5fa;
            position: relative;
            overflow: hidden;
            font-style: normal;
            color: #e2e8f0;
        }
        .article-body .aif-quote::before,
        [data-theme="dark"] .article-body .aif-quote::before {
            content: '\201C';
            position: absolute;
            top: -10px; left: 15px;
            font-size: 5rem;
            color: rgba(96, 165, 250, 0.15);
            font-family: Georgia, serif;
            line-height: 1;
        }
        .article-body .aif-quote p,
        [data-theme="dark"] .article-body .aif-quote p {
            color: #e2e8f0;
            font-size: 1.05rem;
            line-height: 1.7;
            font-style: italic;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }
        .article-body .aif-quote cite,
        [data-theme="dark"] .article-body .aif-quote cite {
            display: block;
            font-style: normal;
            color: #93c5fd;
            font-size: 0.85rem;
            font-weight: 600;
        }
        .aif-quote-source {
            display: block;
            color: #64748b;
            font-size: 0.75rem;
            font-weight: 400;
            margin-top: 2px;
        }

        /* Insight Box */
        .aif-insight-box {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-radius: 12px;
            padding: 1.5rem 2rem;
            margin: 2rem 0;
            border-left: 4px solid #3b82f6;
        }
        .aif-insight-box h4 { color: #1e40af; font-size: 0.9rem; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem; }
        .aif-insight-box p { margin: 0; color: #1e40af; font-size: 0.9rem; }

        /* Opportunity Box */
        .aif-opportunity-box {
            background: linear-gradient(135deg, #0c1929 0%, #1e3a8a 100%);
            border-radius: 16px;
            padding: 2rem;
            margin: 2.5rem 0;
            border: 2px solid #3b82f6;
            position: relative;
            overflow: hidden;
        }
        .aif-opportunity-box::before {
            content: '';
            position: absolute;
            top: 0; right: 0;
            width: 150px; height: 150px;
            background: radial-gradient(circle, rgba(59,130,246,0.3) 0%, transparent 70%);
        }
        .aif-opportunity-box h4 { color: #93c5fd; font-size: 0.95rem; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem; }
        .aif-opportunity-box p { color: #e5e7eb; margin-bottom: 0.5rem; font-size: 0.9rem; }
        .aif-opportunity-box .stat-highlight { color: #60a5fa; font-weight: 700; font-size: 1.25rem; font-family: 'JetBrains Mono', monospace; }

        /* Bear Box */
        .aif-bear-box {
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            border-radius: 12px;
            padding: 1.5rem 2rem;
            margin: 2rem 0;
            border-left: 4px solid #d97706;
        }
        .aif-bear-box h4 { color: #92400e; font-size: 0.9rem; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem; }
        .aif-bear-box p { margin: 0; color: #92400e; font-size: 0.9rem; }

        /* Contrarian Box */
        .aif-contrarian-box {
            background: linear-gradient(135deg, #fdf4ff 0%, #f3e8ff 100%);
            border-radius: 12px;
            padding: 1.5rem 2rem;
            margin: 2rem 0;
            border-left: 4px solid #9333ea;
        }
        .aif-contrarian-box h4 { color: #6b21a8; font-size: 0.9rem; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem; }
        .aif-contrarian-box p { margin: 0; color: #6b21a8; font-size: 0.9rem; }

        /* Data Tables */
        .data-table-container { overflow-x: auto; margin: 2rem 0; }
        .data-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        .data-table th, .data-table td { padding: 0.875rem 1rem; text-align: left; border-bottom: 1px solid #e2e8f0; }
        .data-table th { background: #1e3a8a; color: #fff; font-weight: 600; white-space: nowrap; }
        .data-table tr:hover { background: #eff6ff; }
        .data-table .highlight-row { background: #dbeafe; font-weight: 600; }
        .table-source { font-size: 0.8rem; color: #64748b; margin-top: 0.5rem; font-style: italic; }

        /* Comparison Grid */
        .aif-comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        .aif-comparison-card {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid #e2e8f0;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .aif-comparison-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.1);
        }
        .aif-comparison-card.traditional {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            border-color: #94a3b8;
        }
        .aif-comparison-card.ai-native {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-color: #93c5fd;
        }
        .aif-comparison-card .card-icon { font-size: 2rem; margin-bottom: 0.75rem; }
        .aif-comparison-card .card-title { font-size: 0.95rem; font-weight: 700; margin-bottom: 0.5rem; }
        .aif-comparison-card .card-value { font-size: 1.5rem; font-weight: 800; font-family: 'JetBrains Mono', monospace; margin-bottom: 0.25rem; }
        .aif-comparison-card .card-desc { font-size: 0.8rem; color: #64748b; }

        /* Article Image */
        .article-figure {
            margin: 2.5rem 0;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
        }
        .article-figure img {
            width: 100%;
            height: auto;
            display: block;
        }
        .article-figure figcaption {
            padding: 0.75rem 1rem;
            font-size: 0.8rem;
            color: #64748b;
            background: #f8fafc;
            text-align: center;
            font-style: italic;
        }

        /* Table of Contents */
        .toc-section {
            background: linear-gradient(135deg, #f8fafc 0%, #eff6ff 100%);
            border-radius: 16px;
            padding: 2rem;
            margin: 2.5rem 0;
            border: 1px solid rgba(59,130,246,0.15);
        }
        .toc-section h3 {
            font-size: 1.1rem;
            color: #1e3a8a;
            margin-bottom: 1.25rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .toc-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
        }
        .toc-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            background: rgba(255,255,255,0.7);
            border-radius: 8px;
            text-decoration: none;
            color: #334155;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }
        .toc-item:hover { background: #dbeafe; border-color: rgba(59,130,246,0.2); color: #1e40af; }
        .toc-num {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, #2563eb, #0891b2);
            color: #fff;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 700;
            flex-shrink: 0;
        }
        .toc-item.toc-calculator {
            background: linear-gradient(135deg, rgba(59,130,246,0.08) 0%, rgba(6,182,212,0.05) 100%);
            border: 1px solid rgba(59,130,246,0.2);
            grid-column: 1 / -1;
        }
        .toc-item.toc-calculator .toc-num {
            background: linear-gradient(135deg, #3b82f6, #06b6d4);
        }
        .toc-calc-badge {
            background: linear-gradient(135deg, #2563eb, #0891b2);
            color: #fff;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.6rem;
            font-weight: 700;
            letter-spacing: 0.5px;
            margin-left: auto;
        }

        /* Calculator */
        .aif-calculator {
            background: linear-gradient(135deg, #0c1929 0%, #1e3a8a 100%);
            border-radius: 20px;
            padding: 2.5rem;
            margin: 3rem 0;
            color: #fff;
        }
        .calc-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .calc-subtitle { color: #94a3b8; margin-bottom: 2rem; font-size: 0.9rem; }
        .calc-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        .calc-input-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .calc-input-group label {
            font-size: 0.8rem;
            color: #94a3b8;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .calc-input-group select,
        .calc-input-group input {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            color: #fff;
            font-size: 0.95rem;
            font-family: 'JetBrains Mono', monospace;
            transition: all 0.3s ease;
        }
        .calc-input-group select:focus,
        .calc-input-group input:focus {
            outline: none;
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }
        .calc-input-group select option { background: #0c1929; color: #fff; }

        .calc-tooltip {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            background: rgba(255,255,255,0.15);
            border-radius: 50%;
            font-size: 0.65rem;
            color: #a8a29e;
            cursor: help;
            margin-left: 4px;
            position: relative;
            vertical-align: middle;
            flex-shrink: 0;
        }
        .calc-tooltip .tip-text {
            visibility: hidden;
            opacity: 0;
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            background: #1e293b;
            color: #e2e8f0;
            padding: 0.6rem 0.75rem;
            border-radius: 8px;
            font-size: 0.72rem;
            line-height: 1.4;
            width: 220px;
            text-align: left;
            z-index: 10;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
            transition: opacity 0.2s ease, visibility 0.2s ease;
            pointer-events: none;
            font-style: normal;
            font-weight: 400;
        }
        .calc-tooltip .tip-text::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: #1e293b;
        }
        .calc-tooltip:hover .tip-text { visibility: visible; opacity: 1; }

        /* Result tooltip */
        .res-tip {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 14px;
            height: 14px;
            background: rgba(59,130,246,0.2);
            border-radius: 50%;
            font-size: 0.6rem;
            color: #93c5fd;
            cursor: help;
            margin-left: 4px;
            position: relative;
        }
        .res-tip-body {
            visibility: hidden;
            opacity: 0;
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            background: #1e293b;
            color: #e2e8f0;
            padding: 0.6rem 0.75rem;
            border-radius: 8px;
            font-size: 0.72rem;
            line-height: 1.4;
            width: 220px;
            text-align: left;
            z-index: 10;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
            transition: opacity 0.2s ease, visibility 0.2s ease;
            pointer-events: none;
        }
        .res-tip-body::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: #1e293b;
        }
        .res-tip:hover .res-tip-body { visibility: visible; opacity: 1; }
        .rtt { font-weight: 700; color: #93c5fd; margin-bottom: 3px; }
        .rtd { color: #cbd5e1; margin-bottom: 3px; }
        .rtf { color: #64748b; font-size: 0.68rem; }

        .calc-actions {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
        }
        .calc-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: linear-gradient(135deg, #2563eb 0%, #0891b2 100%);
            color: #fff;
            border: none;
            border-radius: 10px;
            padding: 0.875rem 1.75rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
            font-family: inherit;
        }
        .calc-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }
        .calc-results { display: none; margin-top: 2rem; }
        .calc-results.show { display: block; }
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 1rem;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 1.5rem;
        }
        .result-item {
            text-align: center;
            padding: 1rem;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
        }
        .result-item .label {
            font-size: 0.7rem;
            color: #94a3b8;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }
        .result-item .value {
            font-size: 1.4rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }
        .result-item .value.green { color: #34d399; }
        .result-item .value.amber { color: #fbbf24; }
        .result-item .value.red { color: #f87171; }
        .result-item .value.blue { color: #60a5fa; }
        .result-item .subtext { font-size: 0.7rem; color: #64748b; margin-top: 0.25rem; }

        /* Readiness Gauge */
        .aif-gauge {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            text-align: center;
        }
        .gauge-bar {
            width: 100%;
            height: 20px;
            background: linear-gradient(90deg, #dc2626 0%, #d97706 25%, #eab308 50%, #10b981 75%, #059669 100%);
            border-radius: 10px;
            position: relative;
            margin: 1rem 0;
        }
        .gauge-needle {
            position: absolute;
            top: -6px;
            width: 4px;
            height: 32px;
            background: #fff;
            border-radius: 2px;
            transition: left 0.5s ease;
            box-shadow: 0 0 10px rgba(255,255,255,0.5);
        }
        .gauge-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.7rem;
            color: #64748b;
        }
        .aif-verdict {
            font-size: 1.2rem;
            font-weight: 700;
            margin-top: 1rem;
        }
        .aif-verdict.grade-a { color: #34d399; }
        .aif-verdict.grade-b { color: #6ee7b7; }
        .aif-verdict.grade-c { color: #fbbf24; }
        .aif-verdict.grade-d { color: #fb923c; }
        .aif-verdict.grade-f { color: #f87171; }

        /* Toolbar */
        .aif-toolbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(59,130,246,0.08);
            border: 1px solid rgba(59,130,246,0.2);
            border-radius: 10px;
            padding: 0.75rem 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .aif-mode-bar { display: flex; gap: 4px; }
        .aif-toolbar-btn {
            padding: 8px 18px;
            border-radius: 8px;
            border: 1px solid rgba(59,130,246,0.2);
            background: transparent;
            color: #94a3b8;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.2s;
        }
        .aif-toolbar-btn:hover { color: #e2e8f0; border-color: #3b82f6; }
        .aif-btn-free.active {
            background: linear-gradient(135deg, #2563eb, #3b82f6);
            color: #fff;
            border-color: transparent;
            box-shadow: 0 2px 8px rgba(59,130,246,0.25);
        }
        .aif-btn-pro.active {
            background: linear-gradient(135deg, #d97706, #f59e0b);
            color: #fff;
            border-color: transparent;
            box-shadow: 0 2px 8px rgba(245,158,11,0.25);
        }
        .aif-toolbar-actions { display: flex; gap: 6px; }
        .aif-btn-reset, .aif-btn-pdf {
            padding: 6px 14px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.12);
            background: transparent;
            color: #94a3b8;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        .aif-btn-reset:hover, .aif-btn-pdf:hover { color: #e2e8f0; border-color: rgba(255,255,255,0.25); }

        /* Pro Panels */
        .aif-pro-panel {
            margin: 1.5rem 0;
            padding: 1.25rem;
            background: linear-gradient(135deg, rgba(59,130,246,0.06), rgba(6,182,212,0.03));
            border: 1px solid rgba(59,130,246,0.2);
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }
        .aif-pro-panel.gated .aif-panel-inner {
            filter: blur(4px);
            pointer-events: none;
            user-select: none;
        }
        .aif-gate-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(12,25,41,0.85);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            z-index: 5;
            border-radius: 12px;
        }
        .aif-gate-overlay i { font-size: 1.5rem; color: #fbbf24; }
        .aif-gate-overlay span { color: #fbbf24; font-weight: 700; font-size: 0.9rem; }
        .aif-panel-title {
            font-size: 0.95rem;
            font-weight: 700;
            color: #60a5fa;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .aif-kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.75rem;
            margin: 0.75rem 0;
        }
        .aif-kpi-card {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 0.75rem;
            text-align: center;
        }
        .aif-kpi-card .kpi-label { font-size: 0.65rem; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.5px; }
        .aif-kpi-card .kpi-value { font-size: 1.1rem; font-weight: 700; font-family: 'JetBrains Mono', monospace; color: #60a5fa; margin-top: 4px; }

        .aif-narrative {
            background: rgba(0,0,0,0.15);
            border-radius: 10px;
            padding: 1.25rem;
            margin-top: 0.75rem;
            font-size: 0.82rem;
            line-height: 1.65;
            color: #cbd5e1;
        }
        .aif-narrative h4 { color: #93c5fd; font-size: 0.85rem; margin-bottom: 0.5rem; }
        .aif-narrative p { margin-bottom: 0.5rem; }

        /* Login Modal */
        .aif-login-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }
        .aif-login-overlay.show { display: flex; }
        .aif-login-box {
            background: #0c1929;
            border: 2px solid rgba(59,130,246,0.5);
            border-radius: 16px;
            padding: 2.5rem;
            max-width: 420px;
            width: 90%;
            text-align: center;
            box-shadow: 0 24px 60px rgba(0,0,0,0.6), 0 0 40px rgba(59,130,246,0.15);
            position: relative;
        }
        .aif-login-box h3 { font-size: 1.2rem; color: #60a5fa; margin-bottom: 0.5rem; }
        .aif-login-box p { font-size: 0.82rem; color: #94a3b8; margin-bottom: 1.25rem; }
        .aif-login-box input {
            width: 100%;
            padding: 12px 16px;
            margin-bottom: 12px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(59,130,246,0.3);
            border-radius: 8px;
            color: #e2e8f0;
            font-size: 0.88rem;
            font-family: inherit;
            outline: none;
            box-sizing: border-box;
        }
        .aif-login-box input:focus { border-color: #3b82f6; }
        .aif-login-submit {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #2563eb, #3b82f6);
            color: #fff;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            font-size: 0.9rem;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.2s;
            margin-top: 4px;
        }
        .aif-login-submit:hover { box-shadow: 0 4px 16px rgba(59,130,246,0.3); }
        .aif-login-close {
            position: absolute;
            top: 12px; right: 16px;
            background: none; border: none;
            color: #94a3b8; font-size: 1.5rem;
            cursor: pointer;
        }
        .aif-login-error { display: none; color: #f87171; font-size: 0.78rem; margin-top: 8px; }
        .aif-login-demo { font-size: 0.72rem; color: #64748b; margin-top: 12px; }
        .aif-login-demo code { background: rgba(59,130,246,0.12); padding: 2px 6px; border-radius: 4px; color: #93c5fd; font-size: 0.7rem; }

        /* Privacy Badge */
        .aif-privacy-badge {
            text-align: center;
            font-size: 0.72rem;
            color: #64748b;
            padding: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        .aif-privacy-badge i { color: #3b82f6; }
        .aif-benchmark-meta {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        .aif-benchmark-tag {
            font-size: 0.68rem;
            padding: 3px 10px;
            background: rgba(59,130,246,0.08);
            border: 1px solid rgba(59,130,246,0.15);
            border-radius: 50px;
            color: #94a3b8;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        .aif-benchmark-tag i { font-size: 0.6rem; color: #3b82f6; }

        /* References */
        .references {
            background: linear-gradient(135deg, #f8fafc 0%, #eff6ff 100%);
            padding: 2rem;
            border-radius: 12px;
            margin-top: 3rem;
            border-left: 4px solid #2563eb;
        }
        .references h3 { font-size: 1.1rem; margin-bottom: 1.25rem; color: #1e3a8a; }
        .references ol { font-size: 0.8rem; color: #475569; padding-left: 1.5rem; line-height: 1.6; }
        .references ol li { margin-bottom: 0.5rem; }
        .references a { color: #2563eb; text-decoration: none; }
        .references a:hover { text-decoration: underline; }

        /* Article Nav */
        .article-nav {
            display: flex;
            justify-content: space-between;
            padding: 2rem 0;
            border-top: 1px solid #e2e8f0;
            margin-top: 3rem;
        }
        .article-nav a {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #2563eb;
            font-weight: 600;
            transition: color 0.3s ease;
            text-decoration: none;
        }
        .article-nav a:hover { color: #3b82f6; }

        /* Canvas container for charts */
        .aif-chart-container {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 1rem;
            margin-top: 0.75rem;
        }
        .aif-chart-container canvas {
            width: 100% !important;
            max-height: 300px;
        }

        /* TCO Table */
        .aif-tco-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.75rem;
            margin: 0.75rem 0;
        }
        .aif-tco-table th { background: rgba(59,130,246,0.15); color: #93c5fd; padding: 8px; text-align: center; font-size: 0.7rem; }
        .aif-tco-table td { padding: 6px 8px; text-align: center; color: #cbd5e1; border-bottom: 1px solid rgba(255,255,255,0.05); font-family: 'JetBrains Mono', monospace; font-size: 0.72rem; }
        .aif-tco-table tr:hover { background: rgba(59,130,246,0.05); }

        /* Dark Mode */
        [data-theme="dark"] .article-content { background: #0f172a; }
        [data-theme="dark"] .article-body h2 { color: #93c5fd; }
        [data-theme="dark"] .article-body h3 { color: #cbd5e1; }
        [data-theme="dark"] .article-body p,
        [data-theme="dark"] .article-body li { color: #cbd5e1; }
        [data-theme="dark"] .article-body strong { color: #f1f5f9; }
        [data-theme="dark"] .article-body a { color: #60a5fa; }
        [data-theme="dark"] .article-body ul li::marker,
        [data-theme="dark"] .article-body ol li::marker { color: #94a3b8; }
        [data-theme="dark"] .article-body blockquote:not(.aif-quote) { background: rgba(59, 130, 246, 0.08); border-left-color: #3b82f6; color: #93c5fd; }
        [data-theme="dark"] .toc-section { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); }
        [data-theme="dark"] .toc-item { background: rgba(255,255,255,0.05); color: #e2e8f0; }
        [data-theme="dark"] .toc-item.toc-calculator { background: linear-gradient(135deg, rgba(59,130,246,0.15) 0%, rgba(59,130,246,0.08) 100%); }
        [data-theme="dark"] .data-table th { background: #1e3a5f; color: #e2e8f0; }
        [data-theme="dark"] .data-table td { color: #cbd5e1; border-bottom-color: rgba(255,255,255,0.1); }
        [data-theme="dark"] .data-table tbody tr:hover { background: rgba(255,255,255,0.05); }
        [data-theme="dark"] .aif-insight-box { background: rgba(59,130,246,0.08); border-color: rgba(59,130,246,0.3); }
        [data-theme="dark"] .aif-insight-box h4,
        [data-theme="dark"] .aif-insight-box p { color: #93c5fd; }
        [data-theme="dark"] .aif-bear-box { background: rgba(217,119,6,0.08); border-color: rgba(217,119,6,0.3); }
        [data-theme="dark"] .aif-bear-box h4,
        [data-theme="dark"] .aif-bear-box p { color: #fbbf24; }
        [data-theme="dark"] .aif-contrarian-box { background: rgba(147,51,234,0.08); border-color: rgba(147,51,234,0.3); }
        [data-theme="dark"] .aif-contrarian-box h4,
        [data-theme="dark"] .aif-contrarian-box p { color: #c084fc; }
        [data-theme="dark"] .aif-comparison-card { background: rgba(255,255,255,0.03); border-color: rgba(255,255,255,0.1); }
        [data-theme="dark"] .aif-comparison-card .card-title { color: #e2e8f0; }
        [data-theme="dark"] .aif-comparison-card .card-desc { color: #94a3b8; }
        [data-theme="dark"] .references { background: rgba(255,255,255,0.03); }
        [data-theme="dark"] .references h3 { color: #93c5fd; }
        [data-theme="dark"] .references a { color: #60a5fa; }
        [data-theme="dark"] .references li { color: #94a3b8; }
        [data-theme="dark"] .article-body h4 { color: #93c5fd; }
        [data-theme="dark"] .article-nav { border-top-color: rgba(255,255,255,0.1); }
        [data-theme="dark"] .article-nav a { color: #60a5fa; }
        [data-theme="dark"] .aif-pro-panel { background: rgba(59,130,246,0.03); }
        [data-theme="dark"] .data-table .highlight-row { background: rgba(59,130,246,0.12); }
        [data-theme="dark"] .toc-section h3 { color: #93c5fd; }
        [data-theme="dark"] .toc-item:hover { background: rgba(59,130,246,0.15); color: #93c5fd; }
        [data-theme="dark"] .aif-comparison-card.traditional { background: rgba(255,255,255,0.04); border-color: rgba(148,163,184,0.3); }
        [data-theme="dark"] .aif-comparison-card.ai-native { background: rgba(59,130,246,0.06); border-color: rgba(59,130,246,0.3); }
        [data-theme="dark"] .aif-comparison-card .card-value { color: #60a5fa; }
        [data-theme="dark"] .aif-comparison-card:hover { box-shadow: 0 12px 40px rgba(0,0,0,0.3); }
        /* Self-contained dark boxes — maintain same look in both themes */
        [data-theme="dark"] .aif-opportunity-box { background: linear-gradient(135deg, #0c1929 0%, #1e3a8a 100%); }
        [data-theme="dark"] .aif-opportunity-box h4 { color: #93c5fd; }
        [data-theme="dark"] .aif-opportunity-box p { color: #e5e7eb; }
        [data-theme="dark"] .article-figure figcaption { background: #1e293b; color: #94a3b8; }
        [data-theme="dark"] .table-source { color: #64748b; }
        [data-theme="dark"] .calc-subtitle { color: #94a3b8; }

        /* Responsive */
        @media (max-width: 768px) {
            .article-hero { padding: 6rem 1rem 3rem; }
            .article-content { padding: 3rem 1rem; }
            .aif-calculator { padding: 1.5rem; }
            .calc-grid { grid-template-columns: 1fr; }
            .results-grid { grid-template-columns: repeat(2, 1fr); }
            .toc-grid { grid-template-columns: 1fr; }
            .aif-evidence-grid { grid-template-columns: repeat(2, 1fr); }
            .aif-toolbar { flex-direction: column; align-items: stretch; }
            .aif-comparison-grid { grid-template-columns: 1fr; }
        }
        @media (max-width: 480px) {
            .article-title { font-size: 1.35rem; }
            .results-grid { grid-template-columns: 1fr; }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0" defer></script>
</head>
<body>
    <!-- Reading Progress Bar -->
    <div class="scroll-progress" id="scrollProgress"></div>

    <!-- Search Overlay & Modal -->
    <div class="search-overlay" id="searchOverlay"></div>
    <div class="search-modal" id="searchModal">
        <div class="search-input-wrap">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
            <input type="text" class="search-input" id="searchInput" placeholder="Search articles, calculators, tools..." autocomplete="off">
            <kbd class="search-kbd">ESC</kbd>
        </div>
        <div class="search-results" id="searchResults">
            <div class="search-empty">Type to search across all content</div>
        </div>
        <div class="search-footer">
            <span><kbd class="search-kbd">&uarr;&darr;</kbd> Navigate</span>
            <span><kbd class="search-kbd">Enter</kbd> Open</span>
        </div>
    </div>

    <!-- TOC Sidebar (desktop, wide screens) -->
    <nav class="toc-sidebar" id="tocSidebar" aria-label="Table of Contents">
        <div class="toc-sidebar-label">On this page</div>
        <ul class="toc-sidebar-list" id="tocSidebarList"></ul>
    </nav>

    <!-- TOC Mobile Toggle -->
    <button class="toc-mobile-toggle" id="tocMobileToggle" aria-label="Table of contents">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
    </button>
    <div class="toc-mobile-backdrop" id="tocMobileBackdrop"></div>
    <div class="toc-mobile-drawer" id="tocMobileDrawer">
        <div class="toc-drawer-header">
            <span class="toc-drawer-title">Table of Contents</span>
            <button class="toc-drawer-close" id="tocDrawerClose" aria-label="Close">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
            </button>
        </div>
        <ul class="toc-mobile-list" id="tocMobileList"></ul>
    </div>



<!-- Navigation (shared) -->
<nav class="navbar">
    <div class="nav-container">
        <a href="index.html" class="nav-logo">
            <img loading="lazy" src="assets/profile-photo.jpg" alt="Bagus Dwi Permana" class="nav-avatar">
        </a>
        <ul class="nav-menu">
            <li><a href="index.html" class="nav-link">Home</a></li>
            <li class="nav-dropdown">
                <a href="datacenter-solutions.html" class="nav-link">
                    DC Solutions
                    <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg>
                </a>
                <ul class="dropdown-menu">
                    <li><a href="datacenter-solutions.html" style="color: #06b6d4; font-weight: 600;">DC Solutions Hub</a></li>
                    <li style="border-bottom: 1px solid rgba(255,255,255,0.1); margin: 4px 0;"></li>
                    <li><a href="datahallAI.html" style="color: #8b5cf6;">DC AI/HPC</a></li>
                    <li><a href="dc-conventional.html">DC Conventional</a></li>
                    <li style="border-bottom: 1px solid rgba(255,255,255,0.1); margin: 4px 0;"></li>
                    <li><a href="capex-calculator.html" style="color: #f59e0b;">CAPEX Calculator</a></li>
                    <li><a href="opex-calculator.html" style="color: #10b981;">OPEX Calculator</a></li>
                    <li style="border-bottom: 1px solid rgba(255,255,255,0.1); margin: 4px 0;"></li>
                    <li><a href="dcmoc/" style="color: #ef4444; font-weight: 600;">DC MOC</a></li>
                </ul>
            </li>
            <li><a href="index.html#metrics" class="nav-link">Results</a></li>
            <li><a href="index.html#case-studies" class="nav-link">Case Studies</a></li>
            <li><a href="articles.html" class="nav-link">Articles</a></li>
            <li><a href="index.html#faq" class="nav-link">FAQ</a></li>
            <li><a href="index.html#contact" class="nav-link">Contact</a></li>
        </ul>
                    <button class="nav-search-btn" id="navSearchBtn" aria-label="Search" title="Search (Ctrl+K)">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
            </button>
            <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode" title="Toggle dark/light mode">
            <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
            <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
        </button>
        <button class="hamburger" aria-label="Open navigation menu" aria-expanded="false">
            <span class="bar"></span>
            <span class="bar"></span>
            <span class="bar"></span>
        </button>
    </div>
</nav>

<main id="main-content">
<!-- Article Hero -->
<header class="article-hero">
    <div class="container">
        <a href="articles.html" class="back-link">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
            Back to Articles
        </a>
        <span class="article-category"><i class="fas fa-microchip"></i> AI Infrastructure</span>
        <h1 class="article-title">The Rise of <span class="highlight">AI Factories</span>: Why Traditional Data Center Architecture Faces Technical Extinction</h1>
        <p class="article-subtitle">Rack density surging to 130kW. Liquid cooling becoming non-negotiable. $600B+ in hyperscaler CAPEX. The data center industry is undergoing its most radical transformation since the invention of the raised floor.</p>
        <div class="article-meta">
            <span class="article-meta-item"><i class="fas fa-user"></i> Bagus Dwi Permana</span>
            <span class="article-meta-item"><i class="fas fa-calendar"></i> February 22, 2026</span>
            <span class="article-meta-item"><i class="fas fa-clock"></i> 18 min read</span>
            <span class="article-meta-item"><i class="fas fa-calculator"></i> Interactive Calculator</span>
        </div>
        <a href="#calculator" class="jump-to-calc"><i class="fas fa-calculator"></i> Try the AI Factory Readiness Calculator</a>
    </div>
</header>

    <!-- Series Navigation -->
    <div class="series-nav" style="margin-top: 1rem;">
        <div class="series-badge">
            <span class="series-badge-icon">18</span>
            Engineering Journal &mdash; Article 18 of 18
        </div>
        <span class="series-title"></span>
        <div class="series-links">
            <a href="article-17.html" class="series-link"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>Prev</a>
            <span class="series-link disabled">Next<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg></span>
        </div>
    </div>

<!-- Evidence Block -->
<div class="aif-evidence-block">
    <div class="aif-evidence-grid">
        <div class="aif-evidence-card">
            <div class="aif-evidence-value">$600B+</div>
            <div class="aif-evidence-label">Hyperscaler CAPEX 2026</div>
            <div class="aif-evidence-sub">36% YoY increase</div>
        </div>
        <div class="aif-evidence-card">
            <div class="aif-evidence-value">120-130 kW</div>
            <div class="aif-evidence-label">AI Rack Power Density</div>
            <div class="aif-evidence-sub">vs 10 kW traditional</div>
        </div>
        <div class="aif-evidence-card">
            <div class="aif-evidence-value">PUE 1.10</div>
            <div class="aif-evidence-label">Liquid Cooling Benchmark</div>
            <div class="aif-evidence-sub">vs 1.6 air-cooled</div>
        </div>
        <div class="aif-evidence-card">
            <div class="aif-evidence-value">52%</div>
            <div class="aif-evidence-label">Hyperscale LC Adoption</div>
            <div class="aif-evidence-sub">Up from 18% in 2021</div>
        </div>
        <div class="aif-evidence-card">
            <div class="aif-evidence-value">&lt;5 Years</div>
            <div class="aif-evidence-label">AI Hardware Lifecycle</div>
            <div class="aif-evidence-sub">Rapid depreciation cycle</div>
        </div>
    </div>
</div>

<!-- Main Content -->
<main>
<article class="article-content">
    <div class="container">
        <div class="article-body">

            <!-- Table of Contents -->
            <div class="toc-section">
                <h3><i class="fas fa-list"></i> Table of Contents</h3>
                <div class="toc-grid">
                    <a href="#section1" class="toc-item"><span class="toc-num">1</span> The "AI Factory" Paradigm Shift</a>
                    <a href="#section2" class="toc-item"><span class="toc-num">2</span> Rack Compute Density: Toward the Megawatt Threshold</a>
                    <a href="#section3" class="toc-item"><span class="toc-num">3</span> The Thermodynamic Revolution: Physics of Cooling</a>
                    <a href="#section4" class="toc-item"><span class="toc-num">4</span> The Network War: Ultra Ethernet vs InfiniBand</a>
                    <a href="#section5" class="toc-item"><span class="toc-num">5</span> Energy Geopolitics &amp; The $700 Billion Race</a>
                    <a href="#section6" class="toc-item"><span class="toc-num">6</span> Indonesia's Sovereign AI Ambitions</a>
                    <a href="#section7" class="toc-item"><span class="toc-num">7</span> Strategic Risks: Stranded Assets &amp; Software Efficiency</a>
                    <a href="#section8" class="toc-item"><span class="toc-num">8</span> Industry Perspective: What the Giants Are Building</a>
                    <a href="#section9" class="toc-item"><span class="toc-num">9</span> The Verdict: Infrastructure Is the Product</a>
                    <a href="#calculator" class="toc-item toc-calculator"><span class="toc-num"><i class="fas fa-calculator"></i></span> Interactive: AI Factory Infrastructure Readiness Calculator <span class="toc-calc-badge">INTERACTIVE</span></a>
                </div>
            </div>

            <!-- Section 1 -->
            <h2 id="section1">1. The "AI Factory" Paradigm Shift</h2>

            <p>For two decades, we built data centers as five-star hotels for servers: flexible for humans, but physically inefficient for modern workloads. As of February 2026, that paradigm has collapsed.</p>

            <blockquote class="aif-quote">
                <p>"The fundamental purpose of a data center has changed. Raw data comes in, is refined, and intelligence goes out. Companies aren't running applications anymore. They're manufacturing intelligence. They're operating giant AI factories."</p>
                <cite>
                    <strong>Jensen Huang</strong>, CEO &mdash; NVIDIA
                    <span class="aif-quote-source">GTC 2025 Keynote, March 2025</span>
                </cite>
            </blockquote>

            <p>The explosion of demand for frontier model training (the post-GPT-4 era) and massive-scale inference has given birth to AI-Native Design. These aren't IT facilities anymore. They are AI Factories &mdash; an infrastructure revolution that converts electrons into the most valuable commodity of this century: digital intelligence.</p>

            <p>Consider the scale of the shift. A traditional enterprise data center might house 500 racks at 5-10 kW each, drawing 2.5-5 MW of total IT power. A single NVIDIA GB300 NVL72 cluster occupies the same rack count but demands 65-70 MW. The engineering required to deliver, cool, and network that power density has rendered most of the existing global data center stock functionally obsolete for AI workloads.</p>

            <figure class="article-figure">
                <picture><source srcset="assets/article-18-cover.webp" type="image/webp"><img src="assets/article-18-cover.png" alt="AI Factory Data Center Architecture - The paradigm shift from traditional server hosting to AI-native infrastructure"></picture>
                <figcaption>The AI Factory paradigm: purpose-built infrastructure designed to manufacture digital intelligence at industrial scale.</figcaption>
            </figure>

            <p>The transition from general-purpose to purpose-built is not optional. NVIDIA has deployed over 100 AI factories worldwide as of January 2025, with the number growing monthly. Every major hyperscaler, sovereign government, and forward-thinking enterprise is racing to build or retrofit facilities that can support what amounts to a completely different class of computing.</p>

            <!-- Section 2 -->
            <h2 id="section2">2. Rack Compute Density: Toward the Megawatt Threshold</h2>

            <p>If traditional data centers prided themselves on 10 kW per rack, AI-native architecture in 2026 operates in a different dimension entirely. Hyperscalers are currently integrating Blackwell GB300 and Vera Rubin NVL72 systems with precision densities at 120-130 kW per rack.</p>

            <div class="data-table-container">
                <table class="data-table">
                    <thead>
                        <tr><th>Year</th><th>Platform</th><th>Per-Rack Density</th><th>GPUs per Rack</th><th>Interconnect</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>2015</td><td>Traditional x86</td><td>5 kW</td><td>N/A</td><td>10 GbE</td></tr>
                        <tr><td>2020</td><td>Early GPU (A100)</td><td>10-15 kW</td><td>8</td><td>HDR InfiniBand</td></tr>
                        <tr><td>2023</td><td>NVIDIA H100 DGX</td><td>30-40 kW</td><td>8</td><td>NDR InfiniBand</td></tr>
                        <tr class="highlight-row"><td>2025-26</td><td>GB300 NVL72</td><td>132-140 kW</td><td>72</td><td>NVLink 5.0 (130 TB/s)</td></tr>
                        <tr><td>2026-27</td><td>Vera Rubin NVL72</td><td>120-130 kW</td><td>72</td><td>NVLink 6 (3.6 TB/s per GPU)</td></tr>
                        <tr><td>2027+</td><td>Rubin Ultra NVL576</td><td>~600 kW</td><td>576</td><td>NVLink 6 (Kyber fabric)</td></tr>
                    </tbody>
                </table>
                <p class="table-source">Sources: NVIDIA GTC 2025, Computex 2025, Tom's Hardware, DatacenterDynamics For educational and research purposes only.</p>
            </div>

            <h3>The GB300 NVL72: Setting the Standard</h3>
            <p>The NVIDIA GB300 NVL72 represents the current deployment standard for AI-native facilities. Each rack integrates 72 Blackwell Ultra GPUs interconnected via NVLink 5.0, delivering an aggregate bisection bandwidth of 130 TB/s within the rack. At 132-140 kW per rack, it demands purpose-built liquid cooling infrastructure and structural reinforcement to support its 2.5-3 ton weight.</p>

            <h3>Vera Rubin: The 2026-2027 Transition</h3>
            <p>NVIDIA's next-generation Vera Rubin platform, announced at Computex 2025, introduces the Rubin R100 GPU with HBM4 memory and NVLink 6 interconnect delivering 3.6 TB/s per GPU. The Vera Rubin NVL72 maintains a similar 120-130 kW envelope while delivering substantial performance improvements. Critically, Rubin's architecture enables training with one-quarter the number of GPUs required by Blackwell for equivalent workloads, fundamentally changing the efficiency equation.</p>

            <div class="aif-comparison-grid">
                <div class="aif-comparison-card traditional">
                    <div class="card-icon">&#x1F4E6;</div>
                    <div class="card-title">Traditional Rack</div>
                    <div class="card-value">10 kW</div>
                    <div class="card-desc">Air-cooled, ~1 ton, commodity servers, 10-25 GbE networking</div>
                </div>
                <div class="aif-comparison-card ai-native">
                    <div class="card-icon">&#x26A1;</div>
                    <div class="card-title">AI-Native Rack (GB300)</div>
                    <div class="card-value">132 kW</div>
                    <div class="card-desc">Liquid-cooled, 2.5-3 ton, 72 GPUs, NVLink 5.0 at 130 TB/s</div>
                </div>
            </div>

            <div class="aif-insight-box">
                <h4><i class="fas fa-lightbulb"></i> Operational Reality</h4>
                <p>In billion-dollar GPU clusters, GPU idle time exceeding 1% translates to millions of dollars per hour in lost productivity. Tight clustering with NVLink interconnects is mandatory to minimize latency. This is why AI racks cannot simply be spread across existing facilities &mdash; the physics of interconnect latency demands density.</p>
            </div>

            <!-- Section 3 -->
            <h2 id="section3">3. The Thermodynamic Revolution: Physics of Cooling</h2>

            <p>Air has reached its thermal limit, as our earlier <a href="article-9.html">HVAC shock analysis</a> forewarned. It can no longer handle the heat flux of chips that penetrate 1,000 W/cm&sup2;. AI-native design mandates the transition to liquid cooling with strict operational realities.</p>

            <blockquote class="aif-quote">
                <p>"The primary bottlenecks for AI scaling are no longer the availability of high-end silicon, but the skyrocketing costs of electricity and the lack of advanced liquid cooling infrastructure to support these systems at scale."</p>
                <cite>
                    <strong>Satya Nadella</strong>, CEO &mdash; Microsoft
                    <span class="aif-quote-source">World Economic Forum, Davos, January 2026</span>
                </cite>
            </blockquote>

            <div class="data-table-container">
                <table class="data-table">
                    <thead>
                        <tr><th>Cooling Technology</th><th>PUE Range</th><th>Max Rack Density</th><th>Market Share 2025</th><th>Status</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>Traditional Air</td><td>1.4 - 1.8</td><td>~30 kW</td><td>Declining</td><td>Legacy standard</td></tr>
                        <tr class="highlight-row"><td>Direct-to-Chip (DTC)</td><td>1.10 - 1.35</td><td>~200 kW</td><td>42.85% revenue</td><td>Market leader</td></tr>
                        <tr><td>Rear-Door Heat Exchanger</td><td>1.20 - 1.40</td><td>~50 kW</td><td>Growing</td><td>Retrofit-friendly</td></tr>
                        <tr><td>Single-Phase Immersion</td><td>&lt; 1.10</td><td>300+ kW</td><td>Emerging</td><td>PFAS regulatory risk</td></tr>
                        <tr><td>Two-Phase Immersion</td><td>&lt; 1.08</td><td>400+ kW</td><td>Niche</td><td>Operational complexity</td></tr>
                    </tbody>
                </table>
                <p class="table-source">Sources: Markets and Markets, Grand View Research, Vertiv Data Center Cooling Reports For educational and research purposes only.</p>
            </div>

            <h3>Direct-to-Chip Dominance</h3>
            <p>DTC cooling has emerged as the definitive winner for 2025-2026 deployments. It captured 42.85% of liquid cooling revenue in 2025 according to Markets and Markets, driven by two factors: compatibility with existing brownfield facility retrofits and significantly lower operational complexity compared to immersion cooling. Google's global fleet achieves a PUE of 1.09. AWS operates at a global average PUE of 1.15. These benchmarks are achieved primarily through DTC implementations at scale.</p>

            <figure class="article-figure">
                <img src="assets/article-18-mid.png" alt="Data Center Liquid Cooling Infrastructure - Direct-to-Chip and Immersion systems">
                <figcaption>Modern liquid cooling infrastructure: Direct-to-Chip systems delivering coolant directly to processors, achieving PUE below 1.15 at scale.</figcaption>
            </figure>

            <h3>The PFAS Problem</h3>
            <p>Immersion cooling faces a regulatory headwind that could limit its adoption timeline. The dielectric fluids used in many immersion systems contain PFAS (per- and polyfluoroalkyl substances), a class of chemicals facing increasing regulatory scrutiny in the EU and US. While alternatives exist, the uncertainty has pushed most hyperscalers toward DTC as the safer bet for large-scale deployments.</p>

            <h3>Market Trajectory</h3>
            <p>The liquid cooling market is projected to grow from $2.84 billion in 2025 to between $21 billion and $44 billion by 2032-2035, representing a compound annual growth rate of approximately 33%. This is not speculative demand &mdash; it is the direct consequence of GPU architectures that physically cannot be air-cooled.</p>

            <div class="aif-insight-box">
                <h4><i class="fas fa-chart-line"></i> PUE Reality Check</h4>
                <p>Forget lab claims of PUE 1.02. Real-world hyperscale facilities in early 2026 operate in the 1.10-1.15 range with liquid cooling. The energy losses in pumps and distribution systems are an inescapable consequence of the second law of thermodynamics. Any vendor claiming sub-1.05 PUE at scale deserves scrutiny.</p>
            </div>

            <!-- Section 4 -->
            <h2 id="section4">4. The Network War: Ultra Ethernet vs InfiniBand</h2>

            <p>AI-native data centers demand "flat" (non-blocking) networks with constant utilization above 90% to amortize the massive capital expenditure on GPU infrastructure. The battle between two networking paradigms is reshaping how clusters are built.</p>

            <div class="data-table-container">
                <table class="data-table">
                    <thead>
                        <tr><th>Attribute</th><th>Ultra Ethernet (UEC 1.0)</th><th>InfiniBand (NDR/XDR)</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>Bandwidth</td><td>400/800 GbE</td><td>400/800 Gb/s</td></tr>
                        <tr><td>Latency</td><td>~2-3 &mu;s (improving)</td><td>&lt;1 &mu;s</td></tr>
                        <tr><td>Ecosystem</td><td>Open, multi-vendor</td><td>NVIDIA proprietary</td></tr>
                        <tr><td>Cost</td><td>30-50% lower per port</td><td>Premium pricing</td></tr>
                        <tr><td>Best For</td><td>Inference scale-out, commercial clusters</td><td>Frontier training, ultra-low latency</td></tr>
                        <tr><td>RDMA Support</td><td>RoCEv2 (improving)</td><td>Native, mature</td></tr>
                        <tr><td>Congestion Control</td><td>UEC-specific (new)</td><td>Battle-tested</td></tr>
                    </tbody>
                </table>
                <p class="table-source">Sources: Stordis Network Analysis, Ultra Ethernet Consortium, NVIDIA Networking For educational and research purposes only.</p>
            </div>

            <p>The Ultra Ethernet Consortium (UEC) launched its 1.0 specification in June 2025, bringing open Ethernet to near-InfiniBand performance levels. NVIDIA's Spectrum-X platform bridges both worlds, offering an Ethernet-based solution with AI-specific optimizations.</p>

            <p>The industry is shifting from a singular focus on peak FLOPS toward sustained efficiency and the lowest cost-per-token. This transition favors Ultra Ethernet for the growing inference workload segment, where scale-out economics dominate and the sub-microsecond latency of InfiniBand provides diminishing returns. For frontier training runs where collective operations synchronize across thousands of GPUs, InfiniBand remains the established choice.</p>

            <div class="aif-insight-box">
                <h4><i class="fas fa-network-wired"></i> The Practical Split</h4>
                <p>Ultra Ethernet for inference at scale (cost-optimized, open ecosystem). InfiniBand for frontier training (latency-critical, proven at 100K+ GPU scale). Most large operators are building for both, using InfiniBand in training clusters and Ethernet in inference pools.</p>
            </div>

            <!-- Section 5 -->
            <h2 id="section5">5. Energy Geopolitics &amp; The $700 Billion Race</h2>

            <p>In 2026, the location of a data center is determined by access to baseload power, not proximity to users. The largest capital allocation in the history of technology is underway.</p>

            <blockquote class="aif-quote">
                <p>"The risk of underinvesting is dramatically worse than the risk of overinvesting. For each of these companies, if they turn out to be wrong, they will have the ability to recover. If they don't invest and get it wrong, there may not be a path forward. This AI build-out is moving 10 times faster than prior industrial revolutions."</p>
                <cite>
                    <strong>Sundar Pichai</strong>, CEO &mdash; Alphabet/Google
                    <span class="aif-quote-source">AI Action Summit, Paris, February 2025</span>
                </cite>
            </blockquote>

            <div class="data-table-container">
                <table class="data-table">
                    <thead>
                        <tr><th>Company</th><th>2026 CAPEX (Planned)</th><th>% Revenue</th><th>Primary AI Focus</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>Amazon (AWS)</td><td>~$200B</td><td>~28%</td><td>Custom Trainium, Inferentia chips + NVIDIA</td></tr>
                        <tr><td>Alphabet (Google)</td><td>~$185B</td><td>~45%</td><td>TPUv6, Gemini infrastructure</td></tr>
                        <tr><td>Microsoft</td><td>$120B+</td><td>~45%</td><td>Azure AI, OpenAI partnership</td></tr>
                        <tr><td>Meta</td><td>$100B+</td><td>~57%</td><td>Llama training, AI research</td></tr>
                        <tr class="highlight-row"><td><strong>Total</strong></td><td><strong>~$605B</strong></td><td></td><td>~75% tied to AI infrastructure</td></tr>
                    </tbody>
                </table>
                <p class="table-source">Sources: IEEE Communications Society, CNBC, Company earnings reports Q4 2025 For educational and research purposes only.</p>
            </div>

            <p>Approximately 75% of this spending &mdash; roughly $450 billion &mdash; is directly tied to AI infrastructure: GPU procurement, data center construction, <a href="article-13.html">advanced power distribution systems</a>, and cooling systems. The capital intensity is historically unprecedented: Meta is reinvesting 57% of its revenue into infrastructure, a ratio that would have been unthinkable in any previous technology era.</p>

            <h3>The Nuclear Question</h3>
            <p>Small Modular Reactors (SMRs) remain the long-term dream for baseload AI power, but the licensing process has kept them firmly in the future tense. The dominant power solutions for 2026 are co-location with existing legacy nuclear plants and hybrid configurations combining large-scale solar arrays with battery storage systems. Microsoft's deal with Constellation Energy to restart the Three Mile Island Unit 1 reactor exemplifies the desperation for reliable baseload power.</p>

            <div class="aif-opportunity-box">
                <h4><i class="fas fa-bolt"></i> The Power Arms Race</h4>
                <p>Hyperscalers are becoming energy companies by necessity. The ability to secure 50-500 MW of continuous baseload power is now the single greatest barrier to entry in the AI infrastructure market. Companies that solve the power equation gain a structural competitive advantage that cannot be replicated with software alone.</p>
            </div>

            <!-- Section 6 -->
            <h2 id="section6">6. Indonesia's Sovereign AI Ambitions</h2>

            <p>The sovereign AI movement is driving data center construction in emerging markets, with Indonesia positioning itself as Southeast Asia's AI infrastructure leader.</p>

            <ul>
                <li><strong>BDx Indonesia</strong> launched the country's first sovereign AI data center powered by NVIDIA in December 2024, establishing a template for GPU-dense facilities in the region.</li>
                <li><strong>Telkom NeutraDC Batam</strong> has deployed an 18 MW facility scalable to 54 MW, targeting both domestic and international AI workloads leveraging Batam's proximity to Singapore.</li>
                <li><strong>Market projection:</strong> Indonesia's data center market is expected to grow from $0.66 billion in 2025 to $1.44 billion by 2030, a CAGR of 16.91% — part of <a href="article-17.html">the broader $37 billion Southeast Asian opportunity</a> we analyzed.</li>
                <li><strong>GDP impact:</strong> The Indonesian government projects a $140 billion contribution from AI to national GDP by 2030, underpinning sovereign investment mandates.</li>
                <li><strong>Danantara sovereign wealth fund:</strong> has earmarked a $10 billion deployment specifically for digital infrastructure and AI capabilities.</li>
            </ul>

            <div class="aif-bear-box">
                <h4><i class="fas fa-exclamation-triangle"></i> Infrastructure Constraints</h4>
                <p>Indonesia faces two critical constraints that could slow AI infrastructure deployment. PLN (state utility) grid capacity remains limited in many target regions, with new high-voltage connections taking 12-24 months. Water stress in Java and Bali creates environmental opposition to water-intensive cooling systems. These factors are pushing developers toward modular edge deployments with independent micro-grids and air-cooled or dry-cooled solutions where liquid cooling water supply is constrained.</p>
            </div>

            <!-- Section 7 -->
            <h2 id="section7">7. Strategic Risks: Stranded Assets &amp; Software Efficiency</h2>

            <p>Building AI-native infrastructure is a wager with a brutally short lifecycle. The risks are real and quantifiable.</p>

            <h3>The DeepSeek Factor</h3>
            <p>In January 2025, DeepSeek released its R1 model, demonstrating comparable performance to GPT-4-class models at a fraction of the training compute cost. The reaction was immediate: NVIDIA's stock dropped 17% in a single session. The market briefly questioned whether the entire AI infrastructure buildout was overkill.</p>

            <p>The answer, as it turned out, was no. Meta responded by increasing its 2025 AI spending to $65 billion, up from $38 billion. Jevons Paradox &mdash; the observation that efficiency improvements lead to increased total consumption &mdash; proved predictive once again. Cheaper AI inference made AI accessible to millions more users and use cases, driving exponentially more compute demand.</p>

            <h3>Hardware Depreciation</h3>
            <p>AI hardware refresh cycles are running under 5 years, and accelerating. The NVIDIA A100 (released 2020) was functionally superseded by the H100 (2022), which is now being replaced by Blackwell (2024-2025), with Vera Rubin arriving in 2026-2027. Facilities that cannot support the physical requirements of each successive generation &mdash; 2-3 ton racks, liquid cooling plumbing, reinforced floors, higher power density &mdash; become stranded assets.</p>

            <div class="aif-contrarian-box">
                <h4><i class="fas fa-balance-scale"></i> The Contrarian Case</h4>
                <p>If software efficiency improvements outpace demand growth, the industry faces overcapacity risk. A 10x improvement in model efficiency, applied across all workloads, would theoretically reduce compute demand by 90%. If this happens faster than new AI use cases emerge to absorb the freed capacity, the $600B+ in infrastructure investment becomes a write-down. This is the tail risk that keeps CFOs up at night &mdash; even as they approve the next billion-dollar facility.</p>
            </div>

            <!-- Section 8 -->
            <h2 id="section8">8. Industry Perspective: What the Giants Are Building</h2>

            <blockquote class="aif-quote">
                <p>"What we're building is not just data center infrastructure. This is the largest industrial buildout in human history. We're building AI factories that will manufacture digital intelligence for the world."</p>
                <cite>
                    <strong>Jensen Huang</strong>, CEO &mdash; NVIDIA
                    <span class="aif-quote-source">CES 2025, Las Vegas</span>
                </cite>
            </blockquote>

            <blockquote class="aif-quote">
                <p>"Energy and energy infrastructure costs will be the key driver of who wins the AI race. We have a lot of GPUs, a lot of capacity, but the challenge is to put that capacity to work efficiently. Energy is the bottleneck."</p>
                <cite>
                    <strong>Satya Nadella</strong>, CEO &mdash; Microsoft
                    <span class="aif-quote-source">Microsoft Q1 FY2026 Earnings Call</span>
                </cite>
            </blockquote>

            <blockquote class="aif-quote">
                <p>"We're planning to bring online tens of gigawatts of capacity this decade. Meta Compute represents our commitment to building the infrastructure that will power the next generation of AI services for billions of people."</p>
                <cite>
                    <strong>Mark Zuckerberg</strong>, CEO &mdash; Meta
                    <span class="aif-quote-source">Meta Compute Announcement, January 2026</span>
                </cite>
            </blockquote>

            <p>The colocation operators are tracking this shift directly. Equinix reported that 60% of its largest Q4 2025 deals were driven by AI workloads &mdash; a dramatic shift from the traditional enterprise hosting and cloud connectivity mix that historically dominated their order book. Digital Realty posted record results with a notable shift toward inference workload deployments, confirming that AI demand is transitioning from training-only to production inference at scale.</p>

            <div class="aif-insight-box">
                <h4><i class="fas fa-building"></i> The Operator Shift</h4>
                <p>Traditional colocation operators face a strategic choice: invest heavily to retrofit for AI-density workloads, or cede the fastest-growing segment of the market to purpose-built competitors. Those who invest early and secure power commitments gain lasting structural advantages. Those who wait risk irrelevance as the market migrates to AI-native facilities.</p>
            </div>

            <!-- Section 9 -->
            <h2 id="section9">9. The Verdict: Infrastructure Is the Product</h2>

            <p>In 2026, a data center no longer merely supports the business. It is the product itself. The competitive advantage has shifted from algorithms to energy access and cooling efficiency.</p>

            <div class="data-table-container">
                <table class="data-table">
                    <thead>
                        <tr><th>Dimension</th><th>Traditional Data Center</th><th>AI Factory</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>Rack Density</td><td>5-10 kW</td><td>120-600 kW</td></tr>
                        <tr><td>Cooling</td><td>Air (CRAC/CRAH)</td><td>Liquid (DTC/Immersion)</td></tr>
                        <tr><td>PUE</td><td>1.4-1.8</td><td>1.08-1.15</td></tr>
                        <tr><td>Rack Weight</td><td>~1 ton</td><td>2-3 tons</td></tr>
                        <tr><td>Network</td><td>10-100 GbE</td><td>400-800G + NVLink</td></tr>
                        <tr><td>Power per Facility</td><td>2-10 MW</td><td>50-500 MW</td></tr>
                        <tr><td>Hardware Lifecycle</td><td>7-10 years</td><td>&lt;5 years</td></tr>
                        <tr><td>Primary Workload</td><td>General IT, Web, Storage</td><td>Training, Inference, HPC</td></tr>
                    </tbody>
                </table>
            </div>
            <p class="table-source" style="font-size:0.72rem;color:#64748b;font-style:italic;margin:0.4rem 0 1.2rem;">Source: Publicly available industry data and published standards. For educational and research purposes only.</p>

            <div class="aif-opportunity-box">
                <h4><i class="fas fa-trophy"></i> The New Moat</h4>
                <p>As the industry converges on similar model architectures and training techniques, the remaining competitive differentiator is operational infrastructure. Those who can deliver the lowest cost per token of inference, backed by reliable power and efficient cooling, hold the only defensible moat in an era of commoditizing digital intelligence. Infrastructure is not the cost center. <span class="stat-highlight">Infrastructure is the product.</span></p>
            </div>

            <!-- Calculator Section -->
            <h2 id="calculator">10. AI Factory Infrastructure Readiness Calculator</h2>
            <p>Assess whether your existing or planned data center facility can support AI-native workloads. This calculator evaluates power density readiness, cooling infrastructure adequacy, structural capacity, and estimates operational costs.</p>

            <div class="aif-calculator">
                <div class="calc-title"><i class="fas fa-microchip"></i> AI Factory Infrastructure Readiness Calculator</div>
                <p class="calc-subtitle">Evaluate your facility's capability to support GPU-dense AI workloads, estimate costs, and assess stranded asset risk.</p>

                <!-- Toolbar -->
                <div class="aif-toolbar">
                    <div class="aif-mode-bar">
                        <button class="aif-toolbar-btn aif-btn-free active" onclick="aifSetMode('free')"><i class="fas fa-chart-bar"></i> Free Assessment</button>
                        <button class="aif-toolbar-btn aif-btn-pro" onclick="aifSetMode('pro')"><i class="fas fa-crown"></i> Pro Intelligence</button>
                    </div>
                    <div class="aif-toolbar-actions">
                        <button class="aif-btn-reset" onclick="aifResetDefaults()"><i class="fas fa-undo"></i> Reset</button>
                        <button class="aif-btn-pdf" onclick="aifExportPDF()"><i class="fas fa-file-pdf"></i> Export PDF</button>
                    </div>
                </div>

                <!-- Inputs -->
                <div class="calc-grid">
                    <div class="calc-input-group">
                        <label>Rack Density (kW) <span class="calc-tooltip">?<span class="tip-text">Average power per rack. Traditional DCs: 5-10kW. AI-native: 40-130kW. GB300 NVL72 requires 132kW per rack.</span></span></label>
                        <input type="number" id="aifDensity" value="10" min="1" max="600" step="1">
                    </div>
                    <div class="calc-input-group">
                        <label>Number of AI Racks <span class="calc-tooltip">?<span class="tip-text">Total GPU/AI racks to deploy. Hyperscale clusters: 1000+. Enterprise AI: 50-200. Small AI labs: 10-50.</span></span></label>
                        <input type="number" id="aifRacks" value="100" min="10" max="5000" step="10">
                    </div>
                    <div class="calc-input-group">
                        <label>Cooling Type <span class="calc-tooltip">?<span class="tip-text">Air: limited to ~30kW/rack. Direct-to-Chip (DTC): up to 200kW/rack, dominant solution. Immersion: 300kW+, PFAS regulatory risk.</span></span></label>
                        <select id="aifCooling">
                            <option value="air">Air Cooling</option>
                            <option value="dtc">Direct-to-Chip (DTC)</option>
                            <option value="immersion">Immersion Cooling</option>
                        </select>
                    </div>
                    <div class="calc-input-group">
                        <label>Current PUE <span class="calc-tooltip">?<span class="tip-text">Power Usage Effectiveness. Industry average: 1.58. Best liquid-cooled: 1.10. Google fleet: 1.09. Values below 1.1 require full liquid cooling.</span></span></label>
                        <input type="number" id="aifPUE" value="1.5" min="1.0" max="3.0" step="0.01">
                    </div>
                    <div class="calc-input-group">
                        <label>Electricity Rate ($/kWh) <span class="calc-tooltip">?<span class="tip-text">Local utility rate. US average: $0.08. EU: $0.15-0.25. Indonesia: $0.07. Singapore: $0.12. Lower rates favor higher-density deployments.</span></span></label>
                        <input type="number" id="aifElecRate" value="0.08" min="0.01" max="0.50" step="0.01">
                    </div>
                    <div class="calc-input-group">
                        <label>Facility Age (years) <span class="calc-tooltip">?<span class="tip-text">Older facilities face higher retrofit costs and structural limitations. Facilities over 10 years typically require significant upgrades for AI workloads.</span></span></label>
                        <input type="number" id="aifAge" value="8" min="0" max="30" step="1">
                    </div>
                    <div class="calc-input-group">
                        <label>Floor Load (kg/m&sup2;) <span class="calc-tooltip">?<span class="tip-text">Structural capacity per square meter. Traditional: 1000 kg/m&sup2;. AI racks (3 ton): need 2500+ kg/m&sup2;. Reinforcement costs $50-150/m&sup2;.</span></span></label>
                        <input type="number" id="aifFloorLoad" value="1000" min="300" max="5000" step="100">
                    </div>
                    <div class="calc-input-group">
                        <label>LC Infrastructure <span class="calc-tooltip">?<span class="tip-text">Whether facility has chilled water loops, CDUs, or rear-door heat exchangers installed. Full = complete DTC or immersion ready. Partial = some piping/CDUs. None = air only.</span></span></label>
                        <select id="aifLCInfra">
                            <option value="none">None (Air Only)</option>
                            <option value="partial">Partial (Some Piping/CDUs)</option>
                            <option value="full">Full (DTC/Immersion Ready)</option>
                        </select>
                    </div>
                </div>

                <!-- Actions -->
                <div class="calc-actions">
                    <button class="calc-button" onclick="aifCalculate()"><i class="fas fa-calculator"></i> Assess Readiness</button>
                </div>

                <!-- Results -->
                <div class="calc-results" id="aifResults">
                    <div class="results-grid">
                        <div class="result-item">
                            <div class="label">Total IT Load <span class="res-tip">?<span class="res-tip-body"><div class="rtt">Total IT Load</div><div class="rtd">Rack density x rack count. This is the critical power envelope your facility must deliver.</div><span class="rtf">Hyperscale AI: 50-500 MW typical</span></span></span></div>
                            <div class="value blue" id="resITLoad">-</div>
                            <div class="subtext" id="resITLoadSub"></div>
                        </div>
                        <div class="result-item">
                            <div class="label">Facility Power <span class="res-tip">?<span class="res-tip-body"><div class="rtt">Total Facility Power</div><div class="rtd">IT Load multiplied by PUE. Includes cooling, power distribution, lighting overhead.</div><span class="rtf">Lower PUE = less wasted energy</span></span></span></div>
                            <div class="value blue" id="resFacPower">-</div>
                            <div class="subtext" id="resFacPowerSub"></div>
                        </div>
                        <div class="result-item">
                            <div class="label">Annual Energy Cost <span class="res-tip">?<span class="res-tip-body"><div class="rtt">Annual Energy Cost</div><div class="rtd">Total facility power x 8,760 hours/year x electricity rate. The single largest OPEX line item.</div><span class="rtf">Typically 40-60% of total OPEX</span></span></span></div>
                            <div class="value amber" id="resEnergyCost">-</div>
                        </div>
                        <div class="result-item">
                            <div class="label">Cooling Score <span class="res-tip">?<span class="res-tip-body"><div class="rtt">Cooling Readiness Score</div><div class="rtd">Weighted score comparing cooling capability to rack density requirement. 80+ = ready. 50-79 = needs upgrade. Below 50 = major gap.</div><span class="rtf">0-100 scale</span></span></span></div>
                            <div class="value" id="resCoolScore">-</div>
                        </div>
                        <div class="result-item">
                            <div class="label">Structural Score <span class="res-tip">?<span class="res-tip-body"><div class="rtt">Structural Readiness Score</div><div class="rtd">Floor load capacity adequacy for target rack weight. AI racks: 2-3 tons need 2500+ kg/m&sup2;.</div><span class="rtf">0-100 scale</span></span></span></div>
                            <div class="value" id="resStructScore">-</div>
                        </div>
                        <div class="result-item">
                            <div class="label">AI Readiness Grade <span class="res-tip">?<span class="res-tip-body"><div class="rtt">Overall Readiness Grade</div><div class="rtd">Composite of cooling, structural, and power readiness. A = fully AI-ready, F = requires complete rebuild.</div><span class="rtf">A/B/C/D/F scale</span></span></span></div>
                            <div class="value" id="resGrade">-</div>
                        </div>
                        <div class="result-item">
                            <div class="label">Est. Annual OPEX <span class="res-tip">?<span class="res-tip-body"><div class="rtt">Estimated Annual OPEX</div><div class="rtd">Energy + cooling maintenance + staffing overhead. Does not include hardware depreciation or lease costs.</div><span class="rtf">Industry benchmark: $8-15M per MW</span></span></span></div>
                            <div class="value amber" id="resOPEX">-</div>
                        </div>
                        <div class="result-item">
                            <div class="label">Recommendation <span class="res-tip">?<span class="res-tip-body"><div class="rtt">Retrofit vs New Build</div><div class="rtd">Based on facility age, cooling gap, and structural gap. Recommends optimal upgrade path.</div><span class="rtf">Retrofit cost typically 30-60% of new build</span></span></span></div>
                            <div class="value blue" id="resRecommend" style="font-size:0.85rem;">-</div>
                        </div>
                    </div>

                    <!-- Readiness Gauge -->
                    <div class="aif-gauge">
                        <div style="font-size:0.85rem;color:#94a3b8;margin-bottom:0.5rem;">AI Infrastructure Readiness</div>
                        <div class="gauge-bar">
                            <div class="gauge-needle" id="gaugeNeedle" style="left:0%"></div>
                        </div>
                        <div class="gauge-labels">
                            <span>F - Not Ready</span>
                            <span>D - Major Gaps</span>
                            <span>C - Partial</span>
                            <span>B - Capable</span>
                            <span>A - AI-Native</span>
                        </div>
                        <div class="aif-verdict" id="aifVerdict"></div>
                    </div>
                </div>

                <!-- Pro Panels -->
                <div id="aifProPanels" style="display:none;">

                    <!-- Panel 1: Monte Carlo -->
                    <div class="aif-pro-panel gated" id="aifPanel0">
                        <div class="aif-panel-inner">
                            <div class="aif-panel-title"><i class="fas fa-dice"></i> Monte Carlo Risk Distribution (10K Iterations)</div>
                            <div class="aif-kpi-grid" id="mcKPIs">
                                <div class="aif-kpi-card"><div class="kpi-label">Mean Score</div><div class="kpi-value" id="mcMean">-</div></div>
                                <div class="aif-kpi-card"><div class="kpi-label">P5 (Worst)</div><div class="kpi-value" id="mcP5">-</div></div>
                                <div class="aif-kpi-card"><div class="kpi-label">P25</div><div class="kpi-value" id="mcP25">-</div></div>
                                <div class="aif-kpi-card"><div class="kpi-label">P50 (Median)</div><div class="kpi-value" id="mcP50">-</div></div>
                                <div class="aif-kpi-card"><div class="kpi-label">P75</div><div class="kpi-value" id="mcP75">-</div></div>
                                <div class="aif-kpi-card"><div class="kpi-label">P95 (Best)</div><div class="kpi-value" id="mcP95">-</div></div>
                            </div>
                            <div class="aif-chart-container"><canvas id="mcChart"></canvas></div>
                        </div>
                        <div class="aif-gate-overlay" onclick="aifShowLogin()"><i class="fas fa-lock"></i><span>Unlock Pro Intelligence</span></div>
                    </div>

                    <!-- Panel 2: TCO Comparison -->
                    <div class="aif-pro-panel gated" id="aifPanel1">
                        <div class="aif-panel-inner">
                            <div class="aif-panel-title"><i class="fas fa-chart-bar"></i> 5-Year TCO Comparison</div>
                            <div class="aif-kpi-grid" id="tcoKPIs">
                                <div class="aif-kpi-card"><div class="kpi-label">Traditional 5Y TCO</div><div class="kpi-value" id="tcoTrad">-</div></div>
                                <div class="aif-kpi-card"><div class="kpi-label">Retrofit 5Y TCO</div><div class="kpi-value" id="tcoRetro">-</div></div>
                                <div class="aif-kpi-card"><div class="kpi-label">Greenfield 5Y TCO</div><div class="kpi-value" id="tcoGreen">-</div></div>
                                <div class="aif-kpi-card"><div class="kpi-label">Best Value</div><div class="kpi-value" id="tcoBest">-</div></div>
                            </div>
                            <table class="aif-tco-table" id="tcoTable">
                                <thead><tr><th>Year</th><th>Traditional</th><th>Retrofit</th><th>Greenfield</th></tr></thead>
                                <tbody id="tcoBody"></tbody>
                            </table>
                            <p class="table-source" style="font-size:0.72rem;color:#64748b;font-style:italic;margin:0.4rem 0 1.2rem;">Source: Publicly available industry data and published standards. For educational and research purposes only.</p>
                            <div class="aif-chart-container"><canvas id="tcoChart"></canvas></div>
                        </div>
                        <div class="aif-gate-overlay" onclick="aifShowLogin()"><i class="fas fa-lock"></i><span>Unlock Pro Intelligence</span></div>
                    </div>

                    <!-- Panel 3: Sensitivity Tornado -->
                    <div class="aif-pro-panel gated" id="aifPanel2">
                        <div class="aif-panel-inner">
                            <div class="aif-panel-title"><i class="fas fa-wind"></i> Sensitivity Tornado Analysis</div>
                            <p style="font-size:0.78rem;color:#94a3b8;margin-bottom:0.5rem;">Impact of &plusmn;20% variation in each input on AI Readiness Score, sorted by magnitude.</p>
                            <div class="aif-chart-container"><canvas id="tornadoChart"></canvas></div>
                        </div>
                        <div class="aif-gate-overlay" onclick="aifShowLogin()"><i class="fas fa-lock"></i><span>Unlock Pro Intelligence</span></div>
                    </div>

                    <!-- Panel 4: Stranded Asset Risk -->
                    <div class="aif-pro-panel gated" id="aifPanel3">
                        <div class="aif-panel-inner">
                            <div class="aif-panel-title"><i class="fas fa-exclamation-circle"></i> Stranded Asset Risk Assessment</div>
                            <div class="aif-kpi-grid" id="saKPIs">
                                <div class="aif-kpi-card"><div class="kpi-label">Stranded Risk</div><div class="kpi-value" id="saProb">-</div></div>
                                <div class="aif-kpi-card"><div class="kpi-label">Est. Write-down</div><div class="kpi-value" id="saWritedown">-</div></div>
                                <div class="aif-kpi-card"><div class="kpi-label">Years to Obsolescence</div><div class="kpi-value" id="saYears">-</div></div>
                                <div class="aif-kpi-card"><div class="kpi-label">Action</div><div class="kpi-value" id="saAction" style="font-size:0.8rem;">-</div></div>
                            </div>
                            <div class="aif-chart-container"><canvas id="radarChart"></canvas></div>
                            <div class="aif-narrative" id="saNarrative">
                                <h4>Executive Assessment</h4>
                                <p>Run the calculator to generate your facility assessment.</p>
                            </div>
                        </div>
                        <div class="aif-gate-overlay" onclick="aifShowLogin()"><i class="fas fa-lock"></i><span>Unlock Pro Intelligence</span></div>
                    </div>
                </div>

                <!-- Privacy Badge -->
                <div class="aif-privacy-badge">
                    <i class="fas fa-shield-halved"></i> All calculations run in your browser &mdash; no data is sent to any server
                </div>
                <div class="aif-benchmark-meta">
                    <span class="aif-benchmark-tag"><i class="fas fa-code-branch"></i> Model v1.0</span>
                    <span class="aif-benchmark-tag"><i class="fas fa-calendar"></i> Updated Feb 2026</span>
                    <span class="aif-benchmark-tag"><i class="fas fa-book"></i> Sources: NVIDIA, IEEE, Vertiv, M&amp;M</span>
                    <span class="aif-benchmark-tag"><i class="fas fa-info-circle"></i> MC 10K + Sensitivity + TCO + Risk</span>
                </div>
            </div>

            
                <!-- Independence Disclaimer -->
                <div style="margin:2rem 0 0;padding:1rem 0;border-top:1px solid rgba(255,255,255,0.06);text-align:center;">
                    <p style="font-size:0.72rem;color:#64748b;font-style:italic;line-height:1.6;margin:0;">All content on ResistanceZero is independent personal research derived from publicly available sources. This site does not represent any current or former employer. <a href="terms.html" style="color:#8b5cf6;">Terms &amp; Disclaimer</a></p>
                </div>

<!-- References -->
            <div class="references">
                <h3>References &amp; Sources</h3>
                <ol>
                    <li id="ref1">NVIDIA Blog, "AI Factories: Manufacturing Intelligence at Scale." <a href="https://blogs.nvidia.com/blog/ai-factories/" target="_blank" rel="noopener">blogs.nvidia.com</a></li>
                    <li id="ref2">CNBC, "Nadella says energy and infrastructure costs will decide the AI race." <a href="https://www.cnbc.com/2026/01/21/nadella-energy-costs-ai-race.html" target="_blank" rel="noopener">cnbc.com</a></li>
                    <li id="ref3">Fortune, "Zuckerberg announces Meta Compute: tens of gigawatts this decade." <a href="https://fortune.com/2026/01/24/meta-compute-zuckerberg/" target="_blank" rel="noopener">fortune.com</a></li>
                    <li id="ref4">Reuters, "Pichai warns of underinvestment risk at AI Action Summit." <a href="https://www.reuters.com/technology/pichai-ai-investment-risk/" target="_blank" rel="noopener">reuters.com</a></li>
                    <li id="ref5">Markets and Markets, "Data Center Liquid Cooling Market &mdash; Global Forecast to 2032." <a href="https://www.marketsandmarkets.com/Market-Reports/data-center-liquid-cooling-market.html" target="_blank" rel="noopener">marketsandmarkets.com</a></li>
                    <li id="ref6">Vertiv, "The Impact of Liquid Cooling on Data Center PUE." <a href="https://www.vertiv.com/en-us/about/news-and-insights/articles/liquid-cooling-pue/" target="_blank" rel="noopener">vertiv.com</a></li>
                    <li id="ref7">Google Data Centers, "Efficiency: How we do it &mdash; PUE." <a href="https://www.google.com/about/datacenters/efficiency/" target="_blank" rel="noopener">google.com/datacenters</a></li>
                    <li id="ref8">Stordis, "Ultra Ethernet vs InfiniBand: The AI Networking Battle." <a href="https://www.stordis.com/ultra-ethernet-vs-infiniband/" target="_blank" rel="noopener">stordis.com</a></li>
                    <li id="ref9">IEEE Communications Society, "Hyperscaler CAPEX Exceeds $600B in 2026." <a href="https://www.comsoc.org/publications/magazines/ieee-communications-magazine" target="_blank" rel="noopener">comsoc.org</a></li>
                    <li id="ref10">Introl, "Indonesia Sovereign AI Data Center &mdash; BDx NVIDIA Partnership." <a href="https://www.introl.co.id/sovereign-ai-indonesia/" target="_blank" rel="noopener">introl.co.id</a></li>
                    <li id="ref11">Data Storage Asia, "Indonesia sovereign AI report: $140B GDP contribution by 2030." <a href="https://www.datastorageasean.com/indonesia-ai-data-centers/" target="_blank" rel="noopener">datastorageasean.com</a></li>
                    <li id="ref12">The AI Journal, "DeepSeek and the risk to data center investment." <a href="https://www.aijournal.com/deepseek-data-center-risk/" target="_blank" rel="noopener">aijournal.com</a></li>
                    <li id="ref13">Data Center Frontier, "DeepSeek impact on liquid cooling demand." <a href="https://www.datacenterfrontier.com/liquid-cooling/deepseek-impact/" target="_blank" rel="noopener">datacenterfrontier.com</a></li>
                    <li id="ref14">Bisnow, "Equinix &amp; Digital Realty report AI-driven inflection in Q4 2025." <a href="https://www.bisnow.com/national/news/data-center/equinix-digital-realty-ai-inflection/" target="_blank" rel="noopener">bisnow.com</a></li>
                    <li id="ref15">Equinix Blog, "AI Infrastructure Trends for 2025 and Beyond." <a href="https://blog.equinix.com/blog/ai-infrastructure-trends-2025/" target="_blank" rel="noopener">blog.equinix.com</a></li>
                    <li id="ref16">Tom's Hardware, "NVIDIA Ships Over 100 AI Factories Worldwide." <a href="https://www.tomshardware.com/news/nvidia-100-ai-factories/" target="_blank" rel="noopener">tomshardware.com</a></li>
                    <li id="ref17">Grand View Research, "Liquid Cooling for Data Centers Market Analysis 2025-2035." <a href="https://www.grandviewresearch.com/industry-analysis/data-center-liquid-cooling-market/" target="_blank" rel="noopener">grandviewresearch.com</a></li>
                    <li id="ref18">Precedence Research, "Data Center Liquid Cooling Market Size to Reach $44B by 2035." <a href="https://www.precedenceresearch.com/data-center-liquid-cooling-market/" target="_blank" rel="noopener">precedenceresearch.com</a></li>
                    <li id="ref19">Boyd Corporation, "Air vs Liquid Cooling Energy Analysis for AI Data Centers." <a href="https://www.boydcorp.com/resources/air-vs-liquid-cooling/" target="_blank" rel="noopener">boydcorp.com</a></li>
                    <li id="ref20">ACEEE, "Future-Proofing AI Data Centers: Efficiency Standards &amp; Best Practices." <a href="https://www.aceee.org/research-report/ai-data-centers-efficiency/" target="_blank" rel="noopener">aceee.org</a></li>
                    <li id="ref21">NVIDIA, "Vera Rubin NVL72 Architecture Overview &mdash; Computex 2025." <a href="https://www.nvidia.com/en-us/data-center/vera-rubin/" target="_blank" rel="noopener">nvidia.com</a></li>
                    <li id="ref22">Ultra Ethernet Consortium, "UEC 1.0 Specification Release." <a href="https://ultraethernet.org/specifications/" target="_blank" rel="noopener">ultraethernet.org</a></li>
                </ol>
            </div>

            <!-- Article Nav -->
            <div class="article-nav">
                <a href="article-17.html"><i class="fas fa-arrow-left"></i> Previous Article</a>
                <a href="articles.html">All Articles</a>
            </div>

            <!-- Author Bio -->
            <div class="author-bio">
                <div class="author-bio-image">
                    <img loading="lazy" src="assets/profile-photo.jpg" alt="Bagus Dwi Permana">
                </div>
                <div class="author-bio-content">
                    <h4>Bagus Dwi Permana</h4>
                    <p class="author-bio-title">Engineering Operations Manager | Ahli K3 Listrik</p>
                    <p>12+ years professional experience in critical infrastructure and operations. CDFOM certified. Transforming operations through systematic excellence and safety-first engineering.</p>
                    <div class="author-bio-links">
                        <a href="https://www.linkedin.com/in/bagus-dwi-permana-ba90b092" target="_blank">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                            LinkedIn
                        </a>
                        <a href="https://github.com/baguspermana7-cpu" target="_blank">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
                            GitHub
                        </a>
                        <a href="mailto:baguspermana7@gmail.com">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
                            Email
                        </a>
                    </div>
                </div>
            </div>

            <!-- Related Articles -->
            <div class="related-articles">
                <h3>Continue Reading</h3>
                <div class="related-grid">
                    <a href="article-17.html" class="related-card">
                        <div class="related-card-number">17</div>
                        <div class="related-card-content">
                            <h4>SEA Data Center Opportunity</h4>
                            <p>The $37B infrastructure opportunity of a generation</p>
                        </div>
                    </a>
                    <a href="article-9.html" class="related-card">
                        <div class="related-card-number">09</div>
                        <div class="related-card-content">
                            <h4>Data Center PUE Calculator</h4>
                            <p>HVAC and chiller-free cooling analysis</p>
                        </div>
                    </a>
                    <a href="article-5.html" class="related-card">
                        <div class="related-card-number">05</div>
                        <div class="related-card-content">
                            <h4>Building a Tier III Data Center</h4>
                            <p>Traditional DC architecture baseline</p>
                        </div>
                    </a>
                </div>
            </div>

        </div>
    </div>
</article>
</main>

<!-- Share Buttons -->
<aside class="share-buttons" id="shareButtons" aria-label="Share this article">
    <span class="share-label">Share</span>
    <button class="share-btn linkedin" data-tooltip="Share on LinkedIn" onclick="shareLinkedIn()" aria-label="Share on LinkedIn">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
    </button>
    <button class="share-btn twitter" data-tooltip="Share on X" onclick="shareTwitter()" aria-label="Share on X"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></button>
    <button class="share-btn whatsapp" data-tooltip="Share on WhatsApp" onclick="shareWhatsApp()" aria-label="Share on WhatsApp"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg></button>
    <button class="share-btn copy" data-tooltip="Copy link" onclick="copyLink()" aria-label="Copy article link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="copy-icon"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="check-icon" style="display:none"><polyline points="20 6 9 17 4 12"></polyline></svg>
    </button>
</aside>

<!-- Login Modal -->
<div class="aif-login-overlay" id="aifLoginOverlay">
    <div class="aif-login-box">
        <button class="aif-login-close" onclick="aifHideLogin()">&times;</button>
        <h3><i class="fas fa-lock" style="color:#60a5fa;margin-right:6px"></i> Pro Intelligence Engine</h3>
        <p>Unlock Monte Carlo simulation (10K runs), 5-Year TCO comparison, sensitivity tornado analysis, and stranded asset risk assessment with dynamic narrative.</p>
        <input type="email" id="aifLoginEmail" placeholder="Email address">
        <input type="password" id="aifLoginPass" placeholder="Password">
        <button class="aif-login-submit" onclick="aifHandleLogin()">Unlock Pro Intelligence</button>
        <div class="aif-login-error" id="aifLoginError">Invalid credentials.</div>
        <div class="aif-login-demo">Demo: <code>demo@resistancezero.com</code> / <code>demo2026</code></div>
        <p style="font-size:0.68rem;color:#64748b;margin-top:8px;line-height:1.5;">
            By clicking Login, you agree to our <a href="terms.html" target="_blank" style="color:#60a5fa;text-decoration:underline;">Terms of Service</a> and <a href="privacy.html" target="_blank" style="color:#60a5fa;text-decoration:underline;">Privacy Policy</a>.
        </p>
    </div>
</div>

<!-- Footer -->
<footer class="footer footer-enhanced">
    <div class="container">
        <div class="footer-grid">
            <div class="footer-brand">
                <p class="footer-tagline-main">BUILT FOR MISSION CRITICAL INFRASTRUCTURE<br>MANAGEMENT // 2026</p>
                <p class="footer-tagline-sub">ALL OPERATIONAL DATASETS PRESERVED.</p>
                <p class="footer-copyright">&copy; 2026 Bagus Dwi Permana. All rights reserved.</p>
            </div>
            <div class="footer-nav">
                <h4 class="footer-heading">NAVIGATION</h4>
                <ul class="footer-links">
                    <li><a href="index.html">Home Dashboard</a></li>
                    <li><a href="articles.html">Technical Journal</a></li>
                    <li><a href="index.html#case-studies">Case Studies</a></li>
                    <li><a href="datacenter-solutions.html">DC Solutions</a></li>
                </ul>
            </div>
            <div class="footer-connect">
                <h4 class="footer-heading">CONNECT</h4>
                <ul class="footer-links">
                    <li><a href="https://www.linkedin.com/in/bagus-dwi-permana-ba90b092" target="_blank" rel="noopener">LinkedIn Profile</a></li>
                    <li><a href="articles.html">Technical Journal</a></li>
                    <li><a href="mailto:baguspermana7@gmail.com">Direct Contact</a></li>
                    <li><a href="https://github.com/baguspermana7-cpu" target="_blank" rel="noopener">GitHub</a></li>
                </ul>
            </div>
        </div>
    </div>
</footer>

<script src="script.js"></script>
<script>
// ==================== AUTH ====================
var aifSession = JSON.parse(localStorage.getItem('rz_premium_session') || 'null');
var aifPremium = aifSession && aifSession.tier === 'pro' && new Date(aifSession.expires) > new Date();
var aifMode = 'free';
var mcChartInstance = null, tcoChartInstance = null, tornadoChartInstance = null, radarChartInstance = null;

function aifShowLogin() { document.getElementById('aifLoginOverlay').classList.add('show'); }
function aifHideLogin() { document.getElementById('aifLoginOverlay').classList.remove('show'); }

function aifHandleLogin() {
    var email = document.getElementById('aifLoginEmail').value.trim();
    var pass = document.getElementById('aifLoginPass').value;
    if (email === 'demo@resistancezero.com' && pass === 'demo2026') {
        localStorage.setItem('rz_premium_session', JSON.stringify({ email: email, tier: 'pro', expires: new Date(Date.now() + 30*86400000).toISOString() }));
        window.dispatchEvent(new CustomEvent('rz-auth-change', { detail: { email: email, tier: 'pro', action: 'login' } }));
        aifPremium = true;
        aifHideLogin();
        aifUnlockPanels();
        aifSetMode('pro');
    } else {
        var err = document.getElementById('aifLoginError');
        err.style.display = 'block';
        setTimeout(function() { err.style.display = 'none'; }, 3000);
    }
}

window.addEventListener('rz-auth-change', function() {
    aifPremium = true;
    aifUnlockPanels();
    if (aifMode === 'pro') aifUpdateProPanels();
});

function aifUnlockPanels() {
    document.querySelectorAll('.aif-pro-panel.gated').forEach(function(p) {
        p.classList.remove('gated');
        var ov = p.querySelector('.aif-gate-overlay');
        if (ov) ov.style.display = 'none';
    });
}

function aifSetMode(mode) {
    var sess = JSON.parse(localStorage.getItem('rz_premium_session') || 'null');
    aifPremium = sess && sess.tier === 'pro' && new Date(sess.expires) > new Date();
    if (mode === 'pro' && !aifPremium) { aifShowLogin(); return; }
    aifMode = mode;
    document.querySelector('.aif-btn-free').classList.toggle('active', mode === 'free');
    document.querySelector('.aif-btn-pro').classList.toggle('active', mode === 'pro');
    var pp = document.getElementById('aifProPanels');
    if (mode === 'pro') { pp.style.display = 'block'; aifUpdateProPanels(); } else { pp.style.display = 'none'; }
}

// ==================== DEFAULTS ====================
var aifDefaults = { density: 10, racks: 100, cooling: 'air', pue: 1.5, elecRate: 0.08, age: 8, floorLoad: 1000, lcInfra: 'none' };

function aifResetDefaults() {
    document.getElementById('aifDensity').value = aifDefaults.density;
    document.getElementById('aifRacks').value = aifDefaults.racks;
    document.getElementById('aifCooling').value = aifDefaults.cooling;
    document.getElementById('aifPUE').value = aifDefaults.pue;
    document.getElementById('aifElecRate').value = aifDefaults.elecRate;
    document.getElementById('aifAge').value = aifDefaults.age;
    document.getElementById('aifFloorLoad').value = aifDefaults.floorLoad;
    document.getElementById('aifLCInfra').value = aifDefaults.lcInfra;
    aifCalculate();
}

function aifGetInputs() {
    return {
        density: parseFloat(document.getElementById('aifDensity').value) || 10,
        racks: parseInt(document.getElementById('aifRacks').value) || 100,
        cooling: document.getElementById('aifCooling').value,
        pue: parseFloat(document.getElementById('aifPUE').value) || 1.5,
        elecRate: parseFloat(document.getElementById('aifElecRate').value) || 0.08,
        age: parseInt(document.getElementById('aifAge').value) || 8,
        floorLoad: parseInt(document.getElementById('aifFloorLoad').value) || 1000,
        lcInfra: document.getElementById('aifLCInfra').value
    };
}

// ==================== CORE CALC ====================
// AI Factory Infrastructure Readiness — benchmarked against AI-native requirements
// Weights: Cooling 35%, Structural 25%, Power Density 20%, PUE 10%, Age 10%
function aifComputeReadiness(inp) {
    var itLoadKW = inp.density * inp.racks;
    var itLoadMW = itLoadKW / 1000;
    var facPowerMW = itLoadMW * inp.pue;
    var annualEnergy = facPowerMW * 8760 * inp.elecRate * 1000000;

    // === 1. COOLING READINESS (35%) ===
    // Benchmark: AI racks need 40kW minimum, 130kW state-of-art (GB300 NVL72)
    var coolingMaxKW = inp.cooling === 'immersion' ? 400 : inp.cooling === 'dtc' ? 200 : 30;
    var coolScore;
    if (inp.cooling === 'air') {
        // Air cooling: hard limit ~30kW. Cannot serve AI racks above that.
        if (inp.density <= 10) coolScore = 18;
        else if (inp.density <= 20) coolScore = 14;
        else if (inp.density <= 30) coolScore = 10;
        else coolScore = 3; // physically impossible above 30kW
        // Partial/full LC infrastructure shows transition readiness
        if (inp.lcInfra === 'full') coolScore += 8;
        else if (inp.lcInfra === 'partial') coolScore += 4;
    } else if (inp.cooling === 'dtc') {
        // DTC: up to ~200kW. The 2025-2026 standard for AI deployments.
        if (inp.density <= coolingMaxKW) {
            var headroom = 1 - (inp.density / coolingMaxKW);
            coolScore = 62 + headroom * 20; // 62-82 based on headroom
        } else {
            coolScore = 30; // over-capacity
        }
        if (inp.lcInfra === 'full') coolScore = Math.min(100, coolScore + 12);
        else if (inp.lcInfra === 'partial') coolScore = Math.min(100, coolScore + 6);
        else coolScore = Math.max(0, coolScore - 18); // DTC without LC infrastructure
    } else { // immersion
        if (inp.density <= coolingMaxKW) {
            coolScore = 78 + Math.min(17, ((coolingMaxKW - inp.density) / coolingMaxKW) * 17);
        } else {
            coolScore = 40;
        }
        if (inp.lcInfra === 'full') coolScore = Math.min(100, coolScore + 8);
        else if (inp.lcInfra === 'partial') coolScore = Math.min(100, coolScore + 4);
        else coolScore = Math.max(0, coolScore - 22);
    }
    coolScore = Math.round(Math.max(0, Math.min(100, coolScore)));

    // === 2. STRUCTURAL READINESS (25%) ===
    // AI racks: 40kW class = ~1500 kg/m², 130kW class = ~2500 kg/m², 300kW+ = ~3500 kg/m²
    var structScore;
    var aiMinFloor = 1500, aiTargetFloor = 2500;
    if (inp.floorLoad >= aiTargetFloor) {
        structScore = 82 + Math.min(18, ((inp.floorLoad - aiTargetFloor) / 2500) * 18);
    } else if (inp.floorLoad >= aiMinFloor) {
        structScore = 38 + ((inp.floorLoad - aiMinFloor) / (aiTargetFloor - aiMinFloor)) * 44;
    } else if (inp.floorLoad >= 800) {
        structScore = 8 + ((inp.floorLoad - 800) / (aiMinFloor - 800)) * 30;
    } else {
        structScore = (inp.floorLoad / 800) * 8;
    }
    structScore = Math.round(Math.max(0, Math.min(100, structScore)));

    // === 3. POWER DENSITY READINESS (20%) ===
    // Below 15kW = traditional. 15-40kW = transition. 40-130kW = AI-capable. 130+ = cutting edge.
    var densityScore;
    if (inp.density >= 130) {
        densityScore = 88 + Math.min(12, (inp.density - 130) / 470 * 12);
    } else if (inp.density >= 40) {
        densityScore = 42 + ((inp.density - 40) / 90) * 46;
    } else if (inp.density >= 15) {
        densityScore = 8 + ((inp.density - 15) / 25) * 34;
    } else {
        densityScore = (inp.density / 15) * 8;
    }
    densityScore = Math.round(Math.max(0, Math.min(100, densityScore)));

    // === 4. PUE EFFICIENCY (10%) ===
    // AI-native target: PUE 1.10-1.25. Industry avg 1.58. Air-cooled legacy: 1.6-2.0
    var pueScore;
    if (inp.pue <= 1.08) pueScore = 100;
    else if (inp.pue <= 1.15) pueScore = 82 + ((1.15 - inp.pue) / 0.07) * 18;
    else if (inp.pue <= 1.30) pueScore = 55 + ((1.30 - inp.pue) / 0.15) * 27;
    else if (inp.pue <= 1.50) pueScore = 22 + ((1.50 - inp.pue) / 0.20) * 33;
    else if (inp.pue <= 1.80) pueScore = 5 + ((1.80 - inp.pue) / 0.30) * 17;
    else pueScore = Math.max(0, 5 - (inp.pue - 1.80) * 8);
    pueScore = Math.round(Math.max(0, Math.min(100, pueScore)));

    // === 5. AGE & ADAPTABILITY (10%) ===
    var ageScore;
    if (inp.age <= 1) ageScore = 95;
    else if (inp.age <= 3) ageScore = 78 + ((3 - inp.age) / 2) * 17;
    else if (inp.age <= 7) ageScore = 45 + ((7 - inp.age) / 4) * 33;
    else if (inp.age <= 15) ageScore = 12 + ((15 - inp.age) / 8) * 33;
    else if (inp.age <= 25) ageScore = ((25 - inp.age) / 10) * 12;
    else ageScore = 0;
    ageScore = Math.round(Math.max(0, Math.min(100, ageScore)));

    // === WEIGHTED COMPOSITE ===
    var overall = Math.round(coolScore * 0.35 + structScore * 0.25 + densityScore * 0.20 + pueScore * 0.10 + ageScore * 0.10);
    overall = Math.max(0, Math.min(100, overall));

    var grade = overall >= 85 ? 'A' : overall >= 70 ? 'B' : overall >= 50 ? 'C' : overall >= 30 ? 'D' : 'F';

    // OPEX estimate (annual)
    var coolMaint = itLoadMW * (inp.cooling === 'air' ? 120000 : inp.cooling === 'dtc' ? 320000 : 480000);
    var staffing = Math.max(350000, itLoadMW * 450000);
    var networkMaint = itLoadMW * 160000;
    var insurance = itLoadMW * 70000;
    var totalOPEX = annualEnergy + coolMaint + staffing + networkMaint + insurance;

    // Recommendation
    var recommend;
    if (overall >= 80) recommend = 'AI-Ready';
    else if (overall >= 62) recommend = 'Targeted Retrofit';
    else if (overall >= 42) recommend = 'Major Retrofit';
    else if (overall >= 22 && inp.age <= 15) recommend = 'Extensive Retrofit or New Build';
    else recommend = 'New Build Required';

    return {
        itLoadMW: itLoadMW, facPowerMW: facPowerMW, annualEnergy: annualEnergy,
        coolScore: coolScore, structScore: structScore, densityScore: densityScore,
        pueScore: pueScore, ageScore: ageScore, overall: overall, grade: grade,
        totalOPEX: totalOPEX, recommend: recommend
    };
}

function fmtMoney(n) {
    if (n >= 1e9) return '$' + (n/1e9).toFixed(2) + 'B';
    if (n >= 1e6) return '$' + (n/1e6).toFixed(1) + 'M';
    if (n >= 1e3) return '$' + (n/1e3).toFixed(0) + 'K';
    return '$' + n.toFixed(0);
}

function aifCalculate() {
    var inp = aifGetInputs();
    var r = aifComputeReadiness(inp);

    document.getElementById('aifResults').classList.add('show');

    document.getElementById('resITLoad').textContent = r.itLoadMW.toFixed(1) + ' MW';
    document.getElementById('resITLoadSub').textContent = (inp.density * inp.racks).toLocaleString() + ' kW total';
    document.getElementById('resFacPower').textContent = r.facPowerMW.toFixed(1) + ' MW';
    document.getElementById('resFacPowerSub').textContent = 'PUE ' + inp.pue;
    document.getElementById('resEnergyCost').textContent = fmtMoney(r.annualEnergy);
    document.getElementById('resOPEX').textContent = fmtMoney(r.totalOPEX);

    var csEl = document.getElementById('resCoolScore');
    csEl.textContent = r.coolScore + '/100';
    csEl.className = 'value ' + (r.coolScore >= 65 ? 'green' : r.coolScore >= 35 ? 'amber' : 'red');

    var ssEl = document.getElementById('resStructScore');
    ssEl.textContent = r.structScore + '/100';
    ssEl.className = 'value ' + (r.structScore >= 65 ? 'green' : r.structScore >= 35 ? 'amber' : 'red');

    var grEl = document.getElementById('resGrade');
    grEl.textContent = r.grade;
    grEl.className = 'value ' + (r.grade === 'A' || r.grade === 'B' ? 'green' : r.grade === 'C' ? 'amber' : 'red');

    document.getElementById('resRecommend').textContent = r.recommend;

    // Gauge
    var needle = document.getElementById('gaugeNeedle');
    needle.style.left = Math.max(2, Math.min(98, r.overall)) + '%';
    var verdict = document.getElementById('aifVerdict');
    verdict.textContent = r.grade === 'A' ? 'AI-Native Ready' : r.grade === 'B' ? 'Capable with Targeted Upgrades' : r.grade === 'C' ? 'Partial Readiness — Significant Investment Needed' : r.grade === 'D' ? 'Major Infrastructure Gaps' : 'Not Viable for AI Workloads';
    verdict.className = 'aif-verdict grade-' + r.grade.toLowerCase();

    if (aifPremium && aifMode === 'pro') aifUpdateProPanels();
}

// ==================== PRO PANELS ====================
function aifUpdateProPanels() {
    var inp = aifGetInputs();
    try { aifRunMonteCarlo(inp); } catch(e) { console.error('MC error:', e); }
    try { aifRunTCO(inp); } catch(e) { console.error('TCO error:', e); }
    try { aifRunTornado(inp); } catch(e) { console.error('Tornado error:', e); }
    try { aifRunStrandedAsset(inp); } catch(e) { console.error('SA error:', e); }
}

// Store last MC/TCO/Tornado/SA data for PDF export
var aifLastMC = null, aifLastTCO = null, aifLastTornado = null, aifLastSA = null;

// --- Monte Carlo ---
function aifRunMonteCarlo(inp) {
    var scores = [];
    for (var i = 0; i < 10000; i++) {
        var sim = {
            density: inp.density * (0.85 + Math.random() * 0.30),
            racks: inp.racks,
            cooling: inp.cooling,
            pue: Math.max(1.02, inp.pue * (0.92 + Math.random() * 0.16)),
            elecRate: inp.elecRate * (0.80 + Math.random() * 0.40),
            age: Math.max(0, Math.round(inp.age + (Math.random() - 0.5) * inp.age * 0.5)),
            floorLoad: Math.round(inp.floorLoad * (0.90 + Math.random() * 0.20)),
            lcInfra: inp.lcInfra
        };
        scores.push(aifComputeReadiness(sim).overall);
    }
    scores.sort(function(a,b){return a-b;});
    var mean = scores.reduce(function(s,v){return s+v;},0) / scores.length;
    var variance = scores.reduce(function(s,v){return s+(v-mean)*(v-mean);},0) / scores.length;
    var stdDev = Math.sqrt(variance);

    aifLastMC = { scores: scores, mean: mean, stdDev: stdDev, min: scores[0], max: scores[9999],
        p5: scores[499], p25: scores[2499], p50: scores[4999], p75: scores[7499], p95: scores[9499] };

    document.getElementById('mcMean').textContent = mean.toFixed(1);
    document.getElementById('mcP5').textContent = scores[499].toFixed(1);
    document.getElementById('mcP25').textContent = scores[2499].toFixed(1);
    document.getElementById('mcP50').textContent = scores[4999].toFixed(1);
    document.getElementById('mcP75').textContent = scores[7499].toFixed(1);
    document.getElementById('mcP95').textContent = scores[9499].toFixed(1);

    // Histogram via Chart.js
    var bins = new Array(20).fill(0);
    scores.forEach(function(s) { var b = Math.min(19, Math.floor(s / 5)); bins[b]++; });
    var labels = bins.map(function(_,i) { return (i*5) + '-' + (i*5+4); });

    if (mcChartInstance) mcChartInstance.destroy();
    mcChartInstance = new Chart(document.getElementById('mcChart'), {
        type: 'bar',
        data: { labels: labels, datasets: [{ label: 'Frequency', data: bins,
            backgroundColor: bins.map(function(_,i){var mid=i*5+2.5;return mid>=70?'rgba(34,197,94,0.65)':mid>=40?'rgba(251,191,36,0.65)':'rgba(239,68,68,0.65)';}),
            borderColor: bins.map(function(_,i){var mid=i*5+2.5;return mid>=70?'#22c55e':mid>=40?'#f59e0b':'#ef4444';}), borderWidth: 1 }] },
        options: { responsive: true, plugins: { legend: { display: false } }, scales: {
            x: { ticks: { color: '#94a3b8', font: { size: 8 }, maxRotation: 45 }, grid: { display: false } },
            y: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } } } }
    });
}

// --- TCO ---
function aifRunTCO(inp) {
    var itMW = inp.density * inp.racks / 1000;
    var rows = [];
    var totals = [0, 0, 0];
    var esc = 1.03; // 3% annual escalation

    for (var yr = 1; yr <= 5; yr++) {
        var e = Math.pow(esc, yr - 1);

        // Traditional (air-cooled, PUE ~1.55, limited capability)
        var tradPUE = Math.max(1.55, inp.pue);
        var tradEnergy = itMW * tradPUE * 8760 * inp.elecRate * 1e6 * e;
        var tradCapex = yr === 1 ? itMW * 6e6 : 0;
        var tradOPEX = itMW * 750000 * e;
        if (inp.density > 30) tradEnergy *= 1.25; // efficiency penalty for impossible air cooling
        var tradTotal = tradCapex + tradEnergy + tradOPEX;

        // Retrofit (DTC upgrade, PUE 1.25)
        var retroEnergy = itMW * 1.25 * 8760 * inp.elecRate * 1e6 * e;
        var retroCapex = yr === 1 ? itMW * 10e6 : yr === 2 ? itMW * 2.5e6 : 0;
        var retroOPEX = itMW * 1.1e6 * e;
        var retroTotal = retroCapex + retroEnergy + retroOPEX;

        // Greenfield AI-Native (full LC, PUE 1.12)
        var greenEnergy = itMW * 1.12 * 8760 * inp.elecRate * 1e6 * e;
        var greenCapex = yr === 1 ? itMW * 15e6 : yr === 2 ? itMW * 4e6 : 0;
        var greenOPEX = itMW * 1.3e6 * e;
        var greenTotal = greenCapex + greenEnergy + greenOPEX;

        totals[0] += tradTotal; totals[1] += retroTotal; totals[2] += greenTotal;
        rows.push([yr, tradTotal, retroTotal, greenTotal]);
    }

    aifLastTCO = { rows: rows, totals: totals };

    document.getElementById('tcoTrad').textContent = fmtMoney(totals[0]);
    document.getElementById('tcoRetro').textContent = fmtMoney(totals[1]);
    document.getElementById('tcoGreen').textContent = fmtMoney(totals[2]);
    var best = totals[0] <= totals[1] && totals[0] <= totals[2] ? 'Traditional' : totals[1] <= totals[2] ? 'Retrofit' : 'Greenfield';
    document.getElementById('tcoBest').textContent = best;

    var tbody = document.getElementById('tcoBody');
    tbody.innerHTML = '';
    rows.forEach(function(row) {
        var tr = document.createElement('tr');
        tr.innerHTML = '<td>Year ' + row[0] + '</td><td>' + fmtMoney(row[1]) + '</td><td>' + fmtMoney(row[2]) + '</td><td>' + fmtMoney(row[3]) + '</td>';
        tbody.appendChild(tr);
    });
    var trT = document.createElement('tr');
    trT.style.fontWeight = '700';
    trT.innerHTML = '<td>5-Year Total</td><td>' + fmtMoney(totals[0]) + '</td><td>' + fmtMoney(totals[1]) + '</td><td>' + fmtMoney(totals[2]) + '</td>';
    tbody.appendChild(trT);

    // Chart.js grouped bar
    if (tcoChartInstance) tcoChartInstance.destroy();
    tcoChartInstance = new Chart(document.getElementById('tcoChart'), {
        type: 'bar',
        data: {
            labels: rows.map(function(r){return 'Year '+r[0];}),
            datasets: [
                { label: 'Traditional', data: rows.map(function(r){return r[1];}), backgroundColor: 'rgba(148,163,184,0.65)', borderColor: '#94a3b8', borderWidth: 1 },
                { label: 'Retrofit', data: rows.map(function(r){return r[2];}), backgroundColor: 'rgba(59,130,246,0.65)', borderColor: '#3b82f6', borderWidth: 1 },
                { label: 'Greenfield', data: rows.map(function(r){return r[3];}), backgroundColor: 'rgba(6,182,212,0.65)', borderColor: '#06b6d4', borderWidth: 1 }
            ]
        },
        options: { responsive: true, plugins: { legend: { labels: { color: '#94a3b8', font: { size: 10 } } } }, scales: {
            x: { ticks: { color: '#94a3b8' }, grid: { display: false } },
            y: { ticks: { color: '#94a3b8', callback: function(v){return fmtMoney(v);} }, grid: { color: 'rgba(255,255,255,0.05)' } } } }
    });
}

// --- Tornado ---
function aifRunTornado(inp) {
    var base = aifComputeReadiness(inp).overall;
    var params = [
        { name: 'Rack Density', key: 'density' },
        { name: 'PUE', key: 'pue' },
        { name: 'Floor Load', key: 'floorLoad' },
        { name: 'Facility Age', key: 'age' },
        { name: 'Electricity Rate', key: 'elecRate' },
        { name: 'Number of Racks', key: 'racks' }
    ];
    var results = params.map(function(p) {
        var lo = Object.assign({}, inp); lo[p.key] = inp[p.key] * 0.8;
        var hi = Object.assign({}, inp); hi[p.key] = inp[p.key] * 1.2;
        var scoreLo = aifComputeReadiness(lo).overall;
        var scoreHi = aifComputeReadiness(hi).overall;
        return { name: p.name, low: scoreLo - base, high: scoreHi - base, scoreLo: scoreLo, scoreHi: scoreHi, base: base, range: Math.abs(scoreHi - scoreLo) };
    });
    results.sort(function(a,b){return b.range - a.range;});

    aifLastTornado = { results: results, base: base };

    if (tornadoChartInstance) tornadoChartInstance.destroy();
    tornadoChartInstance = new Chart(document.getElementById('tornadoChart'), {
        type: 'bar',
        data: {
            labels: results.map(function(r){return r.name;}),
            datasets: [
                { label: '-20%', data: results.map(function(r){return r.low;}), backgroundColor: 'rgba(239,68,68,0.6)', borderColor: '#ef4444', borderWidth: 1 },
                { label: '+20%', data: results.map(function(r){return r.high;}), backgroundColor: 'rgba(34,197,94,0.6)', borderColor: '#22c55e', borderWidth: 1 }
            ]
        },
        options: { indexAxis: 'y', responsive: true, plugins: { legend: { labels: { color: '#94a3b8', font: { size: 10 } } } }, scales: {
            x: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } },
            y: { ticks: { color: '#94a3b8', font: { size: 10 } }, grid: { display: false } } } }
    });
}

// --- Stranded Asset ---
function aifRunStrandedAsset(inp) {
    var r = aifComputeReadiness(inp);

    // Stranded probability — multi-factor model
    var baseRisk = Math.max(0, 100 - r.overall);
    var agePenalty = inp.age > 15 ? 18 : inp.age > 10 ? 12 : inp.age > 5 ? 5 : 0;
    var coolingPenalty = (inp.cooling === 'air' && inp.density > 30) ? 22 : (inp.cooling === 'air' ? 10 : 0);
    var structPenalty = inp.floorLoad < 1500 && inp.density > 40 ? 12 : 0;
    var lcPenalty = inp.lcInfra === 'none' && inp.cooling !== 'air' ? 8 : 0;
    var prob = Math.round(Math.max(0, Math.min(100, baseRisk * 0.6 + agePenalty + coolingPenalty + structPenalty + lcPenalty)));

    var itMW = inp.density * inp.racks / 1000;
    var facilityValue = itMW * (inp.cooling === 'air' ? 8e6 : inp.cooling === 'dtc' ? 12e6 : 15e6);
    var writedown = facilityValue * (prob / 100) * 0.55;
    var yearsObs = r.overall >= 80 ? '7+' : r.overall >= 65 ? '5-7' : r.overall >= 45 ? '3-5' : r.overall >= 25 ? '1-3' : '<1';
    var action = r.overall >= 80 ? 'Maintain & Monitor' : r.overall >= 62 ? 'Plan Targeted Retrofit' : r.overall >= 42 ? 'Urgent Retrofit Required' : r.overall >= 22 ? 'Major Rebuild or Divest' : 'Immediate Divestment';

    aifLastSA = { prob: prob, writedown: writedown, yearsObs: yearsObs, action: action, facilityValue: facilityValue, r: r };

    document.getElementById('saProb').textContent = prob + '%';
    document.getElementById('saProb').style.color = prob > 60 ? '#f87171' : prob > 35 ? '#fbbf24' : '#34d399';
    document.getElementById('saWritedown').textContent = fmtMoney(writedown);
    document.getElementById('saYears').textContent = yearsObs;
    document.getElementById('saAction').textContent = action;

    // Radar chart — use actual computed sub-scores
    var lcScore = inp.lcInfra === 'full' ? 92 : inp.lcInfra === 'partial' ? 52 : 10;
    var networkScore = inp.density >= 80 ? 85 : inp.density >= 40 ? 65 : inp.density >= 15 ? 40 : 20;

    if (radarChartInstance) radarChartInstance.destroy();
    radarChartInstance = new Chart(document.getElementById('radarChart'), {
        type: 'radar',
        data: {
            labels: ['Power Density', 'Cooling', 'Structure', 'PUE Efficiency', 'Age/Flexibility', 'LC Infra'],
            datasets: [{
                label: 'Your Facility',
                data: [r.densityScore, r.coolScore, r.structScore, r.pueScore, r.ageScore, lcScore],
                backgroundColor: 'rgba(59,130,246,0.2)',
                borderColor: '#3b82f6',
                borderWidth: 2,
                pointBackgroundColor: '#3b82f6'
            }, {
                label: 'AI-Native Target',
                data: [88, 85, 82, 85, 78, 92],
                backgroundColor: 'rgba(34,197,94,0.08)',
                borderColor: '#22c55e',
                borderWidth: 1.5,
                borderDash: [5, 5],
                pointBackgroundColor: '#22c55e'
            }]
        },
        options: { responsive: true, plugins: { legend: { labels: { color: '#94a3b8', font: { size: 10 } } } },
            scales: { r: { ticks: { color: '#64748b', backdropColor: 'transparent', font: { size: 9 } },
            grid: { color: 'rgba(255,255,255,0.08)' }, pointLabels: { color: '#94a3b8', font: { size: 10 } }, min: 0, max: 100 } } }
    });

    // Dynamic narrative
    var narr = aifGenerateNarrative(inp, r, prob, writedown, facilityValue, yearsObs, action);
    document.getElementById('saNarrative').innerHTML = narr;
}

// --- Narrative Generator ---
function aifGenerateNarrative(inp, r, prob, writedown, facilityValue, yearsObs, action) {
    var narr = '<h4>Executive Assessment</h4>';
    var coolingLabel = inp.cooling === 'air' ? 'air-cooled' : inp.cooling === 'dtc' ? 'direct-to-chip liquid cooled' : 'immersion cooled';
    var densityClass = inp.density >= 130 ? 'cutting-edge AI-native' : inp.density >= 40 ? 'AI-capable' : inp.density >= 15 ? 'transition-density' : 'traditional enterprise';

    // Paragraph 1: Overall assessment
    if (prob > 60) {
        narr += '<p>This ' + inp.age + '-year-old ' + coolingLabel + ' facility operating at ' + inp.density + ' kW/rack (' + densityClass + ' class) presents <strong>high stranded asset risk</strong>. With an AI readiness score of ' + r.overall + '/100 (Grade ' + r.grade + ') and ' + prob + '% estimated probability of functional obsolescence, the infrastructure cannot competitively serve GPU-dense workloads. The estimated write-down exposure is ' + fmtMoney(writedown) + ' against a facility value of ' + fmtMoney(facilityValue) + '.</p>';
    } else if (prob > 35) {
        narr += '<p>This ' + inp.age + '-year-old ' + coolingLabel + ' facility at ' + inp.density + ' kW/rack shows <strong>moderate stranded asset risk</strong>. The readiness score of ' + r.overall + '/100 (Grade ' + r.grade + ') indicates foundational capabilities requiring targeted investment. Estimated obsolescence timeline: ' + yearsObs + ' years without intervention.</p>';
    } else {
        narr += '<p>This ' + coolingLabel + ' facility at ' + inp.density + ' kW/rack demonstrates <strong>low stranded asset risk</strong> with a readiness score of ' + r.overall + '/100 (Grade ' + r.grade + '). The infrastructure supports current AI workload requirements with ' + prob + '% probability of near-term obsolescence.</p>';
    }

    // Paragraph 2: Dimensional analysis
    var weakest = [{n:'Cooling',s:r.coolScore},{n:'Structural',s:r.structScore},{n:'Density',s:r.densityScore},{n:'PUE',s:r.pueScore},{n:'Age',s:r.ageScore}];
    weakest.sort(function(a,b){return a.s-b.s;});
    var strongest = [{n:'Cooling',s:r.coolScore},{n:'Structural',s:r.structScore},{n:'Density',s:r.densityScore},{n:'PUE',s:r.pueScore},{n:'Age',s:r.ageScore}];
    strongest.sort(function(a,b){return b.s-a.s;});

    narr += '<p><strong>Key gaps:</strong> ' + weakest[0].n + ' readiness scores lowest at ' + weakest[0].s + '/100';
    if (weakest[1].s < 50) narr += ', followed by ' + weakest[1].n + ' at ' + weakest[1].s + '/100';
    narr += '. ';

    if (inp.cooling === 'air' && inp.density > 30) {
        narr += 'Air cooling cannot physically remove heat at ' + inp.density + ' kW/rack — thermal runaway risk is immediate. ';
    } else if (inp.cooling === 'air') {
        narr += 'Air cooling limits maximum rack density to approximately 30 kW, blocking any deployment of current-generation GPU accelerators (NVIDIA GB300 at 132 kW/rack). ';
    }

    if (inp.floorLoad < 1500 && inp.density >= 40) {
        narr += 'Floor load capacity of ' + inp.floorLoad + ' kg/m&sup2; is insufficient for AI-class racks weighing 1,500-3,500 kg — structural reinforcement is mandatory. ';
    }

    narr += 'Strongest dimension: ' + strongest[0].n + ' at ' + strongest[0].s + '/100.</p>';

    // Paragraph 3: Actionable recommendation
    narr += '<p><strong>Recommended action: ' + action + '.</strong> ';
    if (r.overall >= 80) {
        narr += 'Maintain current infrastructure with planned capacity expansions aligned to NVIDIA roadmap milestones (Vera Rubin 2026-2027, Rubin Ultra 2027+). Budget 15-20% of facility value annually for technology refresh to preserve competitive position.</p>';
    } else if (r.overall >= 62) {
        narr += 'Develop a phased retrofit plan targeting completion within 12-18 months. Priority investments: ' + (r.coolScore < r.structScore ? 'liquid cooling deployment (DTC recommended for brownfield)' : 'structural reinforcement and power distribution upgrade') + '. Estimated retrofit investment: ' + fmtMoney(facilityValue * 0.25) + ' to ' + fmtMoney(facilityValue * 0.40) + '.</p>';
    } else if (r.overall >= 42) {
        narr += 'Commission an engineering assessment within 60 days. The facility requires substantial upgrades across ' + weakest.filter(function(w){return w.s<50}).length + ' dimensions. If total retrofit costs exceed 55% of greenfield equivalent (' + fmtMoney(facilityValue * 0.55) + '), greenfield replacement delivers better long-term ROI.</p>';
    } else {
        narr += 'The gap between current capability and AI-native requirements is too large for economical retrofit. At current scores, investment in a purpose-built facility costing approximately ' + fmtMoney(facilityValue * 1.8) + ' to ' + fmtMoney(facilityValue * 2.5) + ' will deliver 7-10 year competitive viability versus a retrofit that risks further stranding within 2-3 years.</p>';
    }

    // Paragraph 4: Industry context
    narr += '<p><strong>Industry benchmark:</strong> As of 2026, hyperscaler AI facilities target 100-140 kW/rack density with DTC cooling at PUE 1.10-1.20. Combined hyperscaler CAPEX exceeds $600B annually. Facilities unable to support 40+ kW racks with liquid cooling face accelerating revenue displacement as AI workloads shift to purpose-built infrastructure. The NVIDIA GB300 NVL72 at 132 kW/rack represents the current deployment standard; Vera Rubin and Rubin Ultra will push toward 600 kW/rack within 18-24 months.</p>';

    return narr;
}

// ==================== INPUT LISTENERS ====================
document.querySelectorAll('.aif-calculator input, .aif-calculator select').forEach(function(el) {
    el.addEventListener('input', function() { if (aifPremium && aifMode === 'pro') { aifCalculate(); } });
    el.addEventListener('change', function() { if (aifPremium && aifMode === 'pro') { aifCalculate(); } });
});

// ==================== PDF EXPORT ====================
function aifExportPDF() {
    var w = window.open('', '_blank');
    if (!w) { alert('Please allow popups for PDF export.'); return; }

    var inp = aifGetInputs();
    var r = aifComputeReadiness(inp);
    var isPro = aifPremium && aifMode === 'pro';
    var now = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });

    // Run fresh calculations for PDF
    var mc = null, tcoData = null, tornadoData = null, saData = null;
    if (isPro) {
        mc = aifLastMC; tcoData = aifLastTCO; tornadoData = aifLastTornado; saData = aifLastSA;
    }

    var html = '<!DOCTYPE html><html><head><meta charset="UTF-8"><title>AI Factory Readiness Report</title>';
    html += '<style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:Inter,-apple-system,sans-serif;color:#1f2937;padding:30px;max-width:900px;margin:0 auto;font-size:11px;line-height:1.6}';
    html += 'h1{font-size:22px;color:#1e3a5f;margin-bottom:4px}h2{font-size:14px;color:#1e3a5f;border-bottom:2px solid #3b82f6;padding-bottom:4px;margin:20px 0 10px}';
    html += 'table{width:100%;border-collapse:collapse;margin:8px 0}th{background:#f8fafc;font-size:10px;text-transform:uppercase;color:#64748b;padding:8px;text-align:left;border:1px solid #e5e7eb}';
    html += 'td{padding:8px;border:1px solid #e5e7eb;font-size:11px}.badge{display:inline-block;padding:2px 10px;border-radius:50px;font-weight:700;font-size:10px}';
    html += '.score-big{font-size:48px;font-weight:800;text-align:center;margin:15px 0}.kpi-row{display:flex;gap:12px;margin:10px 0}';
    html += '.kpi-box{flex:1;background:#f8fafc;border:1px solid #e5e7eb;border-radius:8px;padding:12px;text-align:center}.kpi-label{font-size:9px;color:#64748b;text-transform:uppercase}.kpi-val{font-size:16px;font-weight:700;color:#1e3a5f}';
    html += '.narr{background:#f8fafc;border-left:3px solid #3b82f6;padding:12px;margin:10px 0;font-size:10px;line-height:1.6}.narr h4{font-size:12px;color:#1e3a5f;margin-bottom:6px}';
    html += '.narr p{margin-bottom:8px}.narr strong{color:#1e40af}';
    html += '.chart-row{display:flex;gap:16px;margin:12px 0}.chart-row>div{flex:1;min-width:0}';
    html += '@media print{@page{margin:15mm}body{-webkit-print-color-adjust:exact;print-color-adjust:exact}}</style></head><body>';

    // Header
    html += '<div style="display:flex;justify-content:space-between;align-items:center;border-bottom:2px solid #3b82f6;padding-bottom:10px;margin-bottom:15px">';
    html += '<div><h1>AI Factory Infrastructure Readiness Report</h1><div style="color:#64748b;font-size:10px">Generated ' + now + ' | ' + (isPro ? 'Pro Intelligence Report' : 'Free Assessment') + '</div></div>';
    html += '<div style="text-align:right"><div style="font-weight:800;color:#3b82f6;font-size:14px">ResistanceZero</div><div style="font-size:9px;color:#94a3b8">resistancezero.com</div></div></div>';

    // Grade
    var gradeColor = r.grade === 'A' ? '#059669' : r.grade === 'B' ? '#10b981' : r.grade === 'C' ? '#d97706' : '#dc2626';
    html += '<div style="text-align:center;padding:15px;background:#f8fafc;border-radius:10px;margin:10px 0">';
    html += '<div style="font-size:11px;color:#64748b;text-transform:uppercase">AI Infrastructure Readiness</div>';
    html += '<div class="score-big" style="color:' + gradeColor + '">Grade ' + r.grade + '</div>';
    html += '<div style="font-size:14px;color:#64748b">Overall Score: ' + r.overall + '/100</div>';
    html += '<div style="margin-top:6px"><span class="badge" style="background:' + (r.overall >= 70 ? '#ecfdf5;color:#059669' : r.overall >= 40 ? '#fffbeb;color:#d97706' : '#fef2f2;color:#dc2626') + '">' + r.recommend + '</span></div></div>';

    // KPI row
    html += '<div class="kpi-row">';
    html += '<div class="kpi-box"><div class="kpi-label">IT Load</div><div class="kpi-val">' + r.itLoadMW.toFixed(1) + ' MW</div></div>';
    html += '<div class="kpi-box"><div class="kpi-label">Facility Power</div><div class="kpi-val">' + r.facPowerMW.toFixed(1) + ' MW</div></div>';
    html += '<div class="kpi-box"><div class="kpi-label">Annual Energy</div><div class="kpi-val">' + fmtMoney(r.annualEnergy) + '</div></div>';
    html += '<div class="kpi-box"><div class="kpi-label">Annual OPEX</div><div class="kpi-val">' + fmtMoney(r.totalOPEX) + '</div></div>';
    html += '</div>';

    // Sub-score breakdown
    html += '<div class="kpi-row">';
    html += '<div class="kpi-box"><div class="kpi-label">Cooling</div><div class="kpi-val" style="color:' + (r.coolScore >= 65 ? '#059669' : r.coolScore >= 35 ? '#d97706' : '#dc2626') + '">' + r.coolScore + '/100</div></div>';
    html += '<div class="kpi-box"><div class="kpi-label">Structure</div><div class="kpi-val" style="color:' + (r.structScore >= 65 ? '#059669' : r.structScore >= 35 ? '#d97706' : '#dc2626') + '">' + r.structScore + '/100</div></div>';
    html += '<div class="kpi-box"><div class="kpi-label">Density</div><div class="kpi-val" style="color:' + (r.densityScore >= 65 ? '#059669' : r.densityScore >= 35 ? '#d97706' : '#dc2626') + '">' + r.densityScore + '/100</div></div>';
    html += '<div class="kpi-box"><div class="kpi-label">PUE</div><div class="kpi-val" style="color:' + (r.pueScore >= 65 ? '#059669' : r.pueScore >= 35 ? '#d97706' : '#dc2626') + '">' + r.pueScore + '/100</div></div>';
    html += '<div class="kpi-box"><div class="kpi-label">Age</div><div class="kpi-val" style="color:' + (r.ageScore >= 65 ? '#059669' : r.ageScore >= 35 ? '#d97706' : '#dc2626') + '">' + r.ageScore + '/100</div></div>';
    html += '</div>';

    // Input params
    html += '<h2>Input Parameters</h2><table><tr><th>Parameter</th><th>Value</th><th>Parameter</th><th>Value</th></tr>';
    html += '<tr><td>Rack Density</td><td>' + inp.density + ' kW</td><td>Cooling Type</td><td>' + (inp.cooling === 'dtc' ? 'Direct-to-Chip' : inp.cooling === 'immersion' ? 'Immersion' : 'Air') + '</td></tr>';
    html += '<tr><td>Number of Racks</td><td>' + inp.racks + '</td><td>PUE</td><td>' + inp.pue + '</td></tr>';
    html += '<tr><td>Electricity Rate</td><td>$' + inp.elecRate + '/kWh</td><td>Facility Age</td><td>' + inp.age + ' years</td></tr>';
    html += '<tr><td>Floor Load</td><td>' + inp.floorLoad + ' kg/m&sup2;</td><td>LC Infrastructure</td><td>' + (inp.lcInfra === 'full' ? 'Full' : inp.lcInfra === 'partial' ? 'Partial' : 'None') + '</td></tr></table>';

    // Results table
    html += '<h2>Assessment Results</h2><table><tr><th>Metric</th><th>Value</th><th>Assessment</th></tr>';
    html += '<tr><td>Total IT Load</td><td><strong>' + r.itLoadMW.toFixed(1) + ' MW</strong></td><td>' + (r.itLoadMW >= 10 ? 'Hyperscale class' : r.itLoadMW >= 1 ? 'Enterprise class' : 'Small deployment') + '</td></tr>';
    html += '<tr><td>Total Facility Power</td><td>' + r.facPowerMW.toFixed(1) + ' MW</td><td>PUE overhead: ' + ((r.facPowerMW/r.itLoadMW - 1) * 100).toFixed(0) + '%</td></tr>';
    html += '<tr><td>Annual Energy Cost</td><td>' + fmtMoney(r.annualEnergy) + '</td><td>' + fmtMoney(r.annualEnergy / 12) + '/month</td></tr>';
    html += '<tr><td>Estimated Annual OPEX</td><td>' + fmtMoney(r.totalOPEX) + '</td><td>Energy + cooling + staff + network</td></tr>';
    html += '<tr><td>AI Readiness Grade</td><td style="font-weight:700;color:' + gradeColor + '">Grade ' + r.grade + ' (' + r.overall + '/100)</td><td>' + r.recommend + '</td></tr></table>';

    // === PRO SECTIONS WITH SVG CHARTS ===
    if (isPro) {
        // Executive Assessment narrative
        html += '<h2>Executive Assessment</h2>';
        html += '<div class="narr">' + (document.getElementById('saNarrative').innerHTML || '') + '</div>';

        // Monte Carlo SVG Histogram + percentile table
        if (mc && mc.scores) {
            html += '<h2>Monte Carlo Simulation (10,000 Iterations)</h2><div class="chart-row">';
            var bins = 25, bMin = mc.min, bMax = mc.max, bRange = bMax - bMin || 1;
            var binW = bRange / bins, counts = new Array(bins).fill(0), maxCt = 0;
            mc.scores.forEach(function(v) { var bi = Math.min(bins - 1, Math.floor((v - bMin) / binW)); counts[bi]++; if (counts[bi] > maxCt) maxCt = counts[bi]; });
            var svgW = 400, svgH = 200, pad = {t: 18, r: 15, b: 35, l: 42}, cW = svgW - pad.l - pad.r, cH = svgH - pad.t - pad.b;

            html += '<div><svg viewBox="0 0 ' + svgW + ' ' + svgH + '" xmlns="http://www.w3.org/2000/svg" style="width:100%;height:auto;background:#fff">';
            // Grid lines
            for (var g = 0; g <= 4; g++) { var gy = pad.t + cH - cH * (g / 4); html += '<line x1="' + pad.l + '" y1="' + gy + '" x2="' + (svgW - pad.r) + '" y2="' + gy + '" stroke="#e5e7eb" stroke-width="0.5"/>'; html += '<text x="' + (pad.l - 4) + '" y="' + (gy + 3) + '" text-anchor="end" font-size="8" fill="#94a3b8">' + Math.round(maxCt * g / 4) + '</text>'; }
            // Bars
            var barW = cW / bins;
            for (var i = 0; i < bins; i++) {
                var bx = pad.l + i * barW, bh = (counts[i] / maxCt) * cH, by = pad.t + cH - bh;
                var midVal = bMin + (i + 0.5) * binW;
                var bCol = midVal >= 70 ? '#059669' : midVal >= 40 ? '#f59e0b' : '#ef4444';
                html += '<rect x="' + bx + '" y="' + by + '" width="' + (barW - 1) + '" height="' + bh + '" fill="' + bCol + '" rx="1"/>';
                if (i % 5 === 0) html += '<text x="' + (bx + barW / 2) + '" y="' + (svgH - pad.b + 12) + '" text-anchor="middle" font-size="7" fill="#6b7280">' + Math.round(bMin + i * binW) + '</text>';
            }
            // P5/P50/P95 lines
            var pLines = [{v: mc.p5, l: 'P5', c: '#ef4444'}, {v: mc.p50, l: 'P50', c: '#3b82f6'}, {v: mc.p95, l: 'P95', c: '#059669'}];
            pLines.forEach(function(pl) {
                var px = pad.l + ((pl.v - bMin) / bRange) * cW;
                if (px >= pad.l && px <= svgW - pad.r) {
                    html += '<line x1="' + px + '" y1="' + pad.t + '" x2="' + px + '" y2="' + (pad.t + cH) + '" stroke="' + pl.c + '" stroke-width="1.5" stroke-dasharray="4,3"/>';
                    html += '<text x="' + px + '" y="' + (pad.t - 4) + '" text-anchor="middle" font-size="8" font-weight="700" fill="' + pl.c + '">' + pl.l + ': ' + pl.v.toFixed(1) + '</text>';
                }
            });
            html += '<text x="' + (svgW / 2) + '" y="' + (svgH - 2) + '" text-anchor="middle" font-size="8" fill="#6b7280">AI Readiness Score Distribution</text>';
            html += '</svg></div>';

            // Percentile table
            html += '<div><table style="margin-top:0"><tr><th>Percentile</th><th>Score</th><th>Assessment</th></tr>';
            html += '<tr><td style="color:#ef4444;font-weight:600">P5 (Worst Case)</td><td>' + mc.p5.toFixed(1) + '</td><td>' + (mc.p5 >= 50 ? 'Viable' : 'At risk') + '</td></tr>';
            html += '<tr><td>P25</td><td>' + mc.p25.toFixed(1) + '</td><td>' + (mc.p25 >= 50 ? 'Adequate' : 'Below threshold') + '</td></tr>';
            html += '<tr><td style="color:#3b82f6;font-weight:600">P50 (Median)</td><td><strong>' + mc.p50.toFixed(1) + '</strong></td><td>Most likely outcome</td></tr>';
            html += '<tr><td>P75</td><td>' + mc.p75.toFixed(1) + '</td><td>Upside scenario</td></tr>';
            html += '<tr><td style="color:#059669;font-weight:600">P95 (Best Case)</td><td>' + mc.p95.toFixed(1) + '</td><td>Optimistic bound</td></tr>';
            html += '<tr style="background:#f0f9ff"><td>Mean &plusmn; StdDev</td><td>' + mc.mean.toFixed(1) + '</td><td>&sigma; = ' + mc.stdDev.toFixed(1) + ' points</td></tr></table></div></div>';
        }

        // TCO comparison: SVG stacked bar + table
        if (tcoData && tcoData.rows) {
            html += '<h2>5-Year TCO Comparison</h2><div class="chart-row">';
            var tRows = tcoData.rows, tTotals = tcoData.totals;
            var maxTCO = 0; tRows.forEach(function(row) { maxTCO = Math.max(maxTCO, row[1], row[2], row[3]); });

            var tW = 400, tH = 200, tPad = {t: 15, r: 15, b: 30, l: 50}, tCW = tW - tPad.l - tPad.r, tCH = tH - tPad.t - tPad.b;
            html += '<div><svg viewBox="0 0 ' + tW + ' ' + tH + '" xmlns="http://www.w3.org/2000/svg" style="width:100%;height:auto;background:#fff">';
            // Grid
            for (var g = 0; g <= 4; g++) { var gy = tPad.t + tCH - tCH * (g / 4); html += '<line x1="' + tPad.l + '" y1="' + gy + '" x2="' + (tW - tPad.r) + '" y2="' + gy + '" stroke="#e5e7eb" stroke-width="0.5"/>'; html += '<text x="' + (tPad.l - 4) + '" y="' + (gy + 3) + '" text-anchor="end" font-size="7" fill="#94a3b8">' + fmtMoney(maxTCO * g / 4) + '</text>'; }
            // Bars — grouped by year
            var groupW = tCW / 5, barPad = 6, singleBarW = (groupW - barPad * 2) / 3;
            var colors = ['#94a3b8', '#3b82f6', '#06b6d4'];
            tRows.forEach(function(row, yi) {
                for (var bi = 0; bi < 3; bi++) {
                    var bx = tPad.l + yi * groupW + barPad + bi * singleBarW;
                    var bh = (row[bi + 1] / maxTCO) * tCH;
                    var by = tPad.t + tCH - bh;
                    html += '<rect x="' + bx + '" y="' + by + '" width="' + (singleBarW - 1) + '" height="' + bh + '" fill="' + colors[bi] + '" rx="1"/>';
                }
                html += '<text x="' + (tPad.l + yi * groupW + groupW / 2) + '" y="' + (tH - tPad.b + 12) + '" text-anchor="middle" font-size="8" fill="#6b7280">Y' + row[0] + '</text>';
            });
            // Legend
            html += '<rect x="' + (tPad.l + 5) + '" y="' + (tPad.t + 2) + '" width="8" height="8" fill="#94a3b8" rx="1"/><text x="' + (tPad.l + 16) + '" y="' + (tPad.t + 9) + '" font-size="7" fill="#64748b">Traditional</text>';
            html += '<rect x="' + (tPad.l + 75) + '" y="' + (tPad.t + 2) + '" width="8" height="8" fill="#3b82f6" rx="1"/><text x="' + (tPad.l + 86) + '" y="' + (tPad.t + 9) + '" font-size="7" fill="#64748b">Retrofit</text>';
            html += '<rect x="' + (tPad.l + 135) + '" y="' + (tPad.t + 2) + '" width="8" height="8" fill="#06b6d4" rx="1"/><text x="' + (tPad.l + 146) + '" y="' + (tPad.t + 9) + '" font-size="7" fill="#64748b">Greenfield</text>';
            html += '</svg></div>';

            // TCO table
            html += '<div><table style="margin-top:0"><tr><th>Year</th><th>Traditional</th><th>Retrofit</th><th>Greenfield</th></tr>';
            tRows.forEach(function(row) { html += '<tr><td>Year ' + row[0] + '</td><td>' + fmtMoney(row[1]) + '</td><td>' + fmtMoney(row[2]) + '</td><td>' + fmtMoney(row[3]) + '</td></tr>'; });
            html += '<tr style="background:#f0f9ff;font-weight:700"><td>5-Yr Total</td><td>' + fmtMoney(tTotals[0]) + '</td><td>' + fmtMoney(tTotals[1]) + '</td><td>' + fmtMoney(tTotals[2]) + '</td></tr></table></div></div>';
        }

        // Sensitivity Tornado: SVG + table
        if (tornadoData && tornadoData.results) {
            html += '<h2>Sensitivity Analysis</h2><div class="chart-row">';
            var top6 = tornadoData.results.slice(0, 6), baseScore = tornadoData.base;
            var tW = 400, tH = 28 * top6.length + 50, tPad = {t: 22, r: 40, b: 15, l: 120}, tCW = tW - tPad.l - tPad.r;
            var maxRange = 0; top6.forEach(function(s) { var absMax = Math.max(Math.abs(s.low), Math.abs(s.high)); if (absMax > maxRange) maxRange = absMax; });
            maxRange = maxRange || 1;

            html += '<div><svg viewBox="0 0 ' + tW + ' ' + tH + '" xmlns="http://www.w3.org/2000/svg" style="width:100%;height:auto;background:#fff">';
            var baseLine = tPad.l + tCW / 2;
            html += '<line x1="' + baseLine + '" y1="' + tPad.t + '" x2="' + baseLine + '" y2="' + (tH - tPad.b) + '" stroke="#1e3a5f" stroke-width="1.5" stroke-dasharray="4,3"/>';
            html += '<text x="' + baseLine + '" y="' + (tPad.t - 6) + '" text-anchor="middle" font-size="8" font-weight="700" fill="#1e3a5f">Base: ' + baseScore + '</text>';
            top6.forEach(function(s, i) {
                var y = tPad.t + i * 28 + 4, bH = 22;
                var loX = baseLine + (s.low / maxRange) * (tCW / 2);
                var hiX = baseLine + (s.high / maxRange) * (tCW / 2);
                html += '<rect x="' + Math.min(loX, baseLine) + '" y="' + y + '" width="' + Math.abs(loX - baseLine) + '" height="' + bH + '" fill="#fca5a5" rx="2"/>';
                html += '<rect x="' + Math.min(hiX, baseLine) + '" y="' + y + '" width="' + Math.abs(hiX - baseLine) + '" height="' + bH + '" fill="#86efac" rx="2"/>';
                html += '<text x="' + (tPad.l - 4) + '" y="' + (y + bH / 2 + 4) + '" text-anchor="end" font-size="8" fill="#374151">' + s.name + '</text>';
            });
            html += '</svg></div>';

            // Data table
            html += '<div><table style="margin-top:0"><tr><th>Parameter</th><th>-20%</th><th>Base</th><th>+20%</th><th>Range</th></tr>';
            top6.forEach(function(s) { html += '<tr><td>' + s.name + '</td><td style="color:#dc2626">' + s.scoreLo + '</td><td>' + s.base + '</td><td style="color:#059669">' + s.scoreHi + '</td><td><strong>' + s.range + '</strong></td></tr>'; });
            html += '</table></div></div>';
        }

        // Stranded Asset SVG Radar + summary
        if (saData) {
            html += '<h2>Stranded Asset Risk Assessment</h2>';
            html += '<div class="kpi-row">';
            html += '<div class="kpi-box"><div class="kpi-label">Risk Probability</div><div class="kpi-val" style="color:' + (saData.prob > 60 ? '#dc2626' : saData.prob > 35 ? '#d97706' : '#059669') + '">' + saData.prob + '%</div></div>';
            html += '<div class="kpi-box"><div class="kpi-label">Est. Write-down</div><div class="kpi-val">' + fmtMoney(saData.writedown) + '</div></div>';
            html += '<div class="kpi-box"><div class="kpi-label">Years to Obsolescence</div><div class="kpi-val">' + saData.yearsObs + '</div></div>';
            html += '<div class="kpi-box"><div class="kpi-label">Action</div><div class="kpi-val" style="font-size:11px">' + saData.action + '</div></div></div>';

            // SVG Radar chart
            var dims = [
                {n: 'Density', v: r.densityScore, t: 88},
                {n: 'Cooling', v: r.coolScore, t: 85},
                {n: 'Structure', v: r.structScore, t: 82},
                {n: 'PUE', v: r.pueScore, t: 85},
                {n: 'Age', v: r.ageScore, t: 78},
                {n: 'LC Infra', v: inp.lcInfra === 'full' ? 92 : inp.lcInfra === 'partial' ? 52 : 10, t: 92}
            ];
            var rW = 300, rH = 280, cx = rW / 2, cy = rH / 2 + 5, maxR = 105;
            html += '<div style="text-align:center;margin:10px 0"><svg viewBox="0 0 ' + rW + ' ' + rH + '" xmlns="http://www.w3.org/2000/svg" style="width:300px;height:auto;background:#fff">';
            // Grid rings
            [20, 40, 60, 80, 100].forEach(function(ring) {
                var pts = [];
                for (var d = 0; d < 6; d++) { var a = (d * 60 - 90) * Math.PI / 180; pts.push((cx + maxR * (ring / 100) * Math.cos(a)).toFixed(1) + ',' + (cy + maxR * (ring / 100) * Math.sin(a)).toFixed(1)); }
                html += '<polygon points="' + pts.join(' ') + '" fill="none" stroke="#e5e7eb" stroke-width="0.5"/>';
                if (ring % 40 === 0) html += '<text x="' + (cx + 3) + '" y="' + (cy - maxR * ring / 100 + 3) + '" font-size="7" fill="#94a3b8">' + ring + '</text>';
            });
            // Axis lines + labels
            dims.forEach(function(dim, d) {
                var a = (d * 60 - 90) * Math.PI / 180;
                var lx = cx + (maxR + 18) * Math.cos(a), ly = cy + (maxR + 18) * Math.sin(a);
                html += '<line x1="' + cx + '" y1="' + cy + '" x2="' + (cx + maxR * Math.cos(a)).toFixed(1) + '" y2="' + (cy + maxR * Math.sin(a)).toFixed(1) + '" stroke="#e5e7eb" stroke-width="0.5"/>';
                html += '<text x="' + lx.toFixed(1) + '" y="' + ly.toFixed(1) + '" text-anchor="middle" font-size="7" fill="#374151">' + dim.n + '</text>';
            });
            // Target polygon (dashed green)
            var tPts = []; dims.forEach(function(dim, d) { var a = (d * 60 - 90) * Math.PI / 180; tPts.push((cx + maxR * (dim.t / 100) * Math.cos(a)).toFixed(1) + ',' + (cy + maxR * (dim.t / 100) * Math.sin(a)).toFixed(1)); });
            html += '<polygon points="' + tPts.join(' ') + '" fill="rgba(34,197,94,0.08)" stroke="#22c55e" stroke-width="1" stroke-dasharray="4,3"/>';
            // Facility polygon (blue)
            var fPts = []; dims.forEach(function(dim, d) { var a = (d * 60 - 90) * Math.PI / 180; fPts.push((cx + maxR * (dim.v / 100) * Math.cos(a)).toFixed(1) + ',' + (cy + maxR * (dim.v / 100) * Math.sin(a)).toFixed(1)); });
            html += '<polygon points="' + fPts.join(' ') + '" fill="rgba(59,130,246,0.15)" stroke="#3b82f6" stroke-width="2"/>';
            dims.forEach(function(dim, d) { var a = (d * 60 - 90) * Math.PI / 180; html += '<circle cx="' + (cx + maxR * (dim.v / 100) * Math.cos(a)).toFixed(1) + '" cy="' + (cy + maxR * (dim.v / 100) * Math.sin(a)).toFixed(1) + '" r="3" fill="#3b82f6"/>'; });
            // Legend
            html += '<rect x="10" y="' + (rH - 18) + '" width="10" height="10" fill="rgba(59,130,246,0.3)" stroke="#3b82f6" stroke-width="1"/><text x="24" y="' + (rH - 10) + '" font-size="7" fill="#374151">Your Facility</text>';
            html += '<rect x="100" y="' + (rH - 18) + '" width="10" height="10" fill="rgba(34,197,94,0.1)" stroke="#22c55e" stroke-width="1" stroke-dasharray="2,1"/><text x="114" y="' + (rH - 10) + '" font-size="7" fill="#374151">AI-Native Target</text>';
            html += '</svg></div>';
        }
    }

    // Methodology
    html += '<h2>Methodology</h2><div style="font-size:9px;color:#64748b;line-height:1.5">';
    html += 'Weighted scoring: Cooling Readiness (35%), Structural Readiness (25%), Power Density (20%), PUE Efficiency (10%), Age/Adaptability (10%). ';
    html += 'Cooling scores benchmark against AI-native requirements: air cooling caps at ~30 kW/rack, DTC supports up to 200 kW, immersion up to 400 kW. ';
    html += 'Structural scores measure floor load against AI-rack weights (1,500-3,500 kg/m&sup2;). Power density scores evaluate proximity to the 40-130 kW AI-capable range. ';
    html += 'Monte Carlo: 10,000 iterations varying density (&plusmn;15%), PUE (&plusmn;8%), electricity (&plusmn;20%), age (&plusmn;25%), floor load (&plusmn;10%). ';
    html += 'TCO uses 3% annual cost escalation. All calculations client-side; no data transmitted.</div>';

    html += '<div style="text-align:center;margin-top:20px;padding-top:10px;border-top:1px solid #e5e7eb;font-size:8px;color:#94a3b8">';
    html += 'Generated by ResistanceZero AI Factory Readiness Calculator | resistancezero.com | &copy; 2026 Bagus Dwi Permana</div>';
    html += '
<!-- ═══ Feature 22: Reading Progress Bar ═══ -->
<script>
(function() {
    var bar = document.getElementById('scrollProgress');
    if (!bar) return;
    var ticking = false;
    function updateProgress() {
        var scrollTop = window.scrollY || document.documentElement.scrollTop;
        var docHeight = document.documentElement.scrollHeight - window.innerHeight;
        var pct = docHeight > 0 ? (scrollTop / docHeight) * 100 : 0;
        bar.style.width = Math.min(pct, 100) + '%';
        ticking = false;
    }
    window.addEventListener('scroll', function() {
        if (!ticking) { requestAnimationFrame(updateProgress); ticking = true; }
    }, { passive: true });
    updateProgress();
})();
</script>

<!-- ═══ Feature 23: TOC Sidebar ═══ -->
<script>
(function() {
    // Find H2s with IDs first, then fallback to auto-generating IDs
    var sections = document.querySelectorAll('.article-body h2[id], .article-content h2[id]');
    if (!sections.length) {
        var allH2s = document.querySelectorAll('.article-body h2, .article-content h2');
        allH2s.forEach(function(h2, i) {
            if (!h2.id) h2.id = 'toc-section-' + (i + 1);
        });
        sections = document.querySelectorAll('.article-body h2[id], .article-content h2[id]');
    }
    if (!sections.length) return;

    var sidebarList = document.getElementById('tocSidebarList');
    var mobileList = document.getElementById('tocMobileList');
    var sidebar = document.getElementById('tocSidebar');
    var tocToggle = document.getElementById('tocMobileToggle');
    var tocDrawer = document.getElementById('tocMobileDrawer');
    var tocBackdrop = document.getElementById('tocMobileBackdrop');
    var tocClose = document.getElementById('tocDrawerClose');

    var tocData = [];
    sections.forEach(function(h2, i) {
        var id = h2.getAttribute('id');
        var numMatch = id.match(/\d+/);
        var num = numMatch ? numMatch[0] : String(i + 1);
        var text = h2.textContent.replace(/^\s*\d+[\.\s]*/, '').trim();
        tocData.push({ id: id, num: num, text: text });
    });

    function buildList(container, isMobile) {
        tocData.forEach(function(item) {
            var li = document.createElement('li');
            if (!isMobile) li.className = 'toc-sidebar-item';
            var a = document.createElement('a');
            a.href = '#' + item.id;
            a.setAttribute('data-section', item.id);
            if (isMobile) {
                a.textContent = item.num + '. ' + item.text;
            } else {
                a.className = 'toc-sidebar-link';
                a.innerHTML = '<span class="toc-sidebar-num">' + item.num + '</span>' + item.text;
            }
            a.addEventListener('click', function(e) {
                e.preventDefault();
                var target = document.getElementById(item.id);
                if (target) window.scrollTo({ top: target.offsetTop - 80, behavior: 'smooth' });
                if (isMobile) closeMobileDrawer();
            });
            li.appendChild(a);
            container.appendChild(li);
        });
    }

    buildList(sidebarList, false);
    buildList(mobileList, true);

    var currentSection = null;
    var observer = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry) {
            if (entry.isIntersecting) {
                currentSection = entry.target.getAttribute('id');
                highlightActive(currentSection);
            }
        });
    }, { rootMargin: '-80px 0px -70% 0px', threshold: 0 });

    sections.forEach(function(s) { observer.observe(s); });

    function highlightActive(sectionId) {
        sidebarList.querySelectorAll('.toc-sidebar-link').forEach(function(a) {
            a.classList.toggle('active', a.getAttribute('data-section') === sectionId);
        });
        mobileList.querySelectorAll('a').forEach(function(a) {
            a.classList.toggle('active', a.getAttribute('data-section') === sectionId);
        });
    }

    var articleContent = document.querySelector('.article-content');
    if (articleContent && sidebar) {
        var sidebarObserver = new IntersectionObserver(function(entries) {
            entries.forEach(function(entry) {
                sidebar.classList.toggle('visible', entry.isIntersecting);
            });
        }, { rootMargin: '0px', threshold: 0.01 });
        sidebarObserver.observe(articleContent);
    }

    function openMobileDrawer() {
        tocDrawer.classList.add('active');
        tocBackdrop.classList.add('active');
        document.body.style.overflow = 'hidden';
    }
    function closeMobileDrawer() {
        tocDrawer.classList.remove('active');
        tocBackdrop.classList.remove('active');
        document.body.style.overflow = '';
    }

    if (tocToggle) tocToggle.addEventListener('click', openMobileDrawer);
    if (tocClose) tocClose.addEventListener('click', closeMobileDrawer);
    if (tocBackdrop) tocBackdrop.addEventListener('click', closeMobileDrawer);
})();
</script>

<!-- ═══ Feature 21: Global Search ═══ -->
<script>
(function() {
    var searchBtn = document.getElementById('navSearchBtn');
    var overlay = document.getElementById('searchOverlay');
    var modal = document.getElementById('searchModal');
    var input = document.getElementById('searchInput');
    var resultsEl = document.getElementById('searchResults');
    var fuse = null;
    var searchData = null;
    var focusedIdx = -1;

    function openSearch() {
        overlay.classList.add('active');
        modal.classList.add('active');
        input.value = '';
        input.focus();
        focusedIdx = -1;
        resultsEl.innerHTML = '<div class="search-empty">Type to search across all content</div>';
        if (!searchData) {
            fetch('search-index.json')
                .then(function(r) { return r.json(); })
                .then(function(data) {
                    searchData = data;
                    fuse = new Fuse(data, {
                        keys: [
                            { name: 'title', weight: 0.4 },
                            { name: 'description', weight: 0.25 },
                            { name: 'keywords', weight: 0.25 },
                            { name: 'category', weight: 0.1 }
                        ],
                        threshold: 0.35,
                        includeScore: true,
                        minMatchCharLength: 2
                    });
                })
                .catch(function() {});
        }
    }

    function closeSearch() {
        overlay.classList.remove('active');
        modal.classList.remove('active');
        input.blur();
    }

    function getIconClass(cat) {
        cat = (cat || '').toLowerCase();
        if (cat === 'calculator') return 'calc';
        if (cat === 'tool') return 'tool';
        return '';
    }

    function getIconLabel(item) {
        if (item.url && item.url.indexOf('article-') === 0) {
            return item.url.replace('article-', '').replace('.html', '').padStart(2, '0');
        }
        var cat = (item.category || '').toLowerCase();
        if (cat === 'calculator') return '&#9889;';
        if (cat === 'tool') return '&#9881;';
        return '&#9733;';
    }

    function renderResults(results) {
        if (!results.length) {
            resultsEl.innerHTML = '<div class="search-empty">No results found</div>';
            focusedIdx = -1;
            return;
        }
        var html = '';
        results.slice(0, 8).forEach(function(r, i) {
            var item = r.item;
            var iconCls = getIconClass(item.category);
            html += '<a href="' + item.url + '" class="search-result-item" data-idx="' + i + '">'
                + '<div class="search-result-icon ' + iconCls + '">' + getIconLabel(item) + '</div>'
                + '<div class="search-result-info">'
                + '<div class="search-result-category">' + (item.category || '') + '</div>'
                + '<div class="search-result-title">' + item.title + '</div>'
                + '<div class="search-result-desc">' + item.description + '</div>'
                + '</div></a>';
        });
        resultsEl.innerHTML = html;
        focusedIdx = -1;
    }

    function updateFocus() {
        var items = resultsEl.querySelectorAll('.search-result-item');
        items.forEach(function(el, i) {
            el.classList.toggle('focused', i === focusedIdx);
            if (i === focusedIdx) el.scrollIntoView({ block: 'nearest' });
        });
    }

    if (searchBtn) searchBtn.addEventListener('click', openSearch);
    if (overlay) overlay.addEventListener('click', closeSearch);

    document.addEventListener('keydown', function(e) {
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
            e.preventDefault();
            if (modal.classList.contains('active')) closeSearch();
            else openSearch();
            return;
        }
        if (!modal.classList.contains('active')) return;
        if (e.key === 'Escape') { closeSearch(); return; }
        var items = resultsEl.querySelectorAll('.search-result-item');
        if (e.key === 'ArrowDown') {
            e.preventDefault();
            focusedIdx = Math.min(focusedIdx + 1, items.length - 1);
            updateFocus();
        } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            focusedIdx = Math.max(focusedIdx - 1, 0);
            updateFocus();
        } else if (e.key === 'Enter' && focusedIdx >= 0 && items[focusedIdx]) {
            e.preventDefault();
            items[focusedIdx].click();
        }
    });

    if (input) {
        input.addEventListener('input', function() {
            var query = input.value.trim();
            if (query.length < 2 || !fuse) {
                resultsEl.innerHTML = '<div class="search-empty">Type to search across all content</div>';
                focusedIdx = -1;
                return;
            }
            var results = fuse.search(query);
            renderResults(results);
        });
    }
})();
</script>

</body></html>';

    w.document.open();
    w.document.write(html);
    w.document.close();
    setTimeout(function() { w.print(); }, 600);
}

// ==================== SHARE ====================
function shareLinkedIn() { window.open('https://www.linkedin.com/sharing/share-offsite/?url=' + encodeURIComponent(window.location.href), '_blank'); }
function shareTwitter() { window.open('https://twitter.com/intent/tweet?url=' + encodeURIComponent(window.location.href) + '&text=' + encodeURIComponent('AI Factories: Why Traditional Data Center Architecture Faces Technical Extinction'), '_blank'); }
function shareWhatsApp() { window.open('https://wa.me/?text=' + encodeURIComponent(document.title + ' ' + window.location.href), '_blank'); }
function copyLink() {
    navigator.clipboard.writeText(window.location.href).then(function() {
        var copyIcon = document.querySelector('.share-btn.copy .copy-icon');
        var checkIcon = document.querySelector('.share-btn.copy .check-icon');
        if (copyIcon) copyIcon.style.display = 'none';
        if (checkIcon) checkIcon.style.display = 'block';
        setTimeout(function() { if (copyIcon) copyIcon.style.display = 'block'; if (checkIcon) checkIcon.style.display = 'none'; }, 2000);
    });
}

// Init: check auth on load
if (aifPremium) { aifUnlockPanels(); }
</script>
<script src="auth.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-banner hidden" id="cookieBanner">
    <p>We use cookies for analytics to improve your experience. <a href="privacy.html">Learn more</a></p>
    <div class="cookie-actions">
        <button class="cookie-accept" id="cookieAccept">Accept</button>
        <button class="cookie-decline" id="cookieDecline">Decline</button>
    </div>
</div>

<!-- Scroll to Top -->
<button class="scroll-top-btn" id="scrollTopBtn" aria-label="Scroll to top">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"/></svg>
</button>

<script>
(function(){
    // Cookie Banner
    var cb = document.getElementById('cookieBanner');
    var consent = localStorage.getItem('rz_cookie_consent');
    if (!consent && cb) {
        cb.classList.remove('hidden');
    }
    var acceptBtn = document.getElementById('cookieAccept');
    var declineBtn = document.getElementById('cookieDecline');
    if (acceptBtn) acceptBtn.addEventListener('click', function(){
        localStorage.setItem('rz_cookie_consent', 'accepted');
        cb.classList.add('hidden');
    });
    if (declineBtn) declineBtn.addEventListener('click', function(){
        localStorage.setItem('rz_cookie_consent', 'declined');
        cb.classList.add('hidden');
        // Disable GA
        window['ga-disable-G-GED7FX8RTV'] = true;
    });

    // Scroll to Top
    var sBtn = document.getElementById('scrollTopBtn');
    if (sBtn) {
        var ticking = false;
        window.addEventListener('scroll', function(){
            if (!ticking) {
                window.requestAnimationFrame(function(){
                    if (window.scrollY > 500) {
                        sBtn.classList.add('visible');
                    } else {
                        sBtn.classList.remove('visible');
                    }
                    ticking = false;
                });
                ticking = true;
            }
        });
        sBtn.addEventListener('click', function(){
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
    }
})();
</script>

</body>
</html>
