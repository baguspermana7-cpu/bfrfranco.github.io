(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,32737,e=>{"use strict";var t=e.i(33107);let o=[6,182,212],a=[16,185,129],l=[99,102,241],n=[244,63,94],i=[245,158,11],r=[34,197,94],s=[59,130,246],c=[15,23,42],d=[30,41,59],u=[51,65,85],h=[71,85,105],C=[100,116,139],m=[148,163,184],g=[203,213,225],y=[226,232,240],F=[51,65,85],p=[100,116,139],f=182,x=e=>{let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:o},S=(e,t,o,a)=>t+o>e.internal.pageSize.height-20?(b(e,a.current),e.addPage(),a.current++,35):t,v=(e,t,a,l,i)=>{let r=e.internal.pageSize.width,s=e.internal.pageSize.height,d=i?.primaryColor?x(i.primaryColor):o;if(e.setFillColor(...c),e.rect(0,0,r,s,"F"),e.setFillColor(...d),e.rect(0,0,6,s,"F"),i?.logoBase64)try{e.addImage(i.logoBase64,"PNG",r-40-14,14,40,40,void 0,"FAST")}catch(e){console.warn("Failed to render logo",e)}else e.setFillColor(d[0],d[1],d[2]),e.circle(r-30,40,60,"F"),e.setFillColor(...c),e.circle(r-30,40,55,"F");e.setFont("helvetica","bold"),e.setFontSize(32),e.setTextColor(255,255,255);let u=t.toUpperCase().split("\n"),C=.35*s;e.text(u,24,C);let g=C+(u.length-1)*14;e.setFontSize(14),e.setTextColor(...d),e.text(a,24,g+18),e.setDrawColor(...d),e.setLineWidth(.5),e.line(24,g+24,134,g+24);let y=g+39;e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(...m),i?.companyName&&(e.text(`Prepared by: ${i.companyName}`,24,y),y+=7),l.client&&(e.text(`Prepared for: ${l.client}`,24,y),y+=7),e.text(`Date: ${l.date}`,24,y),y+=7,e.text(`Version: ${l.version||"1.0"}`,24,y),!1!==l.confidential&&(e.setFillColor(...n),e.roundedRect(24,s-50,50,10,2,2,"F"),e.setFontSize(7),e.setTextColor(255,255,255),e.setFont("helvetica","bold"),e.text("CONFIDENTIAL",29,s-43)),e.setFontSize(8),e.setTextColor(...h),e.setFont("helvetica","normal");let F=i?.companyName?`Generated by ${i.companyName} Operations Calculator`:"Generated by DCMOC v2.0 — Data Center M&O Calculator";e.text(F,24,s-15)},T=(e,t,a="",l)=>{let n=e.internal.pageSize.width,i=l?.primaryColor?x(l.primaryColor):o;e.setFillColor(...c),e.rect(0,0,n,25,"F"),e.setFillColor(...i),e.rect(0,23,n,1,"F"),e.setFont("helvetica","bold"),e.setFontSize(14),e.setTextColor(255,255,255),e.text(t,14,16),l?.logoBase64?e.addImage(l.logoBase64,"PNG",n-14-12,6,12,12,void 0,"FAST"):a&&(e.setFontSize(8),e.setTextColor(...m),e.text(a,n-14,16,{align:"right"}))},b=(e,t,o)=>{let a=e.internal.pageSize.width,l=e.internal.pageSize.height;e.setDrawColor(...y),e.line(14,l-15,a-14,l-15),e.setFontSize(7),e.setTextColor(...m);let n=new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),i=o?.companyName?o.companyName:"DCMOC v2.0";e.text(`Generated ${n} | ${i} | CONFIDENTIAL`,14,l-8),e.text(`Page ${t}`,a-14,l-8,{align:"right"})},P=(e,t,a,l,n)=>{let i=n?.primaryColor?x(n.primaryColor):o;e.setFillColor(...i),e.rect(14,t,3,8,"F"),e.setFont("helvetica","bold"),e.setFontSize(13),e.setTextColor(...c);let r=l?`${l}. `:"";return e.text(`${r}${a}`,20,t+6),e.setDrawColor(...y),e.setLineWidth(.3),e.line(14,t+10,196,t+10),t+16},$=(e,t,o,l,n,i,r,s,d=a)=>{e.setFillColor(248,250,252),e.setDrawColor(...y),e.roundedRect(t,o,l,n,2,2,"FD"),e.setFillColor(...d),e.rect(t,o+6,2,n-12,"F"),e.setFontSize(7),e.setTextColor(...p),e.setFont("helvetica","normal"),e.text(i.toUpperCase(),t+5,o+9),e.setFontSize(14),e.setFont("helvetica","bold"),e.setTextColor(...c),e.text(r,t+5,o+19),e.setFontSize(7),e.setFont("helvetica","normal"),e.setTextColor(...p),e.text(s,t+5,o+n-5)},R=(e,t,o,l,n="info")=>{let r={info:s,warning:i,success:a},c=e.splitTextToSize(l,f-16),d=14+4.5*c.length;return e.setFillColor(...{info:[239,246,255],warning:[254,252,232],success:[236,253,245]}[n]),e.roundedRect(14,t,f,d,2,2,"F"),e.setFillColor(...r[n]),e.rect(14,t,3,d,"F"),e.setFont("helvetica","bold"),e.setFontSize(9),e.setTextColor(...r[n]),e.text(o,21,t+8),e.setFont("helvetica","normal"),e.setFontSize(8),e.setTextColor(...F),e.text(c,21,t+14),t+d+4},w=(e,t,o,a=f)=>{e.setFont("helvetica","normal"),e.setFontSize(9),e.setTextColor(...F);let l=e.splitTextToSize(o,a);return e.text(l,14,t),t+4.5*l.length+2},A=(e,t,o,a,l,n)=>{e.setFontSize(10),e.setFont("helvetica","bold"),e.setTextColor(...c),e.text(n,t,o);let i=Math.max(...l.map(e=>e.value),1),r=o+8;return l.forEach(o=>{e.setFontSize(7.5),e.setFont("helvetica","normal"),e.setTextColor(...F),e.text(o.label,t,r+5),e.setFillColor(241,245,249),e.roundedRect(t+45,r,a-90,8,1,1,"F");let l=Math.max(2,o.value/i*(a-90));e.setFillColor(...o.color),e.roundedRect(t+45,r,l,8,1,1,"F"),e.setFontSize(7),e.setFont("helvetica","bold"),e.setTextColor(...c);let n=o.value>=1e3?`$${(o.value/1e3).toFixed(1)}k`:`$${o.value.toFixed(0)}`;e.text(n,t+a-40,r+5.5,{align:"right"}),r+=12}),r+4};var D=e.i(42821);let I=async t=>{let o=await e.A(73880),a=null;a=o.default&&"function"==typeof o.default?o.default:o.jsPDF?o.jsPDF:o.default||o;let l=await e.A(34642),n=l.default||l;if(!a)throw Error("Failed to load jsPDF constructor");return{doc:new a({orientation:"portrait",unit:"mm",format:"a4"}),autoTable:(e,t)=>"function"==typeof n?n(e,t):"function"==typeof e.autoTable?e.autoTable(t):void console.error("autoTable plugin not found")}},E=(e,t)=>{try{let o=e.output("blob");if(console.log(`PDF Generated: ${t}, Size: ${o.size} bytes, Type: ${o.type}`),o.size<100)throw Error(`Generated PDF is empty (${o.size} bytes)`);let a=URL.createObjectURL(o),l=document.createElement("a");l.href=a,l.download=t,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(a)}catch(e){console.error("PDF save error:",e),window.alert(`PDF Generation Failed: ${e.message||"Unknown error"}`)}},M=e=>e>=1e6?`$${(e/1e6).toFixed(2)}M`:e>=1e3?`$${(e/1e3).toFixed(1)}k`:`$${e.toFixed(0)}`,z=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0}).format(e),O=()=>new Date().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}),k=async(e,t,l,n,i,r,d)=>{let{doc:u,autoTable:h}=await I(d),C=1;v(u,"Staffing Strategy &\nOperational Roster",`Analysis for ${e.name} Region`,{client:"Internal Assessment",date:O(),version:"2.4",confidential:!0},d),u.addPage(),C++,T(u,"Executive Summary","Staffing & Cost Analysis",d);let g=35,p=l.reduce((e,t)=>e+t.headcount,0),x=l.reduce((e,t)=>e+t.monthlyCost,0);$(u,14,g,42,24,"Total Headcount",`${p}`,"FTEs across all shifts"),$(u,60,g,42,24,"Monthly OPEX",M(x),"Gross Salary + Burden"),$(u,106,g,42,24,"Avg Cost / Head",M(x/p),"Monthly Blended Rate"),$(u,152,g,42,24,"Shift Model","8h"===t?"8-Hour":"12-Hour","Rotation Pattern"),g+=35;let w=i.find(e=>"high"===e.severity)||i[0];if(w&&(g=R(u,g,`Strategic Recommendation: ${w.title}`,w.recommendation,"high"===w.severity?"warning":"info")),g=A(u,14,g,180,l.map(e=>({label:e.role,value:e.monthlyCost,color:e.role.includes("Engineer")?a:o})),"Monthly Cost Distribution by Role"),g=S(u,g,60,{current:C}),r&&r.length>0){var D,z;let t,o;D=g=P(u,g,"Shift Model Comparison","1.0",d),z=`8-Hour vs 12-Hour Model (${e.name})`,u.setFontSize(10),u.setFont("helvetica","bold"),u.setTextColor(...c),u.text(z,14,D),t=D+4,u.setFillColor(...c),u.rect(14,t,f,8,"F"),u.setFontSize(7),u.setFont("helvetica","bold"),u.setTextColor(255,255,255),u.text("Metric",17,t+5.5),u.text("8h Continental",87,t+5.5),u.text("12h (4on/4off)",132,t+5.5),u.text("Better",177,t+5.5),o=t+8,r.forEach((e,t)=>{t%2==0&&(u.setFillColor(248,250,252),u.rect(14,o,f,8,"F")),u.setFontSize(7),u.setFont("helvetica","normal"),u.setTextColor(...F),u.text(e.metric,17,o+5.5),u.text(e.value8h,87,o+5.5),u.text(e.value12h,132,o+5.5),"12h"===e.winner?(u.setTextColor(...a),u.setFont("helvetica","bold"),u.text("12h ✓",177,o+5.5)):"8h"===e.winner?(u.setTextColor(...s),u.setFont("helvetica","bold"),u.text("8h ✓",177,o+5.5)):(u.setTextColor(...m),u.text("—",177,o+5.5)),o+=8}),u.setDrawColor(...y),u.rect(14,t,f,o-t),g=o+6}b(u,C,d),u.addPage(),C++,T(u,"Operational Roster","Shift Pattern Visualization",d),g=P(u,g=35,"Shift Rotation Schedule","2.0",d),h(u,{startY:g,head:[["Team","Next 14 Days Rotation"]],body:Array.from(new Set(n.map(e=>e.team))).map(e=>{let t=n.filter(t=>t.team===e).slice(0,14);return[e,t.map(e=>"Day"===e.shiftType?"☀":"Night"===e.shiftType?"☾":"—").join(" ")]}),theme:"striped",headStyles:{fillColor:(d?.primaryColor,c)},styles:{fontSize:8,cellPadding:3},margin:{left:14,right:14}}),b(u,C,d),E(u,`DCMOC_Staffing_Report_${e.name}_${new Date().toISOString().slice(0,10)}.pdf`)},N=async(e,t,l,s,p)=>{var x;let $,{doc:R,autoTable:w}=await I(s),{inputs:A,results:D,insights:k}=l,N=1;v(R,"Feasibility Simulation\n& Market Analysis",`Assessment for ${e.name} Data Center`,{client:"Strategic Planning Committee",date:O(),version:"1.2"},s),R.addPage(),N++,T(R,"Executive Summary","Operational Viability Assessment",s);let Y=35,B=D.monthlyInternalCost||0,L=D.monthlyVendorCost||0,G=D.totalMonthlyConsumables||0,W=D.turnoverCost||0,U=(e,t,o,a,l,n,i,r,s,c)=>{R.setFillColor(255,255,255),R.setDrawColor(226,232,240),R.roundedRect(e,t,o,a,2,2,"FD"),R.setFont("helvetica","bold"),R.setFontSize(7),R.setTextColor(...C),R.text(l.toUpperCase(),e+4,t+6),R.setFontSize(14),R.setTextColor(...r),R.text(n,e+4,t+14),R.setFillColor(...s),R.roundedRect(e+4,t+18,o-8,5,1,1,"F"),R.setFont("helvetica","normal"),R.setFontSize(6),R.setTextColor(...c),R.text(i,e+6,t+21.5)};U(14,Y,42,26,"Internal Staff Cost",M(B),`${D.headcount||0} Internal FTEs`,c,[241,245,249],h),U(60,Y,42,26,"Vendor Labor Cost",M(L),"Includes Premium",i,[254,243,199],[217,119,6]),U(106,Y,42,26,"Parts & Consumables",M(G),`AQI Impact: ${D.aqiImpact>1?"High":"None"}`,o,[241,245,249],h),U(152,Y,42,26,"Hidden Turnover Loss",M(W),"Recruitment + Training",n,[255,228,230],[225,29,72]),Y+=35,Y=S(R,Y,60,{current:N}),$=x=Y=P(R,Y,"Key Strategic Insights","1.0",s),k.slice(0,6).forEach(e=>{let t="high"===e.severity?n:"medium"===e.severity?i:a,o=R.splitTextToSize(e.description,f-12),l=12+4*o.length;R.setFillColor(248,250,252),R.rect(14,$,f,l,"F"),R.setFillColor(...t),R.rect(14,$,2.5,l,"F"),R.setFontSize(8.5),R.setFont("helvetica","bold"),R.setTextColor(...c),R.text(e.title,20,$+6),R.setFont("helvetica","normal"),R.setFontSize(7.5),R.setTextColor(...F),R.text(o,20,$+12),$+=l+3}),Y=S(R,Y=$,80,{current:N}),Y=P(R,Y,"Operational Physics & Regulatory Analysis","2.0",s),R.setFillColor(248,250,252),R.setDrawColor(...y),R.roundedRect(14,Y,182,30,2,2,"FD"),R.setFont("helvetica","bold"),R.setFontSize(9),R.setTextColor(...d),R.text("Overtime & Regulatory Analysis (PP 35/2021)",18,Y+6),R.setFontSize(8),R.setFont("helvetica","normal"),R.setTextColor(...h),R.text("Weekly OT Hours/Person",18,Y+14),R.setFont("helvetica","bold"),R.setTextColor(...c),R.text(`${D.overtimeHours?.toFixed(1)||0} hrs`,90,Y+14,{align:"right"});let V=Math.min(1,(D.overtimeHours||0)/18);R.setFillColor(...y),R.roundedRect(18,Y+17,72,2,1,1,"F"),R.setFillColor(...(D.overtimeHours||0)>12?n:r),R.roundedRect(18,Y+17,72*V,2,1,1,"F"),R.setFont("helvetica","normal"),R.setFontSize(7),R.setTextColor(...C),R.text("Legal limit for 12h shifts without permit is strict. >18h/week incurs 4.0x multiplier.",18,Y+24),R.setFontSize(8),R.setTextColor(...h),R.text("Base Salary",105,Y+14),R.setTextColor(...c),R.text("$20000.00",185,Y+14,{align:"right"}),R.setFont("helvetica","bold"),R.setTextColor(...i),R.text("Overtime Penalty",105,Y+20),R.text("$1126.30",185,Y+20,{align:"right"}),Y+=35,R.setFillColor(248,250,252),R.roundedRect(14,Y,88,30,2,2,"FD"),R.setFont("helvetica","bold"),R.setFontSize(9),R.setTextColor(...d),R.text("Environmental Physics (Power Law)",18,Y+6),R.setFillColor(241,245,249),R.setDrawColor(...g),R.roundedRect(18,Y+9,60,18,1,1,"FD"),R.setFontSize(6),R.setTextColor(...C),R.text("Mathematical Formula",20,Y+13),R.setFont("courier","normal"),R.setTextColor(...r),R.text("Life_Actual =",20,Y+18),R.text("Life_Base * (AQI_Base/AQI)^1.5",20,Y+22),R.setFont("helvetica","bold"),R.setFontSize(7),R.setTextColor(...C),R.text("Impact",98,Y+13,{align:"right"}),R.setTextColor(...u),R.text((A.aqiOverride||50)>100?"Accelerated Wear":"Standard",98,Y+17,{align:"right"}),R.setFillColor(248,250,252),R.roundedRect(108,Y,88,30,2,2,"FD"),R.setFontSize(9),R.setTextColor(...d),R.text(`Risk & Downtime Exposure (Tier ${A.tierLevel||3})`,112,Y+6),R.setFontSize(6),R.setTextColor(...C),R.text("EXPECTED AVAILABILITY",112,Y+12),R.setFontSize(14),R.setTextColor(...c),R.text(`${D.availability?.toFixed(3)||0}%`,112,Y+18),R.setFontSize(6),R.setTextColor(...C),R.text(`~${Math.round(D.downtimeMinutes||0)} mins downtime / yr`,112,Y+22),R.setFontSize(6),R.setTextColor(...C),R.text("FINANCIAL EXPOSURE",156,Y+12),R.setFontSize(14),R.setTextColor(...n),R.text(z(D.financialRisk||0),156,Y+18),R.setFontSize(6),R.setTextColor(...C),R.text("@ $5k/min impact",156,Y+22),Y+=35,Y=S(R,Y,70,{current:N}),Y=P(R,Y,"Power & Cooling Analytics","3.0",s),R.setFillColor(248,250,252),R.roundedRect(14,Y,182,35,2,2,"FD"),R.setFillColor(241,245,249),R.roundedRect(18,Y+4,38,14,1,1,"FD"),R.setFontSize(6),R.setTextColor(...C),R.text("PUE",20,Y+8),R.setFontSize(10),R.setTextColor(217,119,6),R.text("1.45",20,Y+14),R.roundedRect(58,Y+4,38,14,1,1,"FD"),R.setFontSize(6),R.setTextColor(...C),R.text("COOLING LOAD",60,Y+8),R.setFontSize(10),R.setTextColor(...o),R.text("450 kW",60,Y+14),R.roundedRect(98,Y+4,38,14,1,1,"FD"),R.setFontSize(6),R.setTextColor(...C),R.text("TOTAL FACILITY",100,Y+8),R.setFontSize(10),R.setTextColor(...c),R.text("1450 kW",100,Y+14);let _=e.environment?.gridCarbonIntensity??.5,j=A.tierLevel||3;if(R.roundedRect(138,Y+4,54,14,1,1,"FD"),R.setFontSize(6),R.setTextColor(...C),R.text("ANNUAL CO2",140,Y+8),R.setFontSize(10),R.setTextColor(109,40,217),R.text(`${((4===j?1250:1450)*8760/1e3*_/1e3).toFixed(1)}k tonnes/yr`,140,Y+14),R.setFontSize(6),R.setTextColor(...C),R.text("POWER CHAIN EFFICIENCY",18,Y+24),R.setFont("courier","normal"),R.setFillColor(209,250,229),R.roundedRect(18,Y+26,25,5,1,1,"F"),R.setTextColor(4,120,87),R.text("Grid 98%",21,Y+29.5),R.setTextColor(...m),R.text("->",45,Y+29.5),R.setFillColor(219,234,254),R.roundedRect(50,Y+26,25,5,1,1,"F"),R.setTextColor(29,78,216),R.text("UPS 94%",53,Y+29.5),R.setTextColor(...m),R.text("->",77,Y+29.5),R.setFillColor(233,213,255),R.roundedRect(82,Y+26,25,5,1,1,"F"),R.setTextColor(109,40,217),R.text("PDU 97%",85,Y+29.5),R.setTextColor(...m),R.text("->",109,Y+29.5),R.setFillColor(207,250,254),R.roundedRect(114,Y+26,30,5,1,1,"F"),R.setTextColor(14,116,144),R.text("IT Load ✓",117,Y+29.5),Y+=45,p?.tornado||p?.sankey){if(b(R,N,s),R.addPage(),N++,T(R,"Visual Analysis","Generated Charts",s),Y=35,p.sankey){Y=P(R,Y,"Cost Flow Analysis (Sankey)","3.0",s);try{let e=R.getImageProperties(p.sankey),t=180*e.height/e.width;R.addImage(p.sankey,"PNG",15,Y,180,t),Y+=t+10}catch(e){console.warn("Error adding Sankey image to PDF",e)}}if(p.tornado){Y=S(R,Y,100,{current:N}),Y=P(R,Y,"Sensitivity Analysis (Tornado)","4.0",s);try{let e=R.getImageProperties(p.tornado),t=180*e.height/e.width;R.addImage(p.tornado,"PNG",15,Y,180,t)}catch(e){console.warn("Error adding Tornado image to PDF",e)}}}b(R,N,s),E(R,`DCMOC_Feasibility_${e.name}_${new Date().toISOString().slice(0,10)}.pdf`)},Y=async(e,t,o,a,l)=>{let{doc:n,autoTable:i}=await I(l),r=1;v(n,"Capital Expenditure\nReport",`Budget Estimation for ${e.name}`,{client:"Finance Dept",date:O(),version:"3.1"},l),n.addPage(),r++,T(n,"Project Configuration","Facility Design & Inputs",l);let s=(e,t,o,a)=>{n.setFillColor(248,250,252),n.setDrawColor(226,232,240),n.roundedRect(e,t,85,10+8*a.length,2,2,"FD"),n.setFont("helvetica","bold"),n.setFontSize(9),n.setTextColor(...u),n.text(o,e+4,t+6);let l=t+12;return a.forEach(t=>{n.setFont("helvetica","normal"),n.setFontSize(8),n.setTextColor(...C),n.text(t.label,e+4,l),n.setFont("helvetica","bold"),n.setTextColor(...c),n.text(t.value,e+81,l,{align:"right"}),l+=8}),t+10+8*a.length+4},g=35;g=s(14,35,"Facility Layout",[{label:"IT Capacity",value:`${a.itLoad||1e3} kW`},{label:"Redundancy Tier",value:a.redundancy?.toUpperCase()||"N+1"},{label:"Cooling Strategy",value:"air"===a.coolingType?"Air Cooled":"inrow"===a.coolingType?"In-Row":"Other"},{label:"Building Type",value:"purpose"===a.buildingType?"Purpose Built":"Retrofit/Modular"},{label:"Rack Density",value:a.rackType?.toUpperCase()||"STANDARD"}]),g=s(14,g,"Power & Cooling Build",[{label:"UPS System",value:a.upsType||"Modular"},{label:"Generator",value:a.genType||"Diesel"},{label:"Fuel Storage",value:`${a.fuelHours||48} Hours`},{label:"Fire Suppression",value:a.fireType||"Novec"},{label:"Fire Alarm",value:a.alarmType||"Addressable"}]);let y=35;y=s(105,35,"Sustainability & Site",[{label:"Green Certification",value:a.greenCert||"None"},{label:"Renewable Energy",value:a.renewableOption||"None"},{label:"Substation & Grid",value:a.includeFOM?"Include FOM":"Exclude FOM"},{label:"Project Year",value:a.projYear||"2025"},{label:"City Market",value:"none"!==a.cityMarket?a.cityMarket:"Generic"}]),y=s(105,y,"Soft Costs",[{label:"Design Fee",value:`${a.designFee||8}%`},{label:"PM Fee",value:`${a.pmFee||5}%`},{label:"Contingency",value:`${a.contingency||10}%`}]),b(n,r,l),n.addPage(),r++,T(n,"Project Parameters & Executive Summary",`Total CAPEX: ${z(t.total)}`,l);let F=35,{metrics:p,timeline:f,costs:x,softCosts:S,contingency:$}=t,R=(e,t,o,a,l,i,r,s,c=C)=>{n.setFillColor(255,255,255),n.setDrawColor(226,232,240),n.roundedRect(e,t,o,a,2,2,"FD"),n.setFont("helvetica","medium"),n.setFontSize(8),n.setTextColor(...c),n.text(l,e+4,t+8),n.setFont("helvetica","bold"),n.setFontSize(16),n.setTextColor(...s),n.text(i,e+4,t+16),n.setFont("helvetica","normal"),n.setFontSize(7),n.setTextColor(...m),n.text(r,e+4,t+22)};R(14,35,42,26,"Total CAPEX",z(t.total),"Estimated Total",c,[79,70,229]),R(58,F,42,26,"Cost per kW",`$${Math.round(p.perKw).toLocaleString()}`,p.perKw<8e3?"Low Cost":p.perKw<15e3?"Standard":"Premium",[79,70,229]),R(102,F,42,26,"PUE Target",t.pue.toFixed(2),t.pue<1.3?"Best-in-Class":t.pue<1.5?"Good":"Standard",[5,150,105]),R(146,F,42,26,"Timeline",`${f.totalMonths} Mo`,"Design to Commissioning",[217,119,6]),R(14,F+=30,42,26,"Total Racks",`${p.racks}`,"IT Equipment",u),R(58,F,42,26,"Floor Space",`${Math.round(p.floorSpace).toLocaleString()} m\xb2`,"White space",u),R(102,F,42,26,"Annual Energy",z(p.annualEnergy),"@ $0.10/kWh",u),R(146,F,42,26,"Soft Costs",z((S.design||0)+(S.pm||0)),"Design & PM Fees",u),F+=36,n.setFillColor(238,242,255),n.setDrawColor(224,231,255),n.roundedRect(14,F,174,30,2,2,"FD"),n.setFont("helvetica","bold"),n.setFontSize(10),n.setTextColor(49,46,129),n.text("CAPEX Analysis",18,F+8);let w=n.splitTextToSize(o.replace(/\*\*/g,""),166);n.setFont("helvetica","normal"),n.setFontSize(8),n.setTextColor(55,48,163),n.text(w,18,F+14),F+=38;let A=F=P(n,F,"Details","1.0",l);n.setFont("helvetica","bold"),n.setFontSize(9),n.setTextColor(...u),n.text("Cost Breakdown",14,A),n.setDrawColor(241,245,249);let D=A+6,M=Object.entries(x).sort(([,e],[,t])=>t-e),k=(e,o)=>{t.total,n.line(14,D-3,94,D-3),n.setFillColor(129,140,248),n.circle(16,D-.5,1.5,"F"),n.setFont("helvetica","normal"),n.setFontSize(7.5),n.setTextColor(...h),n.text(e.replace(/([A-Z])/g," $1").trim().replace(/^./,e=>e.toUpperCase()),19,D),n.setFont("helvetica","bold"),n.setFontSize(8),n.setTextColor(...c),n.text(`$${(o/1e3).toFixed(0)}k`,94,D,{align:"right"}),D+=7};for(let[e,t]of M)k(e,t);S.design&&k("Design Fee",S.design),S.pm&&k("PM Fee",S.pm),$&&k("Contingency",$),t.fomTotal>0&&k("Front-of-Meter",t.fomTotal),n.setFont("helvetica","bold"),n.setFontSize(9),n.setTextColor(...u),n.text("Project Timeline",105,A);let N=A+6;for(let e of f.phases){n.setDrawColor(226,232,240),n.line(109,N,109,N+12);let t=(e=>{let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:[0,0,0]})(e.color);n.setFillColor(...t),n.circle(109,N+2,2,"F"),n.setFont("helvetica","bold"),n.setFontSize(8),n.setTextColor(...d),n.text(e.name,113,N+3),n.setFont("helvetica","normal"),n.setFontSize(7),n.setTextColor(...C),n.text(`M${e.start} - M${e.end}`,180,N+3,{align:"right"}),N+=14}n.setFillColor(248,250,252),n.roundedRect(109,N,71,20,2,2,"F"),n.setFont("helvetica","bold"),n.setFontSize(7),n.setTextColor(...C),n.text("TOTAL DURATION",113,N+6),n.setFontSize(14),n.setTextColor(...d),n.text(`${f.totalMonths} months`,113,N+12),n.setFontSize(7),n.setFont("helvetica","normal"),n.setTextColor(...m),n.text(`~${(f.totalMonths/12).toFixed(1)} years from design start to go-live`,113,N+17),b(n,r,l),E(n,`DCMOC_CAPEX_${e.name}_${new Date().toISOString().slice(0,10)}.pdf`)},B=async(e,t,o,a,l,n,i)=>{let{doc:r,autoTable:s}=await I(i),d=1;v(r,"Maintenance Strategy\n& Reliability Analysis",`Operational Plan for ${e.name}`,{client:"Ops Director",date:O()},i),r.addPage(),d++,T(r,"Strategy & OPEX Optimization","Maintenance Regime Analysis",i);let u=35;u=R(r,35,`Recommended Strategy: ${t.recommended.toUpperCase()}`,t.recommendationReason,"success"),u=S(r,u,60,{current:d}),u=P(r,u,"Strategy Cost Comparison","1.0",i),s(r,{startY:u,head:[["Strategy","Annual Cost","5-Year NPV","Status"]],body:t.strategies.map(e=>[e.label,z(e.totalAnnualCost),z(e.fiveYearNPV),e.id===t.recommended?"Recommended":""]),theme:"grid",headStyles:{fillColor:(i?.primaryColor,c)},margin:{left:14,right:14}}),u=r.lastAutoTable.finalY+15;let h=u=P(r,u,"Inventory & SLA Optimization","2.0",i);$(r,14,h,55,24,"Inventory Value",z(a.totalInventoryValue),"Capital Locked in Spares"),$(r,75,h,55,24,"Annual Budget",z(a.totalAnnualSparesBudget),"Consumption + Holding"),$(r,136,h,55,24,"Critical Items",`${a.criticalSpares}`,"Must-Stock SKUs"),u+=35,n&&(u=w(r,u,`Analyst Notes: ${n}`)),b(r,d,i),E(r,`DCMOC_Maintenance_${e.name}_${new Date().toISOString().slice(0,10)}.pdf`)},L=async(e,t,o,l,i,r,s,d,h,g)=>{let{doc:y,autoTable:F}=await I(g),p=1;v(y,"Financial Feasibility\n& Revenue Analysis",`Investment Case for ${e.name}`,{client:"CFO / Investment Comm.",date:O()},g),y.addPage(),p++,T(y,"Financial & Revenue Parameters","Assumption Guidelines",g);let f=(e,t,o,a)=>{y.setFillColor(248,250,252),y.setDrawColor(226,232,240),y.roundedRect(e,t,85,10+8*a.length,2,2,"FD"),y.setFont("helvetica","bold"),y.setFontSize(9),y.setTextColor(...u),y.text(o,e+4,t+6);let l=t+12;return a.forEach(t=>{y.setFont("helvetica","normal"),y.setFontSize(8),y.setTextColor(...C),y.text(t.label,e+4,l),y.setFont("helvetica","bold"),y.setTextColor(...c),y.text(t.value,e+81,l,{align:"right"}),l+=8}),t+10+8*a.length+4},x=35;x=f(14,35,"Financial Analysis",[{label:"Revenue per kW/month",value:`$${l.revenuePerKwMonth}`},{label:"Discount Rate",value:`${(100*l.discountRate).toFixed(0)}%`},{label:"Project Life",value:`${l.projectLifeYears} yrs`},{label:"Rev. Escalation",value:`${(100*l.escalationRate).toFixed(0)}%`},{label:"OPEX Escalation",value:`${(100*l.opexEscalation).toFixed(1)}%`},{label:"Tax Rate",value:`${(100*l.taxRate).toFixed(0)}%`},{label:"Depreciation",value:`${l.depreciationYears} yrs`}]),x=f(14,x,"NRC (Non-Recurring Charges)",[{label:"Setup Fee",value:`$${i.nrcPerKw}/kW`},{label:"X-Connect Setup",value:z(i.nrcCrossConnect)},{label:"Custom Fit-out",value:z(i.nrcCustomFitout)}]);let $=35;$=f(105,35,"MRC (Monthly Recurring)",[{label:"MRC $/kW/mo",value:`$${i.mrcPerKwMonth}`},{label:"Escalation",value:`${(100*i.mrcEscalation).toFixed(0)}%/yr`},{label:"X-Connect MRC",value:`$${i.mrcCrossConnectMonthly}/mo`}]),$=f(105,$,"Contract Terms",[{label:"Lease Term",value:`${i.contractYears} yrs`},{label:"Take-or-Pay Floor",value:`${i.takeOrPayPct}%`}]),$=f(105,$,"Quick Summary",[{label:"CAPEX Investment",value:z(r)},{label:"Annual OPEX (est.)",value:z(s)},{label:"Annual Revenue (100%)",value:z(12*l.revenuePerKwMonth*d)},{label:"Break-even Occupancy",value:`${t.breakEvenOccupancy}%`},{label:"Total NRC",value:z(o.totalNRC)},{label:"TCV",value:z(o.contractValue)}]),b(y,p,g),y.addPage(),p++,T(y,"Financial Executive Summary","Key Investment & Revenue Metrics",g);let w=35,D=(e,t,o,a,l,n,i,r,s=C)=>{y.setFillColor(255,255,255),y.setDrawColor(226,232,240),y.roundedRect(e,t,o,a,2,2,"FD"),y.setFont("helvetica","medium"),y.setFontSize(8),y.setTextColor(...s),y.text(l,e+4,t+8),y.setFont("helvetica","bold"),y.setFontSize(16),y.setTextColor(...r),y.text(n,e+4,t+16),y.setFont("helvetica","normal"),y.setFontSize(7),y.setTextColor(...m),y.text(i,e+4,t+22)};if(D(14,35,42,26,"NPV (10yr)",z(t.npv),"Net Present Value",t.npv>0?[5,150,105]:[220,38,38],[15,23,42]),D(58,w,42,26,"IRR",`${t.irr.toFixed(1)}%`,t.irr>100*l.discountRate?"Exceeds hurdle":"Below hurdle",t.irr>10?[5,150,105]:[217,119,6],[15,23,42]),D(102,w,42,26,"Payback",`${t.paybackPeriodYears.toFixed(1)} yrs`,`Discounted: ${t.discountedPaybackYears} yrs`,c,[15,23,42]),D(146,w,42,26,"ROI",`${t.roiPercent.toFixed(0)}%`,`PI: ${t.profitabilityIndex.toFixed(2)}x`,t.roiPercent>0?[5,150,105]:[220,38,38],[15,23,42]),D(14,w+=30,42,26,"Total NRC",z(o.totalNRC),"One-time setup fees",[8,145,178],[8,145,178]),D(58,w,42,26,"Lifetime MRC",z(o.totalMRC_lifetime),`Over ${i.contractYears} years`,[5,150,105],[5,150,105]),D(102,w,42,26,"TCV",z(o.contractValue),"Total Contract Value",[79,70,229],[79,70,229]),D(146,w,42,26,"Effective $/kW/mo",`$${o.effectiveRate.toFixed(0)}`,"Blended rate",[217,119,6],[217,119,6]),w+=36,w=R(y,w,"Financial Verdict",t.npv>0?`Strong investment case. Positive NPV of ${z(t.npv)} indicates value creation above the discount rate. TCV is ${z(o.contractValue)}.`:`Caution advised. Negative NPV of ${z(t.npv)} suggests returns may not meet capital cost requirements. TCV is ${z(o.contractValue)}.`,t.npv>0?"success":"warning"),h?.cashflow||h?.waterfall||h?.mrc){if(w=S(y,w,90,{current:p}),T(y,"Visual Analysis","Generated Cashflow & Revenue Charts",g),w=35,h.cashflow){w=P(y,w,"Cumulative Cashflow Projection","1.0",g);try{let e=y.getImageProperties(h.cashflow),t=180*e.height/e.width;y.addImage(h.cashflow,"PNG",15,w,180,t),w+=t+10}catch(e){console.warn("Error adding cashflow image to PDF",e)}}if(h.waterfall){w=S(y,w,90,{current:p}),w=P(y,w,"Revenue Waterfall — NRC + MRC Breakdown","2.0",g);try{let e=y.getImageProperties(h.waterfall),t=180*e.height/e.width;y.addImage(h.waterfall,"PNG",15,w,180,t),w+=t+10}catch(e){console.warn("Error adding waterfall image to PDF",e)}}if(h.mrc){w=S(y,w,90,{current:p}),w=P(y,w,"MRC Growth Trajectory with Take-or-Pay Floor","3.0",g);try{let e=y.getImageProperties(h.mrc),t=180*e.height/e.width;y.addImage(h.mrc,"PNG",15,w,180,t)}catch(e){console.warn("Error adding MRC image to PDF",e)}}b(y,p,g),y.addPage(),p++,w=35}else w=S(y,w,90,{current:p}),w=P(y,w,"Cumulative Cashflow Projection","1.0",g),w=A(y,14,w,180,t.cashflows.map(e=>({label:`Y${e.year}`,value:e.cumulativeCashflow,color:e.cumulativeCashflow>=0?a:n})).slice(0,10),"Cumulative Cashflow Growth (First 10 Years)"),b(y,p,g),y.addPage(),p++,w=35;T(y,"Detailed Cashflow & Revenue","Year-by-Year Projection",g),F(y,{startY:w=35,head:[["Period","Revenue","OPEX","EBITDA","Net Income","Occ%","Billed kW","NRC","MRC/mo","MRC Yr","Total Rev","Cum. CF"]],body:t.cashflows.map((e,t)=>{let a=o.yearDetails[t];return[`Y${e.year}`,z(e.revenue),z(-e.opex),z(e.ebitda),z(e.netIncome),a?`${(100*a.occupancy).toFixed(0)}%`:"—",a?M(a.billedKw):"—",a&&a.nrc>0?z(a.nrc):"—",a?z(a.mrcMonthly):"—",a?z(a.mrcAnnual):"—",a?z(a.totalRevenue):z(e.revenue),z(e.cumulativeCashflow)]}),theme:"striped",headStyles:{fillColor:(g?.primaryColor,c)},margin:{left:14,right:14},styles:{fontSize:7,cellPadding:1},columnStyles:{0:{fontStyle:"bold"},1:{halign:"right",textColor:[5,150,105]},2:{halign:"right",textColor:[220,38,38]},3:{halign:"right",fontStyle:"bold"},4:{halign:"right"},5:{halign:"right"},6:{halign:"right"},7:{halign:"right",textColor:[8,145,178]},8:{halign:"right",textColor:[5,150,105]},9:{halign:"right",textColor:[5,150,105]},10:{halign:"right",fontStyle:"bold"},11:{halign:"right",fontStyle:"bold"}}}),b(y,p,g),E(y,`DCMOC_Financials_${e.name}_${new Date().toISOString().slice(0,10)}.pdf`)},G=async(e,t,o,a)=>{let{doc:l}=await I(a),r=1;v(l,"Risk & Compliance\nAssessment",`Facility Analysis for ${e.name}`,{client:"Risk Management",date:O()},a),l.addPage(),r++,T(l,"Risk Matrix Executive Summary",`Normalized Score: ${t.normalizedScore}/100`,a);let c=35;$(l,14,35,55,24,"Total Risk Score",`${t.totalScore}`,"Raw unweighted score"),$(l,75,c,55,24,"SLA Breach Prob.",`${(100*t.slaBreachProbability).toFixed(1)}%`,"Annually"),$(l,136,c,55,24,"Identified Risks",`${t.topRisks.length}`,"Active threats"),c+=35,c=w(l,c,o),c=S(l,c,80,{current:r}),c=P(l,c,"Primary Risk Vectors","1.0",a),c=A(l,14,c,180,t.topRisks.slice(0,5).map(e=>({label:e.title,value:e.score,color:e.score>10?n:e.score>5?i:s})),"Top Matrix Scores"),b(l,r,a),E(l,`DCMOC_RiskProfile_${e.name}_${new Date().toISOString().slice(0,10)}.pdf`)},W=async(e,t,o,a)=>{var r;let s,d,u,h,C,{doc:m,autoTable:g}=await I(a),y=1;v(m,"Carbon & ESG\nFootprint Report",`Sustainability Profile for ${e.name}`,{client:"Sustainability Office",date:O()},a),m.addPage(),y++,T(m,"ESG Executive Summary",`Rating: ${t.efficiencyRating}`,a);let p=35;$(m,14,35,42,24,"Emissions",`${M(t.annualEmissionsTonCO2)} tCO₂`,"Scope 1+2+3"),$(m,60,p,42,24,"Effective PUE",`${t.pueEfficiency.toFixed(2)}`,"Design target"),$(m,106,p,42,24,"Tax Exposure",M(t.carbonTaxExposureUSD),"Potential liability"),$(m,152,p,42,24,"Renewable",`${t.renewableReductionPct}%`,"Offset percentage"),p+=35,p=w(m,p,o),p=S(m,p,80,{current:y}),p=P(m,p,"Emissions Breakdown","1.0",a);let f=[{label:"Scope 1 (Direct)",value:t.scope1,color:n},{label:"Scope 2 (Grid)",value:t.scope2,color:i},{label:"Scope 3 (Supply)",value:t.scope3,color:l}];r=p,m.setFontSize(10),m.setFont("helvetica","bold"),m.setTextColor(...c),m.text("GHG Protocol Scopes",14,r+8),s=f.reduce((e,t)=>e+t.value,0),d=14,u=r+15,f.forEach(e=>{let t=e.value/s*180;t>0&&(m.setFillColor(...e.color),m.rect(d,u,t,10,"F"),d+=t)}),h=u+18,C=0,f.forEach(e=>{C>2&&(C=0,h+=8);let t=14+60*C;m.setFillColor(...e.color),m.circle(t+2,h-1,2,"F"),m.setFontSize(7.5),m.setFont("helvetica","normal"),m.setTextColor(...F);let o=(e.value/s*100).toFixed(1),a=e.value>=1e6?`$${(e.value/1e6).toFixed(2)}M`:e.value>=1e3?`$${(e.value/1e3).toFixed(1)}k`:`$${e.value.toFixed(0)}`;m.text(`${e.label}: ${a} (${o}%)`,t+6,h),C++}),p=S(m,p=h+10,80,{current:y}),p=P(m,p,"Carbon Reduction Investment Scenarios","2.0",a),g(m,{startY:p,head:[["Initiative","Investment","CO₂ Abatement","Est. Payback"]],body:t.reductionScenarios.map(e=>[e.name,z(e.investmentUSD),`${Math.round(e.annualSavingsTonCO2)} tCO₂/yr`,e.paybackYears>0?`${e.paybackYears} yrs`:"Immediate/PPA"]),theme:"striped",headStyles:{fillColor:(a?.primaryColor,c)},margin:{left:14,right:14}}),b(m,y,a),E(m,`DCMOC_CarbonESG_${e.name}_${new Date().toISOString().slice(0,10)}.pdf`)},U=async(e,l,n,i)=>{var r,s,u,h,C,m;let g,y,p,{doc:f,autoTable:x}=await I(n),{inputs:R,capex:z,financial:k,staffing:N,maintenance:Y,risk:B,insights:L}=l,G=1;v(f,"Master Operational Report\n& Exact Feasibility Study",`M&O Assessment for ${e.name}`,{client:"Executive Board",date:O(),version:"1.0"},n),f.addPage(),G++,T(f,"Table of Contents","Master Document Structure",n);let W=35;W=((e,o,a,l="Table of Contents")=>(e.setFontSize(16),e.setFont("helvetica","bold"),e.setTextColor(...c),e.text(l,14,o),(0,t.default)(e,{startY:o+10,head:[["Reason","Source","Validation","Pages"]],body:a.map(e=>[e.reason,e.source,e.validation,e.pages]),theme:"grid",headStyles:{fillColor:c,textColor:255,fontSize:9,fontStyle:"bold",halign:"center"},bodyStyles:{textColor:F,fontSize:8,valign:"middle"},columnStyles:{0:{cellWidth:50},1:{cellWidth:50},2:{cellWidth:60},3:{cellWidth:20,halign:"center"}},margin:{left:14,right:14}}),e.lastAutoTable.finalY+15))(f,35,[{reason:"High-Level Overview",source:"Simulation Engine",validation:"Exec Gen",pages:"3-4"},{reason:"Investment Breakdown",source:"Capex Engine",validation:"Cost Capitulation",pages:"5-6"},{reason:"TCO & Cashflow",source:"Financial Engine",validation:"NPV/IRR Formula",pages:"7-8"},{reason:"Operational Strategy",source:"Shift & Roster Engine",validation:"Cost Modeling",pages:"9-10"},{reason:"Predictive vs SFG20",source:"Maintenance Engine",validation:"Life Cycle Cost",pages:"11-12"},{reason:"Security & Reliability",source:"Risk Engine",validation:"Matrix Model",pages:"13-14"}],"Sections inside this Data Center Report"),b(f,G,n),f.addPage(),G++,T(f,"Executive Summary","C-Suite Narrative",n);let U=W=35;if(U=P(f,U,"CAPEX Assessment","1.0",n),U=w(f,U,(0,D.generateCapexSectionNarrative)(z,R.tierLevel,e.name))+10,U=P(f,U,"Return on Investment & Cashflow","1.1",n),U=w(f,U,(0,D.generateTCONarrative)(k))+10,N){U=P(f,U,"Cost Waterfall Dynamics","1.2",n);let e=k.cashflows.reduce((e,t)=>e+t.opex,0);U=w(f,U,(0,D.generateCostWaterfallNarrative)(z,k,e))+10}if(U=S(f,U,60,{current:G}),U=P(f,U,"Maintenance & Risk Stance","1.3",n),U=w(f,U,(0,D.generateMaintenanceNarrative)(Y?.strategy,Y?.sla,Y?.spares))+5,U=w(f,U,(0,D.generateRiskNarrative)(B?.aggregation)),b(f,G,n),f.addPage(),G++,T(f,"Capital Expenditure Detail","Cost Capitulation Matrix",n),r=W=35,s=z.costs,u=z.softCosts,h=z.contingency,C=z.fomTotal,m=z.total,f.setFontSize(12),f.setFont("helvetica","bold"),f.setTextColor(...c),f.text("Cost Capitulation",14,r),g=e=>`$${(e/1e6).toFixed(2)}M`,y=[],p=0,Object.entries(s).forEach(([e,t])=>{y.push([{content:e.toUpperCase(),styles:{fontStyle:"normal"}},g(t),`${(t/m*100).toFixed(1)}%`]),p+=t}),y.push([{content:"SUBTOTAL (HARD COSTS)",styles:{fontStyle:"bold",fillColor:[241,245,249]}},{content:g(p),styles:{fontStyle:"bold",fillColor:[241,245,249]}},{content:`${(p/m*100).toFixed(1)}%`,styles:{fontStyle:"bold",fillColor:[241,245,249]}}]),u.design,u.pm,y.push([{content:"Design & Engineering Fee",styles:{fontStyle:"normal"}},g(u.design||0),`${((u.design||0)/m*100).toFixed(1)}%`]),y.push([{content:"Project Management Fee",styles:{fontStyle:"normal"}},g(u.pm||0),`${((u.pm||0)/m*100).toFixed(1)}%`]),y.push([{content:"Construction Contingency",styles:{fontStyle:"normal"}},g(h),`${(h/m*100).toFixed(1)}%`]),C>0&&y.push([{content:"First of a Kind (FOM) Upgrades",styles:{fontStyle:"normal"}},g(C),`${(C/m*100).toFixed(1)}%`]),y.push([{content:"TOTAL ESTIMATED CAPEX",styles:{fontStyle:"bold",fillColor:a,textColor:255}},{content:g(m),styles:{fontStyle:"bold",fillColor:a,textColor:255}},{content:"100.0%",styles:{fontStyle:"bold",fillColor:a,textColor:255}}]),(0,t.default)(f,{startY:r+5,head:[["Cost Code / Category","Estimated Amount (USD)","% of Total"]],body:y,theme:"grid",headStyles:{fillColor:d,textColor:255,fontSize:9,fontStyle:"bold"},bodyStyles:{textColor:F,fontSize:8},columnStyles:{0:{cellWidth:90},1:{cellWidth:50,halign:"right"},2:{cellWidth:30,halign:"right"}},margin:{left:14,right:14}}),W=f.lastAutoTable.finalY+15,b(f,G,n),f.addPage(),G++,T(f,"Operational Expenditure","5-Year Tabular View",n),W=((e,o,a,l)=>{e.setFontSize(12),e.setFont("helvetica","bold"),e.setTextColor(...c),e.text("5-Year Total Cost of Ownership (TCO & Cashflow)",14,o);let n=e=>`$${(e/1e6).toFixed(2)}M`,i=a.slice(0,5);for(;i.length<5;)i.push({revenue:0,opex:0,ebitda:0,freeCashflow:0,cumulativeCashflow:0});let r=["Revenue","-",n(i[0].revenue),n(i[1].revenue),n(i[2].revenue),n(i[3].revenue),n(i[4].revenue)],s=["OPEX (Operating Expenses)","-",n(i[0].opex),n(i[1].opex),n(i[2].opex),n(i[3].opex),n(i[4].opex)],u=["CAPEX (Capital Invest)",`(${n(l)})`,"-","-","-","-","-"],h=[{content:"Free Cash Flow (FCF)",styles:{fontStyle:"bold"}},{content:`(${n(l)})`,styles:{fontStyle:"bold",textColor:[220,38,38]}}];i.forEach(e=>{h.push({content:n(e.freeCashflow),styles:{fontStyle:"bold",textColor:e.freeCashflow<0?[220,38,38]:[22,163,74]}})});let C=[{content:"Cumulative Cash Flow",styles:{fontStyle:"bold",fillColor:[241,245,249]}},{content:`(${n(l)})`,styles:{fontStyle:"bold",fillColor:[241,245,249],textColor:[220,38,38]}}];i.forEach(e=>{C.push({content:n(e.cumulativeCashflow),styles:{fontStyle:"bold",fillColor:[241,245,249],textColor:e.cumulativeCashflow<0?[220,38,38]:[22,163,74]}})});let m=[r,s,u,h,C];return(0,t.default)(e,{startY:o+5,head:[["Metric","Year 0","Year 1","Year 2","Year 3","Year 4","Year 5"]],body:m,theme:"grid",headStyles:{fillColor:d,textColor:255,fontSize:8,fontStyle:"bold",halign:"center"},bodyStyles:{textColor:F,fontSize:8,halign:"right"},columnStyles:{0:{cellWidth:45,halign:"left"}},margin:{left:14,right:14}}),e.lastAutoTable.finalY+15})(f,W=35,k.cashflows,z.total),b(f,G,n),f.addPage(),G++,i?.tornado||i?.sankey){if(T(f,"Visual Analysis","Generated Charts",n),W=35,i.sankey){W=P(f,W,"Cost Flow Analysis (Sankey)","3.0",n);try{let e=f.getImageProperties(i.sankey),t=180*e.height/e.width;f.addImage(i.sankey,"PNG",15,W,180,t),W+=t+10}catch(e){console.warn("Error adding Sankey image to PDF",e)}}if(i.tornado){W=S(f,W,100,{current:G}),W=P(f,W,"Sensitivity Analysis (Tornado)","4.0",n);try{let e=f.getImageProperties(i.tornado),t=180*e.height/e.width;f.addImage(i.tornado,"PNG",15,W,180,t)}catch(e){console.warn("Error adding Tornado image to PDF",e)}}b(f,G,n),f.addPage(),G++}if(T(f,"Shift & Roster Strategy","Detailed Personnel Plan",n),W=35,N.results){let e=N.results.reduce((e,t)=>e+t.headcount,0),t=N.results.reduce((e,t)=>e+t.monthlyCost,0);$(f,14,W,55,24,"Total Headcount",`${e}`,"FTEs across all shifts"),$(f,75,W,55,24,"Monthly OPEX",M(t),"Gross Salary + Burden"),W+=35,W=A(f,14,W,180,N.results.map(e=>({label:e.role,value:e.monthlyCost,color:e.role.includes("Engineer")?a:o})),"Monthly Cost Distribution by Role")}b(f,G,n),E(f,`DCMOC_MasterReport_${e.name}_${new Date().toISOString().slice(0,10)}.pdf`)},V=async(e,t,o)=>{let{doc:a,autoTable:l}=await I(o),n=1;v(a,"Country Intelligence\nReport",`Market Assessment for ${e.name}`,{client:"Site Selection Committee",date:O(),version:"1.0"},o),a.addPage(),n++,T(a,"Tax & Incentive Analysis",`${e.name} — Fiscal Environment`,o);let i=35,r=t.taxResult;r&&($(a,14,i,42,24,"Total Savings",M(r.totalIncentiveValue),"NPV of incentives"),$(a,60,i,42,24,"Effective Tax Y1",`${(100*r.effectiveTaxTimeline[0]).toFixed(1)}%`,`vs ${(100*e.economy.taxRate).toFixed(1)}% standard`),$(a,106,i,42,24,"NPV Uplift",M(r.npvWithIncentives-r.npvWithoutIncentives),"With incentives"),$(a,152,i,42,24,"IRR Uplift",`+${(r.irrWithIncentives-r.irrWithoutIncentives).toFixed(1)}%`,`${r.irrWithIncentives.toFixed(1)}% with incentives`),i+=35,i=P(a,i,"Tax Holiday Timeline","1.0",o),l(a,{startY:i,head:[["Period","Standard Rate","Effective Rate","Tax Savings"]],body:r.effectiveTaxTimeline.slice(0,10).map((t,o)=>[`Year ${o+1}`,`${(100*e.economy.taxRate).toFixed(1)}%`,`${(100*t).toFixed(1)}%`,M(r.yearlyTaxSavings[o]||0)]),theme:"striped",headStyles:{fillColor:c},styles:{fontSize:8,cellPadding:2},margin:{left:14,right:14},columnStyles:{3:{halign:"right",textColor:[5,150,105]}}}),i=a.lastAutoTable.finalY+10,r.incentiveSummary&&r.incentiveSummary.length>0&&(i=S(a,i,40,{current:n}),i=R(a,i,"Available Incentive Programs",r.incentiveSummary.join("\n"),"success")),e.taxIncentives?.freeTradeZones&&e.taxIncentives.freeTradeZones.length>0&&(i=S(a,i,20,{current:n}),i=w(a,i,`Free Trade Zones: ${e.taxIncentives.freeTradeZones.join(", ")}. Import duty savings: ${M(r.ftzBenefits)}.`))),b(a,n,o),a.addPage(),n++,T(a,"Natural Disaster Risk",`${e.name} — Hazard Profile`,o),i=35;let s=t.disasterResult;s&&($(a,14,i,42,24,"Risk Score",`${s.compositeScore}/100`,s.riskCategory),$(a,60,i,42,24,"Insurance/Yr",M(s.annualInsuranceCost),"Adjusted premium"),$(a,106,i,42,24,"Structural +",M(s.structuralCostAdder),"CAPEX hardening"),$(a,152,i,42,24,"Revenue @ Risk",M(s.revenueAtRisk),`${s.businessInterruptionDays} days interruption`),i+=35,i=P(a,i,"Risk Factor Breakdown","2.0",o),l(a,{startY:i,head:[["Hazard Type","Score","Impact Assessment"]],body:s.riskBreakdown.map(e=>[e.type,`${e.score}/100`,e.impact]),theme:"striped",headStyles:{fillColor:c},styles:{fontSize:8,cellPadding:2},margin:{left:14,right:14}}),i=a.lastAutoTable.finalY+10,s.mitigationOptions&&s.mitigationOptions.length>0&&(i=S(a,i,60,{current:n}),i=P(a,i,"Mitigation Recommendations","2.1",o),l(a,{startY:i,head:[["Measure","Cost","Annual Benefit","ROI"]],body:s.mitigationOptions.map(e=>[e.name,M(e.cost),M(e.annualBenefit),`${e.roiPercent}%`]),theme:"striped",headStyles:{fillColor:c},styles:{fontSize:8,cellPadding:2},margin:{left:14,right:14},columnStyles:{3:{halign:"right",textColor:[5,150,105]}}}),i=a.lastAutoTable.finalY+10)),b(a,n,o),a.addPage(),n++,T(a,"Grid Reliability Index",`${e.name} — Power Infrastructure`,o),i=35;let d=t.gridResult;if(d){if($(a,14,i,35,24,"Grid Score",`${d.reliabilityScore}`,`Grade ${d.reliabilityGrade}`),$(a,53,i,35,24,"Outage Hrs/Yr",`${(d.annualOutageMinutes/60).toFixed(1)}`,`${d.annualExpectedOutages} events`),$(a,92,i,35,24,"Gen Capacity",`${d.requiredGenCapacity} kW`,`${d.recommendedFuelHours}h fuel`),$(a,131,i,35,24,"Fuel Cost/Yr",M(d.annualFuelCost),"Backup operations"),$(a,170,i,24,24,"Solar",`${d.solarViabilityScore}`,"/100"),i+=35,i=P(a,i,"Grid Risk Cost Breakdown","3.0",o),d.costBreakdown){let e=d.costBreakdown.map(e=>[e.label,z(e.value)]);e.push(["Total Grid-Adjusted OPEX",z(d.gridRiskAdjustedOpex)]),l(a,{startY:i,head:[["Cost Component","Annual Cost"]],body:e,theme:"striped",headStyles:{fillColor:c},styles:{fontSize:8,cellPadding:2},margin:{left:14,right:14},columnStyles:{1:{halign:"right"}}}),i=a.lastAutoTable.finalY+10}i=S(a,i,40,{current:n}),i=R(a,i,"Backup Power Architecture",`Grid Feed ${d.dualFeedRecommendation?"(Dual A+B)":"(Single)"} → ATS → UPS (${t.itLoadKw} kW)
Generator: ${d.requiredGenCapacity} kW (${d.recommendedFuelHours}h fuel reserve)
Availability with Backup: ${d.availabilityWithBackup.toFixed(3)}%
BESS ROI: ${d.batteryStorageROI<50?`${d.batteryStorageROI} year payback`:"Not recommended"}`,"info")}b(a,n,o),a.addPage(),n++,T(a,"Talent Availability Index",`${e.name} — Workforce Assessment`,o),i=35;let u=t.talentResult;u&&($(a,14,i,42,24,"Talent Score",`${u.talentScore}/100`,u.hiringDifficulty),$(a,60,i,42,24,"Salary Premium",`+${((u.adjustedSalaryMultiplier-1)*100).toFixed(0)}%`,M(u.adjustedAnnualStaffCost-t.annualStaffCost)+"/yr extra"),$(a,106,i,42,24,"Time to Staff",`${u.timeToFullStaff} mo`,"Months to full team"),$(a,152,i,42,24,"Turnover",`${(100*u.adjustedTurnoverRate).toFixed(0)}%`,M(u.annualTurnoverCost)+"/yr"),i+=35,i=P(a,i,"Talent Factor Analysis","4.0",o),u.talentBreakdown&&(l(a,{startY:i,head:[["Factor","Value","Impact"]],body:u.talentBreakdown.map(e=>[e.metric,e.value,e.impact]),theme:"striped",headStyles:{fillColor:c},styles:{fontSize:8,cellPadding:2},margin:{left:14,right:14}}),i=a.lastAutoTable.finalY+10),i=S(a,i,50,{current:n}),i=P(a,i,"Annual Staff Cost Impact","4.1",o),l(a,{startY:i,head:[["Component","Amount"]],body:[["Base Annual Staff Cost",z(t.annualStaffCost)],[`+ Salary Premium (${((u.adjustedSalaryMultiplier-1)*100).toFixed(0)}%)`,`+${z(u.adjustedAnnualStaffCost-t.annualStaffCost)}`],["+ Turnover Cost",`+${z(u.annualTurnoverCost)}`],["+ Training Cost",`+${z(u.annualTrainingCost)}`],["+ Recruitment Cost",`+${z(u.totalRecruitmentCost)}`],["Talent-Adjusted Total",z(u.adjustedAnnualStaffCost+u.annualTurnoverCost+u.annualTrainingCost)]],theme:"striped",headStyles:{fillColor:c},styles:{fontSize:8,cellPadding:2},margin:{left:14,right:14},columnStyles:{1:{halign:"right"}}})),b(a,n,o),E(a,`DCMOC_CountryIntel_${e.name}_${new Date().toISOString().slice(0,10)}.pdf`)},_=async(e,t,l)=>{let{doc:n,autoTable:i}=await I(l),r=1;v(n,"Capacity Planning\n& Phased Investment",`Multi-Phase Build Strategy for ${e.name}`,{client:"Infrastructure Planning",date:O(),version:"1.0"},l),n.addPage(),r++,T(n,"Capacity Plan Overview",`${t.capPlan.phases.length} Phases — ${M(t.capPlan.totalItLoadKw)} kW Total`,l);let s=35;$(n,14,35,42,24,"Total Capacity",`${(t.capPlan.totalItLoadKw/1e3).toFixed(1)} MW`,`${t.capPlan.phases.length} phases`),$(n,60,s,42,24,"Total CAPEX",M(t.capPlan.totalCapex),`$${Math.round(t.capPlan.totalCapex/t.capPlan.totalItLoadKw).toLocaleString()}/kW`),$(n,106,s,42,24,"Scalability",`${t.capPlan.scalabilityScore}/100`,"Phase efficiency score"),$(n,152,s,42,24,"Avg Utilization",`${(100*t.capPlan.phaseEfficiency).toFixed(0)}%`,"Across all phases"),s+=35,s=P(n,s,"Phase-by-Phase Breakdown","1.0",l);let d=t.capPlan.phases.map((e,o)=>[t.phases[o]?.label||`Phase ${o+1}`,`${e.itLoadKw.toLocaleString()} kW`,M(e.capex),`$${Math.round(e.capexPerKw).toLocaleString()}`,`${e.headcount} FTE`,e.pue.toFixed(2),`M${t.phases[o]?.startMonth||0}`,`${t.phases[o]?.buildMonths||0} mo`]);i(n,{startY:s,head:[["Phase","IT Load","CAPEX","$/kW","Staff","PUE","Start","Build"]],body:d,theme:"striped",headStyles:{fillColor:c},styles:{fontSize:8,cellPadding:2},margin:{left:14,right:14},columnStyles:{2:{halign:"right"},3:{halign:"right"},4:{halign:"right"}}}),s=n.lastAutoTable.finalY+10,s=S(n,s,50,{current:r}),s=P(n,s,"Build Timeline","1.1",l),t.capPlan.timeline.forEach((e,t)=>{s=S(n,s,12,{current:r}),n.setFillColor(...t%2==0?o:a),n.circle(18,s+2,2,"F"),n.setFont("helvetica","bold"),n.setFontSize(8),n.setTextColor(...c),n.text(e.label,24,s+3),n.setFont("helvetica","normal"),n.setFontSize(7),n.setTextColor(...C),n.text(`M${e.startMonth} → M${e.endMonth} (${e.type})`,80,s+3),s+=8}),b(n,r,l),n.addPage(),r++,T(n,"Staffing & PUE Evolution","Resource Scaling Over Time",l),s=P(n,s=35,"Staffing Ramp","2.0",l);let u=t.capPlan.staffingRamp.filter((e,o)=>o%6==0||o===t.capPlan.staffingRamp.length-1).map(e=>[`Month ${e.month}`,`${e.fte} FTE`]);i(n,{startY:s,head:[["Month","Total FTE"]],body:u,theme:"striped",headStyles:{fillColor:c},styles:{fontSize:8,cellPadding:2},margin:{left:14,right:100}}),s=n.lastAutoTable.finalY+10,s=S(n,s,50,{current:r}),s=P(n,s,"PUE Evolution","2.1",l);let h=t.capPlan.pueEvolution.filter((e,o)=>o%6==0||o===t.capPlan.pueEvolution.length-1).map(e=>[`Month ${e.month}`,e.pue.toFixed(3)]);if(i(n,{startY:s,head:[["Month","PUE"]],body:h,theme:"striped",headStyles:{fillColor:c},styles:{fontSize:8,cellPadding:2},margin:{left:14,right:100}}),s=n.lastAutoTable.finalY+10,t.phasedFinancials){b(n,r,l),n.addPage(),r++,T(n,"Phased Financial Analysis","Per-Phase & Blended Investment Returns",l),s=35;let e=t.phasedFinancials;if($(n,14,s,42,24,"Blended IRR",`${e.blendedIRR?.toFixed(1)||"N/A"}%`,"Weighted by investment"),$(n,60,s,42,24,"Total NPV",M(e.totalNPV||0),"All phases combined"),$(n,106,s,42,24,"Payback",`${e.weightedPayback?.toFixed(1)||"N/A"} yr`,"Weighted average"),$(n,152,s,42,24,"Investment",M(e.totalInvestment||t.capPlan.totalCapex),"Total capital deployed"),s+=35,s=P(n,s,"Investment Decision Matrix","3.0",l),e.phaseResults){let t=e.phaseResults.map(e=>[e.label,M(e.capex),`${e.irr?.toFixed(1)||"N/A"}%`,M(e.npv||0),`${e.payback?.toFixed(1)||"N/A"} yr`,e.irr>=12?"GO":e.irr>=8?"CONDITIONAL":"NO-GO"]);i(n,{startY:s,head:[["Phase","CAPEX","IRR","NPV","Payback","Decision"]],body:t,theme:"striped",headStyles:{fillColor:c},styles:{fontSize:8,cellPadding:2},margin:{left:14,right:14},columnStyles:{1:{halign:"right"},2:{halign:"right"},3:{halign:"right"},4:{halign:"right"}}})}}b(n,r,l),E(n,`DCMOC_CapacityPlan_${e.name}_${new Date().toISOString().slice(0,10)}.pdf`)};e.s(["generateCapacityPlanPDF",0,_,"generateCapexPDF",0,Y,"generateCarbonPDF",0,W,"generateCountryIntelPDF",0,V,"generateDetailedPDF",0,N,"generateFinancialPDF",0,L,"generateMaintenancePDF",0,B,"generateMasterReportPDF",0,U,"generateRiskPDF",0,G,"generateSimulationPDF",0,N,"generateStaffingPDF",0,k],32737)}]);