(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,60837,e=>{"use strict";e.s(["ASSETS",0,[{id:"gen-set",name:"Diesel Generator (2.5MW)",category:"Critical Power",defaultRedundancy:"N+1",maintenanceTasks:[{id:"gen-m",name:"Visual Inspection & Run Test (No Load)",frequency:"Monthly",category:"Mechanical",criticality:"Statutory",standardHours:.5,requiresShutdown:!1},{id:"gen-q",name:"Fuel Cleaning & Filter Check",frequency:"Quarterly",category:"Mechanical",criticality:"Optimal",standardHours:4,requiresShutdown:!1},{id:"gen-a",name:"Full Load Bank Test (4 Hours)",frequency:"Annual",category:"Electrical",criticality:"Statutory",standardHours:12,requiresShutdown:!0},{id:"gen-bi",name:"Vibration Analysis",frequency:"Bi-Annual",category:"Mechanical",criticality:"Optimal",standardHours:2,requiresShutdown:!1}],consumables:[{name:"Fuel Filters",baseLifeMonths:12,costPerUnit:150},{name:"Air Filters",baseLifeMonths:12,costPerUnit:200},{name:"Engine Oil (200L)",baseLifeMonths:12,costPerUnit:1200},{name:"Coolant (50L)",baseLifeMonths:24,costPerUnit:350},{name:"Oil Filters",baseLifeMonths:6,costPerUnit:85}],criticalSpares:[{name:"AVR (Automatic Voltage Regulator)",stockPercent:.25,minStock:1,costPerUnit:8500,leadTimeWeeks:12},{name:"Fuel Injector Set",stockPercent:.1,minStock:1,costPerUnit:4200,leadTimeWeeks:8},{name:"Turbocharger Assembly",stockPercent:.1,minStock:1,costPerUnit:12e3,leadTimeWeeks:16},{name:"Water Pump",stockPercent:.25,minStock:1,costPerUnit:2800,leadTimeWeeks:6},{name:"Starter Motor",stockPercent:.25,minStock:1,costPerUnit:3500,leadTimeWeeks:8},{name:"Gasket & Seal Kit",stockPercent:.5,minStock:2,costPerUnit:1200,leadTimeWeeks:4},{name:"Belt Kit (Alternator/Fan)",stockPercent:.5,minStock:2,costPerUnit:450,leadTimeWeeks:2},{name:"Radiator Core",stockPercent:.1,minStock:1,costPerUnit:6500,leadTimeWeeks:12}]},{id:"ups-module",name:"UPS Module (500kVA)",category:"Critical Power",defaultRedundancy:"2N",maintenanceTasks:[{id:"ups-m",name:"Display Check & Environment Log",frequency:"Monthly",category:"Electrical",criticality:"Optimal",standardHours:.5,requiresShutdown:!1},{id:"ups-bi",name:"Capacitor & Fan Inspection",frequency:"Bi-Annual",category:"Electrical",criticality:"Statutory",standardHours:4,requiresShutdown:!0},{id:"ups-a",name:"Thermal Scan & Battery Discharge",frequency:"Annual",category:"Electrical",criticality:"Statutory",standardHours:6,requiresShutdown:!1},{id:"ups-firm",name:"Firmware Update",frequency:"Annual",category:"Electrical",criticality:"Discretionary",standardHours:2,requiresShutdown:!0}],consumables:[{name:"DC Capacitors",baseLifeMonths:60,costPerUnit:1200},{name:"Fans",baseLifeMonths:48,costPerUnit:300}],criticalSpares:[{name:"UPS Power Module (500kVA)",stockPercent:.05,minStock:1,costPerUnit:45e3,leadTimeWeeks:16},{name:"Static Switch / SCR Module",stockPercent:.05,minStock:1,costPerUnit:18e3,leadTimeWeeks:12},{name:"Control Board / Logic Card",stockPercent:.1,minStock:1,costPerUnit:8500,leadTimeWeeks:8},{name:"DC Bus Capacitor Bank",stockPercent:.1,minStock:1,costPerUnit:5200,leadTimeWeeks:10},{name:"Fan Tray Assembly",stockPercent:.15,minStock:2,costPerUnit:1800,leadTimeWeeks:4}]},{id:"lv-switchgear",name:"LV Switchboard (Main)",category:"Critical Power",defaultRedundancy:"2N",maintenanceTasks:[{id:"lvsb-m",name:"Visual Inspection & Meter Reading",frequency:"Monthly",category:"Electrical",criticality:"Statutory",standardHours:.5,requiresShutdown:!1},{id:"lvsb-a",name:"Thermal Scanning (Terminations)",frequency:"Annual",category:"Electrical",criticality:"Statutory",standardHours:2,requiresShutdown:!1},{id:"lvsb-3y",name:"Busbar Torque Check & Clean",frequency:"Annual",category:"Electrical",criticality:"Optimal",standardHours:8,requiresShutdown:!0},{id:"lvsb-pd",name:"Partial Discharge Testing",frequency:"Annual",category:"Specialist",criticality:"Optimal",standardHours:4,requiresShutdown:!1}],criticalSpares:[{name:"ACB (Air Circuit Breaker) 3200A",stockPercent:.05,minStock:1,costPerUnit:28e3,leadTimeWeeks:16},{name:"ACB (Air Circuit Breaker) 1600A",stockPercent:.05,minStock:1,costPerUnit:18e3,leadTimeWeeks:12},{name:"MCCB 630A",stockPercent:.1,minStock:2,costPerUnit:2800,leadTimeWeeks:4},{name:"MCCB 250A",stockPercent:.1,minStock:2,costPerUnit:1200,leadTimeWeeks:3},{name:"Shunt Trip Coil",stockPercent:.15,minStock:3,costPerUnit:350,leadTimeWeeks:2},{name:"CT (Current Transformer) Set",stockPercent:.1,minStock:2,costPerUnit:800,leadTimeWeeks:4},{name:"Power Meter Module",stockPercent:.1,minStock:2,costPerUnit:1500,leadTimeWeeks:6}]},{id:"transformer",name:"MV/LV Transformer (2.5MVA)",category:"Critical Power",defaultRedundancy:"N+1",maintenanceTasks:[{id:"tx-m",name:"Temp/Pressure Gauge Check",frequency:"Monthly",category:"Electrical",criticality:"Statutory",standardHours:.25,requiresShutdown:!1},{id:"tx-a",name:"Oil Sampling (DGA Analysis)",frequency:"Annual",category:"Specialist",criticality:"Statutory",standardHours:1,requiresShutdown:!1},{id:"tx-bi",name:"Enclosure Cleaning & Bolt Torque",frequency:"Annual",category:"Electrical",criticality:"Optimal",standardHours:4,requiresShutdown:!0}]},{id:"chiller-air",name:"Air Cooled Chiller (1000kW)",category:"Cooling",defaultRedundancy:"N+1",maintenanceTasks:[{id:"chi-m",name:"Refrigerant Pressure & Leak Check",frequency:"Monthly",category:"Mechanical",criticality:"Statutory",standardHours:1,requiresShutdown:!1},{id:"chi-q",name:"Condenser Coil Cleaning",frequency:"Quarterly",category:"Mechanical",criticality:"Optimal",standardHours:6,requiresShutdown:!1},{id:"chi-leg",name:"Legionella Water Testing",frequency:"Monthly",category:"Mechanical",criticality:"Statutory",standardHours:2,requiresShutdown:!1},{id:"chi-tube",name:"Condenser Tube Brushing",frequency:"Annual",category:"Mechanical",criticality:"Optimal",standardHours:16,requiresShutdown:!0}],consumables:[{name:"Compressor Oil",baseLifeMonths:24,costPerUnit:400},{name:"Biocide Chemicals",baseLifeMonths:1,costPerUnit:100}],criticalSpares:[{name:"Compressor Assembly",stockPercent:.1,minStock:1,costPerUnit:35e3,leadTimeWeeks:20},{name:"VFD (Variable Frequency Drive)",stockPercent:.1,minStock:1,costPerUnit:12e3,leadTimeWeeks:12},{name:"Expansion Valve",stockPercent:.15,minStock:1,costPerUnit:3200,leadTimeWeeks:6},{name:"Pressure Transducer Set",stockPercent:.2,minStock:2,costPerUnit:800,leadTimeWeeks:4},{name:"Temperature Sensor (PT1000)",stockPercent:.2,minStock:4,costPerUnit:250,leadTimeWeeks:2},{name:"Condenser Fan Motor",stockPercent:.1,minStock:1,costPerUnit:4500,leadTimeWeeks:8}]},{id:"pac-unit",name:"CRAC/CRAH Unit (100kW)",category:"Cooling",defaultRedundancy:"N+20%",maintenanceTasks:[{id:"pac-m",name:"Filter Check & Belt Tension",frequency:"Monthly",category:"Mechanical",criticality:"Statutory",standardHours:.5,requiresShutdown:!1},{id:"pac-q-hum",name:"Humidifier Canister Check",frequency:"Quarterly",category:"Mechanical",criticality:"Optimal",standardHours:1,requiresShutdown:!1},{id:"pac-a-motor",name:"Motor Bearing Inspection",frequency:"Annual",category:"Mechanical",criticality:"Optimal",standardHours:2,requiresShutdown:!0}],consumables:[{name:"G4 Pre-Filters",baseLifeMonths:3,costPerUnit:45},{name:"Humidifier Bottle",baseLifeMonths:12,costPerUnit:180},{name:"Fan Belts",baseLifeMonths:12,costPerUnit:60}],criticalSpares:[{name:"EC Fan Motor Assembly",stockPercent:.1,minStock:1,costPerUnit:3800,leadTimeWeeks:8},{name:"Control Valve Actuator",stockPercent:.15,minStock:1,costPerUnit:1200,leadTimeWeeks:4},{name:"Humidity Sensor",stockPercent:.2,minStock:2,costPerUnit:450,leadTimeWeeks:2},{name:"Controller Board",stockPercent:.1,minStock:1,costPerUnit:2800,leadTimeWeeks:8}]},{id:"fcu",name:"FCU / VRV (Office/Corridor)",category:"Cooling",defaultRedundancy:"N",maintenanceTasks:[{id:"fcu-q",name:"Filter Cleaning & Drain Tray",frequency:"Quarterly",category:"Mechanical",criticality:"Optimal",standardHours:1,requiresShutdown:!1},{id:"fcu-a",name:"Chemical Coil Cleaning",frequency:"Annual",category:"Mechanical",criticality:"Optimal",standardHours:2,requiresShutdown:!1}]},{id:"fire-suppression",name:"Gas Suppression Cylinder (Novec/IG541)",category:"Fire Safety",defaultRedundancy:"N",maintenanceTasks:[{id:"gas-ba",name:"Level/Pressure Check & Weighing",frequency:"Bi-Annual",category:"Specialist",criticality:"Statutory",standardHours:.5,requiresShutdown:!1},{id:"gas-5y",name:"Hydrostatic Testing",frequency:"Annual",category:"Specialist",criticality:"Statutory",standardHours:4,requiresShutdown:!1}]},{id:"vesda",name:"VESDA Detector",category:"Fire Safety",defaultRedundancy:"N",maintenanceTasks:[{id:"vesda-q",name:"Filter Check & Purge",frequency:"Quarterly",category:"Specialist",criticality:"Optimal",standardHours:.5,requiresShutdown:!1},{id:"vesda-a",name:"Sampling Pipe Blow-through",frequency:"Annual",category:"Specialist",criticality:"Optimal",standardHours:1,requiresShutdown:!1}],consumables:[{name:"VESDA Filter Cartridge",baseLifeMonths:12,costPerUnit:120}]},{id:"fire-panel",name:"Fire Alarm Control Panel (Addressable)",category:"Fire Safety",defaultRedundancy:"N",maintenanceTasks:[{id:"fip-w",name:"System Status Check",frequency:"Monthly",category:"Security",criticality:"Statutory",standardHours:.2,requiresShutdown:!1},{id:"fip-a",name:"Full Loop Test (100% Devices)",frequency:"Annual",category:"Specialist",criticality:"Statutory",standardHours:24,requiresShutdown:!1}]},{id:"fuel-polisher",name:"Fuel Polishing Unit",category:"Fuel System",defaultRedundancy:"N",maintenanceTasks:[{id:"fuel-m",name:"Filter DP Check",frequency:"Monthly",category:"Mechanical",criticality:"Optimal",standardHours:.25,requiresShutdown:!1},{id:"fuel-bi",name:"Filter Replacement",frequency:"Bi-Annual",category:"Mechanical",criticality:"Optimal",standardHours:2,requiresShutdown:!0}],consumables:[{name:"Coalescer Filters",baseLifeMonths:6,costPerUnit:350},{name:"Separator Filters",baseLifeMonths:6,costPerUnit:280}],criticalSpares:[{name:"Transfer Pump",stockPercent:.25,minStock:1,costPerUnit:2200,leadTimeWeeks:6},{name:"Solenoid Valve",stockPercent:.2,minStock:1,costPerUnit:450,leadTimeWeeks:3}]},{id:"bulk-tank",name:"Bulk Fuel Tank (20,000L)",category:"Fuel System",defaultRedundancy:"N+1",maintenanceTasks:[{id:"tank-a",name:"Tank Cleaning & Sludge Removal",frequency:"Annual",category:"Specialist",criticality:"Optimal",standardHours:8,requiresShutdown:!1},{id:"tank-NDT",name:"Thickness Testing (NDT)",frequency:"Annual",category:"Specialist",criticality:"Statutory",standardHours:4,requiresShutdown:!1}]},{id:"sand-filter",name:"Sand Filter (Multimedia)",category:"Water Treatment",defaultRedundancy:"N",maintenanceTasks:[{id:"sand-w",name:"Backwash Cycle Check",frequency:"Monthly",category:"Mechanical",criticality:"Optimal",standardHours:.5,requiresShutdown:!1},{id:"sand-a",name:"Media Replacement",frequency:"Annual",category:"Mechanical",criticality:"Optimal",standardHours:6,requiresShutdown:!0}]},{id:"dosing-pump",name:"Chemical Dosing Pump",category:"Water Treatment",defaultRedundancy:"N+1",maintenanceTasks:[{id:"dose-m",name:"Liquid Level & Stroke Check",frequency:"Monthly",category:"Mechanical",criticality:"Statutory",standardHours:.25,requiresShutdown:!1},{id:"dose-a",name:"Diaphragm Replacement",frequency:"Annual",category:"Mechanical",criticality:"Statutory",standardHours:1,requiresShutdown:!0}]},{id:"bms-server",name:"BMS Server / Workstation",category:"BMS & IT",defaultRedundancy:"N",maintenanceTasks:[{id:"bms-m",name:"Database Backup & Health Check",frequency:"Monthly",category:"BMS & IT",criticality:"Optimal",standardHours:1,requiresShutdown:!1},{id:"bms-q",name:"OS Patching & Security Audit",frequency:"Quarterly",category:"BMS & IT",criticality:"Statutory",standardHours:2,requiresShutdown:!0}],criticalSpares:[{name:"Server SSD (Hot-swap)",stockPercent:.2,minStock:2,costPerUnit:800,leadTimeWeeks:2},{name:"Server PSU Module",stockPercent:.15,minStock:1,costPerUnit:650,leadTimeWeeks:3}]},{id:"plc-hmi",name:"PLC / DDC Controller + HMI",category:"BMS & IT",defaultRedundancy:"N+1",maintenanceTasks:[{id:"plc-q",name:"Program Backup & Battery Check",frequency:"Quarterly",category:"BMS & IT",criticality:"Statutory",standardHours:1,requiresShutdown:!1},{id:"plc-a",name:"I/O Module Verification & Firmware",frequency:"Annual",category:"BMS & IT",criticality:"Optimal",standardHours:4,requiresShutdown:!0}],criticalSpares:[{name:"PLC CPU Module",stockPercent:.1,minStock:1,costPerUnit:5500,leadTimeWeeks:10},{name:"PLC I/O Module (DI/DO)",stockPercent:.15,minStock:2,costPerUnit:1800,leadTimeWeeks:6},{name:"PLC I/O Module (AI/AO)",stockPercent:.15,minStock:2,costPerUnit:2200,leadTimeWeeks:6},{name:'HMI Touch Panel 10"',stockPercent:.1,minStock:1,costPerUnit:3200,leadTimeWeeks:8},{name:"PLC Battery (Lithium)",stockPercent:.5,minStock:4,costPerUnit:35,leadTimeWeeks:1},{name:"Communication Module (Modbus/BACnet)",stockPercent:.15,minStock:1,costPerUnit:1500,leadTimeWeeks:6}]},{id:"field-sensor",name:"Field Sensors (Temp/Pressure/Flow)",category:"BMS & IT",defaultRedundancy:"N",maintenanceTasks:[{id:"sens-a",name:"Calibration Verification",frequency:"Annual",category:"BMS & IT",criticality:"Statutory",standardHours:.5,requiresShutdown:!1}],criticalSpares:[{name:"Temperature Sensor (PT100/PT1000)",stockPercent:.05,minStock:4,costPerUnit:180,leadTimeWeeks:2},{name:"Pressure Transmitter (4-20mA)",stockPercent:.05,minStock:2,costPerUnit:650,leadTimeWeeks:4},{name:"Flow Meter (Electromagnetic)",stockPercent:.05,minStock:1,costPerUnit:3500,leadTimeWeeks:8},{name:"Differential Pressure Switch",stockPercent:.1,minStock:2,costPerUnit:320,leadTimeWeeks:3},{name:"Level Transmitter",stockPercent:.05,minStock:1,costPerUnit:850,leadTimeWeeks:4}]},{id:"cctv",name:"CCTV Camera",category:"Security",defaultRedundancy:"N",maintenanceTasks:[{id:"cctv-q",name:"Lens Cleaning & Focus Check",frequency:"Quarterly",category:"Security",criticality:"Optimal",standardHours:.25,requiresShutdown:!1}]},{id:"access-control",name:"Biometric/Card Reader",category:"Security",defaultRedundancy:"N",maintenanceTasks:[{id:"ac-bi",name:"Function Test & database sync",frequency:"Bi-Annual",category:"Security",criticality:"Statutory",standardHours:.25,requiresShutdown:!1}]},{id:"boom-gate",name:"Boom Gate / Turnstile",category:"Security",defaultRedundancy:"N",maintenanceTasks:[{id:"bg-q",name:"Mechanism Lub & Safety Loop Test",frequency:"Quarterly",category:"Security",criticality:"Optimal",standardHours:1,requiresShutdown:!1}]},{id:"loading-dock",name:"Loading Dock Leveler",category:"Civil",defaultRedundancy:"N",maintenanceTasks:[{id:"dock-q",name:"Hydraulic Oil & Hinge Check",frequency:"Quarterly",category:"Mechanical",criticality:"Optimal",standardHours:1,requiresShutdown:!1},{id:"dock-a",name:"Load Test & Service",frequency:"Annual",category:"Mechanical",criticality:"Statutory",standardHours:2,requiresShutdown:!0}]},{id:"mewp",name:"MEWP (Scissor Lift)",category:"Civil",defaultRedundancy:"N",maintenanceTasks:[{id:"mewp-m",name:"Battery & Hydraulic Check",frequency:"Monthly",category:"Mechanical",criticality:"Statutory",standardHours:.5,requiresShutdown:!1},{id:"mewp-a",name:"Certification Inspection (LOLA)",frequency:"Annual",category:"Specialist",criticality:"Statutory",standardHours:2,requiresShutdown:!0}]},{id:"vent-fan",name:"Ventilation / Extract Fan",category:"Cooling",defaultRedundancy:"N+1",maintenanceTasks:[{id:"fan-q",name:"Belt & Bearing Check",frequency:"Quarterly",category:"Mechanical",criticality:"Optimal",standardHours:1,requiresShutdown:!1}]},{id:"ro-unit",name:"Reverse Osmosis Unit",category:"Water Treatment",defaultRedundancy:"N+1",maintenanceTasks:[{id:"ro-m",name:"Membrane Pressure Check",frequency:"Monthly",category:"Mechanical",criticality:"Optimal",standardHours:.5,requiresShutdown:!1},{id:"ro-a",name:"Membrane Cleaning / Replacement",frequency:"Annual",category:"Specialist",criticality:"Optimal",standardHours:6,requiresShutdown:!0}],consumables:[{name:"RO Membrane Element",baseLifeMonths:36,costPerUnit:2800},{name:"Pre-Filter Cartridge (5μm)",baseLifeMonths:3,costPerUnit:45},{name:"Antiscalant Chemical (25L)",baseLifeMonths:3,costPerUnit:180}],criticalSpares:[{name:"High Pressure Pump",stockPercent:.25,minStock:1,costPerUnit:4500,leadTimeWeeks:10},{name:"Pressure Vessel",stockPercent:.1,minStock:1,costPerUnit:1800,leadTimeWeeks:8},{name:"Conductivity Sensor",stockPercent:.2,minStock:2,costPerUnit:350,leadTimeWeeks:2}]}]])},71524,e=>{"use strict";var t=e.i(33107);let a=[6,182,212],r={primary:a,secondary:[16,185,129],accent:[99,102,241],danger:[244,63,94],warning:[245,158,11],success:[34,197,94],info:[59,130,246],slate900:[15,23,42],slate800:[30,41,59],slate700:[51,65,85],slate600:[71,85,105],slate500:[100,116,139],slate400:[148,163,184],slate300:[203,213,225],slate200:[226,232,240],slate100:[241,245,249],slate50:[248,250,252],text:[51,65,85],textLight:[100,116,139],white:[255,255,255],black:[0,0,0]},n=182,i=e=>{let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:a},o=(e,t,a)=>{let n=e.internal.pageSize.width,i=e.internal.pageSize.height;e.setDrawColor(...r.slate200),e.line(14,i-15,n-14,i-15),e.setFontSize(7),e.setTextColor(...r.slate400);let o=new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),l=a?.companyName?a.companyName:"DCMOC v2.0";e.text(`Generated ${o} | ${l} | CONFIDENTIAL`,14,i-8),e.text(`Page ${t}`,n-14,i-8,{align:"right"})},l=async t=>{let a=await e.A(73880),r=null;r=a.default&&"function"==typeof a.default?a.default:a.jsPDF?a.jsPDF:a.default||a;let n=await e.A(34642),i=n.default||n;if(!r)throw Error("Failed to load jsPDF constructor");return{doc:new r({orientation:"portrait",unit:"mm",format:"a4"}),autoTable:(e,t)=>{if("function"==typeof i)return i(e,t);if("function"==typeof e.autoTable)return e.autoTable(t);throw Error("autoTable plugin not found — jspdf-autotable failed to load")}}};e.s(["PDF_COLORS",0,r,"draw5YearTCOTable",0,(e,a,n,i)=>{e.setFontSize(12),e.setFont("helvetica","bold"),e.setTextColor(...r.slate900),e.text("5-Year Total Cost of Ownership (TCO & Cashflow)",14,a);let o=e=>`$${(e/1e6).toFixed(2)}M`,l=n.slice(0,5);for(;l.length<5;)l.push({revenue:0,opex:0,ebitda:0,freeCashflow:0,cumulativeCashflow:0});let s=["Revenue","-",o(l[0].revenue),o(l[1].revenue),o(l[2].revenue),o(l[3].revenue),o(l[4].revenue)],d=["OPEX (Operating Expenses)","-",o(l[0].opex),o(l[1].opex),o(l[2].opex),o(l[3].opex),o(l[4].opex)],c=["CAPEX (Capital Invest)",`(${o(i)})`,"-","-","-","-","-"],u=[{content:"Free Cash Flow (FCF)",styles:{fontStyle:"bold"}},{content:`(${o(i)})`,styles:{fontStyle:"bold",textColor:[220,38,38]}}];l.forEach(e=>{u.push({content:o(e.freeCashflow),styles:{fontStyle:"bold",textColor:e.freeCashflow<0?[220,38,38]:[22,163,74]}})});let m=[{content:"Cumulative Cash Flow",styles:{fontStyle:"bold",fillColor:[241,245,249]}},{content:`(${o(i)})`,styles:{fontStyle:"bold",fillColor:[241,245,249],textColor:[220,38,38]}}];l.forEach(e=>{m.push({content:o(e.cumulativeCashflow),styles:{fontStyle:"bold",fillColor:[241,245,249],textColor:e.cumulativeCashflow<0?[220,38,38]:[22,163,74]}})});let y=[s,d,c,u,m];return(0,t.default)(e,{startY:a+5,head:[["Metric","Year 0","Year 1","Year 2","Year 3","Year 4","Year 5"]],body:y,theme:"grid",headStyles:{fillColor:r.slate800,textColor:255,fontSize:8,fontStyle:"bold",halign:"center"},bodyStyles:{textColor:r.text,fontSize:8,halign:"right"},columnStyles:{0:{cellWidth:45,halign:"left"}},margin:{left:14,right:14}}),e.lastAutoTable.finalY+15},"drawComparisonTable",0,(e,t,a,i)=>{e.setFontSize(10),e.setFont("helvetica","bold"),e.setTextColor(...r.slate900),e.text(i,14,t);let o=t+4;e.setFillColor(...r.slate900),e.rect(14,o,n,8,"F"),e.setFontSize(7),e.setFont("helvetica","bold"),e.setTextColor(255,255,255),e.text("Metric",17,o+5.5),e.text("8h Continental",87,o+5.5),e.text("12h (4on/4off)",132,o+5.5),e.text("Better",177,o+5.5);let l=o+8;return a.forEach((t,a)=>{a%2==0&&(e.setFillColor(248,250,252),e.rect(14,l,n,8,"F")),e.setFontSize(7),e.setFont("helvetica","normal"),e.setTextColor(...r.text),e.text(t.metric,17,l+5.5),e.text(t.value8h,87,l+5.5),e.text(t.value12h,132,l+5.5),"12h"===t.winner?(e.setTextColor(...r.secondary),e.setFont("helvetica","bold"),e.text("12h ✓",177,l+5.5)):"8h"===t.winner?(e.setTextColor(...r.info),e.setFont("helvetica","bold"),e.text("8h ✓",177,l+5.5)):(e.setTextColor(...r.slate400),e.text("—",177,l+5.5)),l+=8}),e.setDrawColor(...r.slate200),e.rect(14,o,n,l-o),l+6},"drawCostCapitulationTable",0,(e,a,n,i,o,l,s)=>{e.setFontSize(12),e.setFont("helvetica","bold"),e.setTextColor(...r.slate900),e.text("Cost Capitulation",14,a);let d=e=>`$${(e/1e6).toFixed(2)}M`,c=[],u=0;return Object.entries(n).forEach(([e,t])=>{c.push([{content:e.toUpperCase(),styles:{fontStyle:"normal"}},d(t),`${(t/s*100).toFixed(1)}%`]),u+=t}),c.push([{content:"SUBTOTAL (HARD COSTS)",styles:{fontStyle:"bold",fillColor:[241,245,249]}},{content:d(u),styles:{fontStyle:"bold",fillColor:[241,245,249]}},{content:`${(u/s*100).toFixed(1)}%`,styles:{fontStyle:"bold",fillColor:[241,245,249]}}]),i.design,i.pm,c.push([{content:"Design & Engineering Fee",styles:{fontStyle:"normal"}},d(i.design||0),`${((i.design||0)/s*100).toFixed(1)}%`]),c.push([{content:"Project Management Fee",styles:{fontStyle:"normal"}},d(i.pm||0),`${((i.pm||0)/s*100).toFixed(1)}%`]),c.push([{content:"Construction Contingency",styles:{fontStyle:"normal"}},d(o),`${(o/s*100).toFixed(1)}%`]),l>0&&c.push([{content:"First of a Kind (FOM) Upgrades",styles:{fontStyle:"normal"}},d(l),`${(l/s*100).toFixed(1)}%`]),c.push([{content:"TOTAL ESTIMATED CAPEX",styles:{fontStyle:"bold",fillColor:r.secondary,textColor:255}},{content:d(s),styles:{fontStyle:"bold",fillColor:r.secondary,textColor:255}},{content:"100.0%",styles:{fontStyle:"bold",fillColor:r.secondary,textColor:255}}]),(0,t.default)(e,{startY:a+5,head:[["Cost Code / Category","Estimated Amount (USD)","% of Total"]],body:c,theme:"grid",headStyles:{fillColor:r.slate800,textColor:255,fontSize:9,fontStyle:"bold"},bodyStyles:{textColor:r.text,fontSize:8},columnStyles:{0:{cellWidth:90},1:{cellWidth:50,halign:"right"},2:{cellWidth:30,halign:"right"}},margin:{left:14,right:14}}),e.lastAutoTable.finalY+15},"drawCoverPage",0,(e,t,a,n,o)=>{let l=e.internal.pageSize.width,s=e.internal.pageSize.height,d=o?.primaryColor?i(o.primaryColor):r.primary;if(e.setFillColor(...r.slate900),e.rect(0,0,l,s,"F"),e.setFillColor(...d),e.rect(0,0,6,s,"F"),o?.logoBase64)try{e.addImage(o.logoBase64,"PNG",l-40-14,14,40,40,void 0,"FAST")}catch(e){console.warn("Failed to render logo",e)}else e.setFillColor(d[0],d[1],d[2]),e.circle(l-30,40,60,"F"),e.setFillColor(...r.slate900),e.circle(l-30,40,55,"F");e.setFont("helvetica","bold"),e.setFontSize(32),e.setTextColor(255,255,255);let c=t.toUpperCase().split("\n"),u=.35*s;e.text(c,24,u);let m=u+(c.length-1)*14;e.setFontSize(14),e.setTextColor(...d),e.text(a,24,m+18),e.setDrawColor(...d),e.setLineWidth(.5),e.line(24,m+24,134,m+24);let y=m+39;e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(...r.slate400),o?.companyName&&(e.text(`Prepared by: ${o.companyName}`,24,y),y+=7),n.client&&(e.text(`Prepared for: ${n.client}`,24,y),y+=7),e.text(`Date: ${n.date}`,24,y),y+=7,e.text(`Version: ${n.version||"1.0"}`,24,y),!1!==n.confidential&&(e.setFillColor(...r.danger),e.roundedRect(24,s-50,50,10,2,2,"F"),e.setFontSize(7),e.setTextColor(255,255,255),e.setFont("helvetica","bold"),e.text("CONFIDENTIAL",29,s-43)),e.setFontSize(8),e.setTextColor(...r.slate600),e.setFont("helvetica","normal");let h=o?.companyName?`Generated by ${o.companyName} Operations Calculator`:"Generated by DCMOC v2.0 — Data Center M&O Calculator";e.text(h,24,s-15)},"drawDistributionChart",0,(e,t,a,n,i,o)=>{e.setFontSize(10),e.setFont("helvetica","bold"),e.setTextColor(...r.slate900),e.text(o,t,a+8);let l=i.reduce((e,t)=>e+t.value,0),s=t,d=a+15;i.forEach(t=>{let a=t.value/l*n;a>0&&(e.setFillColor(...t.color),e.rect(s,d,a,10,"F"),s+=a)});let c=d+18,u=0;return i.forEach(a=>{u>2&&(u=0,c+=8);let i=t+n/3*u;e.setFillColor(...a.color),e.circle(i+2,c-1,2,"F"),e.setFontSize(7.5),e.setFont("helvetica","normal"),e.setTextColor(...r.text);let o=(a.value/l*100).toFixed(1),s=a.value>=1e6?`$${(a.value/1e6).toFixed(2)}M`:a.value>=1e3?`$${(a.value/1e3).toFixed(1)}k`:`$${a.value.toFixed(0)}`;e.text(`${a.label}: ${s} (${o}%)`,i+6,c),u++}),c+10},"drawExecutiveBox",0,(e,t,a,i,o="info")=>{let l={info:r.info,warning:r.warning,success:r.secondary},s=e.splitTextToSize(i,n-16),d=14+4.5*s.length;return e.setFillColor(...{info:[239,246,255],warning:[254,252,232],success:[236,253,245]}[o]),e.roundedRect(14,t,n,d,2,2,"F"),e.setFillColor(...l[o]),e.rect(14,t,3,d,"F"),e.setFont("helvetica","bold"),e.setFontSize(9),e.setTextColor(...l[o]),e.text(a,21,t+8),e.setFont("helvetica","normal"),e.setFontSize(8),e.setTextColor(...r.text),e.text(s,21,t+14),t+d+4},"drawFooter",0,o,"drawHorizontalBarChart",0,(e,t,a,n,i,o)=>{e.setFontSize(10),e.setFont("helvetica","bold"),e.setTextColor(...r.slate900),e.text(o,t,a);let l=Math.max(...i.map(e=>e.value),1),s=a+8;return i.forEach(a=>{e.setFontSize(7.5),e.setFont("helvetica","normal"),e.setTextColor(...r.text),e.text(a.label,t,s+5),e.setFillColor(241,245,249),e.roundedRect(t+45,s,n-90,8,1,1,"F");let i=Math.max(2,a.value/l*(n-90));e.setFillColor(...a.color),e.roundedRect(t+45,s,i,8,1,1,"F"),e.setFontSize(7),e.setFont("helvetica","bold"),e.setTextColor(...r.slate900);let o=a.value>=1e3?`$${(a.value/1e3).toFixed(1)}k`:`$${a.value.toFixed(0)}`;e.text(o,t+n-40,s+5.5,{align:"right"}),s+=12}),s+4},"drawInsightsSection",0,(e,t,a)=>{let i=t;return a.slice(0,6).forEach(t=>{let a="high"===t.severity?r.danger:"medium"===t.severity?r.warning:r.secondary,o=e.splitTextToSize(t.description,n-12),l=12+4*o.length;e.setFillColor(248,250,252),e.rect(14,i,n,l,"F"),e.setFillColor(...a),e.rect(14,i,2.5,l,"F"),e.setFontSize(8.5),e.setFont("helvetica","bold"),e.setTextColor(...r.slate900),e.text(t.title,20,i+6),e.setFont("helvetica","normal"),e.setFontSize(7.5),e.setTextColor(...r.text),e.text(o,20,i+12),i+=l+3}),i},"drawKpiCard",0,(e,t,a,n,i,o,l,s,d=r.secondary)=>{e.setFillColor(248,250,252),e.setDrawColor(...r.slate200),e.roundedRect(t,a,n,i,2,2,"FD"),e.setFillColor(...d),e.rect(t,a+6,2,i-12,"F"),e.setFontSize(7),e.setTextColor(...r.textLight),e.setFont("helvetica","normal"),e.text(o.toUpperCase(),t+5,a+8),e.setFontSize(14),e.setFont("helvetica","bold"),e.setTextColor(...r.slate900),e.text(l,t+5,a+17),e.setFontSize(7),e.setFont("helvetica","normal"),e.setTextColor(...r.textLight),e.text(s,t+5,a+i-3)},"drawModernHeader",0,(e,t,a="",n)=>{let o=e.internal.pageSize.width,l=n?.primaryColor?i(n.primaryColor):r.primary;e.setFillColor(...r.slate900),e.rect(0,0,o,25,"F"),e.setFillColor(...l),e.rect(0,23,o,1,"F"),e.setFont("helvetica","bold"),e.setFontSize(14),e.setTextColor(255,255,255),e.text(t,14,16),n?.logoBase64?e.addImage(n.logoBase64,"PNG",o-14-12,6,12,12,void 0,"FAST"):a&&(e.setFontSize(8),e.setTextColor(...r.slate400),e.text(a,o-14,16,{align:"right"}))},"drawMultiYearStaffingTable",0,(e,a,n,i,o,l,s=5)=>{e.setFontSize(11),e.setFont("helvetica","bold"),e.setTextColor(...r.slate900),e.text(`${s}-Year Staffing Projection`,14,a);let d=e=>`$${(e/1e3).toFixed(0)}k`,c=["Metric",...Array.from({length:s},(e,t)=>`Year ${t+1}`)],u=["Headcount (FTE)"],m=["Monthly OPEX"],y=[{content:"Annual OPEX",styles:{fontStyle:"bold"}}],h=["Est. Turnover"],S=["Recruitment Cost"];for(let e=0;e<s;e++){let t=i*Math.pow(1+o,e),a=Math.round(n*l),r=a*t*2;u.push(`${n}`),m.push(d(t)),y.push({content:d(12*t),styles:{fontStyle:"bold"}}),h.push(`${a} FTEs`),S.push(d(r))}return(0,t.default)(e,{startY:a+5,head:[c],body:[u,m,y,h,S],theme:"grid",headStyles:{fillColor:r.slate800,textColor:255,fontSize:8,fontStyle:"bold",halign:"center"},bodyStyles:{textColor:r.text,fontSize:8,halign:"right"},columnStyles:{0:{cellWidth:40,halign:"left"}},margin:{left:14,right:14}}),e.lastAutoTable.finalY+10},"drawParagraph",0,(e,t,a,i=n)=>{e.setFont("helvetica","normal"),e.setFontSize(9),e.setTextColor(...r.text);let o=e.splitTextToSize(a,i);return e.text(o,14,t),t+4.5*o.length+2},"drawRiskHeatMap",0,(e,t,a,n,i="Risk Heat Map")=>{e.setFontSize(10),e.setFont("helvetica","bold"),e.setTextColor(...r.slate900),e.text(i,t,a),a+=8,e.setFontSize(7),e.setTextColor(...r.slate500),e.text("IMPACT",t,a+40,{angle:90});let o=t+18,l=a,s=(e,t)=>{let a=e*t;return a>=15?[220,38,38]:a>=10?[245,158,11]:a>=5?[234,179,8]:[34,197,94]};for(let t=5;t>=1;t--){for(let a=1;a<=5;a++){let i=o+(a-1)*28,d=l+(5-t)*16,c=s(a,t);e.setFillColor(c[0],c[1],c[2]),e.setGlobalAlpha?.(.3),e.rect(i,d,28,16,"F"),e.setGlobalAlpha?.(1),e.setDrawColor(...r.slate300),e.setLineWidth(.2),e.rect(i,d,28,16,"S");let u=n.filter(e=>e.probability===a&&e.impact===t);if(u.length>0){e.setFillColor(...c),e.rect(i,d,28,16,"F"),e.setFontSize(5.5),e.setFont("helvetica","bold"),e.setTextColor(255,255,255);let t=1===u.length?u[0].title.substring(0,16):`${u.length} risks`;e.text(t,i+14,d+8+1,{align:"center"})}}e.setFontSize(7),e.setFont("helvetica","normal"),e.setTextColor(...r.slate600);let a=["Negligible","Minor","Moderate","Major","Catastrophic"];e.text(a[t-1]?.substring(0,3)||`${t}`,o-4,l+(5-t)*16+8+1,{align:"right"})}let d=["Rare","Unlikely","Possible","Likely","Almost Certain"];for(let t=1;t<=5;t++)e.setFontSize(7),e.setFont("helvetica","normal"),e.setTextColor(...r.slate600),e.text(d[t-1]?.substring(0,6)||`${t}`,o+(t-1)*28+14,l+80+5,{align:"center"});e.setFontSize(7),e.setTextColor(...r.slate500),e.text("PROBABILITY",o+70,l+80+12,{align:"center"});let c=l+80+18;return[{label:"Critical (15-25)",color:[220,38,38]},{label:"High (10-14)",color:[245,158,11]},{label:"Medium (5-9)",color:[234,179,8]},{label:"Low (1-4)",color:[34,197,94]}].forEach((a,n)=>{let i=t+45*n;e.setFillColor(...a.color),e.rect(i,c,4,4,"F"),e.setFontSize(7),e.setTextColor(...r.slate600),e.text(a.label,i+6,c+3)}),c+10},"drawSectionTitle",0,(e,t,a,n,o)=>{let l=o?.primaryColor?i(o.primaryColor):r.primary;e.setFillColor(...l),e.rect(14,t,3,8,"F"),e.setFont("helvetica","bold"),e.setFontSize(13),e.setTextColor(...r.slate900);let s=n?`${n}. `:"";return e.text(`${s}${a}`,20,t+6),e.setDrawColor(...r.slate200),e.setLineWidth(.3),e.line(14,t+10,196,t+10),t+16},"drawTableOfContents",0,(e,a,n,i="Table of Contents")=>(e.setFontSize(16),e.setFont("helvetica","bold"),e.setTextColor(...r.slate900),e.text(i,14,a),(0,t.default)(e,{startY:a+10,head:[["Reason","Source","Validation","Pages"]],body:n.map(e=>[e.reason,e.source,e.validation,e.pages]),theme:"grid",headStyles:{fillColor:r.slate900,textColor:255,fontSize:9,fontStyle:"bold",halign:"center"},bodyStyles:{textColor:r.text,fontSize:8,valign:"middle"},columnStyles:{0:{cellWidth:50},1:{cellWidth:50},2:{cellWidth:60},3:{cellWidth:20,halign:"center"}},margin:{left:14,right:14}}),e.lastAutoTable.finalY+15),"ensureSpace",0,(e,t,a,r)=>t+a>e.internal.pageSize.height-20?(o(e,r.current),e.addPage(),r.current++,35):t,"fmt",0,e=>e>=1e6?`$${(e/1e6).toFixed(2)}M`:e>=1e3?`$${(e/1e3).toFixed(1)}k`:`$${e.toFixed(0)}`,"fmtMoney",0,e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0}).format(e),"initDoc",0,l,"savePdf",0,(e,t)=>{try{let a=e.output("blob");if(a.size<100)throw Error(`Generated PDF is empty (${a.size} bytes)`);let r=URL.createObjectURL(a),n=document.createElement("a");n.href=r,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)}catch(e){console.error("PDF save error:",e),window.alert(`PDF Generation Failed: ${e.message||"Unknown error"}`)}},"today",0,()=>new Date().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})])},54462,76285,61480,72795,91651,82444,77034,80686,17046,69012,71051,53807,e=>{"use strict";var t=e.i(42821),a=e.i(71524),r=e.i(60837);let n=async(e,t,n,i,o,l,s,d)=>{let{doc:c,autoTable:u}=await (0,a.initDoc)(d),m={current:1},y=l||[];(0,a.drawCoverPage)(c,"Maintenance Strategy\n& Reliability Analysis",`Operational Plan for ${e.name}`,{client:"Ops Director",date:(0,a.today)(),version:"3.0"},d),c.addPage(),m.current++,(0,a.drawModernHeader)(c,"Executive Summary","Maintenance Strategy Overview",d);let h=35,S=t.strategies.find(e=>e.id===t.recommended)?.totalAnnualCost||0,g=o.length,f=o.reduce((e,t)=>e+(t.durationHours||0),0),C=y.reduce((e,t)=>e+(t.count||0),0);(0,a.drawKpiCard)(c,14,h,42,24,"Annual Budget",(0,a.fmtMoney)(S),"Recommended strategy"),(0,a.drawKpiCard)(c,60,h,42,24,"Events / Hours",`${g} / ${Math.round(f)}h`,"Annual maintenance"),(0,a.drawKpiCard)(c,106,h,42,24,"Active Assets",`${C}`,"Total asset count"),(0,a.drawKpiCard)(c,152,h,42,24,"5-Year Savings",(0,a.fmtMoney)(t.fiveYearSavings),"vs worst strategy"),h+=35,s&&(h=(0,a.drawParagraph)(c,h,s)+5),h=(0,a.drawExecutiveBox)(c,h,`Recommended Strategy: ${t.recommended.toUpperCase()}`,t.recommendationReason,"success"),(0,a.drawFooter)(c,m.current,d),c.addPage(),m.current++,(0,a.drawModernHeader)(c,"Asset Inventory","Facility Equipment Register",d),h=35,h=(0,a.drawSectionTitle)(c,h,"Asset Register","1",d),u(c,{startY:h,head:[["Category","Asset","Qty","Redundancy","Maint Hrs/yr","Tasks"]],body:y.map(e=>{let t=r.ASSETS.find(t=>t.id===e.assetId);if(!t)return null;let a=t.maintenanceTasks?.length||0,n=t.maintenanceTasks?.reduce((t,a)=>{let r="Monthly"===a.frequency?12:"Quarterly"===a.frequency?4:"Bi-Annual"===a.frequency?2:1;return t+a.standardHours*r*e.count},0)||0;return[t.category,t.name,`${e.count}`,t.defaultRedundancy,`${Math.round(n)}h`,`${a} tasks`]}).filter(Boolean),theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},columnStyles:{0:{cellWidth:30},4:{halign:"right"},5:{halign:"center"}},margin:{left:14,right:14}}),h=c.lastAutoTable.finalY+10,h=(0,a.ensureSpace)(c,h,60,m),h=(0,a.drawSectionTitle)(c,h,"Asset Consumables & AQI Degradation","1.1",d);let p=[];y.forEach(t=>{let n=r.ASSETS.find(e=>e.id===t.assetId);n?.consumables&&n.consumables.forEach(r=>{let i=(e.environment?.baselineAQI||50)>100?.7:1;p.push([n.name,r.name,`${r.baseLifeMonths} mo`,`${Math.round(r.baseLifeMonths*i)} mo`,(0,a.fmtMoney)(r.costPerUnit),`${t.count*Math.ceil(12/(r.baseLifeMonths*i))}`])})}),p.length>0&&(u(c,{startY:h,head:[["Asset","Consumable","Base Life","Adj. Life","Unit Cost","Annual Qty"]],body:p.slice(0,30),theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},margin:{left:14,right:14}}),h=c.lastAutoTable.finalY+10),(0,a.drawFooter)(c,m.current,d),c.addPage(),m.current++,(0,a.drawModernHeader)(c,"Maintenance Schedule","Annual Plan & Calendar",d),h=35,h=(0,a.drawSectionTitle)(c,h,"Monthly Event Distribution","2",d);let P={};o.forEach(e=>{let t=e.task?.category||"General";P[t]||(P[t]=Array(12).fill(0));let a=Math.floor(((e.weekNumber||1)-1)/4.33);P[t][Math.min(11,Math.max(0,a))]++}),u(c,{startY:h,head:[["Category","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]],body:Object.entries(P).map(([e,t])=>[e,...t.map(e=>e>0?`${e}`:"—")]),theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:7},bodyStyles:{fontSize:7,halign:"center"},columnStyles:{0:{halign:"left",cellWidth:30}},margin:{left:14,right:14},didParseCell:e=>{if("body"===e.section&&e.column.index>0){let t=parseInt(e.cell.text[0]);t>=10?e.cell.styles.fillColor=[254,202,202]:t>=5?e.cell.styles.fillColor=[254,243,199]:t>=1&&(e.cell.styles.fillColor=[220,252,231])}}}),h=c.lastAutoTable.finalY+10,h=(0,a.ensureSpace)(c,h,60,m),h=(0,a.drawSectionTitle)(c,h,"Schedule Detail (Top 50 Events)","2.1",d),u(c,{startY:h,head:[["Asset","Task","Week","Duration","Techs","Criticality"]],body:o.slice(0,50).map(e=>[e.assetName||"N/A",e.task?.name||"N/A",`W${e.weekNumber||0}`,`${e.durationHours||0}h`,`${e.techniciansRequired||1}`,e.task?.criticality||"Optimal"]),theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},columnStyles:{0:{cellWidth:40},1:{cellWidth:50},5:{halign:"center"}},margin:{left:14,right:14},didParseCell:e=>{if("body"===e.section&&5===e.column.index){let t=e.cell.text[0];"Statutory"===t?e.cell.styles.textColor=[220,38,38]:"Optimal"===t?e.cell.styles.textColor=[245,158,11]:e.cell.styles.textColor=[34,197,94]}}}),h=c.lastAutoTable.finalY+10,(0,a.drawFooter)(c,m.current,d),c.addPage(),m.current++,(0,a.drawModernHeader)(c,"Strategy Comparison","Reactive vs Planned vs Predictive",d),h=35,h=(0,a.drawSectionTitle)(c,h,"Strategy Cost & Reliability Analysis","3",d),u(c,{startY:h,head:[["Strategy","Labor/yr","Parts/yr","Downtime Cost","Unplanned","5-Yr NPV","Reliability"]],body:t.strategies.map(e=>[e.label||e.id,(0,a.fmtMoney)(e.annualLaborCost||0),(0,a.fmtMoney)(e.annualPartsCost||0),(0,a.fmtMoney)(e.annualDowntimeCost||0),`${e.unplannedFailures||0}`,(0,a.fmtMoney)(e.fiveYearNPV||0),`${e.reliabilityIndex||0}/100`]),theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},columnStyles:{1:{halign:"right"},2:{halign:"right"},3:{halign:"right"},4:{halign:"center"},5:{halign:"right"},6:{halign:"center"}},margin:{left:14,right:14}}),h=c.lastAutoTable.finalY+10,h=(0,a.drawExecutiveBox)(c,h,`Recommendation: ${t.recommended.toUpperCase()} Maintenance`,`${t.recommendationReason} Projected 5-year savings of ${(0,a.fmtMoney)(t.fiveYearSavings)} compared to the least efficient strategy.`,"success"),h=(0,a.ensureSpace)(c,h,80,m),h=(0,a.drawHorizontalBarChart)(c,14,h,180,t.strategies.map(e=>({label:e.label||e.id,value:e.totalAnnualCost||0,color:e.id===t.recommended?a.PDF_COLORS.secondary:a.PDF_COLORS.slate400})),"Total Annual Cost by Strategy"),(0,a.drawFooter)(c,m.current,d),c.addPage(),m.current++,(0,a.drawModernHeader)(c,"SLA Tier Comparison","Vendor Service Level Analysis",d),h=35,h=(0,a.drawSectionTitle)(c,h,"SLA Tier Analysis","4",d),u(c,{startY:h,head:[["Tier","Response","Annual Cost","Coverage","Risk Exposure","Break-Even","Net Cost"]],body:n.tiers.map(e=>[e.label||e.id,e.responseTime||"N/A",(0,a.fmtMoney)(e.annualCost||0),e.coverageScope||"Standard",(0,a.fmtMoney)(e.riskExposure||0),(0,a.fmtMoney)(e.breakEvenDowntimeCost||0),(0,a.fmtMoney)(e.netAnnualCost||0)]),theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},columnStyles:{2:{halign:"right"},4:{halign:"right"},5:{halign:"right"},6:{halign:"right"}},margin:{left:14,right:14},didParseCell:e=>{if("body"===e.section){let t=n.tiers[e.row.index];(t?.recommended||t?.id===n.recommended)&&(e.cell.styles.fillColor=[220,252,231])}}}),h=c.lastAutoTable.finalY+10,h=(0,a.drawExecutiveBox)(c,h,`Recommended Tier: ${n.recommended.toUpperCase()}`,n.analysis,"info"),(0,a.drawFooter)(c,m.current,d),c.addPage(),m.current++,(0,a.drawModernHeader)(c,"Spare Parts Inventory","Inventory Optimization & ABC Analysis",d),h=35,h=(0,a.drawSectionTitle)(c,h,"Spare Parts Register","5",d),u(c,{startY:h,head:[["Part","Category","Criticality","Qty","Unit Cost","Lead Time","Reorder Pt","Holding Cost"]],body:i.items.slice(0,40).map(e=>[e.partName||e.name||"N/A",e.category||"General",e.criticality||"Minor",`${e.quantity||0}`,(0,a.fmtMoney)(e.unitCost||0),e.leadTimeDays?`${e.leadTimeDays}d`:"N/A",`${e.reorderPoint||0}`,(0,a.fmtMoney)(e.holdingCost||0)]),theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:7},bodyStyles:{fontSize:6.5},columnStyles:{0:{cellWidth:35},4:{halign:"right"},7:{halign:"right"}},margin:{left:14,right:14},didParseCell:e=>{if("body"===e.section&&2===e.column.index){let t=e.cell.text[0];"Critical"===t?e.cell.styles.textColor=[220,38,38]:"Major"===t&&(e.cell.styles.textColor=[245,158,11])}}}),h=c.lastAutoTable.finalY+10,h=(0,a.ensureSpace)(c,h,60,m),h=(0,a.drawSectionTitle)(c,h,"ABC Classification Summary","5.1",d);let w=i.items.filter(e=>"Critical"===e.criticality),b=i.items.filter(e=>"Major"===e.criticality),F=i.items.filter(e=>"Minor"===e.criticality),v=w.reduce((e,t)=>e+(t.unitCost||0)*(t.quantity||0),0),M=b.reduce((e,t)=>e+(t.unitCost||0)*(t.quantity||0),0),T=F.reduce((e,t)=>e+(t.unitCost||0)*(t.quantity||0),0);if((0,a.drawKpiCard)(c,14,h,55,24,"Class A (Critical)",`${w.length} items`,(0,a.fmtMoney)(v),a.PDF_COLORS.danger),(0,a.drawKpiCard)(c,75,h,55,24,"Class B (Major)",`${b.length} items`,(0,a.fmtMoney)(M),a.PDF_COLORS.warning),(0,a.drawKpiCard)(c,136,h,55,24,"Class C (Minor)",`${F.length} items`,(0,a.fmtMoney)(T),a.PDF_COLORS.secondary),h+=35,i.recommendations&&i.recommendations.length>0){h=(0,a.ensureSpace)(c,h,40,m);let e=i.recommendations.map((e,t)=>`${t+1}. ${e}`).join("\n");h=(0,a.drawExecutiveBox)(c,h,"Inventory Recommendations",e,"info")}h=(0,a.ensureSpace)(c,h,40,m),h=(0,a.drawSectionTitle)(c,h,"Spares Budget Summary","5.2",d),(0,a.drawKpiCard)(c,14,h,55,24,"Inventory Value",(0,a.fmtMoney)(i.totalInventoryValue),"Capital locked in spares",a.PDF_COLORS.accent),(0,a.drawKpiCard)(c,75,h,55,24,"Annual Holding",(0,a.fmtMoney)(i.totalHoldingCost),"15% of inventory value",a.PDF_COLORS.warning),(0,a.drawKpiCard)(c,136,h,55,24,"Annual Budget",(0,a.fmtMoney)(i.totalAnnualSparesBudget),"Consumption + holding",a.PDF_COLORS.secondary),(0,a.drawFooter)(c,m.current,d),(0,a.savePdf)(c,`DCMOC_Maintenance_${e.name}_${new Date().toISOString().slice(0,10)}.pdf`)};e.s(["generateMaintenancePDF",0,n],76285);let i=async(e,t,r,n,i,o,l,s,d)=>{let{doc:c,autoTable:u}=await (0,a.initDoc)(d),m={current:1};(0,a.drawCoverPage)(c,"Staffing Strategy &\nOperational Roster",`Analysis for ${e.name} Region`,{client:"Internal Assessment",date:(0,a.today)(),version:"3.0",confidential:!0},d),c.addPage(),m.current++,(0,a.drawModernHeader)(c,"Executive Summary","Staffing & Cost Analysis",d);let y=35,h=r.reduce((e,t)=>e+t.headcount,0),S=r.reduce((e,t)=>e+t.monthlyCost,0),g=h>0?S/h:0;(0,a.drawKpiCard)(c,14,y,42,24,"Total Headcount",`${h}`,"FTEs across all shifts"),(0,a.drawKpiCard)(c,60,y,42,24,"Monthly OPEX",(0,a.fmt)(S),"Gross salary + burden"),(0,a.drawKpiCard)(c,106,y,42,24,"Avg Cost / Head",(0,a.fmt)(g),"Monthly blended rate"),(0,a.drawKpiCard)(c,152,y,42,24,"Shift Model","8h"===t?"8-Hour":"12-Hour","Rotation pattern"),y+=35;let f=i.find(e=>"high"===e.severity)||i[0];f&&(y=(0,a.drawExecutiveBox)(c,y,`Strategic Recommendation: ${f.title}`,f.recommendation,"high"===f.severity?"warning":"info")),(0,a.drawFooter)(c,m.current,d),c.addPage(),m.current++,(0,a.drawModernHeader)(c,"Role Breakdown","Detailed Staffing Table",d),y=35,y=(0,a.drawSectionTitle)(c,y,"Staffing by Role","1",d),u(c,{startY:y,head:[["Role","HC","On-Shift","Schedule","Base Salary","Shift Allow.","OT","Total Cost"]],body:r.map(e=>[e.role,`${e.headcount}`,`${e.onShiftCount}`,"8h"===t?"Continental":"4on/4off",(0,a.fmtMoney)(e.breakdown.baseSalaries),(0,a.fmtMoney)(e.breakdown.shiftAllowance),(0,a.fmtMoney)(e.breakdown.overtime),(0,a.fmtMoney)(e.monthlyCost)]),theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},columnStyles:{1:{halign:"center"},2:{halign:"center"},4:{halign:"right"},5:{halign:"right"},6:{halign:"right"},7:{halign:"right"}},margin:{left:14,right:14}}),y=c.lastAutoTable.finalY+10,y=(0,a.ensureSpace)(c,y,40,m),y=(0,a.drawExecutiveBox)(c,y,`Active Pattern: ${"8h"===t?"8-Hour Continental (3-Shift)":"12-Hour 4on/4off (2-Shift)"}`,`Cycle Length: ${"8h"===t?28:8} days | Work Days: ${"8h"===t?20:4} per cycle | Shift Duration: ${"8h"===t?"8 hours":"12 hours"} | Teams: 4`,"info"),y=(0,a.ensureSpace)(c,y,80,m),y=(0,a.drawSectionTitle)(c,y,"Cost Distribution by Role","1.1",d),y=(0,a.drawHorizontalBarChart)(c,14,y,180,r.map(e=>({label:e.role,value:e.monthlyCost,color:e.role.includes("Engineer")?a.PDF_COLORS.secondary:a.PDF_COLORS.primary})),"Monthly Cost Distribution by Role"),(0,a.drawFooter)(c,m.current,d),c.addPage(),m.current++,(0,a.drawModernHeader)(c,"Shift Model Comparison","8-Hour vs 12-Hour Analysis",d),y=35,y=(0,a.drawSectionTitle)(c,y,"Shift Model Comparison (8h vs 12h)","2",d),y=o&&o.length>0?(0,a.drawComparisonTable)(c,y,o,`8-Hour vs 12-Hour Model (${e.name})`):(0,a.drawComparisonTable)(c,y,[{metric:"Teams Required",value8h:"4 teams",value12h:"4 teams",winner:"tie"},{metric:"Weekly Hours per Person",value8h:"40h",value12h:"42h",winner:"8h"},{metric:"Overtime Risk",value8h:"Low",value12h:"Medium-High",winner:"8h"},{metric:"Handover Frequency",value8h:"3/day",value12h:"2/day",winner:"12h"},{metric:"Knowledge Continuity",value8h:"Standard",value12h:"Better",winner:"12h"}],`8-Hour vs 12-Hour Model (${e.name})`),(0,a.drawFooter)(c,m.current,d),c.addPage(),m.current++,(0,a.drawModernHeader)(c,"5-Year Staffing Projection","Cost & Headcount Forecast",d),y=35,y=(0,a.drawSectionTitle)(c,y,"5-Year Staffing Cost Projection","3",d);let C=e.economy?.laborEscalation??.05;y=(0,a.drawMultiYearStaffingTable)(c,y,h,S,C,.1,5),(0,a.drawFooter)(c,m.current,d),c.addPage(),m.current++,(0,a.drawModernHeader)(c,"Efficiency & Sensitivity","Operational Metrics",d),y=35,y=(0,a.drawSectionTitle)(c,y,"Efficiency Metrics","4",d);let p=s?.utilizationRate||.82,P=S/(r.reduce((e,t)=>e+t.headcount,0)||1),w=s?.otRatio||.05,b=s?.shrinkageLoss||.08;(0,a.drawKpiCard)(c,14,y,42,24,"Utilization Rate",`${(100*p).toFixed(0)}%`,"Productive vs total hours"),(0,a.drawKpiCard)(c,60,y,42,24,"Cost / Head",(0,a.fmt)(12*P),"Annual per-head cost"),(0,a.drawKpiCard)(c,106,y,42,24,"OT Ratio",`${(100*w).toFixed(1)}%`,"Overtime vs regular"),(0,a.drawKpiCard)(c,152,y,42,24,"Shrinkage",`${(100*b).toFixed(1)}%`,"Leave + absence"),y+=35,y=(0,a.drawSectionTitle)(c,y,"Headcount Sensitivity Analysis","4.1",d),u(c,{startY:y,head:[["HC Change","Headcount","Monthly Cost","Annual Cost","Delta vs Base"]],body:[-20,-10,0,10,20].map(e=>{let t=Math.max(1,h+Math.round(h*e/100)),r=t/h*S;return[`${e>=0?"+":""}${e}%`,`${t} FTE`,(0,a.fmtMoney)(r),(0,a.fmtMoney)(12*r),(0,a.fmtMoney)((r-S)*12)]}),theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},columnStyles:{2:{halign:"right"},3:{halign:"right"},4:{halign:"right"}},margin:{left:14,right:14},didParseCell:e=>{"body"===e.section&&2===e.row.index&&(e.cell.styles.fillColor=[219,234,254])}}),y=c.lastAutoTable.finalY+10,(0,a.drawFooter)(c,m.current,d),c.addPage(),m.current++,(0,a.drawModernHeader)(c,"Operational Roster","Shift Pattern Visualization",d),y=35,y=(0,a.drawSectionTitle)(c,y,"Shift Rotation Schedule","5",d),u(c,{startY:y,head:[["Team","Next 14 Days Rotation"]],body:Array.from(new Set(n.map(e=>e.team))).map(e=>{let t=n.filter(t=>t.team===e).slice(0,14);return[e,t.map(e=>"Day"===e.shiftType?"☀":"Night"===e.shiftType?"☾":"—").join(" ")]}),theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900},styles:{fontSize:8,cellPadding:3},margin:{left:14,right:14}}),y=c.lastAutoTable.finalY+10,(0,a.drawFooter)(c,m.current,d),c.addPage(),m.current++,(0,a.drawModernHeader)(c,"Strategic Insights","Key Recommendations",d),y=35,y=(0,a.drawSectionTitle)(c,y,"Strategic Insights & Recommendations","6",d),y=(0,a.drawInsightsSection)(c,y,i),(0,a.drawFooter)(c,m.current,d),(0,a.savePdf)(c,`DCMOC_Staffing_Report_${e.name}_${new Date().toISOString().slice(0,10)}.pdf`)};e.s(["generateStaffingPDF",0,i],61480);let o=async(e,t,r,n)=>{let{doc:i,autoTable:o}=await (0,a.initDoc)(n),l={current:1};(0,a.drawCoverPage)(i,"Risk & Compliance\nAssessment",`Facility Analysis for ${e.name}`,{client:"Risk Management",date:(0,a.today)(),version:"2.0"},n),i.addPage(),l.current++,(0,a.drawModernHeader)(i,"Risk Executive Summary",`Normalized Score: ${t.normalizedScore}/100`,n);let s=35;(0,a.drawKpiCard)(i,14,s,42,24,"Risk Score",`${t.normalizedScore}/100`,t.normalizedScore<30?"Low Risk":t.normalizedScore<60?"Medium Risk":"High Risk",t.normalizedScore<30?a.PDF_COLORS.secondary:t.normalizedScore<60?a.PDF_COLORS.warning:a.PDF_COLORS.danger),(0,a.drawKpiCard)(i,60,s,42,24,"Financial Exposure",(0,a.fmtMoney)(t.financialExposure||0),"Annual estimated"),(0,a.drawKpiCard)(i,106,s,42,24,"Availability",`${(t.availability||99.982).toFixed(3)}%`,"Expected uptime"),(0,a.drawKpiCard)(i,152,s,42,24,"SLA Breach Prob.",`${(100*t.slaBreachProbability).toFixed(1)}%`,"Annual probability"),s+=35,s=(0,a.drawParagraph)(i,s,r),(0,a.drawFooter)(i,l.current,n),i.addPage(),l.current++,(0,a.drawModernHeader)(i,"Risk Matrix","5×5 Probability-Impact Assessment",n),s=35,s=(0,a.drawSectionTitle)(i,s,"Risk Heat Map","1",n);let d=(t.topRisks||[]).map(e=>({title:e.title,probability:({Low:1,Medium:2,High:3,Critical:4})[e.probability]||2,impact:({Low:1,Medium:2,High:3,Catastrophic:4})[e.impact]||2,score:e.score||0}));d.length>0&&(s=(0,a.drawRiskHeatMap)(i,14,s,d,"Risk Probability × Impact Matrix")),(0,a.drawFooter)(i,l.current,n),i.addPage(),l.current++,(0,a.drawModernHeader)(i,"Top Risk Scenarios","Identified Threat Vectors",n),s=35,s=(0,a.drawSectionTitle)(i,s,"Risk Scenario Register","2",n),t.topRisks&&t.topRisks.length>0&&(o(i,{startY:s,head:[["Risk Title","Category","Probability","Impact","Score","Description"]],body:t.topRisks.map(e=>[e.title,e.category||"General",e.probability||"Medium",e.impact||"Medium",`${e.score||0}`,(e.description||"").substring(0,60)]),theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},columnStyles:{0:{cellWidth:35},4:{halign:"center"},5:{cellWidth:50}},margin:{left:14,right:14},didParseCell:e=>{if("body"===e.section&&4===e.column.index){let t=parseInt(e.cell.text[0]);t>=15?e.cell.styles.textColor=[220,38,38]:t>=10?e.cell.styles.textColor=[245,158,11]:e.cell.styles.textColor=[34,197,94],e.cell.styles.fontStyle="bold"}}}),s=i.lastAutoTable.finalY+10),(0,a.drawFooter)(i,l.current,n),i.addPage(),l.current++,(0,a.drawModernHeader)(i,"Downtime & Reliability","Availability Analysis",n),s=35,s=(0,a.drawSectionTitle)(i,s,"Downtime Analysis","3",n);let c=t.availability||99.982,u=t.downtimeMinutes||(100-c)/100*525600,m=t.financialExposure||5e3*u;(0,a.drawKpiCard)(i,14,s,42,24,"Expected Downtime",`${Math.round(u)} min`,"Per year"),(0,a.drawKpiCard)(i,60,s,42,24,"Availability",`${c.toFixed(3)}%`,"Annual target"),(0,a.drawKpiCard)(i,106,s,42,24,"Financial Impact",(0,a.fmtMoney)(m),"@ $5k/min"),(0,a.drawKpiCard)(i,152,s,42,24,"SLA Breach Risk",`${(100*t.slaBreachProbability).toFixed(1)}%`,"Annual probability"),s+=35,s=(0,a.drawSectionTitle)(i,s,"Reliability Metrics (MTTR/MTBF)","3.1",n),o(i,{startY:s,head:[["Metric","Value","Industry Benchmark","Assessment"]],body:[["MTBF (Mean Time Between Failures)",`${t.mtbf||8760}h`,"8,760h (Tier 3)",t.mtbf>=8760?"Within target":"Below target"],["MTTR (Mean Time to Repair)",`${t.mttr||4}h`,"4h (SLA target)",t.mttr<=4?"Within target":"Exceeds target"],["Failure Rate",`${t.failureRate||.001}/hr`,"0.001/hr","Standard"]],theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},margin:{left:14,right:14}}),s=i.lastAutoTable.finalY+10,(0,a.drawFooter)(i,l.current,n),i.addPage(),l.current++,(0,a.drawModernHeader)(i,"5-Year Risk Projection","Risk Trend Analysis",n),s=35,s=(0,a.drawSectionTitle)(i,s,"5-Year Risk Score Projection","4",n),t.fiveYearProjection&&t.fiveYearProjection.length>0&&(o(i,{startY:s,head:[["Year","Risk Score","Trend","Assessment"]],body:t.fiveYearProjection.map(e=>{let a=e.score>t.normalizedScore?"↑":e.score<t.normalizedScore?"↓":"→";return[`Year ${e.year}`,`${e.score}/100`,a,e.label||"Projected"]}),theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:8},columnStyles:{1:{halign:"center"},2:{halign:"center"}},margin:{left:14,right:14}}),s=i.lastAutoTable.finalY+10),(0,a.drawFooter)(i,l.current,n),i.addPage(),l.current++,(0,a.drawModernHeader)(i,"Environmental & Supply Chain Risk",`${e.name} Country Profile`,n),s=35,s=(0,a.drawSectionTitle)(i,s,"Country-Specific Risk Metrics","5",n);let y=e.environment?.baselineAQI||50,h=e.environment?.gridCarbonIntensity||.5;o(i,{startY:s,head:[["Factor","Value","Impact Assessment"]],body:[["Baseline AQI",`${y}`,y>100?"High — accelerated equipment degradation":"Normal range"],["Grid Carbon Intensity",`${h.toFixed(2)} kgCO₂/kWh`,h>.5?"Above average":"Below average"],["Import Lead Time",`${"ID"===e.id?"21":"SG"===e.id?"7":"14"} days`,"Affects spares strategy"],["Natural Disaster Risk","ID"===e.id?"High (seismic/volcanic)":"Moderate","Structural hardening required"],["Regulatory Environment",e.economy?.taxRate?`${(100*e.economy.taxRate).toFixed(0)}% tax`:"Standard","Labor and data sovereignty"]],theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},margin:{left:14,right:14}}),s=i.lastAutoTable.finalY+10,(0,a.drawFooter)(i,l.current,n),i.addPage(),l.current++,(0,a.drawModernHeader)(i,"Mitigation Strategies","Risk Remediation Recommendations",n),s=35,s=(0,a.drawSectionTitle)(i,s,"Recommended Mitigation Actions","6",n),t.topRisks&&t.topRisks.length>0&&(o(i,{startY:s,head:[["Risk","Category","Recommended Mitigation"]],body:t.topRisks.map(e=>[e.title,e.category||"General",e.mitigation||"Review and assess"]),theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},columnStyles:{0:{cellWidth:40},2:{cellWidth:80}},margin:{left:14,right:14}}),s=i.lastAutoTable.finalY+10),(0,a.drawFooter)(i,l.current,n),(0,a.savePdf)(i,`DCMOC_RiskProfile_${e.name}_${new Date().toISOString().slice(0,10)}.pdf`)};e.s(["generateRiskPDF",0,o],72795);let l=async(e,t,r,n,i,o,l)=>{let{doc:s,autoTable:d}=await (0,a.initDoc)(l),c={current:1};(0,a.drawCoverPage)(s,"Investment Analysis\n& Capital Structure",`Investment Case for ${e.name}`,{client:"Investment Committee",date:(0,a.today)(),version:"1.0",confidential:!0},l),s.addPage(),c.current++,(0,a.drawModernHeader)(s,"Executive Summary","Investment Thesis Overview",l);let u=35;(0,a.drawKpiCard)(s,14,u,28,24,"Total CAPEX",(0,a.fmtMoney)(i),"Investment",a.PDF_COLORS.accent),(0,a.drawKpiCard)(s,46,u,28,24,"Debt",(0,a.fmtMoney)(t.totalDebt||0),`${(100*(r.debtRatio||.6)).toFixed(0)}%`),(0,a.drawKpiCard)(s,78,u,28,24,"Equity",(0,a.fmtMoney)(t.totalEquity||0),`${((1-(r.debtRatio||.6))*100).toFixed(0)}%`),(0,a.drawKpiCard)(s,110,u,28,24,"WACC",`${(100*t.wacc).toFixed(1)}%`,"Weighted avg"),(0,a.drawKpiCard)(s,142,u,24,24,"Eq. IRR",`${t.equityIRR.toFixed(1)}%`,"Return",a.PDF_COLORS.secondary),(0,a.drawKpiCard)(s,170,u,24,24,"MOIC",`${t.moic.toFixed(2)}x`,"Multiple",a.PDF_COLORS.secondary),u+=35;let m=t.equityIRR>15?"strong":t.equityIRR>10?"adequate":"below threshold",y=`This ${(0,a.fmtMoney)(i)} investment in ${e.name} is structured with a ${(100*(r.debtRatio||.6)).toFixed(0)}% debt / ${((1-(r.debtRatio||.6))*100).toFixed(0)}% equity split. The weighted average cost of capital (WACC) is ${(100*t.wacc).toFixed(1)}%. Equity returns are ${m} at ${t.equityIRR.toFixed(1)}% IRR with a ${t.moic.toFixed(2)}x MOIC over the investment horizon. Minimum DSCR of ${t.minDSCR.toFixed(2)}x ${t.minDSCR>=1.25?"provides adequate debt coverage":"raises debt service concerns"}.`;u=(0,a.drawParagraph)(s,u,y),(0,a.drawFooter)(s,c.current,l),s.addPage(),c.current++,(0,a.drawModernHeader)(s,"Capital Structure","Debt/Equity Split & Parameters",l),u=35,u=(0,a.drawSectionTitle)(s,u,"Capital Structure","1",l),d(s,{startY:u,head:[["Parameter","Value"]],body:[["Total CAPEX",(0,a.fmtMoney)(i)],["Debt Ratio",`${(100*(r.debtRatio||.6)).toFixed(0)}%`],["Total Debt",(0,a.fmtMoney)(t.totalDebt||0)],["Total Equity",(0,a.fmtMoney)(t.totalEquity||0)],["Interest Rate",`${(100*(r.debtCostAnnual||.05)).toFixed(1)}%`],["Debt Term",`${r.debtTermYears||10} years`],["Equity Cost of Capital",`${(100*(r.equityCostOfCapital||.12)).toFixed(1)}%`],["WACC",`${(100*t.wacc).toFixed(2)}%`],["Annual Debt Payment",(0,a.fmtMoney)(t.annualDebtPayment||0)]],theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:9},bodyStyles:{fontSize:8},columnStyles:{0:{cellWidth:80},1:{halign:"right"}},margin:{left:14,right:14}}),u=s.lastAutoTable.finalY+10,u=(0,a.ensureSpace)(s,u,60,c),u=(0,a.drawSectionTitle)(s,u,"Debt Amortization Schedule","1.1",l),t.debtSchedule&&t.debtSchedule.length>0&&(d(s,{startY:u,head:[["Year","Opening Bal.","Payment","Interest","Principal","Closing Bal."]],body:t.debtSchedule.map(e=>[`Year ${e.year}`,(0,a.fmtMoney)(e.openingBalance),(0,a.fmtMoney)(e.payment),(0,a.fmtMoney)(e.interest),(0,a.fmtMoney)(e.principal),(0,a.fmtMoney)(e.closingBalance)]),theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},columnStyles:{1:{halign:"right"},2:{halign:"right"},3:{halign:"right"},4:{halign:"right"},5:{halign:"right"}},margin:{left:14,right:14}}),u=s.lastAutoTable.finalY+10),(0,a.drawFooter)(s,c.current,l),s.addPage(),c.current++,(0,a.drawModernHeader)(s,"Returns & Debt Service","Equity Performance Metrics",l),u=35,u=(0,a.drawSectionTitle)(s,u,"Key Return Metrics","2",l),(0,a.drawKpiCard)(s,14,u,42,24,"Equity IRR",`${t.equityIRR.toFixed(1)}%`,"Internal rate of return",t.equityIRR>15?a.PDF_COLORS.secondary:a.PDF_COLORS.warning),(0,a.drawKpiCard)(s,60,u,42,24,"MOIC",`${t.moic.toFixed(2)}x`,"Multiple on invested capital"),(0,a.drawKpiCard)(s,106,u,42,24,"Min DSCR",`${t.minDSCR.toFixed(2)}x`,t.minDSCR>=1.25?"Above 1.25x threshold":"Below 1.25x threshold",t.minDSCR>=1.25?a.PDF_COLORS.secondary:a.PDF_COLORS.danger),(0,a.drawKpiCard)(s,152,u,42,24,"Y1 Cash-on-Cash",`${(100*t.year1CashOnCash).toFixed(1)}%`,"Year 1 yield"),u+=35,u=(0,a.drawSectionTitle)(s,u,"DSCR Timeline","2.1",l),t.leveredFCFTable&&t.leveredFCFTable.length>0&&(d(s,{startY:u,head:[["Year","Unlev. FCF","Debt Service","Lev. FCF","Cumulative","CoC %","DSCR"]],body:t.leveredFCFTable.map(e=>[`Year ${e.year}`,(0,a.fmtMoney)(e.unleveredFCF),(0,a.fmtMoney)(e.debtService),(0,a.fmtMoney)(e.leveredFCF),(0,a.fmtMoney)(e.cumulativeLevered),`${(100*e.cashOnCashPct).toFixed(1)}%`,`${e.dscr.toFixed(2)}x`]),theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},columnStyles:{1:{halign:"right"},2:{halign:"right"},3:{halign:"right"},4:{halign:"right"},5:{halign:"right"},6:{halign:"center"}},margin:{left:14,right:14},didParseCell:e=>{"body"===e.section&&6===e.column.index&&(1.25>parseFloat(e.cell.text[0])?e.cell.styles.textColor=[220,38,38]:e.cell.styles.textColor=[34,197,94])}}),u=s.lastAutoTable.finalY+10),(0,a.drawFooter)(s,c.current,l),s.addPage(),c.current++,(0,a.drawModernHeader)(s,"Valuation Analysis","Multi-Method Assessment",l),u=35,u=(0,a.drawSectionTitle)(s,u,"Valuation Methods","3",l),t.valuation&&(d(s,{startY:u,head:[["Method","Implied Value","$/kW"]],body:[["EV/EBITDA Multiple",(0,a.fmtMoney)(t.valuation.evEbitda),`$${Math.round(t.valuation.evEbitda/o).toLocaleString()}`],["Cap Rate Method",(0,a.fmtMoney)(t.valuation.capRateVal),`$${Math.round(t.valuation.capRateVal/o).toLocaleString()}`],["$/kW Implied",(0,a.fmtMoney)(t.valuation.perKwVal),`$${Math.round(t.valuation.dollarPerKw).toLocaleString()}`]],theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:9},bodyStyles:{fontSize:8},columnStyles:{1:{halign:"right"},2:{halign:"right"}},margin:{left:14,right:14}}),u=s.lastAutoTable.finalY+10),u=(0,a.ensureSpace)(s,u,50,c),u=(0,a.drawSectionTitle)(s,u,"Exit Waterfall","3.1",l),d(s,{startY:u,head:[["Component","Value"]],body:[["Stabilized EBITDA",(0,a.fmtMoney)(t.stabilizedEBITDA||0)],[`Exit EV (${r.exitEbitdaMultiple||15}x EBITDA)`,(0,a.fmtMoney)(t.exitEV||0)],["Less: Remaining Debt",`(${(0,a.fmtMoney)(t.exitRemainingDebt||0)})`],[{content:"Equity Value at Exit",styles:{fontStyle:"bold"}},{content:(0,a.fmtMoney)(t.exitEquityValue||0),styles:{fontStyle:"bold"}}]],theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:9},bodyStyles:{fontSize:8},columnStyles:{0:{cellWidth:100},1:{halign:"right"}},margin:{left:14,right:14}}),u=s.lastAutoTable.finalY+10,u=(0,a.ensureSpace)(s,u,60,c),u=(0,a.drawSectionTitle)(s,u,"Terminal Value Sensitivity","3.2",l);let h=t.stabilizedNOI||t.stabilizedEBITDA||0;if(d(s,{startY:u,head:[["Cap Rate","Terminal Value","$/kW","vs Current CAPEX"]],body:[5,5.5,6,6.5,7,7.5,8].map(e=>{let t=h/(e/100),r=t/o,n=i>0?((t/i-1)*100).toFixed(0):"—";return[`${e.toFixed(1)}%`,(0,a.fmtMoney)(t),`$${Math.round(r).toLocaleString()}/kW`,`${n}%`]}),theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},columnStyles:{1:{halign:"right"},2:{halign:"right"},3:{halign:"right"}},margin:{left:14,right:14}}),u=s.lastAutoTable.finalY+10,(0,a.drawFooter)(s,c.current,l),s.addPage(),c.current++,(0,a.drawModernHeader)(s,"IPO & Acquisition Analysis","Exit Strategy Pricing",l),u=35,u=(0,a.drawSectionTitle)(s,u,"IPO / Acquisition Pricing","4",l),d(s,{startY:u,head:[["Metric","Value"]],body:[["Implied IPO Price",(0,a.fmtMoney)(t.ipoPrice||0)],["Control Premium",`${(100*(r.controlPremiumPct||.2)).toFixed(0)}%`],["Pre-Money Valuation",(0,a.fmtMoney)(t.exitEV||0)],["$/kW Implied",`$${Math.round((t.ipoPrice||0)/o).toLocaleString()}`]],theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:9},bodyStyles:{fontSize:8},columnStyles:{0:{cellWidth:100},1:{halign:"right"}},margin:{left:14,right:14}}),u=s.lastAutoTable.finalY+10,u=(0,a.ensureSpace)(s,u,60,c),u=(0,a.drawSectionTitle)(s,u,"Acquisition Sensitivity","4.1",l),t.acquisitionTable&&t.acquisitionTable.length>0&&(d(s,{startY:u,head:[["EV/EBITDA","Enterprise Value","Equity Value","$/kW"]],body:t.acquisitionTable.map(e=>[`${e.multiple}x`,(0,a.fmtMoney)(e.enterpriseValue),(0,a.fmtMoney)(e.equityValue),`$${Math.round(e.impliedDollarPerKw).toLocaleString()}/kW`]),theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},columnStyles:{1:{halign:"right"},2:{halign:"right"},3:{halign:"right"}},margin:{left:14,right:14}}),u=s.lastAutoTable.finalY+10),(0,a.drawFooter)(s,c.current,l),s.addPage(),c.current++,(0,a.drawModernHeader)(s,"Investment Readiness","Due Diligence Checklist",l),u=35,u=(0,a.drawSectionTitle)(s,u,"Readiness Assessment","5",l),(0,a.drawKpiCard)(s,14,u,55,24,"Readiness Score",`${t.readinessScore}/100`,t.readinessLabel||"N/A",t.readinessScore>=70?a.PDF_COLORS.secondary:t.readinessScore>=40?a.PDF_COLORS.warning:a.PDF_COLORS.danger),u+=35,t.readinessChecks&&t.readinessChecks.length>0&&(d(s,{startY:u,head:[["Criteria","Target","Actual","Status","Weight"]],body:t.readinessChecks.map(e=>[e.label,e.target,e.actual,e.pass?"✓ PASS":"✗ FAIL",`${(100*e.weight).toFixed(0)}%`]),theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},columnStyles:{4:{halign:"center"}},margin:{left:14,right:14},didParseCell:e=>{if("body"===e.section&&3===e.column.index){let t=e.cell.text[0].includes("PASS");e.cell.styles.textColor=t?[34,197,94]:[220,38,38],e.cell.styles.fontStyle="bold"}}}),u=s.lastAutoTable.finalY+10),(0,a.drawFooter)(s,c.current,l),s.addPage(),c.current++,(0,a.drawModernHeader)(s,"Sensitivity Analysis","Equity IRR Matrix",l),u=35,u=(0,a.drawSectionTitle)(s,u,"Equity IRR Sensitivity Matrix","6",l),t.sensitivityMatrix&&t.sensitivityMatrix.length>0){let e=Array.from(new Set(t.sensitivityMatrix.map(e=>e.debtRatio))).sort((e,t)=>e-t),r=Array.from(new Set(t.sensitivityMatrix.map(e=>e.exitMultiple))).sort((e,t)=>e-t);d(s,{startY:u,head:[["Debt Ratio \\ Exit Multiple",...r.map(e=>`${e}x`)]],body:e.map(e=>{let a=[{content:`${(100*e).toFixed(0)}%`,styles:{fontStyle:"bold"}}];return r.forEach(r=>{let n=t.sensitivityMatrix.find(t=>t.debtRatio===e&&t.exitMultiple===r),i=n?n.equityIRR:0,o=i>=20?[34,197,94]:i>=12?[245,158,11]:[220,38,38];a.push({content:`${i.toFixed(1)}%`,styles:{textColor:o,fontStyle:"bold",halign:"center"}})}),a}),theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:7,halign:"center"},bodyStyles:{fontSize:7},columnStyles:{0:{cellWidth:35}},margin:{left:14,right:14}}),u=s.lastAutoTable.finalY+10}u=(0,a.ensureSpace)(s,u,50,c),u=(0,a.drawSectionTitle)(s,u,"Key Variable Impact Analysis","6.1",l),d(s,{startY:u,head:[["Variable","Impact Level","Description"]],body:[["Debt Ratio","High","Higher leverage amplifies equity returns but increases risk"],["Exit Multiple","High","Directly impacts terminal value and MOIC"],["Interest Rate","Medium","Affects debt service coverage and levered cash flow"],["Occupancy Ramp","Medium","Slower ramp-up delays cash generation"],["Revenue/kW","High","Primary driver of NOI and EBITDA"],["OPEX Escalation","Low-Medium","Compounding effect on long-term profitability"]],theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},margin:{left:14,right:14}}),(0,a.drawFooter)(s,c.current,l),(0,a.savePdf)(s,`DCMOC_Investment_${e.name}_${new Date().toISOString().slice(0,10)}.pdf`)};e.s(["generateInvestmentPDF",0,l],91651);let s=async(e,t,r)=>{let{doc:n,autoTable:i}=await (0,a.initDoc)(r),o={current:1};(0,a.drawCoverPage)(n,"Asset Lifecycle &\nDepreciation Analysis",`Portfolio Assessment for ${e.name}`,{client:"Asset Management",date:(0,a.today)(),version:"1.0",confidential:!0},r),n.addPage(),o.current++,(0,a.drawModernHeader)(n,"Executive Summary","Asset Portfolio Overview",r);let l=35;(0,a.drawKpiCard)(n,14,l,42,24,"Total Acquisition",(0,a.fmtMoney)(t.totalAcquisitionCost),"Initial CAPEX"),(0,a.drawKpiCard)(n,60,l,42,24,"25-Year Lifecycle",(0,a.fmtMoney)(t.totalLifecycleCost25yr),"Total lifecycle cost"),(0,a.drawKpiCard)(n,106,l,42,24,"Annual Refresh",(0,a.fmtMoney)(t.annualCapexRefresh),"Average per year"),(0,a.drawKpiCard)(n,152,l,42,24,"NPV Replacements",(0,a.fmtMoney)(t.npvOfReplacements),"Discounted"),l+=35;let s=t.portfolioSummary;if(s){let e=`The facility operates ${t.assets.length} asset categories with a total acquisition cost of ${(0,a.fmtMoney)(t.totalAcquisitionCost)}. Peak replacement spending of ${(0,a.fmtMoney)(s.peakSpendAmount)} occurs in Year ${s.peakSpendYear}. The next major replacement is ${s.nextReplacement?.name||"N/A"} in Year ${s.nextReplacement?.year||"N/A"} at ${(0,a.fmtMoney)(s.nextReplacement?.cost||0)}. Depreciation method: ${t.depreciationMethod}.`;l=(0,a.drawParagraph)(n,l,e)}if((0,a.drawFooter)(n,o.current,r),n.addPage(),o.current++,(0,a.drawModernHeader)(n,"Asset Inventory","Complete Equipment Register",r),l=35,l=(0,a.drawSectionTitle)(n,l,"Asset Register","1",r),i(n,{startY:l,head:[["Asset","Qty","Useful Life","Unit Cost","Total Cost","Annual Depr.","Replace Yr"]],body:t.assets.map(e=>[e.name,`${e.count}`,`${e.usefulLifeYears} yr`,(0,a.fmtMoney)(e.unitCost),(0,a.fmtMoney)(e.totalAcquisitionCost),(0,a.fmtMoney)(e.annualDepreciation),`Year ${e.replacementYear}`]),theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},columnStyles:{1:{halign:"center"},2:{halign:"center"},3:{halign:"right"},4:{halign:"right"},5:{halign:"right"}},margin:{left:14,right:14}}),l=n.lastAutoTable.finalY+10,(0,a.drawFooter)(n,o.current,r),n.addPage(),o.current++,(0,a.drawModernHeader)(n,"Depreciation Schedule",`${t.depreciationMethod} Method`,r),l=35,l=(0,a.drawSectionTitle)(n,l,"Annual Depreciation by Category","2",r),t.annualDepreciationSchedule&&t.annualDepreciationSchedule.length>0){let e=Object.keys(t.annualDepreciationSchedule[0].byCategory||{}),r=t.annualDepreciationSchedule.slice(0,25).map(t=>{let r=[`Year ${t.year}`];return e.forEach(e=>{r.push(t.byCategory[e]>0?(0,a.fmt)(t.byCategory[e]):"—")}),r.push((0,a.fmtMoney)(t.total)),r});i(n,{startY:l,head:[["Year",...e.map(e=>e.substring(0,12)),"Total"]],body:r,theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:6.5},bodyStyles:{fontSize:6.5},columnStyles:Object.fromEntries([...Array(e.length+2).keys()].slice(1).map(e=>[e,{halign:"right"}])),margin:{left:14,right:14}}),l=n.lastAutoTable.finalY+10}l=(0,a.ensureSpace)(n,l,60,o),l=(0,a.drawSectionTitle)(n,l,"Book Value & Cumulative Replacement","2.1",r),t.bookValueCurve&&t.bookValueCurve.length>0&&(i(n,{startY:l,head:[["Year","Book Value","Cumulative Replacement"]],body:t.bookValueCurve.filter((e,a)=>a%5==0||a===t.bookValueCurve.length-1).map(e=>[`Year ${e.year}`,(0,a.fmtMoney)(e.bookValue),(0,a.fmtMoney)(e.cumulativeReplacement)]),theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},columnStyles:{1:{halign:"right"},2:{halign:"right"}},margin:{left:14,right:14}}),l=n.lastAutoTable.finalY+10),(0,a.drawFooter)(n,o.current,r),n.addPage(),o.current++,(0,a.drawModernHeader)(n,"Replacement Timeline","25-Year CAPEX Refresh Plan",r),l=35,l=(0,a.drawSectionTitle)(n,l,"Replacement Schedule","3",r),t.replacementTimeline&&t.replacementTimeline.length>0&&(i(n,{startY:l,head:[["Year","Asset","Category","Count","Cost"]],body:t.replacementTimeline.map(e=>[`Year ${e.year}`,e.assetName,e.category,`${e.count}`,(0,a.fmtMoney)(e.cost)]),theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},columnStyles:{3:{halign:"center"},4:{halign:"right"}},margin:{left:14,right:14}}),l=n.lastAutoTable.finalY+10),s&&(l=(0,a.ensureSpace)(n,l,30,o),l=(0,a.drawExecutiveBox)(n,l,`Peak Replacement Year: Year ${s.peakSpendYear}`,`Peak replacement spending of ${(0,a.fmtMoney)(s.peakSpendAmount)} occurs in Year ${s.peakSpendYear}. Plan cash reserves or credit facilities accordingly.`,"warning")),(0,a.drawFooter)(n,o.current,r),n.addPage(),o.current++,(0,a.drawModernHeader)(n,"Asset Health Assessment","Risk & Condition Analysis",r),l=35,l=(0,a.drawSectionTitle)(n,l,"Asset Health Scores","4",r),t.healthScores&&t.healthScores.length>0&&(i(n,{startY:l,head:[["Asset","Category","Health %","Risk Level","Remaining Life","Failure Prob."]],body:t.healthScores.map(e=>[e.name,e.category||"N/A",`${e.healthPct}%`,e.riskLevel,`${e.remainingLife.toFixed(1)} yr`,`${(100*e.failureProbability).toFixed(1)}%`]),theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},columnStyles:{2:{halign:"center"},4:{halign:"right"},5:{halign:"right"}},margin:{left:14,right:14},didParseCell:e=>{if("body"===e.section&&3===e.column.index){let t=e.cell.text[0];"critical"===t?e.cell.styles.textColor=[220,38,38]:"high"===t?e.cell.styles.textColor=[245,158,11]:"medium"===t?e.cell.styles.textColor=[59,130,246]:e.cell.styles.textColor=[34,197,94]}if("body"===e.section&&2===e.column.index){let t=parseInt(e.cell.text[0]);t<=30?e.cell.styles.fillColor=[254,202,202]:t<=60?e.cell.styles.fillColor=[254,243,199]:e.cell.styles.fillColor=[220,252,231]}}}),l=n.lastAutoTable.finalY+10),t.riskEvents&&t.riskEvents.length>0&&(l=(0,a.ensureSpace)(n,l,60,o),l=(0,a.drawSectionTitle)(n,l,"Risk Events Timeline","4.1",r),i(n,{startY:l,head:[["Year","Event Description","Severity"]],body:t.riskEvents.slice(0,15).map(e=>[`Year ${e.year}`,e.description,e.severity]),theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},margin:{left:14,right:14},didParseCell:e=>{if("body"===e.section&&2===e.column.index){let t=e.cell.text[0];"critical"===t?e.cell.styles.textColor=[220,38,38]:"high"===t?e.cell.styles.textColor=[245,158,11]:e.cell.styles.textColor=[34,197,94]}}}),l=n.lastAutoTable.finalY+10),(0,a.drawFooter)(n,o.current,r),n.addPage(),o.current++,(0,a.drawModernHeader)(n,"Financial Impact","Replacement Strategy Comparison",r),l=35,l=(0,a.drawSectionTitle)(n,l,"Replacement Strategy Comparison","5",r);let d=t.financialImpact;if(d){(0,a.drawKpiCard)(n,14,l,42,24,"Early (-2yr)",(0,a.fmtMoney)(d.earlyReplacementNpv),"Proactive NPV",a.PDF_COLORS.info),(0,a.drawKpiCard)(n,60,l,42,24,"On-Time",(0,a.fmtMoney)(t.npvOfReplacements),"Baseline NPV",a.PDF_COLORS.secondary),(0,a.drawKpiCard)(n,106,l,42,24,"Deferred (+2yr)",(0,a.fmtMoney)(d.deferredReplacementNpv),"Deferred NPV",a.PDF_COLORS.warning),(0,a.drawKpiCard)(n,152,l,42,24,"Aging Maint Cost",(0,a.fmtMoney)(d.maintenanceCostOfAging),"Extra OPEX risk",a.PDF_COLORS.danger),l+=35;let e=d.savingsFromEarly>0?"early replacement":"on-time replacement";l=(0,a.drawExecutiveBox)(n,l,"Optimal Replacement Strategy",`Analysis indicates ${e} is optimal. Early replacement saves ${(0,a.fmtMoney)(Math.abs(d.savingsFromEarly))} in NPV terms versus deferral, while avoiding an estimated ${(0,a.fmtMoney)(d.maintenanceCostOfAging)} in accelerated maintenance costs from aging equipment.`,d.savingsFromEarly>0?"success":"info")}(0,a.drawFooter)(n,o.current,r),(0,a.savePdf)(n,`DCMOC_AssetLifecycle_${e.name}_${new Date().toISOString().slice(0,10)}.pdf`)};e.s(["generateAssetLifecyclePDF",0,s],82444);let d=async(e,t,r)=>{let{doc:n,autoTable:i}=await (0,a.initDoc)(r),o={current:1};(0,a.drawCoverPage)(n,"Phased Financial Analysis\n& Investment Timing",`Multi-Phase Strategy for ${e.name}`,{client:"Finance & Strategy",date:(0,a.today)(),version:"1.0",confidential:!0},r),n.addPage(),o.current++,(0,a.drawModernHeader)(n,"Executive Summary","Phased Investment Overview",r);let l=35,s=t.blendedIRR>15?a.PDF_COLORS.secondary:t.blendedIRR>8?a.PDF_COLORS.warning:a.PDF_COLORS.danger;(0,a.drawKpiCard)(n,14,l,35,24,"Blended IRR",`${t.blendedIRR?.toFixed(1)||"N/A"}%`,"Weighted by CAPEX",s),(0,a.drawKpiCard)(n,53,l,35,24,"Total NPV",(0,a.fmtMoney)(t.totalNPV||0),"Combined phases",t.totalNPV>0?a.PDF_COLORS.secondary:a.PDF_COLORS.danger),(0,a.drawKpiCard)(n,92,l,35,24,"Payback",`${t.weightedPayback?.toFixed(1)||"N/A"} yr`,"Weighted average"),(0,a.drawKpiCard)(n,131,l,30,24,"Investment",(0,a.fmt)(t.totalInvestment),"Total CAPEX"),(0,a.drawKpiCard)(n,165,l,29,24,"PI",`${t.profitabilityIndex?.toFixed(2)||"N/A"}x`,"Profitability"),l+=35,t.narrative&&(l=(0,a.drawParagraph)(n,l,t.narrative)+5),(0,a.drawFooter)(n,o.current,r),n.addPage(),o.current++,(0,a.drawModernHeader)(n,"Phase Summary","Investment Decision Matrix",r),l=35,l=(0,a.drawSectionTitle)(n,l,"Per-Phase Investment Decision","1",r),t.phaseResults&&t.phaseResults.length>0&&(i(n,{startY:l,head:[["Phase","CAPEX","IRR","NPV","Payback","Decision"]],body:t.phaseResults.map(e=>{let t=(e.irr||0)>=12?"GO":(e.irr||0)>=8?"CONDITIONAL":"NO-GO";return[e.label||`Phase ${e.id||"?"}`,(0,a.fmtMoney)(e.capex||0),`${e.irr?.toFixed(1)||"N/A"}%`,(0,a.fmtMoney)(e.npv||0),`${e.payback?.toFixed(1)||"N/A"} yr`,t]}),theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:9},bodyStyles:{fontSize:8},columnStyles:{1:{halign:"right"},2:{halign:"right"},3:{halign:"right"},4:{halign:"right"}},margin:{left:14,right:14},didParseCell:e=>{if("body"===e.section&&5===e.column.index){let t=e.cell.text[0];"GO"===t?e.cell.styles.textColor=[34,197,94]:"CONDITIONAL"===t?e.cell.styles.textColor=[245,158,11]:e.cell.styles.textColor=[220,38,38],e.cell.styles.fontStyle="bold"}}}),l=n.lastAutoTable.finalY+10),(0,a.drawFooter)(n,o.current,r),n.addPage(),o.current++,(0,a.drawModernHeader)(n,"Blended Cashflow","Combined Phase Projection",r),l=35,l=(0,a.drawSectionTitle)(n,l,"Blended Cashflow Table","2",r),t.blendedCashflows&&t.blendedCashflows.length>0&&(i(n,{startY:l,head:[["Year","Revenue","OPEX","Net Cashflow","Cumulative"]],body:t.blendedCashflows.slice(0,15).map(e=>[`Year ${e.year}`,(0,a.fmtMoney)(e.revenue||0),(0,a.fmtMoney)(e.opex||0),(0,a.fmtMoney)((e.revenue||0)-(e.opex||0)),(0,a.fmtMoney)(e.cumulativeCashflow||0)]),theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},columnStyles:{1:{halign:"right",textColor:[5,150,105]},2:{halign:"right",textColor:[220,38,38]},3:{halign:"right"},4:{halign:"right"}},margin:{left:14,right:14},didParseCell:e=>{if("body"===e.section&&4===e.column.index){let t=parseFloat(e.cell.text[0].replace(/[^-\d.]/g,""));e.cell.styles.textColor=t>=0?[5,150,105]:[220,38,38],e.cell.styles.fontStyle="bold"}}}),l=n.lastAutoTable.finalY+10),(0,a.drawFooter)(n,o.current,r),n.addPage(),o.current++,(0,a.drawModernHeader)(n,"Scenario Comparison","Conservative / Base / Aggressive",r),l=35,l=(0,a.drawSectionTitle)(n,l,"Scenario Analysis","3",r),t.scenarios&&t.scenarios.length>0&&(i(n,{startY:l,head:[["Scenario","IRR","NPV","Payback","CAPEX"]],body:t.scenarios.map(e=>[e.name||e.label||"N/A",`${e.irr?.toFixed(1)||"N/A"}%`,(0,a.fmtMoney)(e.npv||0),`${e.payback?.toFixed(1)||"N/A"} yr`,(0,a.fmtMoney)(e.capex||t.totalInvestment||0)]),theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:9},bodyStyles:{fontSize:8},columnStyles:{1:{halign:"right"},2:{halign:"right"},3:{halign:"right"},4:{halign:"right"}},margin:{left:14,right:14}}),l=n.lastAutoTable.finalY+10,l=(0,a.ensureSpace)(n,l,50,o),l=(0,a.drawSectionTitle)(n,l,"Scenario Parameters","3.1",r),i(n,{startY:l,head:[["Scenario","Revenue Multiplier","CAPEX Multiplier","Occupancy Delay"]],body:t.scenarios.map(e=>[e.name||e.label||"N/A",`${(e.revenueMultiplier||1).toFixed(2)}x`,`${(e.capexMultiplier||1).toFixed(2)}x`,`${e.occupancyDelay||0} months`]),theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},columnStyles:{1:{halign:"center"},2:{halign:"center"},3:{halign:"center"}},margin:{left:14,right:14}}),l=n.lastAutoTable.finalY+10),(0,a.drawFooter)(n,o.current,r),n.addPage(),o.current++,(0,a.drawModernHeader)(n,"Construction Financing","Interest During Construction (IDC)",r),l=35,l=(0,a.drawSectionTitle)(n,l,"IDC Breakdown by Phase","4",r),t.idcData&&t.idcData.length>0&&(i(n,{startY:l,head:[["Phase","CAPEX","Draw Period","Monthly Draw","IDC Amount"]],body:t.idcData.map(e=>[e.label||e.phase||"N/A",(0,a.fmtMoney)(e.capex||0),`${e.drawMonths||0} mo`,(0,a.fmtMoney)(e.monthlyDraw||0),(0,a.fmtMoney)(e.idcAmount||0)]),theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},columnStyles:{1:{halign:"right"},3:{halign:"right"},4:{halign:"right"}},margin:{left:14,right:14}}),l=n.lastAutoTable.finalY+10),void 0!==t.totalIDC&&(l=(0,a.drawExecutiveBox)(n,l,"Construction Financing Summary",`Total Interest During Construction (IDC): ${(0,a.fmtMoney)(t.totalIDC)}. Effective total CAPEX including IDC: ${(0,a.fmtMoney)(t.totalInvestment+t.totalIDC)}.`,"info")),(0,a.drawFooter)(n,o.current,r),t.crossModuleAdjustments&&t.crossModuleAdjustments.length>0&&(n.addPage(),o.current++,(0,a.drawModernHeader)(n,"Cross-Module Adjustments","External Factor Impacts",r),l=35,l=(0,a.drawSectionTitle)(n,l,"Cross-Module Adjustments","5",r),i(n,{startY:l,head:[["Adjustment","Source Module","Impact on Returns"]],body:t.crossModuleAdjustments.map(e=>[e.adjustment||e.name||"N/A",e.sourceModule||e.source||"N/A",e.impact||e.description||"N/A"]),theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},margin:{left:14,right:14}}),(0,a.drawFooter)(n,o.current,r)),(0,a.savePdf)(n,`DCMOC_PhasedFinancial_${e.name}_${new Date().toISOString().slice(0,10)}.pdf`)};e.s(["generatePhasedFinancialPDF",0,d],77034);let c=async(e,t,r,n)=>{let{doc:i,autoTable:o}=await (0,a.initDoc)(n),l={current:1};(0,a.drawCoverPage)(i,"Carbon & ESG\nFootprint Report",`Sustainability Profile for ${e.name}`,{client:"Sustainability Office",date:(0,a.today)(),version:"2.0"},n),i.addPage(),l.current++,(0,a.drawModernHeader)(i,"ESG Executive Summary",`Rating: ${t.efficiencyRating}`,n);let s=35;(0,a.drawKpiCard)(i,14,s,42,24,"Emissions",`${Math.round(t.annualEmissionsTonCO2)} tCO₂`,"Scope 1+2+3"),(0,a.drawKpiCard)(i,60,s,42,24,"Effective PUE",`${t.pueEfficiency.toFixed(2)}`,"Design target"),(0,a.drawKpiCard)(i,106,s,42,24,"Tax Exposure",(0,a.fmt)(t.carbonTaxExposureUSD),"Potential liability"),(0,a.drawKpiCard)(i,152,s,42,24,"Renewable",`${t.renewableReductionPct}%`,"Offset %"),s+=35,s=(0,a.drawParagraph)(i,s,r),(0,a.drawFooter)(i,l.current,n),i.addPage(),l.current++,(0,a.drawModernHeader)(i,"Emissions Breakdown","GHG Protocol Scope Analysis",n),s=35,s=(0,a.drawSectionTitle)(i,s,"GHG Protocol Scopes","1",n);let d=[{label:"Scope 1 (Direct)",value:t.scope1,color:a.PDF_COLORS.danger},{label:"Scope 2 (Grid)",value:t.scope2,color:a.PDF_COLORS.warning},{label:"Scope 3 (Supply)",value:t.scope3,color:a.PDF_COLORS.accent}];s=(0,a.drawDistributionChart)(i,14,s,180,d,"Annual Emissions by Scope"),s=(0,a.ensureSpace)(i,s,50,l),o(i,{startY:s,head:[["Scope","Description","Annual tCO₂","% of Total"]],body:[["Scope 1","Direct emissions (diesel generators, refrigerants)",`${t.scope1.toFixed(1)}`,`${(t.scope1/t.annualEmissionsTonCO2*100).toFixed(1)}%`],["Scope 2","Indirect — grid electricity",`${t.scope2.toFixed(1)}`,`${(t.scope2/t.annualEmissionsTonCO2*100).toFixed(1)}%`],["Scope 3","Supply chain & embedded",`${t.scope3.toFixed(1)}`,`${(t.scope3/t.annualEmissionsTonCO2*100).toFixed(1)}%`],[{content:"Total",styles:{fontStyle:"bold"}},"",{content:`${t.annualEmissionsTonCO2.toFixed(1)}`,styles:{fontStyle:"bold"}},{content:"100%",styles:{fontStyle:"bold"}}]],theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},columnStyles:{2:{halign:"right"},3:{halign:"right"}},margin:{left:14,right:14}}),s=i.lastAutoTable.finalY+10,(0,a.drawFooter)(i,l.current,n),i.addPage(),l.current++,(0,a.drawModernHeader)(i,"Energy Consumption","Facility Power Breakdown",n),s=35,s=(0,a.drawSectionTitle)(i,s,"Energy Breakdown","2",n),o(i,{startY:s,head:[["Component","Annual MWh","% of Total"]],body:[["IT Equipment",`${t.itEnergyMWh.toFixed(0)}`,`${(t.itEnergyMWh/t.annualEnergyMWh*100).toFixed(1)}%`],["Cooling Systems",`${t.coolingEnergyMWh.toFixed(0)}`,`${(t.coolingEnergyMWh/t.annualEnergyMWh*100).toFixed(1)}%`],["Distribution Losses",`${t.lossEnergyMWh.toFixed(0)}`,`${(t.lossEnergyMWh/t.annualEnergyMWh*100).toFixed(1)}%`],[{content:"Total",styles:{fontStyle:"bold"}},{content:`${t.annualEnergyMWh.toFixed(0)}`,styles:{fontStyle:"bold"}},{content:"100%",styles:{fontStyle:"bold"}}]],theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:9},bodyStyles:{fontSize:8},columnStyles:{1:{halign:"right"},2:{halign:"right"}},margin:{left:14,right:14}}),s=i.lastAutoTable.finalY+10,s=(0,a.ensureSpace)(i,s,50,l),s=(0,a.drawSectionTitle)(i,s,"PUE Benchmark Analysis","2.1",n);let c=t.pueEfficiency;o(i,{startY:s,head:[["Metric","PUE Value","Assessment"]],body:[["Design PUE",c.toFixed(2),c<1.3?"Best-in-Class":c<1.5?"Above Average":"Standard"],["Industry Average","1.58","Uptime Institute 2024"],["Best-in-Class","1.10","Hyperscaler benchmark"],[{content:"Gap vs Industry",styles:{fontStyle:"bold"}},{content:`${(1.58-c).toFixed(2)}`,styles:{fontStyle:"bold"}},{content:c<1.58?`${((1-c/1.58)*100).toFixed(0)}% better`:`${((c/1.58-1)*100).toFixed(0)}% worse`,styles:{fontStyle:"bold"}}]],theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:8},columnStyles:{1:{halign:"center"}},margin:{left:14,right:14}}),s=i.lastAutoTable.finalY+10,(0,a.drawFooter)(i,l.current,n),i.addPage(),l.current++,(0,a.drawModernHeader)(i,"Carbon Reduction Scenarios","Investment Pathways",n),s=35,s=(0,a.drawSectionTitle)(i,s,"Carbon Reduction Investment Scenarios","3",n),o(i,{startY:s,head:[["Initiative","Investment","CO₂ Abatement","Annual Savings","Payback"]],body:t.reductionScenarios.map(e=>[e.name,(0,a.fmtMoney)(e.investmentUSD),`${Math.round(e.annualSavingsTonCO2)} tCO₂/yr`,(0,a.fmtMoney)(e.annualSavingsUSD),e.paybackYears>0?`${e.paybackYears} yrs`:"Immediate/PPA"]),theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},columnStyles:{1:{halign:"right"},3:{halign:"right"}},margin:{left:14,right:14}}),s=i.lastAutoTable.finalY+10,(0,a.drawFooter)(i,l.current,n),i.addPage(),l.current++,(0,a.drawModernHeader)(i,"Net-Zero Trajectory","Decarbonization Roadmap",n),s=35,s=(0,a.drawSectionTitle)(i,s,"Net-Zero Emissions Target","4",n);let u=t.annualEmissionsTonCO2;o(i,{startY:s,head:[["Year","Emissions Target (tCO₂)","Reduction %","Strategy"]],body:[["2025 (Current)",`${Math.round(u)}`,"0%","Baseline measurement"],["2030",`${Math.round(.55*u)}`,"45%","Green PPA + efficiency"],["2040",`${Math.round(.15*u)}`,"85%","Full renewable + carbon capture"],["2050","0","100%","Net-zero achieved"]],theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:8},columnStyles:{1:{halign:"right"},2:{halign:"right"}},margin:{left:14,right:14}}),s=i.lastAutoTable.finalY+10,s=(0,a.ensureSpace)(i,s,40,l),s=(0,a.drawSectionTitle)(i,s,"Key Milestones","4.1",n),(0,a.drawKpiCard)(i,14,s,55,24,"Current Emissions",`${Math.round(u)} tCO₂`,"Annual baseline",a.PDF_COLORS.danger),(0,a.drawKpiCard)(i,75,s,55,24,"2030 Target",`${Math.round(.55*u)} tCO₂`,"45% reduction",a.PDF_COLORS.warning),(0,a.drawKpiCard)(i,136,s,55,24,"Net-Zero Year","2050","Target date",a.PDF_COLORS.secondary),(0,a.drawFooter)(i,l.current,n),(0,a.savePdf)(i,`DCMOC_CarbonESG_${e.name}_${new Date().toISOString().slice(0,10)}.pdf`)};e.s(["generateCarbonPDF",0,c],80686);let u=async(e,t,r,n,i,o,l,s,d,c)=>{let{doc:u,autoTable:m}=await (0,a.initDoc)(c),y={current:1};(0,a.drawCoverPage)(u,"Financial Feasibility\n& Revenue Analysis",`Investment Case for ${e.name}`,{client:"CFO / Investment Comm.",date:(0,a.today)(),version:"2.0"},c),u.addPage(),y.current++,(0,a.drawModernHeader)(u,"Financial & Revenue Parameters","Assumption Guidelines",c);let h=35,S=(e,t,r,n)=>{u.setFillColor(248,250,252),u.setDrawColor(226,232,240),u.roundedRect(e,t,85,10+8*n.length,2,2,"FD"),u.setFont("helvetica","bold"),u.setFontSize(9),u.setTextColor(...a.PDF_COLORS.slate700),u.text(r,e+4,t+6);let i=t+12;return n.forEach(t=>{u.setFont("helvetica","normal"),u.setFontSize(8),u.setTextColor(...a.PDF_COLORS.slate500),u.text(t.label,e+4,i),u.setFont("helvetica","bold"),u.setTextColor(...a.PDF_COLORS.slate900),u.text(t.value,e+81,i,{align:"right"}),i+=8}),t+10+8*n.length+4},g=35;g=S(14,35,"Financial Analysis",[{label:"Revenue per kW/month",value:`$${n.revenuePerKwMonth}`},{label:"Discount Rate",value:`${(100*n.discountRate).toFixed(0)}%`},{label:"Project Life",value:`${n.projectLifeYears} yrs`},{label:"Rev. Escalation",value:`${(100*n.escalationRate).toFixed(0)}%`},{label:"OPEX Escalation",value:`${(100*n.opexEscalation).toFixed(1)}%`},{label:"Tax Rate",value:`${(100*n.taxRate).toFixed(0)}%`},{label:"Depreciation",value:`${n.depreciationYears} yrs`}]),g=S(14,g,"NRC (Non-Recurring Charges)",[{label:"Setup Fee",value:`$${i.nrcPerKw}/kW`},{label:"X-Connect Setup",value:(0,a.fmtMoney)(i.nrcCrossConnect)},{label:"Custom Fit-out",value:(0,a.fmtMoney)(i.nrcCustomFitout)}]);let f=h;if(f=S(105,f,"MRC (Monthly Recurring)",[{label:"MRC $/kW/mo",value:`$${i.mrcPerKwMonth}`},{label:"Escalation",value:`${(100*i.mrcEscalation).toFixed(0)}%/yr`},{label:"X-Connect MRC",value:`$${i.mrcCrossConnectMonthly}/mo`}]),f=S(105,f,"Contract Terms",[{label:"Lease Term",value:`${i.contractYears} yrs`},{label:"Take-or-Pay Floor",value:`${i.takeOrPayPct}%`}]),f=S(105,f,"Quick Summary",[{label:"CAPEX Investment",value:(0,a.fmtMoney)(o)},{label:"Annual OPEX (est.)",value:(0,a.fmtMoney)(l)},{label:"Break-even Occupancy",value:`${t.breakEvenOccupancy}%`},{label:"Total NRC",value:(0,a.fmtMoney)(r.totalNRC)},{label:"TCV",value:(0,a.fmtMoney)(r.contractValue)}]),(0,a.drawFooter)(u,y.current,c),u.addPage(),y.current++,(0,a.drawModernHeader)(u,"Financial Executive Summary","Key Investment & Revenue Metrics",c),h=35,(0,a.drawKpiCard)(u,14,h,42,24,"NPV",(0,a.fmtMoney)(t.npv),"Net Present Value",t.npv>0?a.PDF_COLORS.secondary:a.PDF_COLORS.danger),(0,a.drawKpiCard)(u,60,h,42,24,"IRR",`${t.irr.toFixed(1)}%`,t.irr>100*n.discountRate?"Exceeds hurdle":"Below hurdle"),(0,a.drawKpiCard)(u,106,h,42,24,"Payback",`${t.paybackPeriodYears.toFixed(1)} yrs`,`Discounted: ${t.discountedPaybackYears} yrs`),(0,a.drawKpiCard)(u,152,h,42,24,"ROI",`${t.roiPercent.toFixed(0)}%`,`PI: ${t.profitabilityIndex.toFixed(2)}x`),h+=32,(0,a.drawKpiCard)(u,14,h,42,24,"Total NRC",(0,a.fmtMoney)(r.totalNRC),"One-time fees"),(0,a.drawKpiCard)(u,60,h,42,24,"Lifetime MRC",(0,a.fmtMoney)(r.totalMRC_lifetime),`Over ${i.contractYears} yrs`),(0,a.drawKpiCard)(u,106,h,42,24,"TCV",(0,a.fmtMoney)(r.contractValue),"Total Contract Value"),(0,a.drawKpiCard)(u,152,h,42,24,"Effective Rate",`$${r.effectiveRate.toFixed(0)}/kW/mo`,"Blended rate"),h+=35,h=(0,a.drawExecutiveBox)(u,h,"Financial Verdict",t.npv>0?`Strong investment case. Positive NPV of ${(0,a.fmtMoney)(t.npv)} indicates value creation above the discount rate.`:`Caution advised. Negative NPV of ${(0,a.fmtMoney)(t.npv)} suggests returns may not meet capital cost requirements.`,t.npv>0?"success":"warning"),(0,a.drawFooter)(u,y.current,c),d?.cashflow||d?.waterfall||d?.mrc){if(u.addPage(),y.current++,(0,a.drawModernHeader)(u,"Visual Analysis","Cashflow & Revenue Charts",c),h=35,d.cashflow){h=(0,a.drawSectionTitle)(u,h,"Cumulative Cashflow Projection","1",c);try{let e=u.getImageProperties(d.cashflow),t=180*e.height/e.width;u.addImage(d.cashflow,"PNG",15,h,180,t),h+=t+10}catch(e){console.warn("Error adding cashflow image",e)}}if(d.waterfall){h=(0,a.ensureSpace)(u,h,90,y),h=(0,a.drawSectionTitle)(u,h,"Revenue Waterfall","2",c);try{let e=u.getImageProperties(d.waterfall),t=180*e.height/e.width;u.addImage(d.waterfall,"PNG",15,h,180,t),h+=t+10}catch(e){console.warn("Error adding waterfall image",e)}}(0,a.drawFooter)(u,y.current,c)}u.addPage(),y.current++,(0,a.drawModernHeader)(u,"Detailed Cashflow & Revenue","Year-by-Year Projection",c),m(u,{startY:h=35,head:[["Period","Revenue","OPEX","EBITDA","Net Income","Occ%","Cum. CF"]],body:t.cashflows.map((e,t)=>{let n=r.yearDetails?.[t];return[`Y${e.year}`,(0,a.fmtMoney)(e.revenue),(0,a.fmtMoney)(-e.opex),(0,a.fmtMoney)(e.ebitda),(0,a.fmtMoney)(e.netIncome),n?`${(100*n.occupancy).toFixed(0)}%`:"—",(0,a.fmtMoney)(e.cumulativeCashflow)]}),theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:7},styles:{fontSize:7,cellPadding:1},margin:{left:14,right:14},columnStyles:{1:{halign:"right",textColor:[5,150,105]},2:{halign:"right",textColor:[220,38,38]},3:{halign:"right",fontStyle:"bold"},4:{halign:"right"},5:{halign:"right"},6:{halign:"right",fontStyle:"bold"}}}),h=u.lastAutoTable.finalY+10,(0,a.drawFooter)(u,y.current,c),u.addPage(),y.current++,(0,a.drawModernHeader)(u,"OPEX Breakdown","Operating Cost Analysis",c),h=35,h=(0,a.drawSectionTitle)(u,h,"OPEX Category Breakdown","5",c);let C=.45*l,p=.3*l,P=.12*l,w=.05*l,b=.08*l;m(u,{startY:h,head:[["Category","Annual Amount","% of Total"]],body:[["Energy & Utilities",(0,a.fmtMoney)(C),"45%"],["Staffing & Labor",(0,a.fmtMoney)(p),"30%"],["Maintenance & Repairs",(0,a.fmtMoney)(P),"12%"],["Insurance",(0,a.fmtMoney)(w),"5%"],["Overhead & Admin",(0,a.fmtMoney)(b),"8%"],[{content:"Total Annual OPEX",styles:{fontStyle:"bold"}},{content:(0,a.fmtMoney)(l),styles:{fontStyle:"bold"}},{content:"100%",styles:{fontStyle:"bold"}}]],theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:9},bodyStyles:{fontSize:8},columnStyles:{1:{halign:"right"},2:{halign:"right"}},margin:{left:14,right:14}}),h=u.lastAutoTable.finalY+10,h=(0,a.ensureSpace)(u,h,70,y),h=(0,a.drawHorizontalBarChart)(u,14,h,180,[{label:"Energy & Utilities",value:C,color:a.PDF_COLORS.warning},{label:"Staffing & Labor",value:p,color:a.PDF_COLORS.primary},{label:"Maintenance",value:P,color:a.PDF_COLORS.secondary},{label:"Insurance",value:w,color:a.PDF_COLORS.accent},{label:"Overhead",value:b,color:a.PDF_COLORS.slate400}],"Annual OPEX Distribution"),(0,a.drawFooter)(u,y.current,c),u.addPage(),y.current++,(0,a.drawModernHeader)(u,"Sensitivity Analysis","NPV/IRR Under Varying Assumptions",c),h=35,h=(0,a.drawSectionTitle)(u,h,"NPV Sensitivity Matrix","6",c);let F=[-20,-10,0,10,20];m(u,{startY:h,head:[["CAPEX \\ Revenue",...F.map(e=>`${e>=0?"+":""}${e}%`)]],body:[-20,-10,0,10,20].map(e=>{let t=[{content:`${e>=0?"+":""}${e}%`,styles:{fontStyle:"bold"}}];return F.forEach(r=>{let i=o*(1+e/100),d=(12*(n.revenuePerKwMonth*(1+r/100))*s-l)*n.projectLifeYears*.7-i;t.push({content:(0,a.fmt)(d),styles:{textColor:d>0?[34,197,94]:[220,38,38],fontSize:6.5,halign:"center"}})}),t}),theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:7,halign:"center"},bodyStyles:{fontSize:7},margin:{left:14,right:14}}),h=u.lastAutoTable.finalY+10,h=(0,a.ensureSpace)(u,h,50,y),h=(0,a.drawSectionTitle)(u,h,"Break-Even Occupancy Analysis","6.1",c),m(u,{startY:h,head:[["Occupancy %","Annual Revenue","Net Cashflow","Est. NPV","Status"]],body:[30,40,50,60,70,80,90,100].map(e=>{let r=12*n.revenuePerKwMonth*s*(e/100),i=r-l,d=i*n.projectLifeYears*.7-o,c=e===t.breakEvenOccupancy;return[`${e}%`,(0,a.fmtMoney)(r),(0,a.fmtMoney)(i),(0,a.fmt)(d),c?"← Break-Even":d>0?"Profitable":"Loss"]}),theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},columnStyles:{1:{halign:"right"},2:{halign:"right"},3:{halign:"right"}},margin:{left:14,right:14},didParseCell:e=>{if("body"===e.section&&4===e.column.index){let t=e.cell.text[0];t.includes("Break-Even")?(e.cell.styles.textColor=[59,130,246],e.cell.styles.fontStyle="bold"):"Profitable"===t?e.cell.styles.textColor=[34,197,94]:e.cell.styles.textColor=[220,38,38]}}}),h=u.lastAutoTable.finalY+10,h=(0,a.drawExecutiveBox)(u,h,"Break-Even Analysis",`The facility breaks even at ${t.breakEvenOccupancy}% occupancy. Operations above this threshold generate positive returns.`,"info"),(0,a.drawFooter)(u,y.current,c),(0,a.savePdf)(u,`DCMOC_Financials_${e.name}_${new Date().toISOString().slice(0,10)}.pdf`)};e.s(["generateFinancialPDF",0,u],17046);let m=async(e,t,r,n,i)=>{let{doc:o,autoTable:l}=await (0,a.initDoc)(i),s={current:1};(0,a.drawCoverPage)(o,"Capital Expenditure\nReport",`Budget Estimation for ${e.name}`,{client:"Finance Dept",date:(0,a.today)(),version:"3.1"},i),o.addPage(),s.current++,(0,a.drawModernHeader)(o,"Project Configuration","Facility Design & Inputs",i);let d=35,c=(e,t,r,n)=>{o.setFillColor(248,250,252),o.setDrawColor(226,232,240),o.roundedRect(e,t,85,10+8*n.length,2,2,"FD"),o.setFont("helvetica","bold"),o.setFontSize(9),o.setTextColor(...a.PDF_COLORS.slate700),o.text(r,e+4,t+6);let i=t+12;return n.forEach(t=>{o.setFont("helvetica","normal"),o.setFontSize(8),o.setTextColor(...a.PDF_COLORS.slate500),o.text(t.label,e+4,i),o.setFont("helvetica","bold"),o.setTextColor(...a.PDF_COLORS.slate900),o.text(t.value,e+81,i,{align:"right"}),i+=8}),t+10+8*n.length+4},u=35;u=c(14,35,"Facility Layout",[{label:"IT Capacity",value:`${n.itLoad||1e3} kW`},{label:"Redundancy Tier",value:n.redundancy?.toUpperCase()||"N+1"},{label:"Cooling Strategy",value:"air"===n.coolingType?"Air Cooled":"inrow"===n.coolingType?"In-Row":"Other"},{label:"Building Type",value:"purpose"===n.buildingType?"Purpose Built":"Retrofit/Modular"},{label:"Rack Density",value:n.rackType?.toUpperCase()||"STANDARD"}]),u=c(14,u,"Power & Cooling Build",[{label:"UPS System",value:n.upsType||"Modular"},{label:"Generator",value:n.genType||"Diesel"},{label:"Fuel Storage",value:`${n.fuelHours||48} Hours`},{label:"Fire Suppression",value:n.fireType||"Novec"},{label:"Fire Alarm",value:n.alarmType||"Addressable"}]);let m=d;m=c(105,m,"Sustainability & Site",[{label:"Green Certification",value:n.greenCert||"None"},{label:"Renewable Energy",value:n.renewableOption||"None"},{label:"Substation & Grid",value:n.includeFOM?"Include FOM":"Exclude FOM"},{label:"Project Year",value:n.projYear||"2025"},{label:"City Market",value:"none"!==n.cityMarket?n.cityMarket:"Generic"}]),m=c(105,m,"Soft Costs",[{label:"Design Fee",value:`${n.designFee||8}%`},{label:"PM Fee",value:`${n.pmFee||5}%`},{label:"Contingency",value:`${n.contingency||10}%`}]),(0,a.drawFooter)(o,s.current,i),o.addPage(),s.current++,(0,a.drawModernHeader)(o,"Executive Summary",`Total CAPEX: ${(0,a.fmtMoney)(t.total)}`,i),d=35;let{metrics:y,timeline:h}=t;(0,a.drawKpiCard)(o,14,d,42,24,"Total CAPEX",(0,a.fmtMoney)(t.total),"Estimated total"),(0,a.drawKpiCard)(o,60,d,42,24,"Cost per kW",`$${Math.round(y.perKw).toLocaleString()}`,y.perKw<8e3?"Low Cost":"Standard"),(0,a.drawKpiCard)(o,106,d,42,24,"PUE Target",t.pue.toFixed(2),t.pue<1.3?"Best-in-Class":"Good"),(0,a.drawKpiCard)(o,152,d,42,24,"Timeline",`${h.totalMonths} Mo`,"Design to Commission"),d+=32,(0,a.drawKpiCard)(o,14,d,42,24,"Total Racks",`${y.racks}`,"IT equipment"),(0,a.drawKpiCard)(o,60,d,42,24,"Floor Space",`${Math.round(y.floorSpace).toLocaleString()} m\xb2`,"White space"),(0,a.drawKpiCard)(o,106,d,42,24,"Annual Energy",(0,a.fmtMoney)(y.annualEnergy),"@ $0.10/kWh"),(0,a.drawKpiCard)(o,152,d,42,24,"Soft Costs",(0,a.fmtMoney)((t.softCosts.design||0)+(t.softCosts.pm||0)),"Design & PM"),d+=35,d=(0,a.drawParagraph)(o,d,r.replace(/\*\*/g,"")),(0,a.drawFooter)(o,s.current,i),o.addPage(),s.current++,(0,a.drawModernHeader)(o,"Cost Breakdown","Detailed CAPEX Analysis",i),d=35,d=(0,a.drawSectionTitle)(o,d,"Cost Breakdown","1",i);let S=Object.entries(t.costs).sort(([,e],[,t])=>t-e).map(([e,r])=>[e.replace(/([A-Z])/g," $1").trim(),(0,a.fmtMoney)(r),`${(r/t.total*100).toFixed(1)}%`]);t.softCosts.design&&S.push(["Design Fee",(0,a.fmtMoney)(t.softCosts.design),`${(t.softCosts.design/t.total*100).toFixed(1)}%`]),t.softCosts.pm&&S.push(["PM Fee",(0,a.fmtMoney)(t.softCosts.pm),`${(t.softCosts.pm/t.total*100).toFixed(1)}%`]),t.contingency&&S.push(["Contingency",(0,a.fmtMoney)(t.contingency),`${(t.contingency/t.total*100).toFixed(1)}%`]),t.fomTotal>0&&S.push(["Front-of-Meter",(0,a.fmtMoney)(t.fomTotal),`${(t.fomTotal/t.total*100).toFixed(1)}%`]),S.push([{content:"TOTAL CAPEX",styles:{fontStyle:"bold",fillColor:a.PDF_COLORS.secondary,textColor:[255,255,255]}},{content:(0,a.fmtMoney)(t.total),styles:{fontStyle:"bold",fillColor:a.PDF_COLORS.secondary,textColor:[255,255,255]}},{content:"100.0%",styles:{fontStyle:"bold",fillColor:a.PDF_COLORS.secondary,textColor:[255,255,255]}}]),l(o,{startY:d,head:[["Cost Category","Amount (USD)","% of Total"]],body:S,theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},columnStyles:{0:{cellWidth:80},1:{halign:"right"},2:{halign:"right"}},margin:{left:14,right:14}}),d=o.lastAutoTable.finalY+10,d=(0,a.ensureSpace)(o,d,60,s),d=(0,a.drawSectionTitle)(o,d,"Project Timeline","1.1",i),l(o,{startY:d,head:[["Phase","Start","Duration","End"]],body:h.phases.map(e=>[e.name,`Month ${e.start}`,`${e.end-e.start} months`,`Month ${e.end}`]),theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:8},margin:{left:14,right:14}}),d=o.lastAutoTable.finalY+10,(0,a.drawFooter)(o,s.current,i),o.addPage(),s.current++,(0,a.drawModernHeader)(o,"Construction Schedule","L2 Gantt & Sub-Phases",i),d=35,d=(0,a.drawSectionTitle)(o,d,"L2 Gantt Schedule","2",i);let g=[];h.phases.forEach(e=>{g.push([{content:e.name,styles:{fontStyle:"bold",fillColor:[241,245,249]}},{content:"",styles:{fillColor:[241,245,249]}},{content:`M${e.start}`,styles:{fillColor:[241,245,249]}},{content:`${e.end-e.start} mo`,styles:{fillColor:[241,245,249]}},{content:`M${e.end}`,styles:{fillColor:[241,245,249]}}]),e.name.includes("Design")?(g.push(["  Concept Design","",`M${e.start}`,`${Math.ceil((e.end-e.start)*.3)} mo`,`M${e.start+Math.ceil((e.end-e.start)*.3)}`]),g.push(["  Detailed Design","",`M${e.start+Math.ceil((e.end-e.start)*.3)}`,`${Math.ceil((e.end-e.start)*.5)} mo`,`M${e.start+Math.ceil((e.end-e.start)*.8)}`]),g.push(["  Permitting","",`M${e.start+Math.ceil((e.end-e.start)*.5)}`,`${Math.ceil((e.end-e.start)*.5)} mo`,`M${e.end}`])):(e.name.includes("Construction")||e.name.includes("Build"))&&(g.push(["  Civil & Structure","",`M${e.start}`,`${Math.ceil((e.end-e.start)*.35)} mo`,`M${e.start+Math.ceil((e.end-e.start)*.35)}`]),g.push(["  M&E Installation","",`M${e.start+Math.ceil((e.end-e.start)*.25)}`,`${Math.ceil((e.end-e.start)*.45)} mo`,`M${e.start+Math.ceil((e.end-e.start)*.7)}`]),g.push(["  Testing & Commissioning","",`M${e.start+Math.ceil((e.end-e.start)*.7)}`,`${Math.ceil((e.end-e.start)*.3)} mo`,`M${e.end}`]))}),l(o,{startY:d,head:[["Phase / Sub-Phase","Dependencies","Start","Duration","End"]],body:g,theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},margin:{left:14,right:14}}),d=o.lastAutoTable.finalY+10,(0,a.drawFooter)(o,s.current,i),o.addPage(),s.current++,(0,a.drawModernHeader)(o,"Full Configuration","All Sidebar Input Parameters",i),d=35,d=(0,a.drawSectionTitle)(o,d,"Complete Configuration Parameters","3",i),l(o,{startY:d,head:[["Parameter","Value"]],body:[["Region / Country",e.name],["IT Load",`${n.itLoad||1e3} kW`],["Redundancy Tier",n.redundancy?.toUpperCase()||"N+1"],["Cooling Type",n.coolingType||"Air"],["Building Type",n.buildingType||"Purpose Built"],["Rack Density",n.rackType?.toUpperCase()||"Standard"],["UPS Type",n.upsType||"Modular"],["Generator Type",n.genType||"Diesel"],["Fuel Storage",`${n.fuelHours||48} hours`],["Fire Suppression",n.fireType||"Novec"],["Green Certification",n.greenCert||"None"],["Renewable Option",n.renewableOption||"None"],["Substation / FOM",n.includeFOM?"Included":"Excluded"],["Design Fee",`${n.designFee||8}%`],["PM Fee",`${n.pmFee||5}%`],["Contingency",`${n.contingency||10}%`]],theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:9},bodyStyles:{fontSize:8},columnStyles:{0:{cellWidth:80},1:{halign:"right"}},margin:{left:14,right:14}}),(0,a.drawFooter)(o,s.current,i),(0,a.savePdf)(o,`DCMOC_CAPEX_${e.name}_${new Date().toISOString().slice(0,10)}.pdf`)};e.s(["generateCapexPDF",0,m],69012);let y=async(e,t,r)=>{let{doc:n,autoTable:i}=await (0,a.initDoc)(r),o={current:1},l=t.capPlan;(0,a.drawCoverPage)(n,"Capacity Planning\n& Phased Investment",`Multi-Phase Build Strategy for ${e.name}`,{client:"Infrastructure Planning",date:(0,a.today)(),version:"2.0"},r),n.addPage(),o.current++,(0,a.drawModernHeader)(n,"Capacity Plan Overview",`${l.phases.length} Phases — ${(0,a.fmt)(l.totalItLoadKw)} kW Total`,r);let s=35;(0,a.drawKpiCard)(n,14,s,42,24,"Total Capacity",`${(l.totalItLoadKw/1e3).toFixed(1)} MW`,`${l.phases.length} phases`),(0,a.drawKpiCard)(n,60,s,42,24,"Total CAPEX",(0,a.fmt)(l.totalCapex),`$${Math.round(l.totalCapex/l.totalItLoadKw).toLocaleString()}/kW`),(0,a.drawKpiCard)(n,106,s,42,24,"Scalability",`${l.scalabilityScore}/100`,"Phase efficiency"),(0,a.drawKpiCard)(n,152,s,42,24,"Timeline",`${l.totalMonths} mo`,`~${(l.totalMonths/12).toFixed(1)} years`),s+=35,l.narrative&&(s=(0,a.drawParagraph)(n,s,l.narrative)+5),(0,a.drawFooter)(n,o.current,r),n.addPage(),o.current++,(0,a.drawModernHeader)(n,"Phase Breakdown","Investment & Capacity per Phase",r),s=35,s=(0,a.drawSectionTitle)(n,s,"Phase-by-Phase Comparison","1",r);let d=l.phases.map((e,r)=>[t.phases[r]?.label||`Phase ${r+1}`,`${e.itLoadKw.toLocaleString()} kW`,(0,a.fmt)(e.capex),`$${Math.round(e.capexPerKw).toLocaleString()}`,`${e.headcount||e.fte||0} FTE`,e.pue.toFixed(2),`M${t.phases[r]?.startMonth||0}`,`${t.phases[r]?.buildMonths||0} mo`]);if(i(n,{startY:s,head:[["Phase","IT Load","CAPEX","$/kW","Staff","PUE","Start","Build"]],body:d,theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},columnStyles:{2:{halign:"right"},3:{halign:"right"},4:{halign:"right"}},margin:{left:14,right:14}}),s=n.lastAutoTable.finalY+10,l.phaseDetails&&l.phaseDetails.length>0){s=(0,a.ensureSpace)(n,s,60,o),s=(0,a.drawSectionTitle)(n,s,"Enhanced Phase Assessment","1.1",r);let e=l.phaseDetails.map(e=>[e.label,e.description?.substring(0,50)||"",(0,a.fmtMoney)(e.revenueEstimate||0),`${e.roiYears||0} yr`,`${e.riskScore||0}/100`]);i(n,{startY:s,head:[["Phase","Description","Revenue/yr","ROI Years","Risk Score"]],body:e,theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},columnStyles:{2:{halign:"right"},3:{halign:"right"},4:{halign:"center"}},margin:{left:14,right:14},didParseCell:e=>{if("body"===e.section&&4===e.column.index){let t=parseInt(e.cell.text[0]);t>=60?e.cell.styles.textColor=[220,38,38]:t>=30?e.cell.styles.textColor=[245,158,11]:e.cell.styles.textColor=[34,197,94],e.cell.styles.fontStyle="bold"}}}),s=n.lastAutoTable.finalY+10}if((0,a.drawFooter)(n,o.current,r),n.addPage(),o.current++,(0,a.drawModernHeader)(n,"Build Timeline","Construction & Commissioning Schedule",r),s=35,s=(0,a.drawSectionTitle)(n,s,"Timeline Events","2",r),l.timeline&&l.timeline.length>0){let e=l.timeline.map(e=>[e.label,"build"===e.type?"Construction":"Operational",`Month ${e.startMonth}`,`${e.endMonth-e.startMonth} mo`,`Month ${e.endMonth}`]);i(n,{startY:s,head:[["Event","Type","Start","Duration","End"]],body:e,theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:8},margin:{left:14,right:14},didParseCell:e=>{"body"===e.section&&1===e.column.index&&("Construction"===e.cell.text[0]?e.cell.styles.textColor=[245,158,11]:e.cell.styles.textColor=[34,197,94],e.cell.styles.fontStyle="bold")}}),s=n.lastAutoTable.finalY+10}if(s=(0,a.ensureSpace)(n,s,60,o),s=(0,a.drawSectionTitle)(n,s,"Cumulative Investment","2.1",r),l.cumulativeCapex&&l.cumulativeItLoad){let e=[],t=Math.max(1,Math.floor(l.cumulativeCapex.length/12));for(let r=0;r<l.cumulativeCapex.length;r+=t)e.push([`Month ${r}`,(0,a.fmtMoney)(l.cumulativeCapex[r]||0),`${(l.cumulativeItLoad[r]||0).toLocaleString()} kW`]);let r=l.cumulativeCapex.length-1;r%t!=0&&e.push([`Month ${r}`,(0,a.fmtMoney)(l.cumulativeCapex[r]||0),`${(l.cumulativeItLoad[r]||0).toLocaleString()} kW`]),i(n,{startY:s,head:[["Month","Cumulative CAPEX","Cumulative IT Load"]],body:e,theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:8},columnStyles:{1:{halign:"right"},2:{halign:"right"}},margin:{left:14,right:14}}),s=n.lastAutoTable.finalY+10}if((0,a.drawFooter)(n,o.current,r),n.addPage(),o.current++,(0,a.drawModernHeader)(n,"Utilization Analysis","Capacity vs Demand Projection",r),s=35,s=(0,a.drawSectionTitle)(n,s,"Utilization Curve","3",r),l.utilizationCurve&&l.utilizationCurve.length>0){let e=Math.max(1,Math.floor(l.utilizationCurve.length/24)),t=[];for(let a=0;a<l.utilizationCurve.length;a+=e){let e=l.utilizationCurve[a];t.push([`Month ${e.month}`,`${e.capacityKw.toLocaleString()} kW`,`${e.demandKw.toLocaleString()} kW`,`${(100*e.utilization).toFixed(1)}%`])}let r=l.utilizationCurve[l.utilizationCurve.length-1];(0===t.length||t[t.length-1][0]!==`Month ${r.month}`)&&t.push([`Month ${r.month}`,`${r.capacityKw.toLocaleString()} kW`,`${r.demandKw.toLocaleString()} kW`,`${(100*r.utilization).toFixed(1)}%`]),i(n,{startY:s,head:[["Month","Installed Capacity","Simulated Demand","Utilization %"]],body:t,theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},columnStyles:{1:{halign:"right"},2:{halign:"right"},3:{halign:"right"}},margin:{left:14,right:14},didParseCell:e=>{if("body"===e.section&&3===e.column.index){let t=parseFloat(e.cell.text[0]);t>=85?e.cell.styles.textColor=[220,38,38]:t>=70?e.cell.styles.textColor=[245,158,11]:e.cell.styles.textColor=[34,197,94],e.cell.styles.fontStyle="bold"}}}),s=n.lastAutoTable.finalY+10}if(l.utilizationCurve&&l.utilizationCurve.length>0){s=(0,a.ensureSpace)(n,s,35,o);let e=l.utilizationCurve.reduce((e,t)=>e+t.utilization,0)/l.utilizationCurve.length,t=Math.max(...l.utilizationCurve.map(e=>e.utilization)),r=l.utilizationCurve.find(e=>e.utilization===t);(0,a.drawKpiCard)(n,14,s,55,24,"Avg Utilization",`${(100*e).toFixed(1)}%`,"Across all months"),(0,a.drawKpiCard)(n,75,s,55,24,"Peak Utilization",`${(100*t).toFixed(1)}%`,`Month ${r?.month||"N/A"}`),(0,a.drawKpiCard)(n,136,s,55,24,"Final Capacity",`${(l.totalItLoadKw/1e3).toFixed(1)} MW`,"At full build-out"),s+=32}if((0,a.drawFooter)(n,o.current,r),n.addPage(),o.current++,(0,a.drawModernHeader)(n,"Staffing & PUE Evolution","Resource Scaling Over Time",r),s=35,s=(0,a.drawSectionTitle)(n,s,"Staffing Ramp","4",r),l.staffingRamp&&l.staffingRamp.length>0){let e=l.staffingRamp.filter((e,t)=>t%6==0||t===l.staffingRamp.length-1),t=e.map(t=>[`Month ${t.month}`,`${t.fte} FTE`,t.month>0?`+${Math.max(0,t.fte-(e.find(e=>e.month<t.month)?.fte||0))}`:"—"]);i(n,{startY:s,head:[["Month","Total FTE","Change"]],body:t,theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:8},columnStyles:{1:{halign:"right"},2:{halign:"right"}},margin:{left:14,right:80}}),s=n.lastAutoTable.finalY+10}if(s=(0,a.ensureSpace)(n,s,60,o),s=(0,a.drawSectionTitle)(n,s,"PUE Evolution","4.1",r),l.pueEvolution&&l.pueEvolution.length>0){let e=l.pueEvolution.filter((e,t)=>t%6==0||t===l.pueEvolution.length-1).map(e=>[`Month ${e.month}`,e.pue.toFixed(3),e.pue<1.3?"Best-in-Class":e.pue<1.5?"Above Average":"Standard"]);i(n,{startY:s,head:[["Month","PUE","Assessment"]],body:e,theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:8},columnStyles:{1:{halign:"center"}},margin:{left:14,right:80}}),s=n.lastAutoTable.finalY+10}if((0,a.drawFooter)(n,o.current,r),n.addPage(),o.current++,(0,a.drawModernHeader)(n,"Infrastructure Scope","Per-Phase Infrastructure Details",r),s=35,s=(0,a.drawSectionTitle)(n,s,"Infrastructure per Phase","5",r),l.phaseDetails&&l.phaseDetails.length>0&&l.phaseDetails.forEach(e=>{if(s=(0,a.ensureSpace)(n,s,35,o),n.setFillColor(241,245,249),n.setDrawColor(226,232,240),n.roundedRect(14,s,182,8,2,2,"FD"),n.setFont("helvetica","bold"),n.setFontSize(9),n.setTextColor(...a.PDF_COLORS.slate800),n.text(e.label,18,s+5.5),s+=12,e.infrastructureScope&&e.infrastructureScope.length>0){let t=e.infrastructureScope.map(e=>[e]);i(n,{startY:s,body:t,theme:"plain",bodyStyles:{fontSize:7,textColor:a.PDF_COLORS.slate700},margin:{left:20,right:14}}),s=n.lastAutoTable.finalY+4}e.riskFactors&&e.riskFactors.length>0&&(n.setFont("helvetica","bold"),n.setFontSize(7),n.setTextColor(...a.PDF_COLORS.danger),n.text("Risk Factors:",20,s),s+=4,e.riskFactors.forEach(e=>{n.setFont("helvetica","normal"),n.setFontSize(7),n.setTextColor(...a.PDF_COLORS.slate600),n.text(`• ${e}`,24,s),s+=4}),s+=4)}),(0,a.drawFooter)(n,o.current,r),t.phasedFinancials){n.addPage(),o.current++,(0,a.drawModernHeader)(n,"Phased Financial Analysis","Per-Phase & Blended Returns",r),s=35;let e=t.phasedFinancials;if((0,a.drawKpiCard)(n,14,s,42,24,"Blended IRR",`${e.blendedIRR?.toFixed(1)||"N/A"}%`,"Weighted by CAPEX"),(0,a.drawKpiCard)(n,60,s,42,24,"Total NPV",(0,a.fmt)(e.totalNPV||0),"All phases"),(0,a.drawKpiCard)(n,106,s,42,24,"Payback",`${e.weightedPayback?.toFixed(1)||"N/A"} yr`,"Weighted average"),(0,a.drawKpiCard)(n,152,s,42,24,"Investment",(0,a.fmt)(e.totalInvestment||l.totalCapex),"Total CAPEX"),s+=35,s=(0,a.drawSectionTitle)(n,s,"Investment Decision Matrix","6",r),e.phaseResults){let t=e.phaseResults.map(e=>{let t=(e.irr||0)>=12?"GO":(e.irr||0)>=8?"CONDITIONAL":"NO-GO";return[e.label,(0,a.fmt)(e.capex),`${e.irr?.toFixed(1)||"N/A"}%`,(0,a.fmt)(e.npv||0),`${e.payback?.toFixed(1)||"N/A"} yr`,t]});i(n,{startY:s,head:[["Phase","CAPEX","IRR","NPV","Payback","Decision"]],body:t,theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:8},columnStyles:{1:{halign:"right"},2:{halign:"right"},3:{halign:"right"},4:{halign:"right"}},margin:{left:14,right:14},didParseCell:e=>{if("body"===e.section&&5===e.column.index){let t=e.cell.text[0];"GO"===t?e.cell.styles.textColor=[34,197,94]:"CONDITIONAL"===t?e.cell.styles.textColor=[245,158,11]:e.cell.styles.textColor=[220,38,38],e.cell.styles.fontStyle="bold"}}}),s=n.lastAutoTable.finalY+10}(0,a.drawFooter)(n,o.current,r)}if(n.addPage(),o.current++,(0,a.drawModernHeader)(n,"Key Assumptions","Planning Parameters & Constraints",r),s=35,s=(0,a.drawSectionTitle)(n,s,"Assumptions & Parameters","7",r),l.assumptions&&l.assumptions.length>0){let e=l.assumptions.map(e=>[e.category,e.assumption,e.value]);i(n,{startY:s,head:[["Category","Assumption","Value"]],body:e,theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},columnStyles:{2:{halign:"right"}},margin:{left:14,right:14}}),s=n.lastAutoTable.finalY+10}s=(0,a.ensureSpace)(n,s,40,o),s=(0,a.drawSectionTitle)(n,s,"Plan Summary","7.1",r),i(n,{startY:s,head:[["Parameter","Value"]],body:[["Country / Region",e.name],["Total IT Capacity",`${(l.totalItLoadKw/1e3).toFixed(1)} MW (${l.totalItLoadKw.toLocaleString()} kW)`],["Number of Phases",`${l.phases.length}`],["Total CAPEX",(0,a.fmtMoney)(l.totalCapex)],["Average $/kW",`$${Math.round(l.totalCapex/l.totalItLoadKw).toLocaleString()}`],["Total Build Timeline",`${l.totalMonths} months (~${(l.totalMonths/12).toFixed(1)} years)`],["Scalability Score",`${l.scalabilityScore}/100`],["Phase Efficiency",`${l.phaseEfficiency}/100`]],theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:9},bodyStyles:{fontSize:8},columnStyles:{0:{cellWidth:80},1:{halign:"right"}},margin:{left:14,right:14}}),(0,a.drawFooter)(n,o.current,r),(0,a.savePdf)(n,`DCMOC_CapacityPlan_${e.name}_${new Date().toISOString().slice(0,10)}.pdf`)};e.s(["generateCapacityPlanPDF",0,y],71051);let h=async(e,t,r,n,i)=>{let{doc:o,autoTable:l}=await (0,a.initDoc)(n),{inputs:s,results:d,insights:c}=r,u={current:1};(0,a.drawCoverPage)(o,"Feasibility Simulation\n& Market Analysis",`Assessment for ${e.name} Data Center`,{client:"Strategic Planning Committee",date:(0,a.today)(),version:"2.0"},n),o.addPage(),u.current++,(0,a.drawModernHeader)(o,"Executive Summary","Operational Viability Assessment",n);let m=35,y=d.monthlyInternalCost||0,h=d.monthlyVendorCost||0,S=d.totalMonthlyConsumables||0,g=d.turnoverCost||0;(0,a.drawKpiCard)(o,14,m,42,24,"Internal Staff",(0,a.fmt)(y),`${d.headcount||0} FTEs`),(0,a.drawKpiCard)(o,60,m,42,24,"Vendor Labor",(0,a.fmt)(h),"Contract staff",a.PDF_COLORS.warning),(0,a.drawKpiCard)(o,106,m,42,24,"Parts & Spares",(0,a.fmt)(S),d.aqiImpact>1?"AQI Impact":"Normal"),(0,a.drawKpiCard)(o,152,m,42,24,"Turnover Loss",(0,a.fmt)(g),"Recruitment cost",a.PDF_COLORS.danger),m+=35,m=(0,a.drawSectionTitle)(o,m,"Key Strategic Insights","1",n),m=(0,a.drawInsightsSection)(o,m,c),(0,a.drawFooter)(o,u.current,n),o.addPage(),u.current++,(0,a.drawModernHeader)(o,"Simulation Configuration","All Input Parameters",n),m=35,m=(0,a.drawSectionTitle)(o,m,"Full Input Parameters","2",n),l(o,{startY:m,head:[["Parameter","Value"]],body:[["Country / Region",e.name],["Simulation Year",`${t}`],["IT Load",`${s.itLoad||1e3} kW`],["Redundancy Tier",`Tier ${s.tierLevel||3}`],["Cooling Type",s.coolingType||"Air"],["Shift Model",s.shiftModel||"12h"],["Maintenance Model",s.maintenanceModel||"In-house"],["Hybrid Ratio",void 0!==s.hybridRatio?`${(100*s.hybridRatio).toFixed(0)}%`:"100%"],["Turnover Rate",void 0!==s.turnoverRate?`${(100*s.turnoverRate).toFixed(0)}%`:"Default"],["AQI Override",void 0!==s.aqiOverride?`${s.aqiOverride}`:"Country default"]],theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:9},bodyStyles:{fontSize:8},columnStyles:{0:{cellWidth:80},1:{halign:"right"}},margin:{left:14,right:14}}),m=o.lastAutoTable.finalY+10,m=(0,a.ensureSpace)(o,m,35,u),m=(0,a.drawSectionTitle)(o,m,"Environmental & HR Scenarios","2.1",n);let f=s.aqiOverride||e.environment?.baselineAQI||50,C=s.turnoverRate||.15;(0,a.drawKpiCard)(o,14,m,55,24,"Scenario AQI",`${f}`,f>100?"High pollution":f>50?"Moderate":"Clean air",f>100?a.PDF_COLORS.danger:f>50?a.PDF_COLORS.warning:a.PDF_COLORS.secondary),(0,a.drawKpiCard)(o,75,m,55,24,"Turnover Rate",`${(100*C).toFixed(0)}%`,C>.2?"High attrition":"Normal",C>.2?a.PDF_COLORS.danger:a.PDF_COLORS.secondary),(0,a.drawKpiCard)(o,136,m,55,24,"Grid Carbon",`${(e.environment?.gridCarbonIntensity||.5).toFixed(2)}`,"kgCO₂/kWh"),m+=32,(0,a.drawFooter)(o,u.current,n),o.addPage(),u.current++,(0,a.drawModernHeader)(o,"Operational Physics","Regulatory & Environmental Analysis",n),m=35,m=(0,a.drawSectionTitle)(o,m,"Overtime & Regulatory Analysis","3",n),l(o,{startY:m,head:[["Metric","Value","Assessment"]],body:[["Weekly OT Hours/Person",`${d.overtimeHours?.toFixed(1)||0} hrs`,(d.overtimeHours||0)>12?"Exceeds limit — 4x multiplier":"Within limits"],["Headcount (Internal)",`${d.headcount||0} FTE`,"Active staff"],["Shift Model",s.shiftModel||"12h","Current configuration"],["Monthly Internal Cost",(0,a.fmtMoney)(y),"Base + OT + benefits"],["Monthly Vendor Cost",(0,a.fmtMoney)(h),"Contract labor"]],theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:8},columnStyles:{1:{halign:"right"}},margin:{left:14,right:14}}),m=o.lastAutoTable.finalY+10,m=(0,a.ensureSpace)(o,m,50,u),m=(0,a.drawSectionTitle)(o,m,"Environmental Physics","3.1",n),l(o,{startY:m,head:[["Factor","Value","Impact"]],body:[["AQI Level",`${f}`,f>100?"Accelerated equipment wear":"Standard degradation"],["AQI Impact Multiplier",`${d.aqiImpact?.toFixed(2)||1}x`,d.aqiImpact>1?"Above baseline":"Baseline"],["Filter Life Reduction",d.filterLife?`${(100*d.filterLife).toFixed(0)}%`:"N/A","Power-law degradation model"],["Consumable Penalty",(0,a.fmtMoney)(d.aqiConsumablePenalty||0),"Additional monthly cost"],["Formula","Life = Base × (AQI_Base/AQI)^1.5","Environmental degradation model"]],theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:7},margin:{left:14,right:14}}),m=o.lastAutoTable.finalY+10,m=(0,a.ensureSpace)(o,m,40,u),m=(0,a.drawSectionTitle)(o,m,"Risk & Downtime Exposure","3.2",n),(0,a.drawKpiCard)(o,14,m,55,24,"Availability",`${d.availability?.toFixed(3)||99.982}%`,`Tier ${s.tierLevel||3}`),(0,a.drawKpiCard)(o,75,m,55,24,"Downtime",`${Math.round(d.downtimeMinutes||0)} min`,"Expected per year"),(0,a.drawKpiCard)(o,136,m,55,24,"Financial Risk",(0,a.fmtMoney)(d.financialRisk||0),"@ $5k/min",a.PDF_COLORS.danger),m+=32,(0,a.drawFooter)(o,u.current,n),o.addPage(),u.current++,(0,a.drawModernHeader)(o,"Power & Cooling Analytics","Facility Energy Profile",n),m=35,m=(0,a.drawSectionTitle)(o,m,"Power Chain Efficiency","4",n);let p=s.tierLevel||3,P=s.itLoad||1e3,w=e.environment?.gridCarbonIntensity??.5,b=4===p?1.25:1.45,F=Math.round(P*b),v=F-P,M=8760*F/1e3;l(o,{startY:m,head:[["Component","Value","Notes"]],body:[["IT Load",`${P.toLocaleString()} kW`,"Configured capacity"],["Cooling Load",`${v.toLocaleString()} kW`,"PUE overhead"],["Total Facility Power",`${F.toLocaleString()} kW`,`PUE: ${b.toFixed(2)}`],["Annual Energy",`${Math.round(M).toLocaleString()} MWh`,"8,760 hours/year"],["Annual CO₂",`${Math.round(M*w).toLocaleString()} tonnes`,`@ ${w} kgCO₂/kWh`]],theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:8},columnStyles:{1:{halign:"right"}},margin:{left:14,right:14}}),m=o.lastAutoTable.finalY+10,m=(0,a.ensureSpace)(o,m,30,u),m=(0,a.drawSectionTitle)(o,m,"Power Distribution Chain","4.1",n),l(o,{startY:m,head:[["Stage","Efficiency","Cumulative Loss"]],body:[["Grid Input","98%","2%"],["UPS System","94%","8%"],["PDU Distribution","97%","11%"],["IT Load (Delivered)","100%",`Total overhead: ${((b-1)*100).toFixed(0)}%`]],theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:8},columnStyles:{1:{halign:"center"},2:{halign:"center"}},margin:{left:14,right:80}}),m=o.lastAutoTable.finalY+10,(0,a.drawFooter)(o,u.current,n),o.addPage(),u.current++,(0,a.drawModernHeader)(o,"Cost Breakdown","Monthly OPEX Components",n),m=35,m=(0,a.drawSectionTitle)(o,m,"Monthly Cost Summary","5",n);let T=y+h+S+g;if(l(o,{startY:m,head:[["Category","Monthly Cost","% of Total"]],body:[["Internal Staff",(0,a.fmtMoney)(y),`${T>0?(y/T*100).toFixed(1):0}%`],["Vendor Labor",(0,a.fmtMoney)(h),`${T>0?(h/T*100).toFixed(1):0}%`],["Parts & Consumables",(0,a.fmtMoney)(S),`${T>0?(S/T*100).toFixed(1):0}%`],["Turnover Cost",(0,a.fmtMoney)(g),`${T>0?(g/T*100).toFixed(1):0}%`],[{content:"Total Monthly OPEX",styles:{fontStyle:"bold",fillColor:a.PDF_COLORS.secondary,textColor:[255,255,255]}},{content:(0,a.fmtMoney)(T),styles:{fontStyle:"bold",fillColor:a.PDF_COLORS.secondary,textColor:[255,255,255]}},{content:"100%",styles:{fontStyle:"bold",fillColor:a.PDF_COLORS.secondary,textColor:[255,255,255]}}]],theme:"grid",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:9},bodyStyles:{fontSize:8},columnStyles:{1:{halign:"right"},2:{halign:"right"}},margin:{left:14,right:14}}),m=o.lastAutoTable.finalY+10,m=(0,a.ensureSpace)(o,m,35,u),(0,a.drawKpiCard)(o,14,m,55,24,"Annual OPEX",(0,a.fmtMoney)(12*T),"Monthly × 12"),(0,a.drawKpiCard)(o,75,m,55,24,"Cost per kW",(0,a.fmtMoney)(12*T/(P||1)),"Annual per kW IT"),(0,a.drawKpiCard)(o,136,m,55,24,"Staff Ratio",`${((d.headcount||0)/((P||1e3)/1e3)).toFixed(1)}`,"FTE per MW"),m+=32,(0,a.drawFooter)(o,u.current,n),i?.tornado||i?.sankey){if(o.addPage(),u.current++,(0,a.drawModernHeader)(o,"Visual Analysis","Generated Charts",n),m=35,i.sankey){m=(0,a.drawSectionTitle)(o,m,"Cost Flow Analysis (Sankey)","6",n);try{let e=o.getImageProperties(i.sankey),t=180*e.height/e.width;o.addImage(i.sankey,"PNG",15,m,180,t),m+=t+10}catch(e){console.warn("Error adding Sankey image to PDF",e)}}if(i.tornado){m=(0,a.ensureSpace)(o,m,100,u),m=(0,a.drawSectionTitle)(o,m,"Sensitivity Analysis (Tornado)","6.1",n);try{let e=o.getImageProperties(i.tornado),t=180*e.height/e.width;o.addImage(i.tornado,"PNG",15,m,180,t)}catch(e){console.warn("Error adding Tornado image to PDF",e)}}(0,a.drawFooter)(o,u.current,n)}(0,a.savePdf)(o,`DCMOC_Feasibility_${e.name}_${new Date().toISOString().slice(0,10)}.pdf`)};e.s(["generateSimulationPDF",0,h],53807);let S=async(e,r,n,i)=>{let{doc:o,autoTable:l}=await (0,a.initDoc)(n),{inputs:s,capex:d,financial:c,staffing:u,maintenance:m,risk:y,insights:h}=r,S={current:1};(0,a.drawCoverPage)(o,"Master Operational Report\n& Exact Feasibility Study",`M&O Assessment for ${e.name}`,{client:"Executive Board",date:(0,a.today)(),version:"2.0"},n),o.addPage(),S.current++,(0,a.drawModernHeader)(o,"Table of Contents","Master Document Structure",n);let g=35;g=(0,a.drawTableOfContents)(o,g,[{reason:"High-Level Overview",source:"Simulation Engine",validation:"Exec Gen",pages:"3-4"},{reason:"Investment Breakdown",source:"Capex Engine",validation:"Cost Capitulation",pages:"5-6"},{reason:"TCO & Cashflow",source:"Financial Engine",validation:"NPV/IRR Formula",pages:"7-8"},{reason:"Operational Strategy",source:"Shift & Roster Engine",validation:"Cost Modeling",pages:"9-10"},{reason:"Predictive vs SFG20",source:"Maintenance Engine",validation:"Life Cycle Cost",pages:"11-12"},{reason:"Security & Reliability",source:"Risk Engine",validation:"Matrix Model",pages:"13-14"},{reason:"Investment Analysis",source:"Investment Engine",validation:"DSCR/IRR Model",pages:"15-16"},{reason:"Asset Lifecycle",source:"Lifecycle Engine",validation:"Depreciation Schedule",pages:"17-18"}],"Sections inside this Data Center Report"),(0,a.drawFooter)(o,S.current,n),o.addPage(),S.current++,(0,a.drawModernHeader)(o,"Executive Summary","C-Suite Narrative",n);let f=g=35;if(f=(0,a.drawSectionTitle)(o,f,"CAPEX Assessment","1.0",n),f=(0,a.drawParagraph)(o,f,(0,t.generateCapexSectionNarrative)(d,s.tierLevel,e.name))+10,f=(0,a.drawSectionTitle)(o,f,"Return on Investment & Cashflow","1.1",n),f=(0,a.drawParagraph)(o,f,(0,t.generateTCONarrative)(c))+10,u){f=(0,a.drawSectionTitle)(o,f,"Cost Waterfall Dynamics","1.2",n);let e=c.cashflows.reduce((e,t)=>e+t.opex,0);f=(0,a.drawParagraph)(o,f,(0,t.generateCostWaterfallNarrative)(d,c,e))+10}if(f=(0,a.ensureSpace)(o,f,60,S),f=(0,a.drawSectionTitle)(o,f,"Maintenance & Risk Stance","1.3",n),f=(0,a.drawParagraph)(o,f,(0,t.generateMaintenanceNarrative)(m?.strategy,m?.sla,m?.spares))+5,f=(0,a.drawParagraph)(o,f,(0,t.generateRiskNarrative)(y?.aggregation)),(0,a.drawFooter)(o,S.current,n),o.addPage(),S.current++,(0,a.drawModernHeader)(o,"Capital Expenditure Detail","Cost Capitulation Matrix",n),g=35,g=(0,a.drawCostCapitulationTable)(o,g,d.costs,d.softCosts,d.contingency,d.fomTotal,d.total),(0,a.drawFooter)(o,S.current,n),o.addPage(),S.current++,(0,a.drawModernHeader)(o,"Operational Expenditure","5-Year Tabular View",n),g=35,g=(0,a.draw5YearTCOTable)(o,g,c.cashflows,d.total),(0,a.drawFooter)(o,S.current,n),o.addPage(),S.current++,i?.tornado||i?.sankey){if((0,a.drawModernHeader)(o,"Visual Analysis","Generated Charts",n),g=35,i.sankey){g=(0,a.drawSectionTitle)(o,g,"Cost Flow Analysis (Sankey)","3.0",n);try{let e=o.getImageProperties(i.sankey),t=180*e.height/e.width;o.addImage(i.sankey,"PNG",15,g,180,t),g+=t+10}catch(e){console.warn("Error adding Sankey image to PDF",e)}}if(i.tornado){g=(0,a.ensureSpace)(o,g,100,S),g=(0,a.drawSectionTitle)(o,g,"Sensitivity Analysis (Tornado)","4.0",n);try{let e=o.getImageProperties(i.tornado),t=180*e.height/e.width;o.addImage(i.tornado,"PNG",15,g,180,t)}catch(e){console.warn("Error adding Tornado image to PDF",e)}}(0,a.drawFooter)(o,S.current,n),o.addPage(),S.current++}if((0,a.drawModernHeader)(o,"Shift & Roster Strategy","Detailed Personnel Plan",n),g=35,u?.results){let e=u.results.reduce((e,t)=>e+t.headcount,0),t=u.results.reduce((e,t)=>e+t.monthlyCost,0);(0,a.drawKpiCard)(o,14,g,55,24,"Total Headcount",`${e}`,"FTEs across all shifts"),(0,a.drawKpiCard)(o,75,g,55,24,"Monthly OPEX",(0,a.fmt)(t),"Gross Salary + Burden"),g+=35,g=(0,a.drawHorizontalBarChart)(o,14,g,180,u.results.map(e=>({label:e.role,value:e.monthlyCost,color:e.role.includes("Engineer")?a.PDF_COLORS.secondary:a.PDF_COLORS.primary})),"Monthly Cost Distribution by Role")}if((0,a.drawFooter)(o,S.current,n),o.addPage(),S.current++,r.investment){(0,a.drawModernHeader)(o,"Investment Analysis","Capital Structure & Returns",n),g=35;let e=r.investment;(0,a.drawKpiCard)(o,14,g,35,24,"WACC",`${e.wacc?.toFixed(1)||"N/A"}%`,"Weighted avg"),(0,a.drawKpiCard)(o,53,g,35,24,"Equity IRR",`${e.equityIRR?.toFixed(1)||"N/A"}%`,"Levered return"),(0,a.drawKpiCard)(o,92,g,35,24,"MOIC",`${e.moic?.toFixed(2)||"N/A"}x`,"Multiple"),(0,a.drawKpiCard)(o,131,g,35,24,"Min DSCR",`${e.minDSCR?.toFixed(2)||"N/A"}x`,"Debt coverage"),(0,a.drawKpiCard)(o,170,g,24,24,"Ready",`${e.readinessScore||0}`,"/100"),g+=35,e.valuation&&(g=(0,a.drawSectionTitle)(o,g,"Valuation Summary","7.0",n),l(o,{startY:g,head:[["Method","Value"]],body:[["EV/EBITDA Multiple",(0,a.fmtMoney)(e.valuation.evEbitda||0)],["Cap Rate Approach",(0,a.fmtMoney)(e.valuation.capRate||0)],["$/kW Comparable",(0,a.fmtMoney)(e.valuation.perKw||0)]],theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:8},columnStyles:{1:{halign:"right"}},margin:{left:14,right:14}}),g=o.lastAutoTable.finalY+10),(0,a.drawFooter)(o,S.current,n),o.addPage(),S.current++}if(r.assetLifecycle){(0,a.drawModernHeader)(o,"Asset Lifecycle","Depreciation & Replacement Summary",n),g=35;let e=r.assetLifecycle,t=e.portfolioSummary||{};if((0,a.drawKpiCard)(o,14,g,42,24,"Total Assets",(0,a.fmtMoney)(t.totalAcquisitionCost||0),"Acquisition cost"),(0,a.drawKpiCard)(o,60,g,42,24,"25-Year Cost",(0,a.fmtMoney)(t.total25YearCost||0),"Lifecycle total"),(0,a.drawKpiCard)(o,106,g,42,24,"Annual Refresh",(0,a.fmtMoney)(t.averageAnnualRefresh||0),"Average/year"),(0,a.drawKpiCard)(o,152,g,42,24,"Peak Year",`Year ${t.peakReplacementYear||"N/A"}`,"Highest cost"),g+=35,e.replacementTimeline&&e.replacementTimeline.length>0){g=(0,a.drawSectionTitle)(o,g,"Replacement Timeline (Top Years)","8.0",n);let t=e.replacementTimeline.filter(e=>e.assets&&e.assets.length>0).slice(0,10).map(e=>[`Year ${e.year}`,`${e.assets?.length||0} items`,(0,a.fmtMoney)(e.totalCost||0)]);l(o,{startY:g,head:[["Year","Assets","Cost"]],body:t,theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900,textColor:255,fontSize:8},bodyStyles:{fontSize:8},columnStyles:{2:{halign:"right"}},margin:{left:14,right:14}}),g=o.lastAutoTable.finalY+10}(0,a.drawFooter)(o,S.current,n),o.addPage(),S.current++}(0,a.drawModernHeader)(o,"Investment Recommendation","GO / NO-GO Decision Framework",n),g=35;let C=[{label:"IRR exceeds WACC (10%)",pass:c.irr>10},{label:"NPV is positive",pass:c.npv>0},{label:"Payback < 7 years",pass:c.paybackPeriodYears<7},{label:"Break-even occupancy < 60%",pass:c.breakEvenOccupancy<60},{label:"Profitability Index > 1.0",pass:c.profitabilityIndex>1}],p=C.filter(e=>e.pass).length,P=p>=4?"GO":p>=2?"CONDITIONAL GO":"NO-GO";o.setFillColor(...p>=4?[5,150,105]:p>=2?[217,119,6]:[220,38,38]),o.roundedRect(14,g,180,20,4,4,"F"),o.setFont("helvetica","bold"),o.setFontSize(16),o.setTextColor(255,255,255),o.text(`RECOMMENDATION: ${P}`,104,g+13,{align:"center"}),g+=30,g=(0,a.drawSectionTitle)(o,g,"Decision Criteria","9.0",n),C.forEach(e=>{o.setFont("helvetica","normal"),o.setFontSize(9),o.setTextColor(...e.pass?[5,150,105]:[220,38,38]),o.text(e.pass?"✓":"✗",18,g+1),o.setTextColor(...a.PDF_COLORS.slate900),o.text(e.label,26,g+1),o.setTextColor(...e.pass?[5,150,105]:[220,38,38]),o.text(e.pass?"PASS":"FAIL",160,g+1),g+=8}),g+=10,g=(0,a.drawParagraph)(o,g,`Based on the analysis across CAPEX, financial returns, risk assessment, and operational readiness, this project receives a ${P} recommendation. ${p>=4?"All key investment criteria are met.":p>=2?"Some criteria require attention before final approval.":"Critical metrics fall below acceptable thresholds."}`),(0,a.drawFooter)(o,S.current,n),(0,a.savePdf)(o,`DCMOC_MasterReport_${e.name}_${new Date().toISOString().slice(0,10)}.pdf`)},g=async(e,t,r)=>{let{doc:n,autoTable:i}=await (0,a.initDoc)(r),o={current:1};(0,a.drawCoverPage)(n,"Country Intelligence\nReport",`Market Assessment for ${e.name}`,{client:"Site Selection Committee",date:(0,a.today)(),version:"1.0"},r),n.addPage(),o.current++,(0,a.drawModernHeader)(n,"Tax & Incentive Analysis",`${e.name} — Fiscal Environment`,r);let l=35,s=t.taxResult;s&&((0,a.drawKpiCard)(n,14,l,42,24,"Total Savings",(0,a.fmt)(s.totalIncentiveValue),"NPV of incentives"),(0,a.drawKpiCard)(n,60,l,42,24,"Effective Tax Y1",`${(100*s.effectiveTaxTimeline[0]).toFixed(1)}%`,`vs ${(100*e.economy.taxRate).toFixed(1)}% standard`),(0,a.drawKpiCard)(n,106,l,42,24,"NPV Uplift",(0,a.fmt)(s.npvWithIncentives-s.npvWithoutIncentives),"With incentives"),(0,a.drawKpiCard)(n,152,l,42,24,"IRR Uplift",`+${(s.irrWithIncentives-s.irrWithoutIncentives).toFixed(1)}%`,`${s.irrWithIncentives.toFixed(1)}% with incentives`),l+=35,l=(0,a.drawSectionTitle)(n,l,"Tax Holiday Timeline","1.0",r),i(n,{startY:l,head:[["Period","Standard Rate","Effective Rate","Tax Savings"]],body:s.effectiveTaxTimeline.slice(0,10).map((t,r)=>[`Year ${r+1}`,`${(100*e.economy.taxRate).toFixed(1)}%`,`${(100*t).toFixed(1)}%`,(0,a.fmt)(s.yearlyTaxSavings[r]||0)]),theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900},styles:{fontSize:8,cellPadding:2},margin:{left:14,right:14},columnStyles:{3:{halign:"right",textColor:[5,150,105]}}}),l=n.lastAutoTable.finalY+10,s.incentiveSummary&&s.incentiveSummary.length>0&&(l=(0,a.ensureSpace)(n,l,40,o),l=(0,a.drawExecutiveBox)(n,l,"Available Incentive Programs",s.incentiveSummary.join("\n"),"success")),e.taxIncentives?.freeTradeZones&&e.taxIncentives.freeTradeZones.length>0&&(l=(0,a.ensureSpace)(n,l,20,o),l=(0,a.drawParagraph)(n,l,`Free Trade Zones: ${e.taxIncentives.freeTradeZones.join(", ")}. Import duty savings: ${(0,a.fmt)(s.ftzBenefits)}.`))),(0,a.drawFooter)(n,o.current,r),n.addPage(),o.current++,(0,a.drawModernHeader)(n,"Natural Disaster Risk",`${e.name} — Hazard Profile`,r),l=35;let d=t.disasterResult;d&&((0,a.drawKpiCard)(n,14,l,42,24,"Risk Score",`${d.compositeScore}/100`,d.riskCategory),(0,a.drawKpiCard)(n,60,l,42,24,"Insurance/Yr",(0,a.fmt)(d.annualInsuranceCost),"Adjusted premium"),(0,a.drawKpiCard)(n,106,l,42,24,"Structural +",(0,a.fmt)(d.structuralCostAdder),"CAPEX hardening"),(0,a.drawKpiCard)(n,152,l,42,24,"Revenue @ Risk",(0,a.fmt)(d.revenueAtRisk),`${d.businessInterruptionDays} days interruption`),l+=35,l=(0,a.drawSectionTitle)(n,l,"Risk Factor Breakdown","2.0",r),i(n,{startY:l,head:[["Hazard Type","Score","Impact Assessment"]],body:d.riskBreakdown.map(e=>[e.type,`${e.score}/100`,e.impact]),theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900},styles:{fontSize:8,cellPadding:2},margin:{left:14,right:14}}),l=n.lastAutoTable.finalY+10,d.mitigationOptions&&d.mitigationOptions.length>0&&(l=(0,a.ensureSpace)(n,l,60,o),l=(0,a.drawSectionTitle)(n,l,"Mitigation Recommendations","2.1",r),i(n,{startY:l,head:[["Measure","Cost","Annual Benefit","ROI"]],body:d.mitigationOptions.map(e=>[e.name,(0,a.fmt)(e.cost),(0,a.fmt)(e.annualBenefit),`${e.roiPercent}%`]),theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900},styles:{fontSize:8,cellPadding:2},margin:{left:14,right:14},columnStyles:{3:{halign:"right",textColor:[5,150,105]}}}),l=n.lastAutoTable.finalY+10)),(0,a.drawFooter)(n,o.current,r),n.addPage(),o.current++,(0,a.drawModernHeader)(n,"Grid Reliability Index",`${e.name} — Power Infrastructure`,r),l=35;let c=t.gridResult;if(c){if((0,a.drawKpiCard)(n,14,l,35,24,"Grid Score",`${c.reliabilityScore}`,`Grade ${c.reliabilityGrade}`),(0,a.drawKpiCard)(n,53,l,35,24,"Outage Hrs/Yr",`${(c.annualOutageMinutes/60).toFixed(1)}`,`${c.annualExpectedOutages} events`),(0,a.drawKpiCard)(n,92,l,35,24,"Gen Capacity",`${c.requiredGenCapacity} kW`,`${c.recommendedFuelHours}h fuel`),(0,a.drawKpiCard)(n,131,l,35,24,"Fuel Cost/Yr",(0,a.fmt)(c.annualFuelCost),"Backup operations"),(0,a.drawKpiCard)(n,170,l,24,24,"Solar",`${c.solarViabilityScore}`,"/100"),l+=35,l=(0,a.drawSectionTitle)(n,l,"Grid Risk Cost Breakdown","3.0",r),c.costBreakdown){let e=c.costBreakdown.map(e=>[e.label,(0,a.fmtMoney)(e.value)]);e.push(["Total Grid-Adjusted OPEX",(0,a.fmtMoney)(c.gridRiskAdjustedOpex)]),i(n,{startY:l,head:[["Cost Component","Annual Cost"]],body:e,theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900},styles:{fontSize:8,cellPadding:2},margin:{left:14,right:14},columnStyles:{1:{halign:"right"}}}),l=n.lastAutoTable.finalY+10}l=(0,a.ensureSpace)(n,l,40,o),l=(0,a.drawExecutiveBox)(n,l,"Backup Power Architecture",`Grid Feed ${c.dualFeedRecommendation?"(Dual A+B)":"(Single)"} → ATS → UPS (${t.itLoadKw} kW)
Generator: ${c.requiredGenCapacity} kW (${c.recommendedFuelHours}h fuel reserve)
Availability with Backup: ${c.availabilityWithBackup.toFixed(3)}%
BESS ROI: ${c.batteryStorageROI<50?`${c.batteryStorageROI} year payback`:"Not recommended"}`,"info")}(0,a.drawFooter)(n,o.current,r),n.addPage(),o.current++,(0,a.drawModernHeader)(n,"Talent Availability Index",`${e.name} — Workforce Assessment`,r),l=35;let u=t.talentResult;u&&((0,a.drawKpiCard)(n,14,l,42,24,"Talent Score",`${u.talentScore}/100`,u.hiringDifficulty),(0,a.drawKpiCard)(n,60,l,42,24,"Salary Premium",`+${((u.adjustedSalaryMultiplier-1)*100).toFixed(0)}%`,(0,a.fmt)(u.adjustedAnnualStaffCost-t.annualStaffCost)+"/yr extra"),(0,a.drawKpiCard)(n,106,l,42,24,"Time to Staff",`${u.timeToFullStaff} mo`,"Months to full team"),(0,a.drawKpiCard)(n,152,l,42,24,"Turnover",`${(100*u.adjustedTurnoverRate).toFixed(0)}%`,(0,a.fmt)(u.annualTurnoverCost)+"/yr"),l+=35,l=(0,a.drawSectionTitle)(n,l,"Talent Factor Analysis","4.0",r),u.talentBreakdown&&(i(n,{startY:l,head:[["Factor","Value","Impact"]],body:u.talentBreakdown.map(e=>[e.metric,e.value,e.impact]),theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900},styles:{fontSize:8,cellPadding:2},margin:{left:14,right:14}}),l=n.lastAutoTable.finalY+10),l=(0,a.ensureSpace)(n,l,50,o),l=(0,a.drawSectionTitle)(n,l,"Annual Staff Cost Impact","4.1",r),i(n,{startY:l,head:[["Component","Amount"]],body:[["Base Annual Staff Cost",(0,a.fmtMoney)(t.annualStaffCost)],[`+ Salary Premium (${((u.adjustedSalaryMultiplier-1)*100).toFixed(0)}%)`,`+${(0,a.fmtMoney)(u.adjustedAnnualStaffCost-t.annualStaffCost)}`],["+ Turnover Cost",`+${(0,a.fmtMoney)(u.annualTurnoverCost)}`],["+ Training Cost",`+${(0,a.fmtMoney)(u.annualTrainingCost)}`],["+ Recruitment Cost",`+${(0,a.fmtMoney)(u.totalRecruitmentCost)}`],["Talent-Adjusted Total",(0,a.fmtMoney)(u.adjustedAnnualStaffCost+u.annualTurnoverCost+u.annualTrainingCost)]],theme:"striped",headStyles:{fillColor:a.PDF_COLORS.slate900},styles:{fontSize:8,cellPadding:2},margin:{left:14,right:14},columnStyles:{1:{halign:"right"}}})),(0,a.drawFooter)(n,o.current,r),(0,a.savePdf)(n,`DCMOC_CountryIntel_${e.name}_${new Date().toISOString().slice(0,10)}.pdf`)};e.s(["generateCountryIntelPDF",0,g,"generateMasterReportPDF",0,S],54462)}]);