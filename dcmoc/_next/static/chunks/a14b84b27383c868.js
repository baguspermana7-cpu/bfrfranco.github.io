(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,32737,e=>{"use strict";var t=e.i(42821),a=e.i(33107);let o=[6,182,212],l=[16,185,129],n=[99,102,241],i=[244,63,94],r=[245,158,11],s=[34,197,94],c=[59,130,246],d=[15,23,42],u=[30,41,59],h=[51,65,85],C=[71,85,105],m=[100,116,139],g=[148,163,184],y=[203,213,225],F=[226,232,240],p=[51,65,85],f=[100,116,139],x=182,S=e=>{let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:o},v=(e,t,a,o)=>t+a>e.internal.pageSize.height-20?(P(e,o.current),e.addPage(),o.current++,35):t,T=(e,t,a,l,n)=>{let r=e.internal.pageSize.width,s=e.internal.pageSize.height,c=n?.primaryColor?S(n.primaryColor):o;if(e.setFillColor(...d),e.rect(0,0,r,s,"F"),e.setFillColor(...c),e.rect(0,0,6,s,"F"),n?.logoBase64)try{e.addImage(n.logoBase64,"PNG",r-40-14,14,40,40,void 0,"FAST")}catch(e){console.warn("Failed to render logo",e)}else e.setFillColor(c[0],c[1],c[2]),e.circle(r-30,40,60,"F"),e.setFillColor(...d),e.circle(r-30,40,55,"F");e.setFont("helvetica","bold"),e.setFontSize(32),e.setTextColor(255,255,255);let u=t.toUpperCase().split("\n"),h=.35*s;e.text(u,24,h);let m=h+(u.length-1)*14;e.setFontSize(14),e.setTextColor(...c),e.text(a,24,m+18),e.setDrawColor(...c),e.setLineWidth(.5),e.line(24,m+24,134,m+24);let y=m+39;e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(...g),n?.companyName&&(e.text(`Prepared by: ${n.companyName}`,24,y),y+=7),l.client&&(e.text(`Prepared for: ${l.client}`,24,y),y+=7),e.text(`Date: ${l.date}`,24,y),y+=7,e.text(`Version: ${l.version||"1.0"}`,24,y),!1!==l.confidential&&(e.setFillColor(...i),e.roundedRect(24,s-50,50,10,2,2,"F"),e.setFontSize(7),e.setTextColor(255,255,255),e.setFont("helvetica","bold"),e.text("CONFIDENTIAL",29,s-43)),e.setFontSize(8),e.setTextColor(...C),e.setFont("helvetica","normal");let F=n?.companyName?`Generated by ${n.companyName} Operations Calculator`:"Generated by DCMOC v2.0 — Data Center M&O Calculator";e.text(F,24,s-15)},b=(e,t,a="",l)=>{let n=e.internal.pageSize.width,i=l?.primaryColor?S(l.primaryColor):o;e.setFillColor(...d),e.rect(0,0,n,25,"F"),e.setFillColor(...i),e.rect(0,23,n,1,"F"),e.setFont("helvetica","bold"),e.setFontSize(14),e.setTextColor(255,255,255),e.text(t,14,16),l?.logoBase64?e.addImage(l.logoBase64,"PNG",n-14-12,6,12,12,void 0,"FAST"):a&&(e.setFontSize(8),e.setTextColor(...g),e.text(a,n-14,16,{align:"right"}))},P=(e,t,a)=>{let o=e.internal.pageSize.width,l=e.internal.pageSize.height;e.setDrawColor(...F),e.line(14,l-15,o-14,l-15),e.setFontSize(7),e.setTextColor(...g);let n=new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),i=a?.companyName?a.companyName:"DCMOC v2.0";e.text(`Generated ${n} | ${i} | CONFIDENTIAL`,14,l-8),e.text(`Page ${t}`,o-14,l-8,{align:"right"})},$=(e,t,a,l,n)=>{let i=n?.primaryColor?S(n.primaryColor):o;e.setFillColor(...i),e.rect(14,t,3,8,"F"),e.setFont("helvetica","bold"),e.setFontSize(13),e.setTextColor(...d);let r=l?`${l}. `:"";return e.text(`${r}${a}`,20,t+6),e.setDrawColor(...F),e.setLineWidth(.3),e.line(14,t+10,196,t+10),t+16},R=(e,t,a,o,n,i,r,s,c=l)=>{e.setFillColor(248,250,252),e.setDrawColor(...F),e.roundedRect(t,a,o,n,2,2,"FD"),e.setFillColor(...c),e.rect(t,a+6,2,n-12,"F"),e.setFontSize(7),e.setTextColor(...f),e.setFont("helvetica","normal"),e.text(i.toUpperCase(),t+5,a+9),e.setFontSize(14),e.setFont("helvetica","bold"),e.setTextColor(...d),e.text(r,t+5,a+19),e.setFontSize(7),e.setFont("helvetica","normal"),e.setTextColor(...f),e.text(s,t+5,a+n-5)},w=(e,t,a,o,n="info")=>{let i={info:c,warning:r,success:l},s=e.splitTextToSize(o,x-16),d=14+4.5*s.length;return e.setFillColor(...{info:[239,246,255],warning:[254,252,232],success:[236,253,245]}[n]),e.roundedRect(14,t,x,d,2,2,"F"),e.setFillColor(...i[n]),e.rect(14,t,3,d,"F"),e.setFont("helvetica","bold"),e.setFontSize(9),e.setTextColor(...i[n]),e.text(a,21,t+8),e.setFont("helvetica","normal"),e.setFontSize(8),e.setTextColor(...p),e.text(s,21,t+14),t+d+4},A=(e,t,a,o=x)=>{e.setFont("helvetica","normal"),e.setFontSize(9),e.setTextColor(...p);let l=e.splitTextToSize(a,o);return e.text(l,14,t),t+4.5*l.length+2},I=(e,t,a,o,l,n)=>{e.setFontSize(10),e.setFont("helvetica","bold"),e.setTextColor(...d),e.text(n,t,a);let i=Math.max(...l.map(e=>e.value),1),r=a+8;return l.forEach(a=>{e.setFontSize(7.5),e.setFont("helvetica","normal"),e.setTextColor(...p),e.text(a.label,t,r+5),e.setFillColor(241,245,249),e.roundedRect(t+45,r,o-90,8,1,1,"F");let l=Math.max(2,a.value/i*(o-90));e.setFillColor(...a.color),e.roundedRect(t+45,r,l,8,1,1,"F"),e.setFontSize(7),e.setFont("helvetica","bold"),e.setTextColor(...d);let n=a.value>=1e3?`$${(a.value/1e3).toFixed(1)}k`:`$${a.value.toFixed(0)}`;e.text(n,t+o-40,r+5.5,{align:"right"}),r+=12}),r+4},D=async t=>{let a=await e.A(73880),o=null;o=a.default&&"function"==typeof a.default?a.default:a.jsPDF?a.jsPDF:a.default||a;let l=await e.A(34642),n=l.default||l;if(!o)throw Error("Failed to load jsPDF constructor");return{doc:new o({orientation:"portrait",unit:"mm",format:"a4"}),autoTable:(e,t)=>"function"==typeof n?n(e,t):"function"==typeof e.autoTable?e.autoTable(t):void console.error("autoTable plugin not found")}},E=(e,t)=>{try{let a=e.output("blob");if(console.log(`PDF Generated: ${t}, Size: ${a.size} bytes, Type: ${a.type}`),a.size<100)throw Error(`Generated PDF is empty (${a.size} bytes)`);let o=URL.createObjectURL(a),l=document.createElement("a");l.href=o,l.download=t,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(o)}catch(e){console.error("PDF save error:",e),window.alert(`PDF Generation Failed: ${e.message||"Unknown error"}`)}},O=e=>e>=1e6?`$${(e/1e6).toFixed(2)}M`:e>=1e3?`$${(e/1e3).toFixed(1)}k`:`$${e.toFixed(0)}`,z=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0}).format(e),M=()=>new Date().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}),k=async(e,t,a,n,i,r,s)=>{let{doc:u,autoTable:h}=await D(s),C=1;T(u,"Staffing Strategy &\nOperational Roster",`Analysis for ${e.name} Region`,{client:"Internal Assessment",date:M(),version:"2.4",confidential:!0},s),u.addPage(),C++,b(u,"Executive Summary","Staffing & Cost Analysis",s);let m=35,y=a.reduce((e,t)=>e+t.headcount,0),f=a.reduce((e,t)=>e+t.monthlyCost,0);R(u,14,m,42,24,"Total Headcount",`${y}`,"FTEs across all shifts"),R(u,60,m,42,24,"Monthly OPEX",O(f),"Gross Salary + Burden"),R(u,106,m,42,24,"Avg Cost / Head",O(f/y),"Monthly Blended Rate"),R(u,152,m,42,24,"Shift Model","8h"===t?"8-Hour":"12-Hour","Rotation Pattern"),m+=35;let S=i.find(e=>"high"===e.severity)||i[0];if(S&&(m=w(u,m,`Strategic Recommendation: ${S.title}`,S.recommendation,"high"===S.severity?"warning":"info")),m=I(u,14,m,180,a.map(e=>({label:e.role,value:e.monthlyCost,color:e.role.includes("Engineer")?l:o})),"Monthly Cost Distribution by Role"),m=v(u,m,60,{current:C}),r&&r.length>0){var A,z;let t,a;A=m=$(u,m,"Shift Model Comparison","1.0",s),z=`8-Hour vs 12-Hour Model (${e.name})`,u.setFontSize(10),u.setFont("helvetica","bold"),u.setTextColor(...d),u.text(z,14,A),t=A+4,u.setFillColor(...d),u.rect(14,t,x,8,"F"),u.setFontSize(7),u.setFont("helvetica","bold"),u.setTextColor(255,255,255),u.text("Metric",17,t+5.5),u.text("8h Continental",87,t+5.5),u.text("12h (4on/4off)",132,t+5.5),u.text("Better",177,t+5.5),a=t+8,r.forEach((e,t)=>{t%2==0&&(u.setFillColor(248,250,252),u.rect(14,a,x,8,"F")),u.setFontSize(7),u.setFont("helvetica","normal"),u.setTextColor(...p),u.text(e.metric,17,a+5.5),u.text(e.value8h,87,a+5.5),u.text(e.value12h,132,a+5.5),"12h"===e.winner?(u.setTextColor(...l),u.setFont("helvetica","bold"),u.text("12h ✓",177,a+5.5)):"8h"===e.winner?(u.setTextColor(...c),u.setFont("helvetica","bold"),u.text("8h ✓",177,a+5.5)):(u.setTextColor(...g),u.text("—",177,a+5.5)),a+=8}),u.setDrawColor(...F),u.rect(14,t,x,a-t),m=a+6}P(u,C,s),u.addPage(),C++,b(u,"Operational Roster","Shift Pattern Visualization",s),m=$(u,m=35,"Shift Rotation Schedule","2.0",s),h(u,{startY:m,head:[["Team","Next 14 Days Rotation"]],body:Array.from(new Set(n.map(e=>e.team))).map(e=>{let t=n.filter(t=>t.team===e).slice(0,14);return[e,t.map(e=>"Day"===e.shiftType?"☀":"Night"===e.shiftType?"☾":"—").join(" ")]}),theme:"striped",headStyles:{fillColor:(s?.primaryColor,d)},styles:{fontSize:8,cellPadding:3},margin:{left:14,right:14}}),P(u,C,s),E(u,`DCMOC_Staffing_Report_${e.name}_${new Date().toISOString().slice(0,10)}.pdf`)},N=async(e,t,a,n,c)=>{var f;let S,{doc:R,autoTable:w}=await D(n),{inputs:A,results:I,insights:k}=a,N=1;T(R,"Feasibility Simulation\n& Market Analysis",`Assessment for ${e.name} Data Center`,{client:"Strategic Planning Committee",date:M(),version:"1.2"},n),R.addPage(),N++,b(R,"Executive Summary","Operational Viability Assessment",n);let Y=35,B=I.monthlyInternalCost||0,L=I.monthlyVendorCost||0,G=I.totalMonthlyConsumables||0,W=I.turnoverCost||0,U=(e,t,a,o,l,n,i,r,s,c)=>{R.setFillColor(255,255,255),R.setDrawColor(226,232,240),R.roundedRect(e,t,a,o,2,2,"FD"),R.setFont("helvetica","bold"),R.setFontSize(7),R.setTextColor(...m),R.text(l.toUpperCase(),e+4,t+6),R.setFontSize(14),R.setTextColor(...r),R.text(n,e+4,t+14),R.setFillColor(...s),R.roundedRect(e+4,t+18,a-8,5,1,1,"F"),R.setFont("helvetica","normal"),R.setFontSize(6),R.setTextColor(...c),R.text(i,e+6,t+21.5)};U(14,Y,42,26,"Internal Staff Cost",O(B),`${I.headcount||0} Internal FTEs`,d,[241,245,249],C),U(60,Y,42,26,"Vendor Labor Cost",O(L),"Includes Premium",r,[254,243,199],[217,119,6]),U(106,Y,42,26,"Parts & Consumables",O(G),`AQI Impact: ${I.aqiImpact>1?"High":"None"}`,o,[241,245,249],C),U(152,Y,42,26,"Hidden Turnover Loss",O(W),"Recruitment + Training",i,[255,228,230],[225,29,72]),Y+=35,Y=v(R,Y,60,{current:N}),S=f=Y=$(R,Y,"Key Strategic Insights","1.0",n),k.slice(0,6).forEach(e=>{let t="high"===e.severity?i:"medium"===e.severity?r:l,a=R.splitTextToSize(e.description,x-12),o=12+4*a.length;R.setFillColor(248,250,252),R.rect(14,S,x,o,"F"),R.setFillColor(...t),R.rect(14,S,2.5,o,"F"),R.setFontSize(8.5),R.setFont("helvetica","bold"),R.setTextColor(...d),R.text(e.title,20,S+6),R.setFont("helvetica","normal"),R.setFontSize(7.5),R.setTextColor(...p),R.text(a,20,S+12),S+=o+3}),Y=v(R,Y=S,80,{current:N}),Y=$(R,Y,"Operational Physics & Regulatory Analysis","2.0",n),R.setFillColor(248,250,252),R.setDrawColor(...F),R.roundedRect(14,Y,182,30,2,2,"FD"),R.setFont("helvetica","bold"),R.setFontSize(9),R.setTextColor(...u),R.text("Overtime & Regulatory Analysis (PP 35/2021)",18,Y+6),R.setFontSize(8),R.setFont("helvetica","normal"),R.setTextColor(...C),R.text("Weekly OT Hours/Person",18,Y+14),R.setFont("helvetica","bold"),R.setTextColor(...d),R.text(`${I.overtimeHours?.toFixed(1)||0} hrs`,90,Y+14,{align:"right"});let V=Math.min(1,(I.overtimeHours||0)/18);R.setFillColor(...F),R.roundedRect(18,Y+17,72,2,1,1,"F"),R.setFillColor(...(I.overtimeHours||0)>12?i:s),R.roundedRect(18,Y+17,72*V,2,1,1,"F"),R.setFont("helvetica","normal"),R.setFontSize(7),R.setTextColor(...m),R.text("Legal limit for 12h shifts without permit is strict. >18h/week incurs 4.0x multiplier.",18,Y+24),R.setFontSize(8),R.setTextColor(...C),R.text("Base Salary",105,Y+14),R.setTextColor(...d),R.text("$20000.00",185,Y+14,{align:"right"}),R.setFont("helvetica","bold"),R.setTextColor(...r),R.text("Overtime Penalty",105,Y+20),R.text("$1126.30",185,Y+20,{align:"right"}),Y+=35,R.setFillColor(248,250,252),R.roundedRect(14,Y,88,30,2,2,"FD"),R.setFont("helvetica","bold"),R.setFontSize(9),R.setTextColor(...u),R.text("Environmental Physics (Power Law)",18,Y+6),R.setFillColor(241,245,249),R.setDrawColor(...y),R.roundedRect(18,Y+9,60,18,1,1,"FD"),R.setFontSize(6),R.setTextColor(...m),R.text("Mathematical Formula",20,Y+13),R.setFont("courier","normal"),R.setTextColor(...s),R.text("Life_Actual =",20,Y+18),R.text("Life_Base * (AQI_Base/AQI)^1.5",20,Y+22),R.setFont("helvetica","bold"),R.setFontSize(7),R.setTextColor(...m),R.text("Impact",98,Y+13,{align:"right"}),R.setTextColor(...h),R.text((A.aqiOverride||50)>100?"Accelerated Wear":"Standard",98,Y+17,{align:"right"}),R.setFillColor(248,250,252),R.roundedRect(108,Y,88,30,2,2,"FD"),R.setFontSize(9),R.setTextColor(...u),R.text(`Risk & Downtime Exposure (Tier ${A.tierLevel||3})`,112,Y+6),R.setFontSize(6),R.setTextColor(...m),R.text("EXPECTED AVAILABILITY",112,Y+12),R.setFontSize(14),R.setTextColor(...d),R.text(`${I.availability?.toFixed(3)||0}%`,112,Y+18),R.setFontSize(6),R.setTextColor(...m),R.text(`~${Math.round(I.downtimeMinutes||0)} mins downtime / yr`,112,Y+22),R.setFontSize(6),R.setTextColor(...m),R.text("FINANCIAL EXPOSURE",156,Y+12),R.setFontSize(14),R.setTextColor(...i),R.text(z(I.financialRisk||0),156,Y+18),R.setFontSize(6),R.setTextColor(...m),R.text("@ $5k/min impact",156,Y+22),Y+=35,Y=v(R,Y,70,{current:N}),Y=$(R,Y,"Power & Cooling Analytics","3.0",n),R.setFillColor(248,250,252),R.roundedRect(14,Y,182,35,2,2,"FD"),R.setFillColor(241,245,249),R.roundedRect(18,Y+4,38,14,1,1,"FD"),R.setFontSize(6),R.setTextColor(...m),R.text("PUE",20,Y+8),R.setFontSize(10),R.setTextColor(217,119,6),R.text("1.45",20,Y+14),R.roundedRect(58,Y+4,38,14,1,1,"FD"),R.setFontSize(6),R.setTextColor(...m),R.text("COOLING LOAD",60,Y+8),R.setFontSize(10),R.setTextColor(...o),R.text("450 kW",60,Y+14),R.roundedRect(98,Y+4,38,14,1,1,"FD"),R.setFontSize(6),R.setTextColor(...m),R.text("TOTAL FACILITY",100,Y+8),R.setFontSize(10),R.setTextColor(...d),R.text("1450 kW",100,Y+14);let _=e.environment?.gridCarbonIntensity??.5,j=A.tierLevel||3;if(R.roundedRect(138,Y+4,54,14,1,1,"FD"),R.setFontSize(6),R.setTextColor(...m),R.text("ANNUAL CO2",140,Y+8),R.setFontSize(10),R.setTextColor(109,40,217),R.text(`${((4===j?1250:1450)*8760/1e3*_/1e3).toFixed(1)}k tonnes/yr`,140,Y+14),R.setFontSize(6),R.setTextColor(...m),R.text("POWER CHAIN EFFICIENCY",18,Y+24),R.setFont("courier","normal"),R.setFillColor(209,250,229),R.roundedRect(18,Y+26,25,5,1,1,"F"),R.setTextColor(4,120,87),R.text("Grid 98%",21,Y+29.5),R.setTextColor(...g),R.text("->",45,Y+29.5),R.setFillColor(219,234,254),R.roundedRect(50,Y+26,25,5,1,1,"F"),R.setTextColor(29,78,216),R.text("UPS 94%",53,Y+29.5),R.setTextColor(...g),R.text("->",77,Y+29.5),R.setFillColor(233,213,255),R.roundedRect(82,Y+26,25,5,1,1,"F"),R.setTextColor(109,40,217),R.text("PDU 97%",85,Y+29.5),R.setTextColor(...g),R.text("->",109,Y+29.5),R.setFillColor(207,250,254),R.roundedRect(114,Y+26,30,5,1,1,"F"),R.setTextColor(14,116,144),R.text("IT Load ✓",117,Y+29.5),Y+=45,c?.tornado||c?.sankey){if(P(R,N,n),R.addPage(),N++,b(R,"Visual Analysis","Generated Charts",n),Y=35,c.sankey){Y=$(R,Y,"Cost Flow Analysis (Sankey)","3.0",n);try{let e=R.getImageProperties(c.sankey),t=180*e.height/e.width;R.addImage(c.sankey,"PNG",15,Y,180,t),Y+=t+10}catch(e){console.warn("Error adding Sankey image to PDF",e)}}if(c.tornado){Y=v(R,Y,100,{current:N}),Y=$(R,Y,"Sensitivity Analysis (Tornado)","4.0",n);try{let e=R.getImageProperties(c.tornado),t=180*e.height/e.width;R.addImage(c.tornado,"PNG",15,Y,180,t)}catch(e){console.warn("Error adding Tornado image to PDF",e)}}}P(R,N,n),E(R,`DCMOC_Feasibility_${e.name}_${new Date().toISOString().slice(0,10)}.pdf`)},Y=async(e,t,a,o,l)=>{let{doc:n,autoTable:i}=await D(l),r=1;T(n,"Capital Expenditure\nReport",`Budget Estimation for ${e.name}`,{client:"Finance Dept",date:M(),version:"3.1"},l),n.addPage(),r++,b(n,"Project Configuration","Facility Design & Inputs",l);let s=(e,t,a,o)=>{n.setFillColor(248,250,252),n.setDrawColor(226,232,240),n.roundedRect(e,t,85,10+8*o.length,2,2,"FD"),n.setFont("helvetica","bold"),n.setFontSize(9),n.setTextColor(...h),n.text(a,e+4,t+6);let l=t+12;return o.forEach(t=>{n.setFont("helvetica","normal"),n.setFontSize(8),n.setTextColor(...m),n.text(t.label,e+4,l),n.setFont("helvetica","bold"),n.setTextColor(...d),n.text(t.value,e+81,l,{align:"right"}),l+=8}),t+10+8*o.length+4},c=35;c=s(14,35,"Facility Layout",[{label:"IT Capacity",value:`${o.itLoad||1e3} kW`},{label:"Redundancy Tier",value:o.redundancy?.toUpperCase()||"N+1"},{label:"Cooling Strategy",value:"air"===o.coolingType?"Air Cooled":"inrow"===o.coolingType?"In-Row":"Other"},{label:"Building Type",value:"purpose"===o.buildingType?"Purpose Built":"Retrofit/Modular"},{label:"Rack Density",value:o.rackType?.toUpperCase()||"STANDARD"}]),c=s(14,c,"Power & Cooling Build",[{label:"UPS System",value:o.upsType||"Modular"},{label:"Generator",value:o.genType||"Diesel"},{label:"Fuel Storage",value:`${o.fuelHours||48} Hours`},{label:"Fire Suppression",value:o.fireType||"Novec"},{label:"Fire Alarm",value:o.alarmType||"Addressable"}]);let y=35;y=s(105,35,"Sustainability & Site",[{label:"Green Certification",value:o.greenCert||"None"},{label:"Renewable Energy",value:o.renewableOption||"None"},{label:"Substation & Grid",value:o.includeFOM?"Include FOM":"Exclude FOM"},{label:"Project Year",value:o.projYear||"2025"},{label:"City Market",value:"none"!==o.cityMarket?o.cityMarket:"Generic"}]),y=s(105,y,"Soft Costs",[{label:"Design Fee",value:`${o.designFee||8}%`},{label:"PM Fee",value:`${o.pmFee||5}%`},{label:"Contingency",value:`${o.contingency||10}%`}]),P(n,r,l),n.addPage(),r++,b(n,"Project Parameters & Executive Summary",`Total CAPEX: ${z(t.total)}`,l);let F=35,{metrics:p,timeline:f,costs:x,softCosts:S,contingency:v}=t,R=(e,t,a,o,l,i,r,s,c=m)=>{n.setFillColor(255,255,255),n.setDrawColor(226,232,240),n.roundedRect(e,t,a,o,2,2,"FD"),n.setFont("helvetica","medium"),n.setFontSize(8),n.setTextColor(...c),n.text(l,e+4,t+8),n.setFont("helvetica","bold"),n.setFontSize(16),n.setTextColor(...s),n.text(i,e+4,t+16),n.setFont("helvetica","normal"),n.setFontSize(7),n.setTextColor(...g),n.text(r,e+4,t+22)};R(14,35,42,26,"Total CAPEX",z(t.total),"Estimated Total",d,[79,70,229]),R(58,F,42,26,"Cost per kW",`$${Math.round(p.perKw).toLocaleString()}`,p.perKw<8e3?"Low Cost":p.perKw<15e3?"Standard":"Premium",[79,70,229]),R(102,F,42,26,"PUE Target",t.pue.toFixed(2),t.pue<1.3?"Best-in-Class":t.pue<1.5?"Good":"Standard",[5,150,105]),R(146,F,42,26,"Timeline",`${f.totalMonths} Mo`,"Design to Commissioning",[217,119,6]),R(14,F+=30,42,26,"Total Racks",`${p.racks}`,"IT Equipment",h),R(58,F,42,26,"Floor Space",`${Math.round(p.floorSpace).toLocaleString()} m\xb2`,"White space",h),R(102,F,42,26,"Annual Energy",z(p.annualEnergy),"@ $0.10/kWh",h),R(146,F,42,26,"Soft Costs",z((S.design||0)+(S.pm||0)),"Design & PM Fees",h),F+=36,n.setFillColor(238,242,255),n.setDrawColor(224,231,255),n.roundedRect(14,F,174,30,2,2,"FD"),n.setFont("helvetica","bold"),n.setFontSize(10),n.setTextColor(49,46,129),n.text("CAPEX Analysis",18,F+8);let w=n.splitTextToSize(a.replace(/\*\*/g,""),166);n.setFont("helvetica","normal"),n.setFontSize(8),n.setTextColor(55,48,163),n.text(w,18,F+14),F+=38;let A=F=$(n,F,"Details","1.0",l);n.setFont("helvetica","bold"),n.setFontSize(9),n.setTextColor(...h),n.text("Cost Breakdown",14,A),n.setDrawColor(241,245,249);let I=A+6,O=Object.entries(x).sort(([,e],[,t])=>t-e),k=(e,a)=>{t.total,n.line(14,I-3,94,I-3),n.setFillColor(129,140,248),n.circle(16,I-.5,1.5,"F"),n.setFont("helvetica","normal"),n.setFontSize(7.5),n.setTextColor(...C),n.text(e.replace(/([A-Z])/g," $1").trim().replace(/^./,e=>e.toUpperCase()),19,I),n.setFont("helvetica","bold"),n.setFontSize(8),n.setTextColor(...d),n.text(`$${(a/1e3).toFixed(0)}k`,94,I,{align:"right"}),I+=7};for(let[e,t]of O)k(e,t);S.design&&k("Design Fee",S.design),S.pm&&k("PM Fee",S.pm),v&&k("Contingency",v),t.fomTotal>0&&k("Front-of-Meter",t.fomTotal),n.setFont("helvetica","bold"),n.setFontSize(9),n.setTextColor(...h),n.text("Project Timeline",105,A);let N=A+6;for(let e of f.phases){n.setDrawColor(226,232,240),n.line(109,N,109,N+12);let t=(e=>{let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:[0,0,0]})(e.color);n.setFillColor(...t),n.circle(109,N+2,2,"F"),n.setFont("helvetica","bold"),n.setFontSize(8),n.setTextColor(...u),n.text(e.name,113,N+3),n.setFont("helvetica","normal"),n.setFontSize(7),n.setTextColor(...m),n.text(`M${e.start} - M${e.end}`,180,N+3,{align:"right"}),N+=14}n.setFillColor(248,250,252),n.roundedRect(109,N,71,20,2,2,"F"),n.setFont("helvetica","bold"),n.setFontSize(7),n.setTextColor(...m),n.text("TOTAL DURATION",113,N+6),n.setFontSize(14),n.setTextColor(...u),n.text(`${f.totalMonths} months`,113,N+12),n.setFontSize(7),n.setFont("helvetica","normal"),n.setTextColor(...g),n.text(`~${(f.totalMonths/12).toFixed(1)} years from design start to go-live`,113,N+17),P(n,r,l),E(n,`DCMOC_CAPEX_${e.name}_${new Date().toISOString().slice(0,10)}.pdf`)},B=async(e,t,a,o,l,n,i)=>{let{doc:r,autoTable:s}=await D(i),c=1;T(r,"Maintenance Strategy\n& Reliability Analysis",`Operational Plan for ${e.name}`,{client:"Ops Director",date:M()},i),r.addPage(),c++,b(r,"Strategy & OPEX Optimization","Maintenance Regime Analysis",i);let u=35;u=w(r,35,`Recommended Strategy: ${t.recommended.toUpperCase()}`,t.recommendationReason,"success"),u=v(r,u,60,{current:c}),u=$(r,u,"Strategy Cost Comparison","1.0",i),s(r,{startY:u,head:[["Strategy","Annual Cost","5-Year NPV","Status"]],body:t.strategies.map(e=>[e.label,z(e.totalAnnualCost),z(e.fiveYearNPV),e.id===t.recommended?"Recommended":""]),theme:"grid",headStyles:{fillColor:(i?.primaryColor,d)},margin:{left:14,right:14}}),u=r.lastAutoTable.finalY+15;let h=u=$(r,u,"Inventory & SLA Optimization","2.0",i);R(r,14,h,55,24,"Inventory Value",z(o.totalInventoryValue),"Capital Locked in Spares"),R(r,75,h,55,24,"Annual Budget",z(o.totalAnnualSparesBudget),"Consumption + Holding"),R(r,136,h,55,24,"Critical Items",`${o.criticalSpares}`,"Must-Stock SKUs"),u+=35,n&&(u=A(r,u,`Analyst Notes: ${n}`)),P(r,c,i),E(r,`DCMOC_Maintenance_${e.name}_${new Date().toISOString().slice(0,10)}.pdf`)},L=async(e,t,a,o,n,r,s,c,u,C)=>{let{doc:y,autoTable:F}=await D(C),p=1;T(y,"Financial Feasibility\n& Revenue Analysis",`Investment Case for ${e.name}`,{client:"CFO / Investment Comm.",date:M()},C),y.addPage(),p++,b(y,"Financial & Revenue Parameters","Assumption Guidelines",C);let f=(e,t,a,o)=>{y.setFillColor(248,250,252),y.setDrawColor(226,232,240),y.roundedRect(e,t,85,10+8*o.length,2,2,"FD"),y.setFont("helvetica","bold"),y.setFontSize(9),y.setTextColor(...h),y.text(a,e+4,t+6);let l=t+12;return o.forEach(t=>{y.setFont("helvetica","normal"),y.setFontSize(8),y.setTextColor(...m),y.text(t.label,e+4,l),y.setFont("helvetica","bold"),y.setTextColor(...d),y.text(t.value,e+81,l,{align:"right"}),l+=8}),t+10+8*o.length+4},x=35;x=f(14,35,"Financial Analysis",[{label:"Revenue per kW/month",value:`$${o.revenuePerKwMonth}`},{label:"Discount Rate",value:`${(100*o.discountRate).toFixed(0)}%`},{label:"Project Life",value:`${o.projectLifeYears} yrs`},{label:"Rev. Escalation",value:`${(100*o.escalationRate).toFixed(0)}%`},{label:"OPEX Escalation",value:`${(100*o.opexEscalation).toFixed(1)}%`},{label:"Tax Rate",value:`${(100*o.taxRate).toFixed(0)}%`},{label:"Depreciation",value:`${o.depreciationYears} yrs`}]),x=f(14,x,"NRC (Non-Recurring Charges)",[{label:"Setup Fee",value:`$${n.nrcPerKw}/kW`},{label:"X-Connect Setup",value:z(n.nrcCrossConnect)},{label:"Custom Fit-out",value:z(n.nrcCustomFitout)}]);let S=35;S=f(105,35,"MRC (Monthly Recurring)",[{label:"MRC $/kW/mo",value:`$${n.mrcPerKwMonth}`},{label:"Escalation",value:`${(100*n.mrcEscalation).toFixed(0)}%/yr`},{label:"X-Connect MRC",value:`$${n.mrcCrossConnectMonthly}/mo`}]),S=f(105,S,"Contract Terms",[{label:"Lease Term",value:`${n.contractYears} yrs`},{label:"Take-or-Pay Floor",value:`${n.takeOrPayPct}%`}]),S=f(105,S,"Quick Summary",[{label:"CAPEX Investment",value:z(r)},{label:"Annual OPEX (est.)",value:z(s)},{label:"Annual Revenue (100%)",value:z(12*o.revenuePerKwMonth*c)},{label:"Break-even Occupancy",value:`${t.breakEvenOccupancy}%`},{label:"Total NRC",value:z(a.totalNRC)},{label:"TCV",value:z(a.contractValue)}]),P(y,p,C),y.addPage(),p++,b(y,"Financial Executive Summary","Key Investment & Revenue Metrics",C);let R=35,A=(e,t,a,o,l,n,i,r,s=m)=>{y.setFillColor(255,255,255),y.setDrawColor(226,232,240),y.roundedRect(e,t,a,o,2,2,"FD"),y.setFont("helvetica","medium"),y.setFontSize(8),y.setTextColor(...s),y.text(l,e+4,t+8),y.setFont("helvetica","bold"),y.setFontSize(16),y.setTextColor(...r),y.text(n,e+4,t+16),y.setFont("helvetica","normal"),y.setFontSize(7),y.setTextColor(...g),y.text(i,e+4,t+22)};if(A(14,35,42,26,"NPV (10yr)",z(t.npv),"Net Present Value",t.npv>0?[5,150,105]:[220,38,38],[15,23,42]),A(58,R,42,26,"IRR",`${t.irr.toFixed(1)}%`,t.irr>100*o.discountRate?"Exceeds hurdle":"Below hurdle",t.irr>10?[5,150,105]:[217,119,6],[15,23,42]),A(102,R,42,26,"Payback",`${t.paybackPeriodYears.toFixed(1)} yrs`,`Discounted: ${t.discountedPaybackYears} yrs`,d,[15,23,42]),A(146,R,42,26,"ROI",`${t.roiPercent.toFixed(0)}%`,`PI: ${t.profitabilityIndex.toFixed(2)}x`,t.roiPercent>0?[5,150,105]:[220,38,38],[15,23,42]),A(14,R+=30,42,26,"Total NRC",z(a.totalNRC),"One-time setup fees",[8,145,178],[8,145,178]),A(58,R,42,26,"Lifetime MRC",z(a.totalMRC_lifetime),`Over ${n.contractYears} years`,[5,150,105],[5,150,105]),A(102,R,42,26,"TCV",z(a.contractValue),"Total Contract Value",[79,70,229],[79,70,229]),A(146,R,42,26,"Effective $/kW/mo",`$${a.effectiveRate.toFixed(0)}`,"Blended rate",[217,119,6],[217,119,6]),R+=36,R=w(y,R,"Financial Verdict",t.npv>0?`Strong investment case. Positive NPV of ${z(t.npv)} indicates value creation above the discount rate. TCV is ${z(a.contractValue)}.`:`Caution advised. Negative NPV of ${z(t.npv)} suggests returns may not meet capital cost requirements. TCV is ${z(a.contractValue)}.`,t.npv>0?"success":"warning"),u?.cashflow||u?.waterfall||u?.mrc){if(R=v(y,R,90,{current:p}),b(y,"Visual Analysis","Generated Cashflow & Revenue Charts",C),R=35,u.cashflow){R=$(y,R,"Cumulative Cashflow Projection","1.0",C);try{let e=y.getImageProperties(u.cashflow),t=180*e.height/e.width;y.addImage(u.cashflow,"PNG",15,R,180,t),R+=t+10}catch(e){console.warn("Error adding cashflow image to PDF",e)}}if(u.waterfall){R=v(y,R,90,{current:p}),R=$(y,R,"Revenue Waterfall — NRC + MRC Breakdown","2.0",C);try{let e=y.getImageProperties(u.waterfall),t=180*e.height/e.width;y.addImage(u.waterfall,"PNG",15,R,180,t),R+=t+10}catch(e){console.warn("Error adding waterfall image to PDF",e)}}if(u.mrc){R=v(y,R,90,{current:p}),R=$(y,R,"MRC Growth Trajectory with Take-or-Pay Floor","3.0",C);try{let e=y.getImageProperties(u.mrc),t=180*e.height/e.width;y.addImage(u.mrc,"PNG",15,R,180,t)}catch(e){console.warn("Error adding MRC image to PDF",e)}}P(y,p,C),y.addPage(),p++,R=35}else R=v(y,R,90,{current:p}),R=$(y,R,"Cumulative Cashflow Projection","1.0",C),R=I(y,14,R,180,t.cashflows.map(e=>({label:`Y${e.year}`,value:e.cumulativeCashflow,color:e.cumulativeCashflow>=0?l:i})).slice(0,10),"Cumulative Cashflow Growth (First 10 Years)"),P(y,p,C),y.addPage(),p++,R=35;b(y,"Detailed Cashflow & Revenue","Year-by-Year Projection",C),F(y,{startY:R=35,head:[["Period","Revenue","OPEX","EBITDA","Net Income","Occ%","Billed kW","NRC","MRC/mo","MRC Yr","Total Rev","Cum. CF"]],body:t.cashflows.map((e,t)=>{let o=a.yearDetails[t];return[`Y${e.year}`,z(e.revenue),z(-e.opex),z(e.ebitda),z(e.netIncome),o?`${(100*o.occupancy).toFixed(0)}%`:"—",o?O(o.billedKw):"—",o&&o.nrc>0?z(o.nrc):"—",o?z(o.mrcMonthly):"—",o?z(o.mrcAnnual):"—",o?z(o.totalRevenue):z(e.revenue),z(e.cumulativeCashflow)]}),theme:"striped",headStyles:{fillColor:(C?.primaryColor,d)},margin:{left:14,right:14},styles:{fontSize:7,cellPadding:1},columnStyles:{0:{fontStyle:"bold"},1:{halign:"right",textColor:[5,150,105]},2:{halign:"right",textColor:[220,38,38]},3:{halign:"right",fontStyle:"bold"},4:{halign:"right"},5:{halign:"right"},6:{halign:"right"},7:{halign:"right",textColor:[8,145,178]},8:{halign:"right",textColor:[5,150,105]},9:{halign:"right",textColor:[5,150,105]},10:{halign:"right",fontStyle:"bold"},11:{halign:"right",fontStyle:"bold"}}}),P(y,p,C),E(y,`DCMOC_Financials_${e.name}_${new Date().toISOString().slice(0,10)}.pdf`)},G=async(e,t,a,o)=>{let{doc:l}=await D(o),n=1;T(l,"Risk & Compliance\nAssessment",`Facility Analysis for ${e.name}`,{client:"Risk Management",date:M()},o),l.addPage(),n++,b(l,"Risk Matrix Executive Summary",`Normalized Score: ${t.normalizedScore}/100`,o);let s=35;R(l,14,35,55,24,"Total Risk Score",`${t.totalScore}`,"Raw unweighted score"),R(l,75,s,55,24,"SLA Breach Prob.",`${(100*t.slaBreachProbability).toFixed(1)}%`,"Annually"),R(l,136,s,55,24,"Identified Risks",`${t.topRisks.length}`,"Active threats"),s+=35,s=A(l,s,a),s=v(l,s,80,{current:n}),s=$(l,s,"Primary Risk Vectors","1.0",o),s=I(l,14,s,180,t.topRisks.slice(0,5).map(e=>({label:e.title,value:e.score,color:e.score>10?i:e.score>5?r:c})),"Top Matrix Scores"),P(l,n,o),E(l,`DCMOC_RiskProfile_${e.name}_${new Date().toISOString().slice(0,10)}.pdf`)},W=async(e,t,a,o)=>{var l;let s,c,u,h,C,{doc:m,autoTable:g}=await D(o),y=1;T(m,"Carbon & ESG\nFootprint Report",`Sustainability Profile for ${e.name}`,{client:"Sustainability Office",date:M()},o),m.addPage(),y++,b(m,"ESG Executive Summary",`Rating: ${t.efficiencyRating}`,o);let F=35;R(m,14,35,42,24,"Emissions",`${O(t.annualEmissionsTonCO2)} tCO₂`,"Scope 1+2+3"),R(m,60,F,42,24,"Effective PUE",`${t.pueEfficiency.toFixed(2)}`,"Design target"),R(m,106,F,42,24,"Tax Exposure",O(t.carbonTaxExposureUSD),"Potential liability"),R(m,152,F,42,24,"Renewable",`${t.renewableReductionPct}%`,"Offset percentage"),F+=35,F=A(m,F,a),F=v(m,F,80,{current:y}),F=$(m,F,"Emissions Breakdown","1.0",o);let f=[{label:"Scope 1 (Direct)",value:t.scope1,color:i},{label:"Scope 2 (Grid)",value:t.scope2,color:r},{label:"Scope 3 (Supply)",value:t.scope3,color:n}];l=F,m.setFontSize(10),m.setFont("helvetica","bold"),m.setTextColor(...d),m.text("GHG Protocol Scopes",14,l+8),s=f.reduce((e,t)=>e+t.value,0),c=14,u=l+15,f.forEach(e=>{let t=e.value/s*180;t>0&&(m.setFillColor(...e.color),m.rect(c,u,t,10,"F"),c+=t)}),h=u+18,C=0,f.forEach(e=>{C>2&&(C=0,h+=8);let t=14+60*C;m.setFillColor(...e.color),m.circle(t+2,h-1,2,"F"),m.setFontSize(7.5),m.setFont("helvetica","normal"),m.setTextColor(...p);let a=(e.value/s*100).toFixed(1),o=e.value>=1e6?`$${(e.value/1e6).toFixed(2)}M`:e.value>=1e3?`$${(e.value/1e3).toFixed(1)}k`:`$${e.value.toFixed(0)}`;m.text(`${e.label}: ${o} (${a}%)`,t+6,h),C++}),F=v(m,F=h+10,80,{current:y}),F=$(m,F,"Carbon Reduction Investment Scenarios","2.0",o),g(m,{startY:F,head:[["Initiative","Investment","CO₂ Abatement","Est. Payback"]],body:t.reductionScenarios.map(e=>[e.name,z(e.investmentUSD),`${Math.round(e.annualSavingsTonCO2)} tCO₂/yr`,e.paybackYears>0?`${e.paybackYears} yrs`:"Immediate/PPA"]),theme:"striped",headStyles:{fillColor:(o?.primaryColor,d)},margin:{left:14,right:14}}),P(m,y,o),E(m,`DCMOC_CarbonESG_${e.name}_${new Date().toISOString().slice(0,10)}.pdf`)},U=async(e,n,i,r)=>{var s,c,h,C,m,g;let y,F,f,{doc:x,autoTable:S}=await D(i),{inputs:w,capex:z,financial:k,staffing:N,maintenance:Y,risk:B,insights:L}=n,G=1;T(x,"Master Operational Report\n& Exact Feasibility Study",`M&O Assessment for ${e.name}`,{client:"Executive Board",date:M(),version:"1.0"},i),x.addPage(),G++,b(x,"Table of Contents","Master Document Structure",i);let W=35;W=((e,t,o,l="Table of Contents")=>(e.setFontSize(16),e.setFont("helvetica","bold"),e.setTextColor(...d),e.text(l,14,t),(0,a.default)(e,{startY:t+10,head:[["Reason","Source","Validation","Pages"]],body:o.map(e=>[e.reason,e.source,e.validation,e.pages]),theme:"grid",headStyles:{fillColor:d,textColor:255,fontSize:9,fontStyle:"bold",halign:"center"},bodyStyles:{textColor:p,fontSize:8,valign:"middle"},columnStyles:{0:{cellWidth:50},1:{cellWidth:50},2:{cellWidth:60},3:{cellWidth:20,halign:"center"}},margin:{left:14,right:14}}),e.lastAutoTable.finalY+15))(x,35,[{reason:"High-Level Overview",source:"Simulation Engine",validation:"Exec Gen",pages:"3-4"},{reason:"Investment Breakdown",source:"Capex Engine",validation:"Cost Capitulation",pages:"5-6"},{reason:"TCO & Cashflow",source:"Financial Engine",validation:"NPV/IRR Formula",pages:"7-8"},{reason:"Operational Strategy",source:"Shift & Roster Engine",validation:"Cost Modeling",pages:"9-10"},{reason:"Predictive vs SFG20",source:"Maintenance Engine",validation:"Life Cycle Cost",pages:"11-12"},{reason:"Security & Reliability",source:"Risk Engine",validation:"Matrix Model",pages:"13-14"}],"Sections inside this Data Center Report"),P(x,G,i),x.addPage(),G++,b(x,"Executive Summary","C-Suite Narrative",i);let U=W=35;if(U=$(x,U,"CAPEX Assessment","1.0",i),U=A(x,U,(0,t.generateCapexSectionNarrative)(z,w.tierLevel,e.name))+10,U=$(x,U,"Return on Investment & Cashflow","1.1",i),U=A(x,U,(0,t.generateTCONarrative)(k))+10,N){U=$(x,U,"Cost Waterfall Dynamics","1.2",i);let e=k.cashflows.reduce((e,t)=>e+t.opex,0);U=A(x,U,(0,t.generateCostWaterfallNarrative)(z,k,e))+10}if(U=v(x,U,60,{current:G}),U=$(x,U,"Maintenance & Risk Stance","1.3",i),U=A(x,U,(0,t.generateMaintenanceNarrative)(Y?.strategy,Y?.sla,Y?.spares))+5,U=A(x,U,(0,t.generateRiskNarrative)(B?.aggregation)),P(x,G,i),x.addPage(),G++,b(x,"Capital Expenditure Detail","Cost Capitulation Matrix",i),s=W=35,c=z.costs,h=z.softCosts,C=z.contingency,m=z.fomTotal,g=z.total,x.setFontSize(12),x.setFont("helvetica","bold"),x.setTextColor(...d),x.text("Cost Capitulation",14,s),y=e=>`$${(e/1e6).toFixed(2)}M`,F=[],f=0,Object.entries(c).forEach(([e,t])=>{F.push([{content:e.toUpperCase(),styles:{fontStyle:"normal"}},y(t),`${(t/g*100).toFixed(1)}%`]),f+=t}),F.push([{content:"SUBTOTAL (HARD COSTS)",styles:{fontStyle:"bold",fillColor:[241,245,249]}},{content:y(f),styles:{fontStyle:"bold",fillColor:[241,245,249]}},{content:`${(f/g*100).toFixed(1)}%`,styles:{fontStyle:"bold",fillColor:[241,245,249]}}]),h.design,h.pm,F.push([{content:"Design & Engineering Fee",styles:{fontStyle:"normal"}},y(h.design||0),`${((h.design||0)/g*100).toFixed(1)}%`]),F.push([{content:"Project Management Fee",styles:{fontStyle:"normal"}},y(h.pm||0),`${((h.pm||0)/g*100).toFixed(1)}%`]),F.push([{content:"Construction Contingency",styles:{fontStyle:"normal"}},y(C),`${(C/g*100).toFixed(1)}%`]),m>0&&F.push([{content:"First of a Kind (FOM) Upgrades",styles:{fontStyle:"normal"}},y(m),`${(m/g*100).toFixed(1)}%`]),F.push([{content:"TOTAL ESTIMATED CAPEX",styles:{fontStyle:"bold",fillColor:l,textColor:255}},{content:y(g),styles:{fontStyle:"bold",fillColor:l,textColor:255}},{content:"100.0%",styles:{fontStyle:"bold",fillColor:l,textColor:255}}]),(0,a.default)(x,{startY:s+5,head:[["Cost Code / Category","Estimated Amount (USD)","% of Total"]],body:F,theme:"grid",headStyles:{fillColor:u,textColor:255,fontSize:9,fontStyle:"bold"},bodyStyles:{textColor:p,fontSize:8},columnStyles:{0:{cellWidth:90},1:{cellWidth:50,halign:"right"},2:{cellWidth:30,halign:"right"}},margin:{left:14,right:14}}),W=x.lastAutoTable.finalY+15,P(x,G,i),x.addPage(),G++,b(x,"Operational Expenditure","5-Year Tabular View",i),W=((e,t,o,l)=>{e.setFontSize(12),e.setFont("helvetica","bold"),e.setTextColor(...d),e.text("5-Year Total Cost of Ownership (TCO & Cashflow)",14,t);let n=e=>`$${(e/1e6).toFixed(2)}M`,i=o.slice(0,5);for(;i.length<5;)i.push({revenue:0,opex:0,ebitda:0,freeCashflow:0,cumulativeCashflow:0});let r=["Revenue","-",n(i[0].revenue),n(i[1].revenue),n(i[2].revenue),n(i[3].revenue),n(i[4].revenue)],s=["OPEX (Operating Expenses)","-",n(i[0].opex),n(i[1].opex),n(i[2].opex),n(i[3].opex),n(i[4].opex)],c=["CAPEX (Capital Invest)",`(${n(l)})`,"-","-","-","-","-"],h=[{content:"Free Cash Flow (FCF)",styles:{fontStyle:"bold"}},{content:`(${n(l)})`,styles:{fontStyle:"bold",textColor:[220,38,38]}}];i.forEach(e=>{h.push({content:n(e.freeCashflow),styles:{fontStyle:"bold",textColor:e.freeCashflow<0?[220,38,38]:[22,163,74]}})});let C=[{content:"Cumulative Cash Flow",styles:{fontStyle:"bold",fillColor:[241,245,249]}},{content:`(${n(l)})`,styles:{fontStyle:"bold",fillColor:[241,245,249],textColor:[220,38,38]}}];i.forEach(e=>{C.push({content:n(e.cumulativeCashflow),styles:{fontStyle:"bold",fillColor:[241,245,249],textColor:e.cumulativeCashflow<0?[220,38,38]:[22,163,74]}})});let m=[r,s,c,h,C];return(0,a.default)(e,{startY:t+5,head:[["Metric","Year 0","Year 1","Year 2","Year 3","Year 4","Year 5"]],body:m,theme:"grid",headStyles:{fillColor:u,textColor:255,fontSize:8,fontStyle:"bold",halign:"center"},bodyStyles:{textColor:p,fontSize:8,halign:"right"},columnStyles:{0:{cellWidth:45,halign:"left"}},margin:{left:14,right:14}}),e.lastAutoTable.finalY+15})(x,W=35,k.cashflows,z.total),P(x,G,i),x.addPage(),G++,r?.tornado||r?.sankey){if(b(x,"Visual Analysis","Generated Charts",i),W=35,r.sankey){W=$(x,W,"Cost Flow Analysis (Sankey)","3.0",i);try{let e=x.getImageProperties(r.sankey),t=180*e.height/e.width;x.addImage(r.sankey,"PNG",15,W,180,t),W+=t+10}catch(e){console.warn("Error adding Sankey image to PDF",e)}}if(r.tornado){W=v(x,W,100,{current:G}),W=$(x,W,"Sensitivity Analysis (Tornado)","4.0",i);try{let e=x.getImageProperties(r.tornado),t=180*e.height/e.width;x.addImage(r.tornado,"PNG",15,W,180,t)}catch(e){console.warn("Error adding Tornado image to PDF",e)}}P(x,G,i),x.addPage(),G++}if(b(x,"Shift & Roster Strategy","Detailed Personnel Plan",i),W=35,N.results){let e=N.results.reduce((e,t)=>e+t.headcount,0),t=N.results.reduce((e,t)=>e+t.monthlyCost,0);R(x,14,W,55,24,"Total Headcount",`${e}`,"FTEs across all shifts"),R(x,75,W,55,24,"Monthly OPEX",O(t),"Gross Salary + Burden"),W+=35,W=I(x,14,W,180,N.results.map(e=>({label:e.role,value:e.monthlyCost,color:e.role.includes("Engineer")?l:o})),"Monthly Cost Distribution by Role")}P(x,G,i),x.addPage(),G++,b(x,"Investment Recommendation","GO / NO-GO Decision Framework",i),W=35;let V=[{label:"IRR exceeds WACC (10%)",pass:k.irr>10},{label:"NPV is positive",pass:k.npv>0},{label:"Payback < 7 years",pass:k.paybackPeriodYears<7},{label:"Break-even occupancy < 60%",pass:k.breakEvenOccupancy<60},{label:"Profitability Index > 1.0",pass:k.profitabilityIndex>1}],_=V.filter(e=>e.pass).length,j=_>=4?"GO":_>=2?"CONDITIONAL GO":"NO-GO";x.setFillColor(..._>=4?[5,150,105]:_>=2?[217,119,6]:[220,38,38]),x.roundedRect(14,W,180,20,4,4,"F"),x.setFont("helvetica","bold"),x.setFontSize(16),x.setTextColor(255,255,255),x.text(`RECOMMENDATION: ${j}`,104,W+13,{align:"center"}),W+=30,W=$(x,W,"Decision Criteria","8.0",i),V.forEach(e=>{x.setFont("helvetica","normal"),x.setFontSize(9),x.setTextColor(...e.pass?[5,150,105]:[220,38,38]),x.text(e.pass?"✓":"✗",18,W+1),x.setTextColor(...d),x.text(e.label,26,W+1),x.setTextColor(...e.pass?[5,150,105]:[220,38,38]),x.text(e.pass?"PASS":"FAIL",160,W+1),W+=8}),W+=10,W=A(x,W,`Based on the analysis across CAPEX, financial returns, risk assessment, and operational readiness, this project receives a ${j} recommendation. ${_>=4?"All key investment criteria are met.":_>=2?"Some criteria require attention before final approval.":"Critical metrics fall below acceptable thresholds."}`),P(x,G,i),E(x,`DCMOC_MasterReport_${e.name}_${new Date().toISOString().slice(0,10)}.pdf`)},V=async(e,t,a)=>{let{doc:o,autoTable:l}=await D(a),n=1;T(o,"Country Intelligence\nReport",`Market Assessment for ${e.name}`,{client:"Site Selection Committee",date:M(),version:"1.0"},a),o.addPage(),n++,b(o,"Tax & Incentive Analysis",`${e.name} — Fiscal Environment`,a);let i=35,r=t.taxResult;r&&(R(o,14,i,42,24,"Total Savings",O(r.totalIncentiveValue),"NPV of incentives"),R(o,60,i,42,24,"Effective Tax Y1",`${(100*r.effectiveTaxTimeline[0]).toFixed(1)}%`,`vs ${(100*e.economy.taxRate).toFixed(1)}% standard`),R(o,106,i,42,24,"NPV Uplift",O(r.npvWithIncentives-r.npvWithoutIncentives),"With incentives"),R(o,152,i,42,24,"IRR Uplift",`+${(r.irrWithIncentives-r.irrWithoutIncentives).toFixed(1)}%`,`${r.irrWithIncentives.toFixed(1)}% with incentives`),i+=35,i=$(o,i,"Tax Holiday Timeline","1.0",a),l(o,{startY:i,head:[["Period","Standard Rate","Effective Rate","Tax Savings"]],body:r.effectiveTaxTimeline.slice(0,10).map((t,a)=>[`Year ${a+1}`,`${(100*e.economy.taxRate).toFixed(1)}%`,`${(100*t).toFixed(1)}%`,O(r.yearlyTaxSavings[a]||0)]),theme:"striped",headStyles:{fillColor:d},styles:{fontSize:8,cellPadding:2},margin:{left:14,right:14},columnStyles:{3:{halign:"right",textColor:[5,150,105]}}}),i=o.lastAutoTable.finalY+10,r.incentiveSummary&&r.incentiveSummary.length>0&&(i=v(o,i,40,{current:n}),i=w(o,i,"Available Incentive Programs",r.incentiveSummary.join("\n"),"success")),e.taxIncentives?.freeTradeZones&&e.taxIncentives.freeTradeZones.length>0&&(i=v(o,i,20,{current:n}),i=A(o,i,`Free Trade Zones: ${e.taxIncentives.freeTradeZones.join(", ")}. Import duty savings: ${O(r.ftzBenefits)}.`))),P(o,n,a),o.addPage(),n++,b(o,"Natural Disaster Risk",`${e.name} — Hazard Profile`,a),i=35;let s=t.disasterResult;s&&(R(o,14,i,42,24,"Risk Score",`${s.compositeScore}/100`,s.riskCategory),R(o,60,i,42,24,"Insurance/Yr",O(s.annualInsuranceCost),"Adjusted premium"),R(o,106,i,42,24,"Structural +",O(s.structuralCostAdder),"CAPEX hardening"),R(o,152,i,42,24,"Revenue @ Risk",O(s.revenueAtRisk),`${s.businessInterruptionDays} days interruption`),i+=35,i=$(o,i,"Risk Factor Breakdown","2.0",a),l(o,{startY:i,head:[["Hazard Type","Score","Impact Assessment"]],body:s.riskBreakdown.map(e=>[e.type,`${e.score}/100`,e.impact]),theme:"striped",headStyles:{fillColor:d},styles:{fontSize:8,cellPadding:2},margin:{left:14,right:14}}),i=o.lastAutoTable.finalY+10,s.mitigationOptions&&s.mitigationOptions.length>0&&(i=v(o,i,60,{current:n}),i=$(o,i,"Mitigation Recommendations","2.1",a),l(o,{startY:i,head:[["Measure","Cost","Annual Benefit","ROI"]],body:s.mitigationOptions.map(e=>[e.name,O(e.cost),O(e.annualBenefit),`${e.roiPercent}%`]),theme:"striped",headStyles:{fillColor:d},styles:{fontSize:8,cellPadding:2},margin:{left:14,right:14},columnStyles:{3:{halign:"right",textColor:[5,150,105]}}}),i=o.lastAutoTable.finalY+10)),P(o,n,a),o.addPage(),n++,b(o,"Grid Reliability Index",`${e.name} — Power Infrastructure`,a),i=35;let c=t.gridResult;if(c){if(R(o,14,i,35,24,"Grid Score",`${c.reliabilityScore}`,`Grade ${c.reliabilityGrade}`),R(o,53,i,35,24,"Outage Hrs/Yr",`${(c.annualOutageMinutes/60).toFixed(1)}`,`${c.annualExpectedOutages} events`),R(o,92,i,35,24,"Gen Capacity",`${c.requiredGenCapacity} kW`,`${c.recommendedFuelHours}h fuel`),R(o,131,i,35,24,"Fuel Cost/Yr",O(c.annualFuelCost),"Backup operations"),R(o,170,i,24,24,"Solar",`${c.solarViabilityScore}`,"/100"),i+=35,i=$(o,i,"Grid Risk Cost Breakdown","3.0",a),c.costBreakdown){let e=c.costBreakdown.map(e=>[e.label,z(e.value)]);e.push(["Total Grid-Adjusted OPEX",z(c.gridRiskAdjustedOpex)]),l(o,{startY:i,head:[["Cost Component","Annual Cost"]],body:e,theme:"striped",headStyles:{fillColor:d},styles:{fontSize:8,cellPadding:2},margin:{left:14,right:14},columnStyles:{1:{halign:"right"}}}),i=o.lastAutoTable.finalY+10}i=v(o,i,40,{current:n}),i=w(o,i,"Backup Power Architecture",`Grid Feed ${c.dualFeedRecommendation?"(Dual A+B)":"(Single)"} → ATS → UPS (${t.itLoadKw} kW)
Generator: ${c.requiredGenCapacity} kW (${c.recommendedFuelHours}h fuel reserve)
Availability with Backup: ${c.availabilityWithBackup.toFixed(3)}%
BESS ROI: ${c.batteryStorageROI<50?`${c.batteryStorageROI} year payback`:"Not recommended"}`,"info")}P(o,n,a),o.addPage(),n++,b(o,"Talent Availability Index",`${e.name} — Workforce Assessment`,a),i=35;let u=t.talentResult;u&&(R(o,14,i,42,24,"Talent Score",`${u.talentScore}/100`,u.hiringDifficulty),R(o,60,i,42,24,"Salary Premium",`+${((u.adjustedSalaryMultiplier-1)*100).toFixed(0)}%`,O(u.adjustedAnnualStaffCost-t.annualStaffCost)+"/yr extra"),R(o,106,i,42,24,"Time to Staff",`${u.timeToFullStaff} mo`,"Months to full team"),R(o,152,i,42,24,"Turnover",`${(100*u.adjustedTurnoverRate).toFixed(0)}%`,O(u.annualTurnoverCost)+"/yr"),i+=35,i=$(o,i,"Talent Factor Analysis","4.0",a),u.talentBreakdown&&(l(o,{startY:i,head:[["Factor","Value","Impact"]],body:u.talentBreakdown.map(e=>[e.metric,e.value,e.impact]),theme:"striped",headStyles:{fillColor:d},styles:{fontSize:8,cellPadding:2},margin:{left:14,right:14}}),i=o.lastAutoTable.finalY+10),i=v(o,i,50,{current:n}),i=$(o,i,"Annual Staff Cost Impact","4.1",a),l(o,{startY:i,head:[["Component","Amount"]],body:[["Base Annual Staff Cost",z(t.annualStaffCost)],[`+ Salary Premium (${((u.adjustedSalaryMultiplier-1)*100).toFixed(0)}%)`,`+${z(u.adjustedAnnualStaffCost-t.annualStaffCost)}`],["+ Turnover Cost",`+${z(u.annualTurnoverCost)}`],["+ Training Cost",`+${z(u.annualTrainingCost)}`],["+ Recruitment Cost",`+${z(u.totalRecruitmentCost)}`],["Talent-Adjusted Total",z(u.adjustedAnnualStaffCost+u.annualTurnoverCost+u.annualTrainingCost)]],theme:"striped",headStyles:{fillColor:d},styles:{fontSize:8,cellPadding:2},margin:{left:14,right:14},columnStyles:{1:{halign:"right"}}})),P(o,n,a),E(o,`DCMOC_CountryIntel_${e.name}_${new Date().toISOString().slice(0,10)}.pdf`)},_=async(e,t,a)=>{let{doc:n,autoTable:i}=await D(a),r=1;T(n,"Capacity Planning\n& Phased Investment",`Multi-Phase Build Strategy for ${e.name}`,{client:"Infrastructure Planning",date:M(),version:"1.0"},a),n.addPage(),r++,b(n,"Capacity Plan Overview",`${t.capPlan.phases.length} Phases — ${O(t.capPlan.totalItLoadKw)} kW Total`,a);let s=35;R(n,14,35,42,24,"Total Capacity",`${(t.capPlan.totalItLoadKw/1e3).toFixed(1)} MW`,`${t.capPlan.phases.length} phases`),R(n,60,s,42,24,"Total CAPEX",O(t.capPlan.totalCapex),`$${Math.round(t.capPlan.totalCapex/t.capPlan.totalItLoadKw).toLocaleString()}/kW`),R(n,106,s,42,24,"Scalability",`${t.capPlan.scalabilityScore}/100`,"Phase efficiency score"),R(n,152,s,42,24,"Timeline",`${t.capPlan.totalMonths} mo`,`~${(t.capPlan.totalMonths/12).toFixed(1)} years`),s+=35,t.capPlan.narrative&&(s=A(n,s,t.capPlan.narrative)+8),s=$(n,s,"Phase-by-Phase Breakdown","1.0",a);let c=t.capPlan.phases.map((e,a)=>[t.phases[a]?.label||`Phase ${a+1}`,`${e.itLoadKw.toLocaleString()} kW`,O(e.capex),`$${Math.round(e.capexPerKw).toLocaleString()}`,`${e.headcount} FTE`,e.pue.toFixed(2),`M${t.phases[a]?.startMonth||0}`,`${t.phases[a]?.buildMonths||0} mo`]);if(i(n,{startY:s,head:[["Phase","IT Load","CAPEX","$/kW","Staff","PUE","Start","Build"]],body:c,theme:"striped",headStyles:{fillColor:d},styles:{fontSize:8,cellPadding:2},margin:{left:14,right:14},columnStyles:{2:{halign:"right"},3:{halign:"right"},4:{halign:"right"}}}),s=n.lastAutoTable.finalY+10,s=v(n,s,50,{current:r}),s=$(n,s,"Build Timeline","1.1",a),t.capPlan.timeline.forEach((e,t)=>{s=v(n,s,12,{current:r}),n.setFillColor(...t%2==0?o:l),n.circle(18,s+2,2,"F"),n.setFont("helvetica","bold"),n.setFontSize(8),n.setTextColor(...d),n.text(e.label,24,s+3),n.setFont("helvetica","normal"),n.setFontSize(7),n.setTextColor(...m),n.text(`M${e.startMonth} → M${e.endMonth} (${e.type})`,80,s+3),s+=8}),t.capPlan.phaseDetails&&t.capPlan.phaseDetails.length>0&&(s=v(n,s,50,{current:r}),s=$(n,s,"Phase Detail Cards","1.2",a),t.capPlan.phaseDetails.forEach(e=>{s=v(n,s,25,{current:r}),n.setFont("helvetica","bold"),n.setFontSize(9),n.setTextColor(...d),n.text(e.label,14,s),n.setFont("helvetica","normal"),n.setFontSize(7),n.setTextColor(...m),n.text(`Revenue: ${O(e.revenueEstimate)}/yr | ROI: ${e.roiYears}yr | Risk: ${e.riskScore}/100`,50,s),s+=5,n.setFontSize(7),n.text(e.description,14,s,{maxWidth:180}),s+=10})),t.capPlan.assumptions&&t.capPlan.assumptions.length>0){s=v(n,s,60,{current:r}),s=$(n,s,"Key Assumptions","1.3",a);let e=t.capPlan.assumptions.map(e=>[e.category,e.assumption,e.value]);i(n,{startY:s,head:[["Category","Assumption","Value"]],body:e,theme:"striped",headStyles:{fillColor:d},styles:{fontSize:7,cellPadding:2},margin:{left:14,right:14}}),s=n.lastAutoTable.finalY+10}P(n,r,a),n.addPage(),r++,b(n,"Staffing & PUE Evolution","Resource Scaling Over Time",a),s=$(n,s=35,"Staffing Ramp","2.0",a);let u=t.capPlan.staffingRamp.filter((e,a)=>a%6==0||a===t.capPlan.staffingRamp.length-1).map(e=>[`Month ${e.month}`,`${e.fte} FTE`]);i(n,{startY:s,head:[["Month","Total FTE"]],body:u,theme:"striped",headStyles:{fillColor:d},styles:{fontSize:8,cellPadding:2},margin:{left:14,right:100}}),s=n.lastAutoTable.finalY+10,s=v(n,s,50,{current:r}),s=$(n,s,"PUE Evolution","2.1",a);let h=t.capPlan.pueEvolution.filter((e,a)=>a%6==0||a===t.capPlan.pueEvolution.length-1).map(e=>[`Month ${e.month}`,e.pue.toFixed(3)]);if(i(n,{startY:s,head:[["Month","PUE"]],body:h,theme:"striped",headStyles:{fillColor:d},styles:{fontSize:8,cellPadding:2},margin:{left:14,right:100}}),s=n.lastAutoTable.finalY+10,t.phasedFinancials){P(n,r,a),n.addPage(),r++,b(n,"Phased Financial Analysis","Per-Phase & Blended Investment Returns",a),s=35;let e=t.phasedFinancials;if(R(n,14,s,42,24,"Blended IRR",`${e.blendedIRR?.toFixed(1)||"N/A"}%`,"Weighted by investment"),R(n,60,s,42,24,"Total NPV",O(e.totalNPV||0),"All phases combined"),R(n,106,s,42,24,"Payback",`${e.weightedPayback?.toFixed(1)||"N/A"} yr`,"Weighted average"),R(n,152,s,42,24,"Investment",O(e.totalInvestment||t.capPlan.totalCapex),"Total capital deployed"),s+=35,s=$(n,s,"Investment Decision Matrix","3.0",a),e.phaseResults){let t=e.phaseResults.map(e=>[e.label,O(e.capex),`${e.irr?.toFixed(1)||"N/A"}%`,O(e.npv||0),`${e.payback?.toFixed(1)||"N/A"} yr`,e.irr>=12?"GO":e.irr>=8?"CONDITIONAL":"NO-GO"]);i(n,{startY:s,head:[["Phase","CAPEX","IRR","NPV","Payback","Decision"]],body:t,theme:"striped",headStyles:{fillColor:d},styles:{fontSize:8,cellPadding:2},margin:{left:14,right:14},columnStyles:{1:{halign:"right"},2:{halign:"right"},3:{halign:"right"},4:{halign:"right"}}})}}P(n,r,a),E(n,`DCMOC_CapacityPlan_${e.name}_${new Date().toISOString().slice(0,10)}.pdf`)};e.s(["generateCapacityPlanPDF",0,_,"generateCapexPDF",0,Y,"generateCarbonPDF",0,W,"generateCountryIntelPDF",0,V,"generateDetailedPDF",0,N,"generateFinancialPDF",0,L,"generateMaintenancePDF",0,B,"generateMasterReportPDF",0,U,"generateRiskPDF",0,G,"generateSimulationPDF",0,N,"generateStaffingPDF",0,k],32737)}]);