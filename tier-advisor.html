<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GED7FX8RTV"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-GED7FX8RTV');</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tier Advisor | Data Center Tier Classification Calculator</title>
    <meta name="description" content="Interactive Uptime Institute tier classification advisor. Compare Tier I-IV requirements, costs, and redundancy configurations.">
    <meta name="keywords" content="Tier Advisor, Uptime Institute, Tier Classification, TIA-942, EN 50600, Data Center, Redundancy, BICSI 002, Infrastructure, Compliance">
    <meta name="author" content="Bagus Dwi Permana">
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#8b5cf6">
    <link rel="canonical" href="https://resistancezero.com/tier-advisor.html">
    <link rel="alternate" hreflang="en" href="https://resistancezero.com/tier-advisor.html">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://resistancezero.com/tier-advisor.html">
    <meta property="og:title" content="Tier Advisor — Data Center Tier Classification Calculator">
    <meta property="og:description" content="Map your infrastructure to Uptime Institute Tier I-IV, TIA-942, and EN 50600 with regional compliance overlays.">
    <meta property="og:image" content="https://resistancezero.com/assets/tier-advisor-hero.jpg">
    <meta property="og:locale" content="en_US">
    <meta property="og:site_name" content="Bagus Dwi Permana Portfolio">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Tier Advisor — Data Center Tier Classification Calculator">
    <meta name="twitter:description" content="Map your infrastructure to Uptime Institute Tier I-IV, TIA-942, EN 50600 with regional compliance.">
    <meta name="twitter:image" content="https://resistancezero.com/assets/tier-advisor-hero.jpg">
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"WebApplication","name":"Tier Advisor","applicationCategory":"UtilityApplication","description":"Map data center infrastructure to Uptime Institute Tier I-IV, TIA-942, EN 50600 classifications with regional compliance overlays.","url":"https://resistancezero.com/tier-advisor.html","operatingSystem":"Web Browser","offers":{"@type":"Offer","price":"0","priceCurrency":"USD"},"creator":{"@type":"Person","name":"Bagus Dwi Permana"}}</script>
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"HowTo","name":"How to Classify Your Data Center Tier Level","description":"Step-by-step guide to map your facility infrastructure to Uptime Institute, TIA-942, and EN 50600 classifications.","totalTime":"PT5M","tool":[{"@type":"HowToTool","name":"Tier Advisor Calculator"}],"step":[{"@type":"HowToStep","position":1,"name":"Enter Facility Profile","text":"Select your facility type, IT load, and building characteristics."},{"@type":"HowToStep","position":2,"name":"Configure Power Infrastructure","text":"Specify utility feeds, generator configuration, UPS topology, and PDU redundancy."},{"@type":"HowToStep","position":3,"name":"Define Cooling & Network","text":"Set cooling redundancy, distribution type, network entry points, and carrier diversity."},{"@type":"HowToStep","position":4,"name":"Review Tier Classification","text":"Get instant Uptime Institute Tier, TIA-942 Rating, EN 50600 Class, and gap analysis with upgrade recommendations."}]}</script>
    <link rel="icon" type="image/png" href="assets/Favicon.png">
    <link rel="apple-touch-icon" href="assets/Favicon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"></noscript>
    <link rel="preload" as="image" href="assets/tier-advisor-hero.webp" type="image/webp">
    <link rel="preload" as="image" href="assets/tier-advisor-hero.jpg">

    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #5b21b6 0%, #8b5cf6 50%, #a78bfa 100%);
            --secondary-gradient: linear-gradient(135deg, #8b5cf6 0%, #5b21b6 100%);
            --dark-purple: #5b21b6;
            --medium-purple: #8b5cf6;
            --light-purple: #a78bfa;
            --accent-purple: #8b5cf6;
            --accent-gold: #f59e0b;
            --accent-emerald: #10b981;
            --accent-red: #ef4444;
            --accent-cyan: #06b6d4;
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-tertiary: #e9ecef;
            --text-primary: #212529;
            --text-secondary: #495057;
            --text-muted: #6c757d;
            --glass-bg: rgba(255,255,255,0.85);
            --glass-bg-dark: rgba(91,33,182,0.95);
            --glass-border: rgba(139,92,246,0.1);
            --glass-blur: blur(20px);
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
            --shadow-lg: 0 8px 30px rgba(0,0,0,0.12);
        }
        [data-theme="dark"] {
            --bg-primary: #0f172a; --bg-secondary: #1e293b; --bg-tertiary: #334155;
            --text-primary: #f1f5f9; --text-secondary: #94a3b8; --text-muted: #64748b;
            --glass-bg: rgba(30,41,59,0.85); --glass-border: rgba(139,92,246,0.15);
        }
        [data-theme="dark"] .navbar { background: rgba(15,23,42,0.9); }
        [data-theme="dark"] .input-field { background: #1e293b; border-color: #334155; color: #f1f5f9; }
        [data-theme="dark"] .input-field:focus { border-color: #8b5cf6; box-shadow: 0 0 0 3px rgba(139,92,246,0.15); }
        [data-theme="dark"] .pue-mode-bar { background: #1e293b; border-color: #334155; }
        [data-theme="dark"] .pue-btn-reset { background: #1e293b; border-color: #334155; color: #94a3b8; }
        [data-theme="dark"] .preset-btn { background: rgba(139,92,246,0.08); border-color: rgba(139,92,246,0.2); }
        [data-theme="dark"] .nav-user-dropdown { background: #1e293b; border-color: #334155; }
        [data-theme="dark"] .nav-dd-header { border-color: #334155; }
        [data-theme="dark"] .nav-dd-logout:hover { background: rgba(239,68,68,0.1); }
        [data-theme="dark"] #loginModal > div { background: #1e293b; color: #f1f5f9; }
        [data-theme="dark"] #loginModal label { color: #94a3b8; }
        [data-theme="dark"] #loginModal input { background: #0f172a; border-color: #334155; color: #f1f5f9; }
        [data-theme="dark"] .subsystem-bar-bg { background: #334155; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; line-height: 1.6; }
        .page-background { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; background: radial-gradient(ellipse at top right, rgba(139,92,246,0.08) 0%, transparent 50%), radial-gradient(ellipse at bottom left, rgba(91,33,182,0.05) 0%, transparent 50%), linear-gradient(rgba(139,92,246,0.02) 1px, transparent 1px), linear-gradient(90deg, rgba(139,92,246,0.02) 1px, transparent 1px); background-size: 100% 100%, 100% 100%, 50px 50px, 50px 50px; }
        .navbar { position: fixed; top: 0; left: 0; right: 0; z-index: 1000; background: var(--glass-bg); backdrop-filter: var(--glass-blur); border-bottom: 1px solid var(--glass-border); box-shadow: var(--shadow-md); }
        .nav-container { display: flex; justify-content: space-between; align-items: center; padding: 1rem 2rem; max-width: 1400px; margin: 0 auto; }
        .nav-brand { display: flex; align-items: center; gap: 12px; text-decoration: none; color: var(--dark-purple); }
        .nav-logo { width: 44px; height: 44px; background: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 11px; color: white; box-shadow: 0 4px 12px rgba(139,92,246,0.3); letter-spacing: -0.5px; }
        .nav-title { font-weight: 700; font-size: 1.1rem; color: var(--text-primary); }
        .nav-subtitle { font-size: 0.75rem; color: var(--text-muted); }
        .nav-links { display: flex; gap: 1.5rem; align-items: center; }
        .nav-link { color: var(--text-secondary); text-decoration: none; font-size: 0.9rem; font-weight: 500; padding: 8px 0; transition: color 0.3s; }
        .nav-link:hover { color: var(--dark-purple); }
        .nav-back { display: flex; align-items: center; gap: 8px; padding: 10px 20px; background: var(--primary-gradient); border: none; border-radius: 8px; color: white; text-decoration: none; font-size: 0.85rem; font-weight: 600; transition: all 0.3s; box-shadow: 0 4px 12px rgba(139,92,246,0.25); }
        .nav-back:hover { transform: translateY(-2px); }
        .nav-auth-wrap { position: relative; margin-left: 0.5rem; }
        .nav-login-btn { display: flex; align-items: center; gap: 6px; padding: 8px 18px; background: linear-gradient(135deg, #7c3aed, #a855f7); border: none; border-radius: 8px; color: white; font-size: 0.82rem; font-weight: 600; font-family: inherit; cursor: pointer; transition: all 0.3s; box-shadow: 0 3px 10px rgba(139,92,246,0.3); white-space: nowrap; }
        .nav-login-btn:hover { transform: translateY(-1px); box-shadow: 0 5px 16px rgba(139,92,246,0.4); }
        .nav-user-btn { display: flex; align-items: center; gap: 8px; padding: 6px 12px 6px 6px; background: rgba(139,92,246,0.08); border: 1px solid rgba(139,92,246,0.25); border-radius: 50px; cursor: pointer; transition: all 0.3s; font-family: inherit; color: var(--text-primary); }
        .nav-user-btn:hover { background: rgba(139,92,246,0.14); }
        .nav-user-avatar { width: 30px; height: 30px; border-radius: 50%; background: linear-gradient(135deg, #7c3aed, #a855f7); display: flex; align-items: center; justify-content: center; color: white; font-size: 0.7rem; font-weight: 700; }
        .nav-user-email { font-size: 0.8rem; font-weight: 500; color: var(--text-secondary); max-width: 130px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .nav-user-chevron { font-size: 0.6rem; color: var(--text-muted); transition: transform 0.3s; }
        .nav-user-btn.open .nav-user-chevron { transform: rotate(180deg); }
        .nav-user-dropdown { display: none; position: absolute; top: calc(100% + 8px); right: 0; background: white; border-radius: 12px; border: 1px solid #e2e8f0; box-shadow: 0 12px 40px rgba(0,0,0,0.12); min-width: 220px; z-index: 1001; overflow: hidden; }
        .nav-user-dropdown.show { display: block; }
        .nav-dd-header { padding: 14px 16px; border-bottom: 1px solid #f1f5f9; }
        .nav-dd-tier-badge { display: inline-flex; padding: 3px 10px; border-radius: 50px; font-size: 0.65rem; font-weight: 700; letter-spacing: 0.5px; margin-bottom: 6px; }
        .nav-dd-tier-badge.pro { background: linear-gradient(135deg,#8b5cf6,#a855f7); color: white; }
        .nav-dd-email { font-size: 0.78rem; color: #64748b; word-break: break-all; }
        .nav-dd-logout { display: flex; align-items: center; gap: 8px; width: 100%; padding: 12px 16px; border: none; background: none; font-size: 0.82rem; font-weight: 500; color: #ef4444; cursor: pointer; font-family: inherit; transition: background 0.2s; }
        .nav-dd-logout:hover { background: #fef2f2; }
        .theme-toggle { background: none; border: 1px solid var(--glass-border); border-radius: 8px; padding: 8px 10px; cursor: pointer; color: var(--text-muted); font-size: 1rem; transition: all 0.3s; }
        .theme-toggle:hover { color: var(--accent-purple); border-color: var(--accent-purple); }
        .hamburger { display: none; flex-direction: column; gap: 5px; background: none; border: none; cursor: pointer; padding: 8px; }
        .hamburger span { width: 24px; height: 2px; background: var(--text-primary); border-radius: 2px; transition: all 0.3s; }
        .main-content { position: relative; z-index: 10; padding-top: 80px; }
        .hero { padding: 3rem 2rem 2rem; text-align: center; max-width: 900px; margin: 0 auto; }
        .hero-badge { display: inline-flex; align-items: center; gap: 8px; padding: 8px 16px; background: linear-gradient(135deg, rgba(139,92,246,0.1), rgba(139,92,246,0.05)); border: 1px solid rgba(139,92,246,0.3); border-radius: 50px; font-size: 0.8rem; color: var(--accent-purple); font-weight: 600; margin-bottom: 1.5rem; }
        .hero h1 { font-size: clamp(2rem, 4vw, 2.8rem); font-weight: 800; background: linear-gradient(135deg, #8b5cf6 0%, #5b21b6 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 1rem; }
        .hero p { font-size: 1.05rem; color: var(--text-secondary); max-width: 700px; margin: 0 auto; }
        .quick-stats { display: flex; justify-content: center; gap: 2rem; margin-top: 1.5rem; flex-wrap: wrap; }
        .quick-stat { display: flex; align-items: center; gap: 6px; font-size: 0.82rem; color: var(--text-muted); }
        .quick-stat i { color: var(--accent-purple); }
        .calculator-section { max-width: 1400px; margin: 2rem auto; padding: 0 2rem; }
        .calculator-grid { display: grid; grid-template-columns: 1.2fr 1fr; gap: 2rem; }
        .input-panel { display: flex; flex-direction: column; gap: 1.5rem; }
        .input-section { background: var(--glass-bg); backdrop-filter: var(--glass-blur); border: 1px solid var(--glass-border); border-radius: 16px; padding: 1.5rem; }
        .section-header { display: flex; align-items: center; gap: 10px; margin-bottom: 1.25rem; }
        .section-icon { width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; }
        .section-title { font-size: 0.95rem; font-weight: 700; color: var(--text-primary); }
        .section-subtitle { font-size: 0.72rem; color: var(--text-muted); }
        .input-group { margin-bottom: 1rem; }
        .input-group:last-child { margin-bottom: 0; }
        .input-label { display: flex; align-items: center; gap: 6px; font-size: 0.78rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 6px; }
        .input-field { width: 100%; padding: 10px 14px; border: 1px solid #e2e8f0; border-radius: 10px; font-size: 0.9rem; font-family: inherit; color: var(--text-primary); background: white; outline: none; transition: border-color 0.3s; }
        .input-field:focus { border-color: var(--accent-purple); box-shadow: 0 0 0 3px rgba(139,92,246,0.1); }
        select.input-field { cursor: pointer; }
        .preset-row { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 10px; }
        .preset-btn { padding: 5px 12px; border: 1px solid rgba(139,92,246,0.3); border-radius: 50px; background: rgba(139,92,246,0.05); color: var(--accent-purple); font-size: 0.72rem; font-weight: 600; cursor: pointer; font-family: inherit; transition: all 0.2s; white-space: nowrap; }
        .preset-btn:hover, .preset-btn.active { background: var(--accent-purple); color: white; border-color: var(--accent-purple); }
        .results-panel { position: sticky; top: 100px; }
        .results-card { background: var(--glass-bg); backdrop-filter: var(--glass-blur); border: 1px solid var(--glass-border); border-radius: 16px; padding: 1.5rem; margin-bottom: 1.5rem; }
        .tier-display { text-align: center; padding: 1.5rem 0; }
        .tier-value { font-size: 2.8rem; font-weight: 800; font-family: 'JetBrains Mono', monospace; line-height: 1; }
        .tier-label { font-size: 0.8rem; color: var(--text-muted); font-weight: 600; text-transform: uppercase; letter-spacing: 1px; margin-top: 0.5rem; }
        .tier-badge { display: inline-flex; align-items: center; gap: 6px; padding: 6px 16px; border-radius: 50px; font-size: 0.85rem; font-weight: 700; margin-top: 0.75rem; }
        .score-row { display: flex; justify-content: center; gap: 2rem; margin-top: 1rem; }
        .score-item { text-align: center; }
        .score-item .val { font-size: 1.4rem; font-weight: 700; font-family: 'JetBrains Mono', monospace; }
        .score-item .lbl { font-size: 0.68rem; color: var(--text-muted); font-weight: 600; text-transform: uppercase; }
        .metric-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-top: 1.25rem; }
        .metric-box { background: rgba(139,92,246,0.04); border: 1px solid rgba(139,92,246,0.1); border-radius: 10px; padding: 0.75rem; text-align: center; }
        .metric-label { font-size: 0.68rem; color: var(--text-muted); font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; }
        .metric-value { font-size: 1.05rem; font-weight: 700; font-family: 'JetBrains Mono', monospace; color: var(--text-primary); margin-top: 2px; }
        .subsystem-scores { margin-top: 1.25rem; }
        .subsystem-row { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
        .subsystem-label { font-size: 0.72rem; font-weight: 600; color: var(--text-secondary); min-width: 72px; }
        .subsystem-bar-bg { flex: 1; height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden; }
        .subsystem-bar-fill { height: 100%; border-radius: 4px; transition: width 0.5s ease; }
        .subsystem-val { font-size: 0.72rem; font-weight: 700; font-family: 'JetBrains Mono', monospace; min-width: 30px; text-align: right; }
        .gap-section { margin-top: 1.25rem; padding: 1rem; background: rgba(139,92,246,0.04); border: 1px solid rgba(139,92,246,0.1); border-radius: 10px; }
        .gap-title { font-size: 0.82rem; font-weight: 700; color: var(--text-primary); margin-bottom: 0.5rem; display: flex; align-items: center; gap: 6px; }
        .gap-list { list-style: none; padding: 0; }
        .gap-list li { font-size: 0.78rem; color: var(--text-secondary); padding: 4px 0; padding-left: 16px; position: relative; }
        .gap-list li::before { content: ''; position: absolute; left: 0; top: 10px; width: 6px; height: 6px; border-radius: 50%; background: var(--accent-purple); }
        .rec-section { margin-top: 1.25rem; }
        .rec-title { font-size: 0.78rem; font-weight: 700; color: var(--text-primary); margin-bottom: 0.75rem; display: flex; align-items: center; gap: 6px; }
        .rec-card { display: flex; gap: 10px; padding: 0.75rem; background: rgba(139,92,246,0.04); border: 1px solid rgba(139,92,246,0.1); border-radius: 10px; margin-bottom: 0.5rem; }
        .rec-icon { width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; flex-shrink: 0; }
        .rec-text h4 { font-size: 0.78rem; font-weight: 600; color: var(--text-primary); }
        .rec-text p { font-size: 0.72rem; color: var(--text-muted); margin-top: 2px; }
        .rec-priority { font-size: 0.6rem; font-weight: 700; padding: 2px 8px; border-radius: 50px; margin-top: 4px; display: inline-block; }
        .rec-p1 { background: rgba(239,68,68,0.1); color: #ef4444; }
        .rec-p2 { background: rgba(245,158,11,0.1); color: #f59e0b; }
        .rec-p3 { background: rgba(59,130,246,0.1); color: #3b82f6; }
        .charts-section { max-width: 1400px; margin: 2rem auto; padding: 0 2rem; }
        .charts-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
        .chart-card { background: var(--glass-bg); backdrop-filter: var(--glass-blur); border: 1px solid var(--glass-border); border-radius: 16px; padding: 1.5rem; }
        .chart-title { font-size: 0.85rem; font-weight: 700; color: var(--text-primary); margin-bottom: 1rem; display: flex; align-items: center; gap: 8px; }
        .chart-container { position: relative; height: 280px; }
        .pue-toolbar { display: flex; align-items: center; justify-content: space-between; gap: 0.75rem; margin: 0 auto; max-width: 1400px; padding: 0 2rem 1.25rem; flex-wrap: wrap; }
        .pue-mode-bar { display: flex; gap: 0; background: #f1f5f9; border-radius: 10px; padding: 3px; border: 1px solid #e2e8f0; }
        .pue-toolbar-btn { padding: 0.55rem 1.2rem; border-radius: 8px; border: none; cursor: pointer; font-weight: 700; font-size: 0.82rem; font-family: inherit; transition: all 0.25s; display: flex; align-items: center; gap: 6px; white-space: nowrap; }
        .pue-btn-free { background: transparent; color: #64748b; }
        .pue-btn-free.active { background: linear-gradient(135deg, #8b5cf6, #a78bfa); color: white; box-shadow: 0 2px 8px rgba(139,92,246,0.3); }
        .pue-btn-free:not(.active):hover { background: rgba(139,92,246,0.08); color: #8b5cf6; }
        .pue-btn-pro { background: transparent; color: #64748b; }
        .pue-btn-pro.active { background: linear-gradient(135deg, #7c3aed, #a855f7); color: white; box-shadow: 0 2px 8px rgba(139,92,246,0.3); }
        .pue-btn-pro:not(.active):hover { background: rgba(139,92,246,0.08); color: #8b5cf6; }
        .pue-btn-pro.locked-hint { position: relative; }
        .pue-btn-pro.locked-hint::after { content: ''; position: absolute; top: -2px; right: -2px; width: 8px; height: 8px; background: #f59e0b; border-radius: 50%; border: 2px solid #f1f5f9; }
        .pue-toolbar-actions { display: flex; gap: 0.5rem; align-items: center; }
        .pue-btn-reset { padding: 0.55rem 1rem; border-radius: 10px; border: 1px solid #e2e8f0; background: white; color: #64748b; cursor: pointer; font-weight: 600; font-size: 0.82rem; font-family: inherit; transition: all 0.3s; display: flex; align-items: center; gap: 6px; }
        .pue-btn-reset:hover { border-color: #8b5cf6; color: #8b5cf6; background: rgba(139,92,246,0.04); }
        .pue-btn-pdf { padding: 0.55rem 1rem; border-radius: 10px; border: 1px solid rgba(239,68,68,0.3); background: rgba(239,68,68,0.04); color: #ef4444; cursor: pointer; font-weight: 600; font-size: 0.82rem; font-family: inherit; transition: all 0.3s; display: flex; align-items: center; gap: 6px; }
        .pue-btn-pdf:hover { border-color: #ef4444; background: rgba(239,68,68,0.1); }
        .pue-btn-pdf.disabled { opacity: 0.45; pointer-events: none; }
        .pue-mode-indicator { font-size: 0.72rem; font-weight: 700; letter-spacing: 0.5px; padding: 3px 10px; border-radius: 50px; display: none; }
        .pue-mode-indicator.free-active { display: inline-flex; background: rgba(139,92,246,0.1); color: #8b5cf6; }
        .pue-mode-indicator.pro-active { display: inline-flex; background: rgba(124,58,237,0.1); color: #7c3aed; }
        .pro-section { position: relative; }
        .pro-section.locked > *:not(.pro-overlay) { filter: blur(6px); user-select: none; pointer-events: none; }
        .pro-overlay { display: none; position: absolute; top: 0; left: 0; right: 0; bottom: 0; z-index: 10; background: rgba(255,255,255,0.7); backdrop-filter: blur(2px); border-radius: 16px; flex-direction: column; align-items: center; justify-content: center; gap: 0.75rem; pointer-events: all; cursor: pointer; }
        .pro-section.locked .pro-overlay { display: flex; }
        .pro-overlay i { font-size: 2rem; color: var(--accent-purple); }
        .pro-overlay-title { font-size: 1rem; font-weight: 700; color: var(--text-primary); }
        .pro-overlay-desc { font-size: 0.8rem; color: var(--text-muted); text-align: center; max-width: 260px; }
        .pro-overlay-btn { padding: 8px 20px; background: linear-gradient(135deg, #7c3aed, #a855f7); border: none; border-radius: 8px; color: white; font-size: 0.82rem; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .pro-overlay-btn:hover { transform: translateY(-1px); }
        .pro-badge { display: inline-flex; align-items: center; gap: 4px; padding: 2px 8px; background: linear-gradient(135deg, #8b5cf6, #a855f7); color: white; font-size: 0.6rem; font-weight: 700; border-radius: 50px; letter-spacing: 0.5px; vertical-align: middle; }
        @keyframes modalSlideIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        @media print {
            body { background: white !important; }
            .navbar, .hero, .pue-toolbar, #loginModal, .nav-back, footer, .pro-overlay, .pro-badge, .preset-row, .hamburger { display: none !important; }
            .main-content { padding-top: 0 !important; }
            .calculator-grid { display: block !important; }
            .results-panel { position: static !important; }
            @page { margin: 1cm; size: A4; }
        }
        @media (max-width: 768px) {
            .hamburger { display: flex; }
            .nav-links { display: none; position: absolute; top: 100%; left: 0; right: 0; flex-direction: column; background: var(--glass-bg); backdrop-filter: var(--glass-blur); padding: 1rem 2rem; gap: 0.5rem; border-bottom: 1px solid var(--glass-border); box-shadow: var(--shadow-md); }
            .nav-links.open { display: flex; }
            .calculator-grid { grid-template-columns: 1fr; }
            .results-panel { position: static; }
            .charts-grid { grid-template-columns: 1fr; }
            .hero h1 { font-size: 1.8rem; }
            .tier-value { font-size: 2rem; }
            .metric-grid { grid-template-columns: 1fr 1fr; }
            .pue-toolbar { flex-direction: column; align-items: stretch; }
            .pue-mode-bar { justify-content: center; }
            .pue-toolbar-actions { justify-content: center; }
        }
        /* Calculator Disclaimer */
        .calc-disclaimer { background: #f1f5f9 !important; border: 1px solid #cbd5e1 !important; border-radius: 12px; padding: 1.25rem 1.5rem; margin-top: 1.5rem; }
        .calc-disclaimer .disc-title { color: #1e293b !important; }
        .calc-disclaimer .disc-text { color: #475569 !important; }
        .calc-disclaimer .disc-text strong { color: #1e293b !important; }
        .calc-disclaimer .disc-text a { color: #2563eb !important; }
        .calc-disclaimer .disc-fine { color: #64748b !important; }
            /* Cookie Banner */
        .cookie-banner { position: fixed; bottom: 0; left: 0; right: 0; z-index: 10002; display: flex; align-items: center; justify-content: center; gap: 1.5rem; padding: 1rem 2rem; background: rgba(255,255,255,0.92); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border-top: 1px solid rgba(0,0,0,0.08); box-shadow: 0 -2px 16px rgba(0,0,0,0.06); font-size: 0.85rem; color: #374151; transform: translateY(0); transition: transform 0.4s cubic-bezier(0.4,0,0.2,1); }
        .cookie-banner.hidden { transform: translateY(100%); pointer-events: none; }
        .cookie-banner p { margin: 0; line-height: 1.5; }
        .cookie-banner a { color: #2563eb; text-decoration: underline; }
        .cookie-actions { display: flex; gap: 0.75rem; align-items: center; flex-shrink: 0; }
        .cookie-accept { padding: 0.45rem 1.2rem; background: #2563eb; color: #fff; border: none; border-radius: 6px; font-size: 0.8rem; font-weight: 600; cursor: pointer; transition: background 0.2s; }
        .cookie-accept:hover { background: #1d4ed8; }
        .cookie-decline { padding: 0.45rem 1.2rem; background: transparent; color: #6b7280; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.8rem; cursor: pointer; transition: all 0.2s; }
        .cookie-decline:hover { background: #f3f4f6; color: #374151; }
        @media (max-width: 768px) { .cookie-banner { flex-direction: column; gap: 0.75rem; text-align: center; padding: 1rem; } }
        @media print { .cookie-banner { display: none; } }
</style>
</head>

<body>
    <div class="page-background"></div>
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-brand">
                <div class="nav-logo">TA</div>
                <div>
                    <div class="nav-title">Tier Advisor</div>
                    <div class="nav-subtitle">Infrastructure Classification</div>
                </div>
            </a>
            <div class="nav-links" id="navLinks">
                <a href="datacenter-solutions.html" class="nav-link">DC Solutions</a>
                <a href="pue-calculator.html" class="nav-link" style="color:#06b6d4;">PUE Calc</a>
                <a href="capex-calculator.html" class="nav-link" style="color:#f59e0b;">CAPEX Calc</a>
                <a href="tia-942-checklist.html" class="nav-link" style="color:#10b981;">TIA-942</a>
                <a href="dcmoc/" class="nav-link" style="color:#ef4444;">DC MOC</a>
                <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()" title="Toggle dark mode"><i class="fas fa-moon"></i></button>
                <div class="nav-auth-wrap" id="navAuthWrap">
                    <button class="nav-login-btn" id="navLoginBtn" onclick="handlePremiumTab()"><i class="fas fa-user-circle"></i><span class="nav-login-text">Login</span></button>
                    <button class="nav-user-btn" id="navUserBtn" style="display:none;" onclick="toggleUserDropdown()">
                        <div class="nav-user-avatar" id="navUserAvatar">U</div>
                        <span class="nav-user-email" id="navUserEmail"></span>
                        <i class="fas fa-chevron-down nav-user-chevron"></i>
                    </button>
                    <div class="nav-user-dropdown" id="navUserDropdown">
                        <div class="nav-dd-header">
                            <div class="nav-dd-tier-badge pro" id="navDdTierBadge">PRO</div>
                            <div class="nav-dd-email" id="navDdEmail"></div>
                        </div>
                        <button class="nav-dd-logout" onclick="logoutPremium()"><i class="fas fa-sign-out-alt"></i> Logout</button>
                    </div>
                </div>
                <a href="index.html" class="nav-back"><i class="fas fa-arrow-left"></i> Portfolio</a>
            </div>
            <button class="hamburger" id="hamburgerBtn" onclick="toggleMobileMenu()"><span></span><span></span><span></span></button>
        </div>
    </nav>
    <main class="main-content">
        <section class="hero">
            <div class="hero-badge"><i class="fas fa-layer-group"></i> Infrastructure Classification</div>
            <h1>Tier Advisor</h1>
            <p>Map your data center's power, cooling, network, and site infrastructure to Uptime Institute Tier I-IV, TIA-942 Ratings 1-4, and EN 50600 Availability Classes — with regional compliance overlays for 12+ jurisdictions.</p>
            <div style="max-width:800px;margin:1.5rem auto;border-radius:16px;overflow:hidden;box-shadow:0 8px 30px rgba(0,0,0,0.12);border:1px solid rgba(139,92,246,0.15);">
                <picture>
                    <source type="image/webp" srcset="assets/tier-advisor-hero-600.webp 600w, assets/tier-advisor-hero.webp 1200w" sizes="(max-width:800px) 100vw, 800px">
                    <source type="image/jpeg" srcset="assets/tier-advisor-hero-600.jpg 600w, assets/tier-advisor-hero.jpg 1200w" sizes="(max-width:800px) 100vw, 800px">
                    <img src="assets/tier-advisor-hero.jpg" alt="Tier Advisor — Data Center Tier Classification Calculator" width="1200" height="509" style="width:100%;height:auto;display:block;" fetchpriority="high">
                </picture>
            </div>
            <div style="max-width:800px;margin:0 auto 1.5rem;text-align:left;padding:1.25rem 1.5rem;background:rgba(139,92,246,0.04);border:1px solid rgba(139,92,246,0.12);border-radius:12px;">
                <h3 style="font-size:0.95rem;font-weight:700;color:var(--text-primary);margin-bottom:0.5rem;display:flex;align-items:center;gap:8px;"><i class="fas fa-info-circle" style="color:#8b5cf6;"></i> What is Tier Classification?</h3>
                <p style="font-size:0.85rem;color:var(--text-secondary);line-height:1.7;margin:0 0 0.75rem 0;">The <strong>Uptime Institute Tier Standard</strong> classifies data centers from Tier I (basic, 99.67% availability) to Tier IV (fault tolerant, 99.995% availability) based on infrastructure topology and redundancy. <strong>TIA-942-B</strong> uses "Rated" levels 1-4 with additional telecom and security requirements. <strong>EN 50600</strong> defines Availability Classes VK1-VK4 aligned with European standards.</p>
                <p style="font-size:0.85rem;color:var(--text-secondary);line-height:1.7;margin:0;">This calculator maps your actual infrastructure against all four major frameworks simultaneously, identifies which subsystem limits your classification, and shows exactly what upgrades are needed to reach the next level.</p>
            </div>
            <div class="quick-stats">
                <span class="quick-stat"><i class="fas fa-layer-group"></i> 6 input sections</span>
                <span class="quick-stat"><i class="fas fa-th"></i> 4 framework mappings</span>
                <span class="quick-stat"><i class="fas fa-globe"></i> 12+ regional standards</span>
                <span class="quick-stat"><i class="fas fa-file-pdf"></i> PDF reports</span>
            </div>
        </section>
        <div class="pue-toolbar">
            <div class="pue-mode-bar">
                <button class="pue-toolbar-btn pue-btn-free active" id="btnFreeMode" onclick="setMode('free')"><i class="fas fa-chart-bar"></i> Free Assessment</button>
                <button class="pue-toolbar-btn pue-btn-pro locked-hint" id="btnProMode" onclick="setMode('pro')"><i class="fas fa-crown"></i> Pro Analysis</button>
            </div>
            <span class="pue-mode-indicator free-active" id="modeIndicator">FREE MODE</span>
            <div class="pue-toolbar-actions">
                <button class="pue-btn-reset" onclick="resetDefaults()"><i class="fas fa-undo"></i> Reset</button>
                <button class="pue-btn-pdf disabled" id="btnExportPDF" onclick="exportPDF()"><i class="fas fa-file-pdf"></i> Export PDF</button>
            </div>
        </div>

        <section class="calculator-section">
            <div class="calculator-grid">
                <div class="input-panel">
                    <!-- Section 1: Facility Profile -->
                    <div class="input-section">
                        <div class="section-header">
                            <div class="section-icon" style="background:rgba(139,92,246,0.1);color:#8b5cf6;"><i class="fas fa-building"></i></div>
                            <div><div class="section-title">Facility Profile</div><div class="section-subtitle">Type, capacity, and building characteristics</div></div>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Facility Type</label>
                            <select id="facilityType" class="input-field" onchange="debouncedCalculate()">
                                <option value="enterprise">Enterprise</option>
                                <option value="colocation" selected>Colocation</option>
                                <option value="hyperscale">Hyperscale</option>
                                <option value="edge">Edge</option>
                                <option value="telecom">Telecom</option>
                                <option value="financial">Financial</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Total IT Load (kW)</label>
                            <div class="preset-row">
                                <button class="preset-btn" onclick="setPreset(200,'edge')">Edge 200kW</button>
                                <button class="preset-btn active" onclick="setPreset(2000,'colocation')">Colo 2MW</button>
                                <button class="preset-btn" onclick="setPreset(5000,'enterprise')">Enterprise 5MW</button>
                                <button class="preset-btn" onclick="setPreset(20000,'hyperscale')">Hyperscale 20MW</button>
                            </div>
                            <input type="number" id="itLoad" class="input-field" value="2000" min="50" max="500000" step="50" oninput="debouncedCalculate()">
                        </div>
                        <div class="input-group">
                            <label class="input-label">Number of Floors</label>
                            <select id="numFloors" class="input-field" onchange="debouncedCalculate()">
                                <option value="1">1</option>
                                <option value="2" selected>2</option>
                                <option value="3">3</option>
                                <option value="4">4+</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Building Age (years)</label>
                            <input type="number" id="buildingAge" class="input-field" value="5" min="0" max="50" oninput="debouncedCalculate()">
                        </div>
                    </div>
                    <!-- Section 2: Power Infrastructure -->
                    <div class="input-section">
                        <div class="section-header">
                            <div class="section-icon" style="background:rgba(245,158,11,0.1);color:#f59e0b;"><i class="fas fa-bolt"></i></div>
                            <div><div class="section-title">Power Infrastructure</div><div class="section-subtitle">Utility, generators, UPS, and distribution</div></div>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Utility Feeds</label>
                            <select id="utilityFeeds" class="input-field" onchange="debouncedCalculate()">
                                <option value="single">Single Feed</option>
                                <option value="dual_same" selected>Dual Feed (Same Substation)</option>
                                <option value="dual_diverse">Dual Feed (Diverse Substations)</option>
                                <option value="onsite">On-Site Generation Only</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Generator Configuration</label>
                            <select id="genConfig" class="input-field" onchange="debouncedCalculate()">
                                <option value="none">None</option>
                                <option value="n">N (No Redundancy)</option>
                                <option value="n1" selected>N+1</option>
                                <option value="2n">2N</option>
                                <option value="2n1">2(N+1)</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label class="input-label">UPS Configuration</label>
                            <select id="upsConfig" class="input-field" onchange="debouncedCalculate()">
                                <option value="none">None</option>
                                <option value="n">N</option>
                                <option value="n1" selected>N+1</option>
                                <option value="2n">2N</option>
                                <option value="2n1">2(N+1)</option>
                                <option value="distributed">Distributed Redundant</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label class="input-label">UPS Topology</label>
                            <select id="upsTopo" class="input-field" onchange="debouncedCalculate()">
                                <option value="standby">Standby</option>
                                <option value="line_interactive">Line-Interactive</option>
                                <option value="double_conversion" selected>Double-Conversion</option>
                                <option value="rotary">Rotary</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Automatic Transfer Switch</label>
                            <select id="atsConfig" class="input-field" onchange="debouncedCalculate()">
                                <option value="none">None</option>
                                <option value="single" selected>Single ATS</option>
                                <option value="dual">Dual ATS</option>
                                <option value="sts">STS (Static Transfer Switch)</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label class="input-label">PDU Redundancy</label>
                            <select id="pduRedundancy" class="input-field" onchange="debouncedCalculate()">
                                <option value="single">Single-cord</option>
                                <option value="dual" selected>Dual-cord (A+B)</option>
                                <option value="triple">Triple-cord</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Generator Fuel Autonomy (hours)</label>
                            <input type="number" id="fuelAutonomy" class="input-field" value="48" min="0" max="720" oninput="debouncedCalculate()">
                        </div>
                    </div>
                    <!-- Section 3: Cooling Infrastructure -->
                    <div class="input-section">
                        <div class="section-header">
                            <div class="section-icon" style="background:rgba(59,130,246,0.1);color:#3b82f6;"><i class="fas fa-snowflake"></i></div>
                            <div><div class="section-title">Cooling Infrastructure</div><div class="section-subtitle">Redundancy, distribution, and cooling type</div></div>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Cooling Redundancy</label>
                            <select id="coolRedundancy" class="input-field" onchange="debouncedCalculate()">
                                <option value="n">N (No Redundancy)</option>
                                <option value="n1" selected>N+1</option>
                                <option value="n2">N+2</option>
                                <option value="2n">2N</option>
                                <option value="2n1">2(N+1)</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Cooling Distribution</label>
                            <select id="coolDistribution" class="input-field" onchange="debouncedCalculate()">
                                <option value="single">Single Loop</option>
                                <option value="dual" selected>Dual Loop</option>
                                <option value="n1_piping">N+1 Piping</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Cooling Type</label>
                            <select id="coolType" class="input-field" onchange="debouncedCalculate()">
                                <option value="dx">DX (Direct Expansion)</option>
                                <option value="chilled_water" selected>Chilled Water</option>
                                <option value="free_cooling">Free Cooling</option>
                                <option value="rdhx">Rear-Door Heat Exchanger</option>
                                <option value="dlc">Direct Liquid Cooling</option>
                                <option value="immersion">Immersion</option>
                            </select>
                        </div>
                    </div>
                    <!-- Section 4: Network & Connectivity -->
                    <div class="input-section">
                        <div class="section-header">
                            <div class="section-icon" style="background:rgba(16,185,129,0.1);color:#10b981;"><i class="fas fa-network-wired"></i></div>
                            <div><div class="section-title">Network & Connectivity</div><div class="section-subtitle">Entry points, carriers, and meet-me rooms</div></div>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Network Entry Points</label>
                            <select id="netEntry" class="input-field" onchange="debouncedCalculate()">
                                <option value="single">Single</option>
                                <option value="dual_same">Dual (Same Path)</option>
                                <option value="dual_diverse" selected>Dual (Diverse Path)</option>
                                <option value="three_plus">3+ Diverse</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Carrier Diversity</label>
                            <select id="carrierDiv" class="input-field" onchange="debouncedCalculate()">
                                <option value="single">Single Carrier</option>
                                <option value="two" selected>2 Carriers</option>
                                <option value="three_plus">3+ Carriers</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Meet-Me Room</label>
                            <select id="meetMeRoom" class="input-field" onchange="debouncedCalculate()">
                                <option value="none">None</option>
                                <option value="single" selected>Single</option>
                                <option value="redundant">Redundant</option>
                            </select>
                        </div>
                    </div>
                    <!-- Section 5: Physical Security & Fire -->
                    <div class="input-section">
                        <div class="section-header">
                            <div class="section-icon" style="background:rgba(239,68,68,0.1);color:#ef4444;"><i class="fas fa-shield-alt"></i></div>
                            <div><div class="section-title">Physical Security & Fire</div><div class="section-subtitle">Suppression, access control, and monitoring</div></div>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Fire Suppression</label>
                            <select id="fireSuppression" class="input-field" onchange="debouncedCalculate()">
                                <option value="none">None</option>
                                <option value="wet">Wet Sprinkler</option>
                                <option value="preaction" selected>Pre-Action</option>
                                <option value="clean">Clean Agent (FM-200/Novec)</option>
                                <option value="vesda_clean">VESDA + Clean Agent</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Physical Access Control</label>
                            <select id="accessControl" class="input-field" onchange="debouncedCalculate()">
                                <option value="key">Key Lock</option>
                                <option value="card" selected>Card Access</option>
                                <option value="biometric">Biometric</option>
                                <option value="mfa_mantrap">Multi-Factor + Mantrap</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Monitoring (BMS/DCIM)</label>
                            <select id="monitoring" class="input-field" onchange="debouncedCalculate()">
                                <option value="none">None</option>
                                <option value="basic">Basic Sensors</option>
                                <option value="bms" selected>BMS</option>
                                <option value="full_dcim">Full DCIM + BMS</option>
                            </select>
                        </div>
                    </div>
                    <!-- Section 6: Regional Compliance (PRO) -->
                    <div class="input-section pro-section locked" id="regionalSection">
                        <div class="pro-overlay" onclick="handlePremiumTab()">
                            <i class="fas fa-lock"></i>
                            <div class="pro-overlay-title">Regional Compliance</div>
                            <div class="pro-overlay-desc">Unlock regional compliance overlays for 12+ jurisdictions</div>
                            <button class="pro-overlay-btn"><i class="fas fa-crown" style="margin-right:6px;"></i>Unlock PRO</button>
                        </div>
                        <div class="section-header">
                            <div class="section-icon" style="background:rgba(99,102,241,0.1);color:#6366f1;"><i class="fas fa-globe"></i></div>
                            <div><div class="section-title">Regional Compliance <span class="pro-badge"><i class="fas fa-crown"></i> PRO</span></div><div class="section-subtitle">Jurisdiction-specific requirements</div></div>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Region</label>
                            <select id="regionSelect" class="input-field" onchange="debouncedCalculate()">
                                <option value="global" selected>Global (No Overlay)</option>
                                <option value="singapore">Singapore (MAS TRM)</option>
                                <option value="indonesia">Indonesia (OJK/ESDM)</option>
                                <option value="malaysia">Malaysia (BNM RMiT)</option>
                                <option value="thailand">Thailand (BOT IT Risk)</option>
                                <option value="japan">Japan (FISC Guidelines)</option>
                                <option value="south_korea">South Korea (FSS)</option>
                                <option value="australia">Australia (APRA CPS 234)</option>
                                <option value="eu">EU (DORA)</option>
                                <option value="uk">UK (FCA/PRA)</option>
                                <option value="usa">USA (SOC 2/HIPAA/PCI)</option>
                                <option value="india">India (RBI/SEBI)</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Industry Vertical</label>
                            <select id="verticalSelect" class="input-field" onchange="debouncedCalculate()">
                                <option value="general" selected>General</option>
                                <option value="financial">Financial Services</option>
                                <option value="healthcare">Healthcare</option>
                                <option value="government">Government</option>
                                <option value="telecom">Telecom</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Results Panel -->
                <div class="results-panel">
                    <div class="results-card">
                        <div class="tier-display">
                            <div class="tier-label">Classification Result</div>
                            <div id="tierDisplay" class="tier-value" style="color:#3b82f6;">Tier III</div>
                            <div id="tierBadge" class="tier-badge" style="background:rgba(59,130,246,0.1);color:#3b82f6;">
                                <i class="fas fa-check-circle"></i> <span id="tierBadgeText">Concurrently Maintainable</span>
                            </div>
                            <div class="score-row">
                                <div class="score-item"><div class="val" id="scoreValue" style="color:#8b5cf6;">72</div><div class="lbl">Score</div></div>
                                <div class="score-item"><div class="val" id="gradeValue" style="color:#3b82f6;">B</div><div class="lbl">Grade</div></div>
                                <div class="score-item"><div class="val" id="confidenceValue" style="color:#10b981;">88%</div><div class="lbl">Confidence</div></div>
                            </div>
                        </div>
                        <div class="metric-grid">
                            <div class="metric-box"><div class="metric-label">Uptime Institute</div><div class="metric-value" id="uptimeTier">Tier III</div></div>
                            <div class="metric-box"><div class="metric-label">TIA-942-B</div><div class="metric-value" id="tia942Rating">Rated 3</div></div>
                            <div class="metric-box"><div class="metric-label">EN 50600</div><div class="metric-value" id="en50600Class">VK3</div></div>
                            <div class="metric-box"><div class="metric-label">BICSI 002</div><div class="metric-value" id="bicsiClass">Class F3</div></div>
                        </div>
                        <div class="subsystem-scores">
                            <div style="font-size:0.78rem;font-weight:700;color:var(--text-primary);margin-bottom:0.5rem;"><i class="fas fa-chart-bar" style="color:#8b5cf6;margin-right:4px;"></i>Subsystem Scores</div>
                            <div class="subsystem-row"><span class="subsystem-label">Power</span><div class="subsystem-bar-bg"><div class="subsystem-bar-fill" id="powerBar" style="width:70%;background:#f59e0b;"></div></div><span class="subsystem-val" id="powerVal">70</span></div>
                            <div class="subsystem-row"><span class="subsystem-label">Cooling</span><div class="subsystem-bar-bg"><div class="subsystem-bar-fill" id="coolingBar" style="width:65%;background:#3b82f6;"></div></div><span class="subsystem-val" id="coolingVal">65</span></div>
                            <div class="subsystem-row"><span class="subsystem-label">Network</span><div class="subsystem-bar-bg"><div class="subsystem-bar-fill" id="networkBar" style="width:72%;background:#10b981;"></div></div><span class="subsystem-val" id="networkVal">72</span></div>
                            <div class="subsystem-row"><span class="subsystem-label">Physical</span><div class="subsystem-bar-bg"><div class="subsystem-bar-fill" id="physicalBar" style="width:55%;background:#ef4444;"></div></div><span class="subsystem-val" id="physicalVal">55</span></div>
                            <div class="subsystem-row"><span class="subsystem-label">Monitoring</span><div class="subsystem-bar-bg"><div class="subsystem-bar-fill" id="monitorBar" style="width:65%;background:#6366f1;"></div></div><span class="subsystem-val" id="monitorVal">65</span></div>
                        </div>
                        <div class="gap-section" id="gapSection">
                            <div class="gap-title"><i class="fas fa-arrow-up" style="color:#8b5cf6;"></i> Gap Analysis</div>
                            <div id="gapContent"><p style="font-size:0.78rem;color:var(--text-secondary);">Calculating...</p></div>
                        </div>
                        <div class="rec-section">
                            <div class="rec-title"><i class="fas fa-lightbulb" style="color:#f59e0b;"></i> Recommendations</div>
                            <div id="recommendations"></div>
                        </div>
                    </div>
                    <!-- Pro Results -->
                    <div class="results-card pro-section locked" id="proResultsCard">
                        <div class="pro-overlay" onclick="handlePremiumTab()">
                            <i class="fas fa-lock"></i>
                            <div class="pro-overlay-title">Pro Analysis</div>
                            <div class="pro-overlay-desc">Regional compliance, cost estimates, Monte Carlo confidence</div>
                            <button class="pro-overlay-btn"><i class="fas fa-crown" style="margin-right:6px;"></i>Unlock PRO</button>
                        </div>
                        <div style="font-size:0.82rem;font-weight:700;color:var(--text-primary);margin-bottom:0.75rem;"><i class="fas fa-crown" style="color:#8b5cf6;margin-right:4px;"></i>Pro Analysis <span class="pro-badge"><i class="fas fa-crown"></i> PRO</span></div>
                        <div class="metric-grid">
                            <div class="metric-box"><div class="metric-label">Regional Score</div><div class="metric-value" id="regionalScoreVal">—</div></div>
                            <div class="metric-box"><div class="metric-label">Upgrade Cost Est.</div><div class="metric-value" id="upgradeCostVal">—</div></div>
                            <div class="metric-box"><div class="metric-label">MC P50 Score</div><div class="metric-value" id="mcP50Val">—</div></div>
                            <div class="metric-box"><div class="metric-label">Tier Probability</div><div class="metric-value" id="tierProbVal">—</div></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Charts Section -->
        <section class="charts-section">
            <div class="charts-grid">
                <div class="chart-card">
                    <div class="chart-title"><i class="fas fa-spider" style="color:#8b5cf6;"></i> Subsystem Radar</div>
                    <div class="chart-container"><canvas id="radarChart"></canvas></div>
                </div>
                <div class="chart-card">
                    <div class="chart-title"><i class="fas fa-chart-bar" style="color:#3b82f6;"></i> Subsystem vs Tier Thresholds</div>
                    <div class="chart-container"><canvas id="barChart"></canvas></div>
                </div>
            </div>
            <!-- Pro Charts -->
            <div class="charts-grid pro-section locked" id="proChartsSection" style="margin-top:1.5rem;">
                <div class="pro-overlay" onclick="handlePremiumTab()">
                    <i class="fas fa-lock"></i>
                    <div class="pro-overlay-title">Pro Charts</div>
                    <div class="pro-overlay-desc">Monte Carlo histogram, sensitivity tornado, cost waterfall</div>
                    <button class="pro-overlay-btn"><i class="fas fa-crown" style="margin-right:6px;"></i>Unlock PRO</button>
                </div>
                <div class="chart-card">
                    <div class="chart-title"><i class="fas fa-dice" style="color:#7c3aed;"></i> Monte Carlo Distribution <span class="pro-badge"><i class="fas fa-crown"></i> PRO</span></div>
                    <div class="chart-container"><canvas id="histogramChart"></canvas></div>
                </div>
                <div class="chart-card">
                    <div class="chart-title"><i class="fas fa-tornado" style="color:#f59e0b;"></i> Sensitivity Analysis <span class="pro-badge"><i class="fas fa-crown"></i> PRO</span></div>
                    <div class="chart-container"><canvas id="tornadoChart"></canvas></div>
                </div>
            </div>
        </section>
        <!-- Pro Panels -->
        <section class="charts-section">
            <div class="charts-grid pro-section locked" id="proPanelsSection">
                <div class="pro-overlay" onclick="handlePremiumTab()">
                    <i class="fas fa-lock"></i>
                    <div class="pro-overlay-title">Pro Deep Dive</div>
                    <div class="pro-overlay-desc">Cost estimator, regional compliance checklist</div>
                    <button class="pro-overlay-btn"><i class="fas fa-crown" style="margin-right:6px;"></i>Unlock PRO</button>
                </div>
                <div class="chart-card">
                    <div class="chart-title"><i class="fas fa-dollar-sign" style="color:#10b981;"></i> Cost-to-Upgrade Estimator <span class="pro-badge"><i class="fas fa-crown"></i> PRO</span></div>
                    <div id="costEstimatorContent" style="font-size:0.82rem;color:var(--text-secondary);">
                        <table style="width:100%;border-collapse:collapse;font-size:0.78rem;">
                            <thead><tr style="border-bottom:2px solid var(--glass-border);"><th style="text-align:left;padding:8px;color:var(--text-primary);">Upgrade Action</th><th style="text-align:right;padding:8px;color:var(--text-primary);">Cost Range</th><th style="text-align:right;padding:8px;color:var(--text-primary);">Impact</th></tr></thead>
                            <tbody id="costTableBody"></tbody>
                        </table>
                        <div id="costTotal" style="margin-top:12px;padding:10px;background:rgba(16,185,129,0.06);border-radius:8px;font-weight:600;color:var(--text-primary);"></div>
                    </div>
                </div>
                <div class="chart-card">
                    <div class="chart-title"><i class="fas fa-clipboard-check" style="color:#6366f1;"></i> Regional Compliance <span class="pro-badge"><i class="fas fa-crown"></i> PRO</span></div>
                    <div id="regionalComplianceContent" style="font-size:0.82rem;color:var(--text-secondary);">
                        <p>Select a region in the Regional Compliance section to see jurisdiction-specific requirements.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Login Modal -->
    <div id="loginModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);backdrop-filter:blur(8px);z-index:99999;align-items:center;justify-content:center;">
        <div style="background:white;border-radius:20px;padding:2.5rem;max-width:420px;width:90%;box-shadow:0 25px 60px rgba(0,0,0,0.3);position:relative;animation:modalSlideIn 0.3s ease;">
            <button onclick="closeLoginModal()" style="position:absolute;top:16px;right:16px;background:none;border:none;font-size:1.2rem;color:#94a3b8;cursor:pointer;padding:4px;">&times;</button>
            <div style="text-align:center;margin-bottom:1.5rem;">
                <div style="width:56px;height:56px;background:linear-gradient(135deg,#7c3aed,#a855f7);border-radius:16px;display:flex;align-items:center;justify-content:center;margin:0 auto 1rem;"><i class="fas fa-crown" style="color:white;font-size:1.3rem;"></i></div>
                <h3 style="font-size:1.3rem;font-weight:700;color:#1e293b;margin-bottom:0.25rem;">Sign In</h3>
                <p style="font-size:0.85rem;color:#64748b;">Access calculators, tools, and analytical content.</p>
            </div>
            <div id="loginError" style="display:none;padding:10px 14px;border-radius:8px;background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.3);color:#dc2626;font-size:0.8rem;margin-bottom:1rem;text-align:center;">Invalid credentials</div>
            <div style="display:flex;flex-direction:column;gap:1rem;">
                <div>
                    <label style="display:block;font-size:0.8rem;font-weight:600;color:#475569;margin-bottom:6px;">Email</label>
                    <input type="email" id="loginEmail" placeholder="your@email.com" style="width:100%;padding:12px 14px;border:2px solid #e2e8f0;border-radius:10px;font-size:0.95rem;font-family:inherit;outline:none;transition:border-color 0.3s;" onfocus="this.style.borderColor='#8b5cf6'" onblur="this.style.borderColor='#e2e8f0'">
                </div>
                <div>
                    <label style="display:block;font-size:0.8rem;font-weight:600;color:#475569;margin-bottom:6px;">Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter password" style="width:100%;padding:12px 14px;border:2px solid #e2e8f0;border-radius:10px;font-size:0.95rem;font-family:inherit;outline:none;transition:border-color 0.3s;" onfocus="this.style.borderColor='#8b5cf6'" onblur="this.style.borderColor='#e2e8f0'" onkeydown="if(event.key==='Enter')attemptLogin()">
                </div>
                <button onclick="attemptLogin()" style="padding:12px;border-radius:10px;border:none;background:linear-gradient(135deg,#8b5cf6,#a855f7);color:white;font-size:0.95rem;font-weight:600;font-family:inherit;cursor:pointer;transition:all 0.3s;box-shadow:0 4px 12px rgba(139,92,246,0.3);"><i class="fas fa-unlock" style="margin-right:8px;"></i>Sign In</button>
            </div>
            <div style="text-align:center;margin-top:1.25rem;padding-top:1rem;border-top:1px solid #f1f5f9;">
                <p style="font-size:0.75rem;color:#94a3b8;">Features: Regional compliance, Monte Carlo, cost estimates, PDF export</p>
<div class="demo-creds" style="margin-top:12px;padding:10px 12px;border-radius:8px;background:rgba(139,92,246,0.08);border:1px solid rgba(139,92,246,0.2);font-size:0.78rem;color:#64748b;line-height:1.6;">
                    <span style="color:#8b5cf6;font-weight:600;">Demo Account:</span><br>
                    <code style="background:rgba(139,92,246,0.1);padding:2px 6px;border-radius:4px;font-size:0.75rem;color:#7c3aed;">demo@resistancezero.com</code> / <code style="background:rgba(139,92,246,0.1);padding:2px 6px;border-radius:4px;font-size:0.75rem;color:#7c3aed;">demo2026</code>
                </div>
                <p class="disc-fine" style="font-size:0.68rem;color:#64748b;margin-top:12px;line-height:1.5;">By signing in, you agree to our <a href="terms.html" target="_blank" style="color:#8b5cf6;text-decoration:underline;">Terms</a> &amp; <a href="privacy.html" target="_blank" style="color:#8b5cf6;text-decoration:underline;">Privacy Policy</a>.</p>
            </div>
        </div>
    </div>
    
        <!-- Independence Disclaimer -->
        <div style="max-width:900px;margin:2rem auto 0;padding:1rem 1.5rem;text-align:center;">
            <p style="font-size:0.72rem;color:#64748b;font-style:italic;line-height:1.6;margin:0;">All content on ResistanceZero is independent personal research derived from publicly available sources. This site does not represent any current or former employer. <a href="terms.html" style="color:#8b5cf6;">Terms &amp; Disclaimer</a></p>
        </div>


    <!-- Calculator Disclaimer -->
    <div style="max-width:1400px;margin:2rem auto 0;padding:0 2rem;">
        <div class="calc-disclaimer" style="background:rgba(30,41,59,0.6);border:1px solid rgba(148,163,184,0.15);border-radius:12px;padding:1.25rem 1.5rem;">
            <div style="display:flex;align-items:flex-start;gap:0.75rem;">
                <div style="color:#f59e0b;font-size:1rem;margin-top:2px;flex-shrink:0;"><i class="fas fa-triangle-exclamation"></i></div>
                <div>
                    <div class="disc-title" style="font-weight:700;font-size:0.8rem;color:#e2e8f0;margin-bottom:0.5rem;">Disclaimer &amp; Data Sources</div>
                    <p class="disc-text" style="font-size:0.72rem;color:#94a3b8;line-height:1.65;margin:0 0 0.5rem 0;">This calculator is provided for <strong style="color:#cbd5e1;">educational and estimation purposes only</strong>. Results are approximations based on industry benchmarks and publicly available data. They should not be used as the sole basis for investment, procurement, or engineering decisions. Always consult qualified professionals for site-specific analysis.</p>
                    <p class="disc-text" style="font-size:0.72rem;color:#94a3b8;line-height:1.65;margin:0 0 0.5rem 0;"><strong style="color:#cbd5e1;">Algorithm &amp; methodology sources:</strong> Uptime Institute Tier Classification System (Tier I-IV), TIA-942 rated/fault-tolerant topology, IEEE 493 (Gold Book) reliability data, component MTBF/MTTR databases from manufacturer specifications.</p>
                    <p class="disc-text" style="font-size:0.72rem;color:#94a3b8;line-height:1.65;margin:0 0 0.5rem 0;">All calculations are performed entirely in your browser. No data is transmitted to any server. See our <a href="privacy.html" style="color:#60a5fa;text-decoration:underline;">Privacy Policy</a> for details.</p>
                    <p class="disc-fine" style="font-size:0.68rem;color:#64748b;line-height:1.5;margin:0;">By using this tool you agree to our <a href="terms.html" style="color:#60a5fa;text-decoration:underline;">Terms of Service</a>. All content on ResistanceZero is independent personal research. This site does not represent any current or former employer.</p>
                </div>
            </div>
        </div>
    </div>

<!-- Footer -->
    <footer style="background:linear-gradient(135deg,#0f172a 0%,#1e293b 100%);color:#94a3b8;padding:3rem 2rem;margin-top:3rem;">
        <div style="max-width:1200px;margin:0 auto;">
            <div style="display:grid;grid-template-columns:2fr 1fr 1fr;gap:2rem;align-items:start;">
                <div>
                    <p style="font-size:0.75rem;font-weight:700;letter-spacing:0.15em;color:#64748b;line-height:1.6;margin-bottom:1rem;">BUILT FOR MISSION CRITICAL INFRASTRUCTURE<br>MANAGEMENT // 2026</p>
                    <p style="font-size:0.65rem;letter-spacing:0.1em;color:#475569;margin-bottom:0.75rem;">ALL OPERATIONAL DATASETS PRESERVED.</p>
                    <p style="font-size:0.75rem;color:#64748b;">&copy; 2026 Bagus Dwi Permana. All rights reserved.</p>
                </div>
                <div>
                    <h4 style="font-size:0.7rem;font-weight:700;letter-spacing:0.15em;color:#64748b;margin-bottom:1rem;">NAVIGATION</h4>
                    <ul style="list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:0.5rem;">
                        <li><a href="index.html" style="color:#94a3b8;text-decoration:none;font-size:0.8rem;">Home Dashboard</a></li>
                        <li><a href="articles.html" style="color:#94a3b8;text-decoration:none;font-size:0.8rem;">Technical Journal</a></li>
                        <li><a href="datacenter-solutions.html" style="color:#94a3b8;text-decoration:none;font-size:0.8rem;">DC Solutions</a></li>
                        <li><a href="pue-calculator.html" style="color:#94a3b8;text-decoration:none;font-size:0.8rem;">PUE Calculator</a></li>
                    </ul>
                </div>
                <div>
                    <h4 style="font-size:0.7rem;font-weight:700;letter-spacing:0.15em;color:#64748b;margin-bottom:1rem;">CONNECT</h4>
                    <ul style="list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:0.5rem;">
                        <li><a href="https://www.linkedin.com/in/bagus-dwi-permana-ba90b092" target="_blank" rel="noopener" style="color:#94a3b8;text-decoration:none;font-size:0.8rem;">LinkedIn Profile</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <script>
    // ═══════════════════════════════════════════
    // TIER ADVISOR ENGINE
    // ═══════════════════════════════════════════
    var isPremiumUser = false;
    var userTier = 'free';
    var currentMode = 'free';
    var radarChart = null, barChart = null, histogramChart = null, tornadoChart = null;

    var WEIGHTS = { power: 0.35, cooling: 0.20, network: 0.15, physical: 0.10, monitoring: 0.05, regional: 0.15 };

    var SCORE_MAPS = {
        utilityFeeds: { single:10, dual_same:40, dual_diverse:80, onsite:60 },
        genConfig: { none:0, n:30, n1:60, '2n':85, '2n1':100 },
        upsConfig: { none:0, n:20, n1:50, '2n':80, '2n1':100, distributed:90 },
        upsTopo: { standby:20, line_interactive:40, double_conversion:90, rotary:80 },
        atsConfig: { none:0, single:40, dual:75, sts:100 },
        pduRedundancy: { single:20, dual:70, triple:100 },
        coolRedundancy: { n:15, n1:50, n2:70, '2n':90, '2n1':100 },
        coolDistribution: { single:20, dual:70, n1_piping:100 },
        coolType: { dx:30, chilled_water:60, free_cooling:75, rdhx:80, dlc:90, immersion:100 },
        netEntry: { single:15, dual_same:40, dual_diverse:80, three_plus:100 },
        carrierDiv: { single:20, two:60, three_plus:100 },
        meetMeRoom: { none:0, single:50, redundant:100 },
        fireSuppression: { none:0, wet:30, preaction:60, clean:85, vesda_clean:100 },
        accessControl: { key:15, card:40, biometric:75, mfa_mantrap:100 },
        monitoring: { none:0, basic:30, bms:65, full_dcim:100 }
    };

    function gv(id) { return document.getElementById(id).value; }
    function gs(id) { return SCORE_MAPS[id] ? (SCORE_MAPS[id][gv(id)] || 0) : 0; }

    function fuelScore(h) {
        if (h <= 8) return (h / 8) * 30;
        if (h <= 24) return 30 + ((h - 8) / 16) * 30;
        if (h <= 72) return 60 + ((h - 24) / 48) * 25;
        return Math.min(100, 85 + ((h - 72) / 648) * 15);
    }

    function calculate() {
        var powerScore = gs('utilityFeeds')*0.20 + gs('genConfig')*0.25 + gs('upsConfig')*0.20 + gs('upsTopo')*0.10 + gs('atsConfig')*0.10 + gs('pduRedundancy')*0.10 + fuelScore(parseFloat(gv('fuelAutonomy'))||0)*0.05;
        var coolingScore = gs('coolRedundancy')*0.50 + gs('coolDistribution')*0.30 + gs('coolType')*0.20;
        var networkScore = gs('netEntry')*0.45 + gs('carrierDiv')*0.30 + gs('meetMeRoom')*0.25;
        var physicalScore = gs('fireSuppression')*0.35 + gs('accessControl')*0.35 + gs('monitoring')*0.30;
        var monitoringScore = SCORE_MAPS.monitoring[gv('monitoring')] || 0;
        var regionalScore = 50;
        if (isPremiumUser && currentMode === 'pro') regionalScore = calcRegional();

        var compositeRaw = powerScore*WEIGHTS.power + coolingScore*WEIGHTS.cooling + networkScore*WEIGHTS.network + physicalScore*WEIGHTS.physical + monitoringScore*WEIGHTS.monitoring + regionalScore*WEIGHTS.regional;

        // Floor constraints
        var uF = gv('utilityFeeds'), gC = gv('genConfig'), uC = gv('upsConfig'), pR = gv('pduRedundancy'), cR = gv('coolRedundancy'), nE = gv('netEntry');
        var canT3 = (uF==='dual_same'||uF==='dual_diverse'||uF==='onsite') && (gC==='n1'||gC==='2n'||gC==='2n1') && (uC==='n1'||uC==='2n'||uC==='2n1'||uC==='distributed');
        var canT4 = uF==='dual_diverse' && (gC==='2n'||gC==='2n1') && (uC==='2n'||uC==='2n1') && (pR==='dual'||pR==='triple') && (cR==='2n'||cR==='2n1') && (nE==='dual_diverse'||nE==='three_plus');

        if (compositeRaw >= 75 && !canT3) compositeRaw = Math.min(compositeRaw, 74);
        if (compositeRaw >= 90 && !canT4) compositeRaw = Math.min(compositeRaw, 89);
        var composite = Math.round(compositeRaw);

        var tier, grade, tierColor, tierNum, tierDesc;
        if (composite >= 90) { tier='Tier IV'; grade='A+'; tierColor='#10b981'; tierNum=4; tierDesc='Fault Tolerant'; }
        else if (composite >= 75) { tier='Tier III'; grade='A'; tierColor='#3b82f6'; tierNum=3; tierDesc='Concurrently Maintainable'; }
        else if (composite >= 60) { tier='Tier II+'; grade='B'; tierColor='#f59e0b'; tierNum=2; tierDesc='Redundant Components+'; }
        else if (composite >= 45) { tier='Tier II'; grade='C'; tierColor='#f59e0b'; tierNum=2; tierDesc='Redundant Components'; }
        else if (composite >= 25) { tier='Tier I+'; grade='D'; tierColor='#ef4444'; tierNum=1; tierDesc='Basic Capacity+'; }
        else { tier='Tier I'; grade='F'; tierColor='#ef4444'; tierNum=1; tierDesc='Basic Capacity'; }

        var tia = 'Rated '+tierNum, en = 'VK'+tierNum, bicsi = 'Class F'+tierNum;
        var scores = [powerScore, coolingScore, networkScore, physicalScore, monitoringScore];
        var avg = scores.reduce(function(a,b){return a+b;},0)/scores.length;
        var variance = scores.reduce(function(a,b){return a+Math.pow(b-avg,2);},0)/scores.length;
        var confidence = Math.max(60, Math.min(98, Math.round(95 - Math.sqrt(variance)*0.5)));

        // Update DOM
        document.getElementById('tierDisplay').textContent = tier;
        document.getElementById('tierDisplay').style.color = tierColor;
        document.getElementById('tierBadge').style.background = tierColor+'1a';
        document.getElementById('tierBadge').style.color = tierColor;
        document.getElementById('tierBadgeText').textContent = tierDesc;
        document.getElementById('scoreValue').textContent = composite;
        document.getElementById('gradeValue').textContent = grade;
        document.getElementById('gradeValue').style.color = tierColor;
        document.getElementById('confidenceValue').textContent = confidence+'%';
        document.getElementById('uptimeTier').textContent = tier.replace('+','');
        document.getElementById('tia942Rating').textContent = tia;
        document.getElementById('en50600Class').textContent = en;
        document.getElementById('bicsiClass').textContent = bicsi;

        var bars = [{id:'power',score:powerScore,color:'#f59e0b'},{id:'cooling',score:coolingScore,color:'#3b82f6'},{id:'network',score:networkScore,color:'#10b981'},{id:'physical',score:physicalScore,color:'#ef4444'},{id:'monitor',score:monitoringScore,color:'#6366f1'}];
        bars.forEach(function(b){
            document.getElementById(b.id+'Bar').style.width = Math.round(b.score)+'%';
            document.getElementById(b.id+'Val').textContent = Math.round(b.score);
        });

        buildGapAnalysis(composite, tier, tierNum, canT3, canT4);
        buildRecommendations(powerScore, coolingScore, networkScore, physicalScore, monitoringScore);
        updateCharts(powerScore, coolingScore, networkScore, physicalScore, monitoringScore, regionalScore, tierNum);

        if (isPremiumUser && currentMode === 'pro') {
            runProAnalysis(composite, powerScore, coolingScore, networkScore, physicalScore, monitoringScore, regionalScore, tierNum);
        }
    }

    function calcRegional() {
        var r = gv('regionSelect'), v = gv('verticalSelect');
        if (r === 'global') return 50;
        var s = 50, uC = gv('upsConfig'), nE = gv('netEntry'), fH = parseFloat(gv('fuelAutonomy'))||0, aC = gv('accessControl'), m = gv('monitoring'), gC = gv('genConfig');
        if (r === 'singapore') { if(uC==='2n'||uC==='2n1')s+=15; if(nE==='dual_diverse'||nE==='three_plus')s+=10; if(fH>=48)s+=10; if(aC==='mfa_mantrap')s+=5; if(m==='full_dcim')s+=10; }
        if (r === 'indonesia') { if(uC==='2n'||uC==='2n1')s+=10; if(m==='full_dcim')s+=10; if(fH>=48)s+=10; if(aC==='biometric'||aC==='mfa_mantrap')s+=10; if(gC==='2n'||gC==='2n1')s+=10; }
        if (r === 'malaysia') { if(uC==='2n'||uC==='2n1')s+=12; if(nE==='dual_diverse'||nE==='three_plus')s+=10; if(m==='full_dcim')s+=10; if(fH>=24)s+=8; if(aC==='biometric'||aC==='mfa_mantrap')s+=10; }
        if (r === 'thailand') { if(uC==='n1'||uC==='2n'||uC==='2n1')s+=10; if(m==='bms'||m==='full_dcim')s+=10; if(fH>=24)s+=10; if(aC==='biometric'||aC==='mfa_mantrap')s+=10; if(nE==='dual_diverse'||nE==='three_plus')s+=10; }
        if (r === 'japan') { if(fH>=72)s+=20; else if(fH>=48)s+=10; if(uC==='2n'||uC==='2n1')s+=10; if(aC==='biometric'||aC==='mfa_mantrap')s+=10; if(m==='full_dcim')s+=10; }
        if (r === 'south_korea') { if(uC==='2n'||uC==='2n1')s+=12; if(nE==='dual_diverse'||nE==='three_plus')s+=10; if(m==='full_dcim')s+=10; if(fH>=48)s+=8; if(aC==='biometric'||aC==='mfa_mantrap')s+=10; }
        if (r === 'australia') { if(aC==='biometric'||aC==='mfa_mantrap')s+=12; if(m==='full_dcim')s+=12; if(uC==='2n'||uC==='2n1')s+=10; if(nE==='dual_diverse'||nE==='three_plus')s+=8; if(fH>=48)s+=8; }
        if (r === 'eu') { if(nE==='dual_diverse'||nE==='three_plus')s+=15; if(m==='full_dcim')s+=10; if(uC==='2n'||uC==='2n1')s+=10; if(aC==='biometric'||aC==='mfa_mantrap')s+=10; if(fH>=72)s+=5; }
        if (r === 'uk') { if(nE==='dual_diverse'||nE==='three_plus')s+=12; if(m==='full_dcim')s+=10; if(uC==='2n'||uC==='2n1')s+=10; if(aC==='biometric'||aC==='mfa_mantrap')s+=10; if(fH>=48)s+=8; }
        if (r === 'usa') { if(aC==='biometric'||aC==='mfa_mantrap')s+=12; if(m==='full_dcim')s+=10; if(uC==='2n'||uC==='2n1')s+=10; if(nE==='dual_diverse'||nE==='three_plus')s+=10; if(fH>=48)s+=8; }
        if (r === 'india') { if(uC==='2n'||uC==='2n1')s+=15; if(nE==='dual_diverse'||nE==='three_plus')s+=10; if(m==='full_dcim')s+=10; if(fH>=48)s+=8; if(aC==='biometric'||aC==='mfa_mantrap')s+=7; }
        return Math.min(100, s);
    }

    function buildGapAnalysis(score, tier, tierNum, canT3, canT4) {
        var html = '';
        if (tierNum >= 4) {
            html = '<p style="font-size:0.82rem;color:#10b981;font-weight:600;"><i class="fas fa-check-circle" style="margin-right:4px;"></i>Your facility meets Tier IV (Fault Tolerant) requirements.</p>';
        } else {
            var nextTier = tierNum < 3 ? 'Tier III' : 'Tier IV';
            html = '<p style="font-size:0.78rem;color:var(--text-secondary);margin-bottom:8px;">Current: <strong>'+tier+'</strong> ('+score+'/100). To reach <strong>'+nextTier+'</strong>:</p><ul class="gap-list">';
            if (tierNum < 3) {
                if (gv('utilityFeeds')==='single') html += '<li>Upgrade to dual utility feeds (same or diverse substations)</li>';
                if (gv('genConfig')==='none'||gv('genConfig')==='n') html += '<li>Add N+1 or better generator configuration</li>';
                if (gv('upsConfig')==='none'||gv('upsConfig')==='n') html += '<li>Upgrade UPS to N+1 or better</li>';
                if (gv('coolRedundancy')==='n') html += '<li>Add cooling redundancy (N+1 minimum)</li>';
                if (gv('coolDistribution')==='single') html += '<li>Implement dual cooling distribution loop</li>';
                if (gv('netEntry')==='single') html += '<li>Add diverse network entry points</li>';
                if (gv('atsConfig')==='none') html += '<li>Install automatic transfer switch(es)</li>';
            } else {
                if (gv('utilityFeeds')!=='dual_diverse') html += '<li>Upgrade to dual diverse utility feeds (separate substations)</li>';
                if (gv('genConfig')!=='2n'&&gv('genConfig')!=='2n1') html += '<li>Upgrade generators to 2N or 2(N+1)</li>';
                if (gv('upsConfig')!=='2n'&&gv('upsConfig')!=='2n1') html += '<li>Upgrade UPS to 2N or 2(N+1)</li>';
                if (gv('pduRedundancy')==='single') html += '<li>Implement dual-cord (A+B) PDU distribution</li>';
                if (gv('coolRedundancy')!=='2n'&&gv('coolRedundancy')!=='2n1') html += '<li>Upgrade cooling to 2N or 2(N+1) redundancy</li>';
                if (gv('netEntry')!=='dual_diverse'&&gv('netEntry')!=='three_plus') html += '<li>Ensure diverse network entry paths</li>';
                if (gv('atsConfig')!=='sts'&&gv('atsConfig')!=='dual') html += '<li>Install STS or dual ATS for seamless transfer</li>';
            }
            html += '</ul>';
        }
        document.getElementById('gapContent').innerHTML = html;
    }

    function buildRecommendations(pwr, cool, net, phys, mon) {
        var recs = [];
        var all = [{s:pwr,n:'Power',sub:'power'},{s:cool,n:'Cooling',sub:'cooling'},{s:net,n:'Network',sub:'network'},{s:phys,n:'Physical',sub:'physical'},{s:mon,n:'Monitoring',sub:'monitoring'}];
        all.sort(function(a,b){return a.s-b.s;});
        all.forEach(function(item,i) {
            if (item.s >= 85 || i >= 3) return;
            var priority = item.s < 40 ? 'P1' : item.s < 60 ? 'P2' : 'P3';
            var pClass = priority === 'P1' ? 'rec-p1' : priority === 'P2' ? 'rec-p2' : 'rec-p3';
            var icon, color, desc;
            if (item.sub === 'power') { icon='bolt'; color='#f59e0b'; desc='Upgrade power redundancy: consider higher-tier UPS, dual ATS/STS, or generator configuration improvements.'; }
            else if (item.sub === 'cooling') { icon='snowflake'; color='#3b82f6'; desc='Improve cooling redundancy: add N+1 or 2N cooling capacity and dual distribution loops.'; }
            else if (item.sub === 'network') { icon='network-wired'; color='#10b981'; desc='Enhance network resilience: add diverse entry paths, multiple carriers, or redundant meet-me rooms.'; }
            else if (item.sub === 'physical') { icon='shield-alt'; color='#ef4444'; desc='Strengthen physical security: upgrade to biometric access, clean agent fire suppression, or VESDA.'; }
            else { icon='desktop'; color='#6366f1'; desc='Upgrade monitoring: implement full DCIM + BMS for comprehensive visibility and alerting.'; }
            recs.push('<div class="rec-card"><div class="rec-icon" style="background:'+color+'1a;color:'+color+';"><i class="fas fa-'+icon+'"></i></div><div class="rec-text"><h4>'+item.n+' (Score: '+Math.round(item.s)+')</h4><p>'+desc+'</p><span class="rec-priority '+pClass+'">['+priority+'-'+(priority==='P1'?'Critical':priority==='P2'?'High':'Medium')+']</span></div></div>');
        });
        if (recs.length === 0) recs.push('<div style="text-align:center;padding:1rem;color:#10b981;font-size:0.82rem;"><i class="fas fa-check-circle" style="margin-right:6px;"></i>All subsystems scoring well. No critical improvements needed.</div>');
        document.getElementById('recommendations').innerHTML = recs.join('');
    }

    // ═══ CHARTS ═══
    function updateCharts(pwr, cool, net, phys, mon, reg, tierNum) {
        if (typeof Chart === 'undefined') return; // Chart.js not loaded yet
        var labels = ['Power','Cooling','Network','Physical','Monitoring','Compliance'];
        var data = [pwr,cool,net,phys,mon,reg];
        var t3Bench = [75,75,75,75,75,75];
        var isDark = document.documentElement.getAttribute('data-theme') === 'dark';
        var gridColor = isDark ? 'rgba(148,163,184,0.2)' : 'rgba(0,0,0,0.08)';
        var labelColor = isDark ? '#94a3b8' : '#495057';

        if (radarChart) {
            radarChart.data.datasets[0].data = data;
            radarChart.options.scales.r.ticks.color = labelColor;
            radarChart.options.scales.r.grid.color = gridColor;
            radarChart.options.scales.r.pointLabels.color = labelColor;
            radarChart.options.plugins.legend.labels.color = labelColor;
            radarChart.update();
        } else {
            radarChart = new Chart(document.getElementById('radarChart'), {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [
                        { label: 'Your Facility', data: data, backgroundColor: 'rgba(139,92,246,0.2)', borderColor: '#8b5cf6', borderWidth: 2, pointBackgroundColor: '#8b5cf6', pointRadius: 4 },
                        { label: 'Tier III Benchmark', data: t3Bench, backgroundColor: 'rgba(59,130,246,0.08)', borderColor: '#3b82f6', borderWidth: 1.5, borderDash: [5,5], pointRadius: 0 }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: { r: { min: 0, max: 100, ticks: { stepSize: 25, color: labelColor, font: {size:10} }, grid: { color: gridColor }, pointLabels: { color: labelColor, font: {size:11,weight:'600'} } } },
                    plugins: { legend: { labels: { color: labelColor, font: {size:11} } } }
                }
            });
        }

        var barColors = ['#f59e0b','#3b82f6','#10b981','#ef4444','#6366f1'];
        if (barChart) {
            barChart.data.datasets[0].data = [pwr,cool,net,phys,mon];
            barChart.options.scales.x.grid.color = gridColor;
            barChart.options.scales.x.ticks.color = labelColor;
            barChart.options.scales.y.ticks.color = labelColor;
            barChart.update();
        } else {
            barChart = new Chart(document.getElementById('barChart'), {
                type: 'bar',
                data: {
                    labels: ['Power','Cooling','Network','Physical','Monitoring'],
                    datasets: [{ label: 'Score', data: [pwr,cool,net,phys,mon], backgroundColor: barColors, borderRadius: 4, barThickness: 28 }]
                },
                options: {
                    indexAxis: 'y', responsive: true, maintainAspectRatio: false,
                    scales: {
                        x: { min: 0, max: 100, grid: { color: gridColor }, ticks: { color: labelColor } },
                        y: { grid: { display: false }, ticks: { color: labelColor, font: {weight:'600'} } }
                    },
                    plugins: {
                        legend: { display: false },
                        annotation: { annotations: {
                            t2line: { type: 'line', xMin: 45, xMax: 45, borderColor: '#f59e0b', borderWidth: 1.5, borderDash: [4,4], label: { content: 'T-II', display: true, position: 'start', font: {size:9}, color: '#f59e0b' } },
                            t3line: { type: 'line', xMin: 75, xMax: 75, borderColor: '#3b82f6', borderWidth: 1.5, borderDash: [4,4], label: { content: 'T-III', display: true, position: 'start', font: {size:9}, color: '#3b82f6' } },
                            t4line: { type: 'line', xMin: 90, xMax: 90, borderColor: '#10b981', borderWidth: 1.5, borderDash: [4,4], label: { content: 'T-IV', display: true, position: 'start', font: {size:9}, color: '#10b981' } }
                        }}
                    }
                }
            });
        }
    }

    // ═══ MONTE CARLO WEB WORKER ═══
    var mcWorkerBlob = new Blob([
        'onmessage=function(e){var c=e.data.composite,t=e.data.targetTier,r=[];for(var i=0;i<10000;i++){var v=c*(1+(Math.random()-0.5)*0.25);r.push(Math.max(0,Math.min(100,v)))}r.sort(function(a,b){return a-b});var above=r.filter(function(x){return x>=t}).length;postMessage({results:r,p5:Math.round(r[499]),p50:Math.round(r[4999]),p95:Math.round(r[9499]),prob:Math.round(above/100)})}'
    ], {type:'application/javascript'});
    var mcWorkerUrl = URL.createObjectURL(mcWorkerBlob);
    var mcWorker = null;
    try { mcWorker = new Worker(mcWorkerUrl); } catch(e) { mcWorker = null; }

    // ═══ PRO ANALYSIS ═══
    function runProAnalysis(composite, pwr, cool, net, phys, mon, reg, tierNum) {
        var targetTier = tierNum < 3 ? 75 : 90;
        document.getElementById('regionalScoreVal').textContent = Math.round(reg);

        // Monte Carlo — use Web Worker if available, fallback to main thread
        if (mcWorker) {
            mcWorker.onmessage = function(e) {
                var d = e.data;
                document.getElementById('mcP50Val').textContent = d.p50;
                document.getElementById('tierProbVal').textContent = d.prob + '%';
                renderHistogram(d.results, d.p5, d.p50, d.p95);
            };
            mcWorker.postMessage({composite: composite, targetTier: targetTier});
        } else {
            // Fallback: run on main thread
            var results = [];
            for (var i = 0; i < 10000; i++) {
                var v = composite * (1 + (Math.random() - 0.5) * 0.25);
                results.push(Math.max(0, Math.min(100, v)));
            }
            results.sort(function(a,b){return a-b;});
            var p5 = Math.round(results[499]), p50 = Math.round(results[4999]), p95 = Math.round(results[9499]);
            var aboveTarget = results.filter(function(r){return r>=targetTier;}).length;
            document.getElementById('mcP50Val').textContent = p50;
            document.getElementById('tierProbVal').textContent = Math.round(aboveTarget / 100) + '%';
            renderHistogram(results, p5, p50, p95);
        }

        // Cost estimate
        var costItems = [];
        var totalCost = 0;
        if (gv('upsConfig') === 'n1' || gv('upsConfig') === 'n') { costItems.push({action:'Upgrade UPS to 2N', low:200, high:800, impact:'+15 pts'}); totalCost += 500; }
        if (gv('genConfig') === 'n1' || gv('genConfig') === 'n') { costItems.push({action:'Upgrade Generators to 2N', low:300, high:1200, impact:'+12 pts'}); totalCost += 750; }
        if (gv('utilityFeeds') !== 'dual_diverse') { costItems.push({action:'Add Diverse Utility Feed', low:150, high:600, impact:'+10 pts'}); totalCost += 375; }
        if (gv('coolRedundancy') !== '2n' && gv('coolRedundancy') !== '2n1') { costItems.push({action:'Upgrade Cooling to 2N', low:250, high:900, impact:'+10 pts'}); totalCost += 575; }
        if (gv('pduRedundancy') === 'single') { costItems.push({action:'Add Dual-cord PDU (A+B)', low:50, high:200, impact:'+8 pts'}); totalCost += 125; }
        if (gv('atsConfig') !== 'sts' && gv('atsConfig') !== 'dual') { costItems.push({action:'Install STS/Dual ATS', low:80, high:300, impact:'+6 pts'}); totalCost += 190; }
        if (gv('monitoring') !== 'full_dcim') { costItems.push({action:'Deploy Full DCIM + BMS', low:100, high:400, impact:'+5 pts'}); totalCost += 250; }

        var tbody = '';
        costItems.forEach(function(c) {
            tbody += '<tr style="border-bottom:1px solid var(--glass-border);"><td style="padding:8px;">'+c.action+'</td><td style="padding:8px;text-align:right;font-family:JetBrains Mono,monospace;font-size:0.75rem;">$'+c.low+'K - $'+c.high+'K</td><td style="padding:8px;text-align:right;color:#10b981;font-weight:600;">'+c.impact+'</td></tr>';
        });
        document.getElementById('costTableBody').innerHTML = tbody;
        document.getElementById('costTotal').innerHTML = '<i class="fas fa-calculator" style="color:#10b981;margin-right:6px;"></i>Estimated Total: <span style="font-family:JetBrains Mono,monospace;">$' + Math.round(totalCost*0.8) + 'K - $' + Math.round(totalCost*1.5) + 'K</span>';
        document.getElementById('upgradeCostVal').textContent = '$'+Math.round(totalCost)+'K';

        // Regional compliance content
        var region = gv('regionSelect');
        if (region !== 'global') {
            var regionNames = {singapore:'Singapore — MAS TRM',indonesia:'Indonesia — OJK/ESDM',malaysia:'Malaysia — BNM RMiT',thailand:'Thailand — BOT IT Risk',japan:'Japan — FISC Guidelines',south_korea:'South Korea — FSS',australia:'Australia — APRA CPS 234',eu:'EU — DORA',uk:'UK — FCA/PRA',usa:'USA — SOC 2/HIPAA/PCI',india:'India — RBI/SEBI'};
            var checks = getRegionalChecks(region);
            var rhtml = '<h4 style="font-size:0.82rem;font-weight:700;color:var(--text-primary);margin-bottom:8px;">'+regionNames[region]+'</h4>';
            checks.forEach(function(c) {
                var pass = c.pass;
                rhtml += '<div style="display:flex;align-items:center;gap:8px;padding:6px 0;border-bottom:1px solid var(--glass-border);font-size:0.78rem;">';
                rhtml += '<i class="fas fa-'+(pass?'check-circle':'times-circle')+'" style="color:'+(pass?'#10b981':'#ef4444')+';"></i>';
                rhtml += '<span style="color:var(--text-secondary);">'+c.label+'</span></div>';
            });
            document.getElementById('regionalComplianceContent').innerHTML = rhtml;
        }

        // Tornado (synchronous — no MC dependency)
        renderTornado(composite, pwr, cool, net, phys, mon);
    }

    function getRegionalChecks(r) {
        var uC=gv('upsConfig'),nE=gv('netEntry'),fH=parseFloat(gv('fuelAutonomy'))||0,aC=gv('accessControl'),m=gv('monitoring'),gC=gv('genConfig'),cR=gv('coolRedundancy');
        var checks = [];
        if (r==='singapore') {
            checks.push({label:'2N UPS for critical systems (MAS TRM §7.3)',pass:uC==='2n'||uC==='2n1'});
            checks.push({label:'Dual diverse fiber paths (MAS TRM §7.4)',pass:nE==='dual_diverse'||nE==='three_plus'});
            checks.push({label:'48hr+ backup fuel autonomy',pass:fH>=48});
            checks.push({label:'Multi-factor physical access',pass:aC==='mfa_mantrap'});
            checks.push({label:'Full DCIM monitoring',pass:m==='full_dcim'});
        } else if (r==='eu') {
            checks.push({label:'Dual diverse network paths (DORA Art. 11)',pass:nE==='dual_diverse'||nE==='three_plus'});
            checks.push({label:'Full DCIM + BMS monitoring (DORA Art. 12)',pass:m==='full_dcim'});
            checks.push({label:'2N power redundancy',pass:uC==='2n'||uC==='2n1'});
            checks.push({label:'Biometric or MFA access control',pass:aC==='biometric'||aC==='mfa_mantrap'});
            checks.push({label:'72hr+ fuel autonomy',pass:fH>=72});
        } else if (r==='japan') {
            checks.push({label:'72hr backup power (FISC §3.2)',pass:fH>=72});
            checks.push({label:'2N UPS configuration',pass:uC==='2n'||uC==='2n1'});
            checks.push({label:'Biometric/MFA access',pass:aC==='biometric'||aC==='mfa_mantrap'});
            checks.push({label:'Full DCIM monitoring',pass:m==='full_dcim'});
            checks.push({label:'Seismic-rated cooling (2N)',pass:cR==='2n'||cR==='2n1'});
        } else {
            checks.push({label:'2N UPS redundancy',pass:uC==='2n'||uC==='2n1'});
            checks.push({label:'Diverse network paths',pass:nE==='dual_diverse'||nE==='three_plus'});
            checks.push({label:'48hr+ fuel autonomy',pass:fH>=48});
            checks.push({label:'Biometric/MFA access',pass:aC==='biometric'||aC==='mfa_mantrap'});
            checks.push({label:'Full DCIM monitoring',pass:m==='full_dcim'});
        }
        return checks;
    }

    function renderHistogram(results, p5, p50, p95) {
        var bins = new Array(20).fill(0);
        results.forEach(function(r) { var b = Math.min(19, Math.floor(r / 5)); bins[b]++; });
        var labels = []; for (var i=0;i<20;i++) labels.push((i*5)+'-'+((i+1)*5));
        var colors = bins.map(function(_,i) { var mid = i*5+2.5; return mid>=90?'#10b981':mid>=75?'#3b82f6':mid>=45?'#f59e0b':'#ef4444'; });
        var isDark = document.documentElement.getAttribute('data-theme')==='dark';
        var annots = {
            p5: {type:'line',xMin:p5/5,xMax:p5/5,borderColor:'#ef4444',borderWidth:1.5,borderDash:[4,4],label:{content:'P5: '+p5,display:true,position:'start',font:{size:9},color:'#ef4444'}},
            p50: {type:'line',xMin:p50/5,xMax:p50/5,borderColor:'#8b5cf6',borderWidth:2,label:{content:'P50: '+p50,display:true,position:'start',font:{size:9},color:'#8b5cf6'}},
            p95: {type:'line',xMin:p95/5,xMax:p95/5,borderColor:'#10b981',borderWidth:1.5,borderDash:[4,4],label:{content:'P95: '+p95,display:true,position:'start',font:{size:9},color:'#10b981'}}
        };
        if (histogramChart) {
            histogramChart.data.datasets[0].data = bins;
            histogramChart.data.datasets[0].backgroundColor = colors;
            histogramChart.options.scales.x.ticks.color = isDark?'#94a3b8':'#495057';
            histogramChart.options.scales.y.grid.color = isDark?'rgba(148,163,184,0.15)':'rgba(0,0,0,0.06)';
            histogramChart.options.scales.y.ticks.color = isDark?'#94a3b8':'#495057';
            histogramChart.options.plugins.annotation.annotations = annots;
            histogramChart.update();
        } else {
            histogramChart = new Chart(document.getElementById('histogramChart'), {
                type: 'bar',
                data: { labels: labels, datasets: [{ data: bins, backgroundColor: colors, borderRadius: 2 }] },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: { x: { grid: {display:false}, ticks: {color:isDark?'#94a3b8':'#495057',font:{size:8},maxRotation:45} }, y: { grid: {color:isDark?'rgba(148,163,184,0.15)':'rgba(0,0,0,0.06)'}, ticks: {color:isDark?'#94a3b8':'#495057'} } },
                    plugins: { legend: {display:false}, annotation: { annotations: annots } }
                }
            });
        }
    }

    function renderTornado(composite, pwr, cool, net, phys, mon) {
        var factors = [
            {label:'UPS Config',impact:gs('upsConfig')*WEIGHTS.power*0.20},
            {label:'Generator Config',impact:gs('genConfig')*WEIGHTS.power*0.25},
            {label:'Utility Feeds',impact:gs('utilityFeeds')*WEIGHTS.power*0.20},
            {label:'Cooling Redundancy',impact:gs('coolRedundancy')*WEIGHTS.cooling*0.50},
            {label:'Network Entry',impact:gs('netEntry')*WEIGHTS.network*0.45},
            {label:'PDU Redundancy',impact:gs('pduRedundancy')*WEIGHTS.power*0.10},
            {label:'Fire Suppression',impact:gs('fireSuppression')*WEIGHTS.physical*0.35},
            {label:'Access Control',impact:gs('accessControl')*WEIGHTS.physical*0.35}
        ];
        factors.sort(function(a,b){return b.impact-a.impact;});
        var top6 = factors.slice(0,6);
        var isDark = document.documentElement.getAttribute('data-theme')==='dark';
        var newLabels = top6.map(function(f){return f.label;});
        var newData = top6.map(function(f){return Math.round(f.impact*10)/10;});
        if (tornadoChart) {
            tornadoChart.data.labels = newLabels;
            tornadoChart.data.datasets[0].data = newData;
            tornadoChart.options.scales.x.grid.color = isDark?'rgba(148,163,184,0.15)':'rgba(0,0,0,0.06)';
            tornadoChart.options.scales.x.ticks.color = isDark?'#94a3b8':'#495057';
            tornadoChart.options.scales.y.ticks.color = isDark?'#94a3b8':'#495057';
            tornadoChart.update();
        } else {
            tornadoChart = new Chart(document.getElementById('tornadoChart'), {
                type: 'bar',
                data: {
                    labels: newLabels,
                    datasets: [{label:'Weighted Impact',data:newData,backgroundColor:['#8b5cf6','#7c3aed','#6d28d9','#5b21b6','#4c1d95','#3b0764'],borderRadius:4,barThickness:22}]
                },
                options: {
                    indexAxis:'y',responsive:true,maintainAspectRatio:false,
                    scales: { x: {grid:{color:isDark?'rgba(148,163,184,0.15)':'rgba(0,0,0,0.06)'},ticks:{color:isDark?'#94a3b8':'#495057'}}, y: {grid:{display:false},ticks:{color:isDark?'#94a3b8':'#495057',font:{weight:'600',size:10}}} },
                    plugins: {legend:{display:false}}
                }
            });
        }
    }

    // ═══ PDF EXPORT (Comprehensive) ═══
    function pdfNarrative(subsystem, score, details) {
        var rating = score >= 90 ? 'excellent' : score >= 75 ? 'strong' : score >= 60 ? 'adequate' : score >= 40 ? 'below expectations' : 'critically deficient';
        var tierAlign = score >= 90 ? 'Tier IV (Fault Tolerant)' : score >= 75 ? 'Tier III (Concurrently Maintainable)' : score >= 45 ? 'Tier II (Redundant Components)' : 'Tier I (Basic Capacity)';
        return 'The ' + subsystem + ' subsystem scores ' + Math.round(score) + '/100, which is ' + rating + ' and aligns with ' + tierAlign + ' requirements. ' + details;
    }

    function pdfGaugeSVG(score, label, color) {
        var startAngle = Math.PI, endAngle = 0, cx = 160, cy = 140, r = 100;
        var zones = [
            {from:0,to:25,color:'#ef4444'},{from:25,to:45,color:'#f97316'},{from:45,to:60,color:'#f59e0b'},
            {from:60,to:75,color:'#3b82f6'},{from:75,to:90,color:'#6366f1'},{from:90,to:100,color:'#10b981'}
        ];
        var svg = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 180" style="width:100%;height:auto;">';
        // Zone arcs
        zones.forEach(function(z) {
            var a1 = Math.PI - (z.from/100)*Math.PI, a2 = Math.PI - (z.to/100)*Math.PI;
            var x1=cx+r*Math.cos(a1),y1=cy-r*Math.sin(a1),x2=cx+r*Math.cos(a2),y2=cy-r*Math.sin(a2);
            var largeArc = (z.to-z.from) > 50 ? 1 : 0;
            svg += '<path d="M'+x1+' '+y1+' A'+r+' '+r+' 0 '+largeArc+' 1 '+x2+' '+y2+'" fill="none" stroke="'+z.color+'" stroke-width="18" opacity="0.2" stroke-linecap="round"/>';
        });
        // Active arc
        var activeEnd = Math.PI - (Math.min(score,100)/100)*Math.PI;
        var ax1=cx+r*Math.cos(Math.PI),ay1=cy-r*Math.sin(Math.PI);
        var ax2=cx+r*Math.cos(activeEnd),ay2=cy-r*Math.sin(activeEnd);
        var largArc = score > 50 ? 1 : 0;
        svg += '<path d="M'+ax1+' '+ay1+' A'+r+' '+r+' 0 '+largArc+' 1 '+ax2+' '+ay2+'" fill="none" stroke="'+color+'" stroke-width="18" stroke-linecap="round"/>';
        // Needle
        var needleAngle = Math.PI - (score/100)*Math.PI;
        var nx=cx+(r-30)*Math.cos(needleAngle),ny=cy-(r-30)*Math.sin(needleAngle);
        svg += '<line x1="'+cx+'" y1="'+cy+'" x2="'+nx+'" y2="'+ny+'" stroke="#1f2937" stroke-width="2.5" stroke-linecap="round"/>';
        svg += '<circle cx="'+cx+'" cy="'+cy+'" r="5" fill="#1f2937"/>';
        // Score text
        svg += '<text x="'+cx+'" y="'+(cy-20)+'" text-anchor="middle" font-size="32" font-weight="800" fill="'+color+'">'+Math.round(score)+'</text>';
        svg += '<text x="'+cx+'" y="'+(cy+2)+'" text-anchor="middle" font-size="10" fill="#6b7280" font-weight="600">'+label+'</text>';
        // Labels at ends
        svg += '<text x="'+(cx-r-8)+'" y="'+(cy+12)+'" text-anchor="middle" font-size="8" fill="#94a3b8">0</text>';
        svg += '<text x="'+(cx+r+8)+'" y="'+(cy+12)+'" text-anchor="middle" font-size="8" fill="#94a3b8">100</text>';
        svg += '</svg>';
        return svg;
    }

    function pdfSubsystemDetailSVG(items) {
        var h = items.length * 32 + 20;
        var svg = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 360 '+h+'" style="width:100%;height:auto;">';
        items.forEach(function(item, i) {
            var y = 12 + i * 32, bw = Math.max(2, item.score/100*200);
            var statusColor = item.score >= 75 ? '#10b981' : item.score >= 45 ? '#f59e0b' : '#ef4444';
            var statusIcon = item.score >= 75 ? 'PASS' : item.score >= 45 ? 'WARN' : 'FAIL';
            svg += '<text x="0" y="'+(y+14)+'" font-size="9" fill="#374151" font-weight="600">'+item.label+'</text>';
            svg += '<rect x="100" y="'+y+'" width="200" height="18" rx="3" fill="#f3f4f6"/>';
            svg += '<rect x="100" y="'+y+'" width="'+bw+'" height="18" rx="3" fill="'+item.color+'"/>';
            svg += '<text x="'+(105+bw)+'" y="'+(y+13)+'" font-size="9" fill="#1f2937" font-weight="700">'+Math.round(item.score)+'</text>';
            svg += '<rect x="310" y="'+y+'" width="40" height="18" rx="9" fill="'+statusColor+'22"/>';
            svg += '<text x="330" y="'+(y+13)+'" text-anchor="middle" font-size="7" fill="'+statusColor+'" font-weight="700">'+statusIcon+'</text>';
        });
        return svg + '</svg>';
    }

    function pdfHistogramSVG(results) {
        var bins = new Array(20).fill(0);
        results.forEach(function(r) { bins[Math.min(19, Math.floor(r/5))]++; });
        var maxBin = Math.max.apply(null, bins) || 1;
        var svg = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 360 180" style="width:100%;height:auto;">';
        svg += '<text x="180" y="12" text-anchor="middle" font-size="10" fill="#1e3a5f" font-weight="700">Monte Carlo Distribution (10,000 iterations)</text>';
        bins.forEach(function(count, i) {
            var x = 20 + i*16, barH = (count/maxBin)*120, y = 155 - barH;
            var mid = i*5+2.5;
            var col = mid >= 90 ? '#10b981' : mid >= 75 ? '#3b82f6' : mid >= 45 ? '#f59e0b' : '#ef4444';
            svg += '<rect x="'+x+'" y="'+y+'" width="14" height="'+barH+'" rx="1" fill="'+col+'"/>';
            if (i%4===0) svg += '<text x="'+(x+7)+'" y="170" text-anchor="middle" font-size="7" fill="#6b7280">'+(i*5)+'</text>';
        });
        // P-lines
        var p5 = results[499], p50 = results[4999], p95 = results[9499];
        [{v:p5,c:'#ef4444',l:'P5'},{v:p50,c:'#8b5cf6',l:'P50'},{v:p95,c:'#10b981',l:'P95'}].forEach(function(p) {
            var px = 20 + (p.v/5)*16 + 7;
            svg += '<line x1="'+px+'" y1="20" x2="'+px+'" y2="155" stroke="'+p.c+'" stroke-width="1.5" stroke-dasharray="3,3"/>';
            svg += '<text x="'+px+'" y="178" text-anchor="middle" font-size="7" fill="'+p.c+'" font-weight="700">'+p.l+': '+Math.round(p.v)+'</text>';
        });
        return svg + '</svg>';
    }

    function pdfTornadoSVG(factors) {
        factors.sort(function(a,b){return b.impact-a.impact;});
        var top = factors.slice(0,8);
        var maxImpact = top[0] ? top[0].impact : 1;
        var h = top.length * 28 + 30;
        var svg = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 360 '+h+'" style="width:100%;height:auto;">';
        svg += '<text x="180" y="12" text-anchor="middle" font-size="10" fill="#1e3a5f" font-weight="700">Sensitivity Analysis (Weighted Impact)</text>';
        var purples = ['#8b5cf6','#7c3aed','#6d28d9','#5b21b6','#4c1d95','#3b0764','#2e1065','#1e0a3e'];
        top.forEach(function(f,i) {
            var y = 24 + i*28, bw = Math.max(4,(f.impact/maxImpact)*180);
            svg += '<text x="110" y="'+(y+15)+'" text-anchor="end" font-size="9" fill="#374151" font-weight="600">'+f.label+'</text>';
            svg += '<rect x="115" y="'+y+'" width="'+bw+'" height="20" rx="3" fill="'+(purples[i]||'#8b5cf6')+'"/>';
            svg += '<text x="'+(120+bw)+'" y="'+(y+14)+'" font-size="9" fill="#1f2937" font-weight="600">'+(Math.round(f.impact*10)/10)+'</text>';
        });
        return svg + '</svg>';
    }

    function exportPDF() {
        if (!isPremiumUser) { handlePremiumTab(); return; }
        var w = window.open('', '_blank');
        if (!w) { alert('Please allow popups for PDF export.'); return; }
        var d = new Date(), dateStr = d.toLocaleDateString('en-US',{year:'numeric',month:'long',day:'numeric'});
        var tier = document.getElementById('tierDisplay').textContent;
        var score = parseFloat(document.getElementById('scoreValue').textContent);
        var grade = document.getElementById('gradeValue').textContent;
        var conf = document.getElementById('confidenceValue').textContent;
        var tia = document.getElementById('tia942Rating').textContent;
        var en = document.getElementById('en50600Class').textContent;
        var bicsi = document.getElementById('bicsiClass').textContent;
        var pwr = parseFloat(document.getElementById('powerVal').textContent);
        var cool = parseFloat(document.getElementById('coolingVal').textContent);
        var net = parseFloat(document.getElementById('networkVal').textContent);
        var phys = parseFloat(document.getElementById('physicalVal').textContent);
        var mon = parseFloat(document.getElementById('monitorVal').textContent);
        var reg = parseFloat(document.getElementById('regionalScoreVal').textContent) || 50;
        var tierColor = document.getElementById('tierDisplay').style.color;
        var facilityType = gv('facilityType'), itLoad = gv('itLoad');
        var region = gv('regionSelect');

        // ─── NARRATIVE GENERATION ───
        var facilityDesc = {enterprise:'enterprise',colocation:'colocation',hyperscale:'hyperscale',edge:'edge',telecom:'telecommunications',financial:'financial services'}[facilityType] || facilityType;
        var tierDescs = {'Tier I':'basic site infrastructure with no redundancy','Tier I+':'basic capacity with limited redundancy improvements','Tier II':'redundant capacity components on a single distribution path','Tier II+':'enhanced redundant components approaching concurrent maintainability','Tier III':'concurrently maintainable infrastructure with multiple distribution paths','Tier IV':'fully fault-tolerant infrastructure with 2N redundancy across all systems'};
        var tierDesc = tierDescs[tier] || tier;

        // Executive narrative
        var weakest = [{n:'Power',s:pwr},{n:'Cooling',s:cool},{n:'Network',s:net},{n:'Physical Security',s:phys},{n:'Monitoring',s:mon}];
        weakest.sort(function(a,b){return a.s-b.s;});
        var strongest = [{n:'Power',s:pwr},{n:'Cooling',s:cool},{n:'Network',s:net},{n:'Physical Security',s:phys},{n:'Monitoring',s:mon}];
        strongest.sort(function(a,b){return b.s-a.s;});
        var execNarrative = 'This ' + facilityDesc + ' facility with ' + itLoad + ' kW IT load achieves a composite score of ' + Math.round(score) + '/100, corresponding to ' + tier + ' classification under the Uptime Institute Tier Standard. This means the facility provides ' + tierDesc + '. The classification maps to ' + tia + ' under TIA-942-B, ' + en + ' under EN 50600, and ' + bicsi + ' under BICSI 002. ';
        execNarrative += 'The strongest subsystem is ' + strongest[0].n + ' at ' + Math.round(strongest[0].s) + '/100, while ' + weakest[0].n + ' is the primary limiting factor at ' + Math.round(weakest[0].s) + '/100. ';
        if (score < 75) {
            execNarrative += 'To achieve Tier III (Concurrently Maintainable), the facility requires upgrades primarily in ' + weakest[0].n + ' and ' + weakest[1].n + ' subsystems. ';
        } else if (score < 90) {
            execNarrative += 'To achieve Tier IV (Fault Tolerant), all subsystems must reach 2N or 2(N+1) redundancy with zero single points of failure. ';
        } else {
            execNarrative += 'The facility meets the highest classification level with robust redundancy across all subsystems. ';
        }
        execNarrative += 'Classification confidence is ' + conf + ', reflecting the consistency of subsystem scores relative to the composite.';

        // Per-subsystem narratives
        var pwrNarr = pdfNarrative('Power', pwr,
            'The facility uses ' + gv('utilityFeeds').replace(/_/g,' ') + ' utility feed(s) with ' + gv('genConfig').toUpperCase() + ' generator configuration and ' + gv('upsConfig').toUpperCase() + ' UPS (' + gv('upsTopo').replace(/_/g,' ') + ' topology). ' +
            'Transfer switching is ' + gv('atsConfig').replace(/_/g,' ') + ' with ' + gv('pduRedundancy') + '-cord PDU distribution. ' +
            'Fuel autonomy is ' + gv('fuelAutonomy') + ' hours. ' +
            (pwr < 75 ? 'Key improvement: upgrading to 2N UPS and dual diverse utility feeds would significantly increase the power subsystem score.' : 'The power infrastructure is well-positioned for the current tier classification.')
        );
        var coolNarr = pdfNarrative('Cooling', cool,
            'Cooling uses ' + gv('coolType').replace(/_/g,' ') + ' technology with ' + gv('coolRedundancy').toUpperCase() + ' redundancy and ' + gv('coolDistribution').replace(/_/g,' ') + ' distribution. ' +
            (cool < 75 ? 'To reach Tier III, cooling redundancy should be upgraded to at least N+1 with dual loop distribution to eliminate single points of failure during maintenance.' : 'Cooling infrastructure provides adequate redundancy for concurrent maintenance operations.')
        );
        var netNarr = pdfNarrative('Network', net,
            'The facility has ' + gv('netEntry').replace(/_/g,' ') + ' network entry point(s) with ' + gv('carrierDiv').replace(/_/g,' ') + ' carrier diversity and ' + gv('meetMeRoom') + ' meet-me room configuration. ' +
            (net < 75 ? 'Diverse network entry paths from separate conduit routes and additional carrier agreements would improve resilience.' : 'Network connectivity provides the diverse paths needed for continuous service during maintenance events.')
        );
        var physNarr = pdfNarrative('Physical Security & Fire', phys,
            'Fire suppression uses ' + gv('fireSuppression').replace(/_/g,' ') + ' technology. Physical access is controlled via ' + gv('accessControl').replace(/_/g,' ') + '. ' +
            (phys < 75 ? 'Upgrading to clean agent (FM-200/Novec) or VESDA early warning with biometric access control would strengthen the physical security posture.' : 'Physical security and fire suppression meet the requirements for the current tier level.')
        );
        var monNarr = pdfNarrative('Monitoring', mon,
            'The facility employs ' + gv('monitoring').replace(/_/g,' ') + ' monitoring capability. ' +
            (mon < 75 ? 'Full DCIM integration with BMS provides the real-time visibility, trending, and alerting needed for proactive operations and higher tier classifications.' : 'Monitoring infrastructure provides the visibility needed for proactive facility management.')
        );

        // ─── SVG CHARTS ───
        // Gauge
        var svgGauge = pdfGaugeSVG(score, tier, tierColor);

        // Radar
        var cx=160,cy=140,r=110;
        var axes=['Power','Cooling','Network','Physical','Monitoring','Compliance'];
        var vals=[pwr,cool,net,phys,mon,reg];
        var svgR='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 290" style="width:100%;height:auto;">';
        svgR+='<text x="160" y="12" text-anchor="middle" font-size="10" fill="#1e3a5f" font-weight="700">Subsystem Radar vs Tier III Benchmark</text>';
        var rcy=cy+10;
        [25,50,75,100].forEach(function(lv){
            var pts=[];for(var i=0;i<6;i++){var a=Math.PI*2*i/6-Math.PI/2;pts.push((cx+r*lv/100*Math.cos(a))+','+(rcy+r*lv/100*Math.sin(a)));}
            svgR+='<polygon points="'+pts.join(' ')+'" fill="none" stroke="#e5e7eb" stroke-width="0.5" stroke-dasharray="3,3"/>';
            if(lv===75) svgR+='<polygon points="'+pts.join(' ')+'" fill="none" stroke="#3b82f6" stroke-width="0.8" stroke-dasharray="4,4" opacity="0.5"/>';
        });
        for(var i=0;i<6;i++){var a=Math.PI*2*i/6-Math.PI/2;svgR+='<line x1="'+cx+'" y1="'+rcy+'" x2="'+(cx+r*Math.cos(a))+'" y2="'+(rcy+r*Math.sin(a))+'" stroke="#e5e7eb" stroke-width="0.5"/>';var lx=cx+(r+18)*Math.cos(a),ly=rcy+(r+18)*Math.sin(a);svgR+='<text x="'+lx+'" y="'+ly+'" text-anchor="middle" dominant-baseline="middle" font-size="9" fill="#374151" font-weight="600">'+axes[i]+'</text>';}
        var dataPts=[],benchPts=[];
        for(var i=0;i<6;i++){var a=Math.PI*2*i/6-Math.PI/2;dataPts.push((cx+r*vals[i]/100*Math.cos(a))+','+(rcy+r*vals[i]/100*Math.sin(a)));benchPts.push((cx+r*0.75*Math.cos(a))+','+(rcy+r*0.75*Math.sin(a)));}
        svgR+='<polygon points="'+benchPts.join(' ')+'" fill="rgba(59,130,246,0.08)" stroke="#3b82f6" stroke-width="1" stroke-dasharray="4,4"/>';
        svgR+='<polygon points="'+dataPts.join(' ')+'" fill="rgba(139,92,246,0.15)" stroke="#8b5cf6" stroke-width="2"/>';
        for(var i=0;i<6;i++){var a=Math.PI*2*i/6-Math.PI/2;var dx=cx+r*vals[i]/100*Math.cos(a),dy=rcy+r*vals[i]/100*Math.sin(a);svgR+='<circle cx="'+dx+'" cy="'+dy+'" r="3" fill="#8b5cf6"/>';}
        svgR+='</svg>';

        // Bar chart with pass/fail
        var barItems=[
            {label:'Power (35%)',score:pwr,color:'#f59e0b'},
            {label:'Cooling (20%)',score:cool,color:'#3b82f6'},
            {label:'Network (15%)',score:net,color:'#10b981'},
            {label:'Physical (10%)',score:phys,color:'#ef4444'},
            {label:'Monitoring (5%)',score:mon,color:'#6366f1'},
            {label:'Compliance (15%)',score:reg,color:'#8b5cf6'}
        ];
        var svgDetail = pdfSubsystemDetailSVG(barItems);

        // Monte Carlo
        var mcResults = [];
        for(var i=0;i<10000;i++){mcResults.push(Math.max(0,Math.min(100,score*(1+(Math.random()-0.5)*0.25))));}
        mcResults.sort(function(a,b){return a-b;});
        var p5=Math.round(mcResults[499]),p50=Math.round(mcResults[4999]),p95=Math.round(mcResults[9499]);
        var svgHist = pdfHistogramSVG(mcResults);

        // Tornado
        var factors=[
            {label:'UPS Config',impact:gs('upsConfig')*WEIGHTS.power*0.20},
            {label:'Generator Config',impact:gs('genConfig')*WEIGHTS.power*0.25},
            {label:'Utility Feeds',impact:gs('utilityFeeds')*WEIGHTS.power*0.20},
            {label:'Cooling Redund.',impact:gs('coolRedundancy')*WEIGHTS.cooling*0.50},
            {label:'Network Entry',impact:gs('netEntry')*WEIGHTS.network*0.45},
            {label:'PDU Redundancy',impact:gs('pduRedundancy')*WEIGHTS.power*0.10},
            {label:'Fire Suppression',impact:gs('fireSuppression')*WEIGHTS.physical*0.35},
            {label:'Access Control',impact:gs('accessControl')*WEIGHTS.physical*0.35}
        ];
        var svgTornado = pdfTornadoSVG(factors);

        // ─── INPUT TABLE ───
        var inputLabels = {
            single:'Single Feed', dual_same:'Dual Feed (Same Sub)', dual_diverse:'Dual Feed (Diverse Sub)', onsite:'On-Site Gen Only',
            none:'None', n:'N', n1:'N+1', '2n':'2N', '2n1':'2(N+1)', distributed:'Distributed',
            standby:'Standby', line_interactive:'Line-Interactive', double_conversion:'Double-Conversion', rotary:'Rotary',
            single_ats:'Single ATS', dual_ats:'Dual ATS', sts:'STS',
            dual:'Dual-cord (A+B)', triple:'Triple-cord',
            n2:'N+2', n1_piping:'N+1 Piping',
            dx:'DX', chilled_water:'Chilled Water', free_cooling:'Free Cooling', rdhx:'RDHX', dlc:'DLC', immersion:'Immersion',
            dual_same_net:'Dual (Same Path)', dual_diverse_net:'Dual (Diverse Path)', three_plus:'3+ Diverse',
            two:'2 Carriers',
            redundant:'Redundant',
            wet:'Wet Sprinkler', preaction:'Pre-Action', clean:'Clean Agent', vesda_clean:'VESDA + Clean Agent',
            key:'Key Lock', card:'Card Access', biometric:'Biometric', mfa_mantrap:'MFA + Mantrap',
            basic:'Basic Sensors', bms:'BMS', full_dcim:'Full DCIM + BMS'
        };
        function fl(v){return inputLabels[v]||v.replace(/_/g,' ');}
        var inputs=[
            ['Facility Type',fl(gv('facilityType'))],['IT Load',gv('itLoad')+' kW'],
            ['Utility Feeds',fl(gv('utilityFeeds'))],['Generators',fl(gv('genConfig'))],
            ['UPS Config',fl(gv('upsConfig'))],['UPS Topology',fl(gv('upsTopo'))],
            ['Transfer Switch',fl(gv('atsConfig'))],['PDU Redundancy',fl(gv('pduRedundancy'))],
            ['Fuel Autonomy',gv('fuelAutonomy')+' hours'],['Cooling Redundancy',fl(gv('coolRedundancy'))],
            ['Cooling Distribution',fl(gv('coolDistribution'))],['Cooling Type',fl(gv('coolType'))],
            ['Network Entry',fl(gv('netEntry'))],['Carrier Diversity',fl(gv('carrierDiv'))],
            ['Meet-Me Room',fl(gv('meetMeRoom'))],['Fire Suppression',fl(gv('fireSuppression'))],
            ['Access Control',fl(gv('accessControl'))],['Monitoring',fl(gv('monitoring'))]
        ];
        var inputRows='';
        for(var i=0;i<inputs.length;i+=2){
            var bg=i%4===0?'#f8fafc':'white';
            inputRows+='<tr style="background:'+bg+'"><td style="width:22%;font-weight:600;padding:5px 8px;border:1px solid #e5e7eb;font-size:10px;color:#374151;">'+inputs[i][0]+'</td><td style="width:28%;padding:5px 8px;border:1px solid #e5e7eb;font-size:10px;">'+inputs[i][1]+'</td>';
            if(inputs[i+1]) inputRows+='<td style="width:22%;font-weight:600;padding:5px 8px;border:1px solid #e5e7eb;font-size:10px;color:#374151;">'+inputs[i+1][0]+'</td><td style="width:28%;padding:5px 8px;border:1px solid #e5e7eb;font-size:10px;">'+inputs[i+1][1]+'</td>';
            else inputRows+='<td style="border:1px solid #e5e7eb;"></td><td style="border:1px solid #e5e7eb;"></td>';
            inputRows+='</tr>';
        }

        // ─── COST TABLE ───
        var costItems=[], totalMin=0, totalMax=0;
        if(gv('upsConfig')==='n1'||gv('upsConfig')==='n'){costItems.push({a:'Upgrade UPS to 2N',lo:200,hi:800,imp:'+15 pts'});totalMin+=200;totalMax+=800;}
        if(gv('genConfig')==='n1'||gv('genConfig')==='n'){costItems.push({a:'Upgrade Generators to 2N',lo:300,hi:1200,imp:'+12 pts'});totalMin+=300;totalMax+=1200;}
        if(gv('utilityFeeds')!=='dual_diverse'){costItems.push({a:'Diverse Utility Feed',lo:150,hi:600,imp:'+10 pts'});totalMin+=150;totalMax+=600;}
        if(gv('coolRedundancy')!=='2n'&&gv('coolRedundancy')!=='2n1'){costItems.push({a:'Upgrade Cooling to 2N',lo:250,hi:900,imp:'+10 pts'});totalMin+=250;totalMax+=900;}
        if(gv('pduRedundancy')==='single'){costItems.push({a:'Dual-cord PDU (A+B)',lo:50,hi:200,imp:'+8 pts'});totalMin+=50;totalMax+=200;}
        if(gv('atsConfig')!=='sts'&&gv('atsConfig')!=='dual'){costItems.push({a:'Install STS/Dual ATS',lo:80,hi:300,imp:'+6 pts'});totalMin+=80;totalMax+=300;}
        if(gv('monitoring')!=='full_dcim'){costItems.push({a:'Full DCIM + BMS',lo:100,hi:400,imp:'+5 pts'});totalMin+=100;totalMax+=400;}
        var costTable='';
        if(costItems.length>0){
            costTable='<table><thead><tr style="background:#f8fafc;"><th style="text-align:left;padding:5px 8px;border:1px solid #e5e7eb;font-size:10px;">Upgrade Action</th><th style="text-align:right;padding:5px 8px;border:1px solid #e5e7eb;font-size:10px;">Cost Range (USD)</th><th style="text-align:center;padding:5px 8px;border:1px solid #e5e7eb;font-size:10px;">Score Impact</th></tr></thead><tbody>';
            costItems.forEach(function(c){costTable+='<tr><td style="padding:5px 8px;border:1px solid #e5e7eb;font-size:10px;">'+c.a+'</td><td style="text-align:right;padding:5px 8px;border:1px solid #e5e7eb;font-size:10px;font-family:monospace;">$'+c.lo+'K - $'+c.hi+'K</td><td style="text-align:center;padding:5px 8px;border:1px solid #e5e7eb;font-size:10px;color:#10b981;font-weight:600;">'+c.imp+'</td></tr>';});
            costTable+='</tbody></table><p style="font-size:10px;color:#374151;margin-top:6px;"><strong>Estimated Total Investment: $'+totalMin+'K - $'+totalMax+'K</strong> (based on '+itLoad+' kW facility, regional pricing may vary)</p>';
        }

        // ─── REGIONAL COMPLIANCE TABLE ───
        var regionTable = '';
        if (region !== 'global') {
            var regionNames = {singapore:'Singapore (MAS TRM)',indonesia:'Indonesia (OJK/ESDM)',malaysia:'Malaysia (BNM RMiT)',thailand:'Thailand (BOT IT Risk)',japan:'Japan (FISC)',south_korea:'South Korea (FSS)',australia:'Australia (APRA CPS 234)',eu:'EU (DORA)',uk:'UK (FCA/PRA)',usa:'USA (SOC 2/HIPAA/PCI)',india:'India (RBI/SEBI)'};
            var checks = getRegionalChecks(region);
            var passed = checks.filter(function(c){return c.pass;}).length;
            regionTable = '<h2 style="margin-top:16px;">Regional Compliance: ' + (regionNames[region]||region) + '</h2>';
            regionTable += '<p style="font-size:11px;color:#1f2937;margin-bottom:8px;">Compliance Score: <strong>' + Math.round(reg) + '/100</strong> (' + passed + '/' + checks.length + ' requirements met)</p>';
            regionTable += '<table><thead><tr style="background:#f8fafc;"><th style="text-align:left;padding:5px 8px;border:1px solid #e5e7eb;font-size:10px;">Requirement</th><th style="text-align:center;padding:5px 8px;border:1px solid #e5e7eb;font-size:10px;width:60px;">Status</th></tr></thead><tbody>';
            checks.forEach(function(c) {
                var st = c.pass ? '<span style="color:#10b981;font-weight:700;">PASS</span>' : '<span style="color:#ef4444;font-weight:700;">FAIL</span>';
                regionTable += '<tr><td style="padding:5px 8px;border:1px solid #e5e7eb;font-size:10px;">'+c.label+'</td><td style="text-align:center;padding:5px 8px;border:1px solid #e5e7eb;font-size:10px;">'+st+'</td></tr>';
            });
            regionTable += '</tbody></table>';
            regionTable += '<p style="font-size:10px;color:#374151;margin-top:6px;">' + (passed < checks.length ? 'The facility does not fully meet ' + (regionNames[region]||region) + ' requirements. Address FAIL items to achieve compliance.' : 'The facility meets all evaluated requirements for this jurisdiction.') + '</p>';
        }

        var gap = document.getElementById('gapContent').innerHTML;

        // ─── BUILD HTML ───
        var html='<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Tier Classification Report — '+dateStr+'</title>';
        html+='<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">';
        html+='<style>';
        html+='@media print{body{-webkit-print-color-adjust:exact;print-color-adjust:exact;}@page{margin:12mm;}}';
        html+='body{font-family:Inter,Arial,sans-serif;max-width:820px;margin:0 auto;padding:20px 30px;color:#1f2937;font-size:11px;line-height:1.6;}';
        html+='h1{color:#1e3a5f;font-size:20px;margin:0;} h2{color:#1e3a5f;margin:16px 0 8px;font-size:13px;border-bottom:1px solid #e5e7eb;padding-bottom:4px;} h3{margin:10px 0 4px;color:#374151;font-size:11px;}';
        html+='.hdr{display:flex;justify-content:space-between;align-items:center;border-bottom:3px solid #8b5cf6;padding-bottom:12px;margin-bottom:12px;}';
        html+='.kpi-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin:10px 0;}';
        html+='.kpi-card{background:#f8fafc;border:1px solid #e5e7eb;border-radius:6px;padding:8px;text-align:center;}';
        html+='.kpi-val{font-size:16px;font-weight:700;color:#1e3a5f;} .kpi-lbl{font-size:8px;color:#6b7280;margin-top:2px;text-transform:uppercase;letter-spacing:0.5px;}';
        html+='.chart-row{display:flex;gap:12px;margin:10px 0;} .chart-row>div{flex:1;min-width:0;}';
        html+='.narr{font-size:10.5px;color:#1f2937;line-height:1.65;padding:8px 10px;background:#f8fafc;border-left:3px solid #8b5cf6;border-radius:0 6px 6px 0;margin:6px 0;}';
        html+='.sub-narr{font-size:10px;color:#1f2937;line-height:1.6;padding:6px 10px;background:#fafbfc;border-left:3px solid VAR_COLOR;border-radius:0 4px 4px 0;margin:4px 0;}';
        html+='table{width:100%;border-collapse:collapse;margin:6px 0;}';
        html+='.section-badge{display:inline-block;padding:2px 8px;border-radius:10px;font-size:8px;font-weight:700;letter-spacing:0.5px;margin-bottom:4px;}';
        html+='.gap-list{list-style:none;padding:0;} .gap-list li{font-size:10px;padding:3px 0 3px 14px;position:relative;color:#374151;} .gap-list li::before{content:"";position:absolute;left:0;top:8px;width:5px;height:5px;border-radius:50%;background:#8b5cf6;}';
        html+='</style></head><body>';

        // Header
        html+='<div class="hdr"><div><h1>Tier Classification Report</h1><p style="color:#6b7280;margin:2px 0 0;font-size:10px;">Generated '+dateStr+' | Pro Analysis | Facility: '+fl(facilityType)+' '+itLoad+' kW</p></div><div style="text-align:right;"><span style="font-size:10px;font-weight:700;letter-spacing:1.5px;color:#8b5cf6;">RESISTANCEZERO</span><br><span style="font-size:8px;color:#94a3b8;">Tier Advisor v1.0</span></div></div>';

        // Executive Score: Gauge + KPIs side by side
        html+='<div class="chart-row"><div style="flex:0 0 280px;">'+svgGauge+'</div><div style="display:flex;flex-direction:column;justify-content:center;">';
        html+='<div style="text-align:center;padding:12px;background:'+tierColor+'12;border:1px solid '+tierColor+'33;border-radius:8px;margin-bottom:8px;"><span style="font-size:24px;font-weight:800;color:'+tierColor+';">'+tier+'</span><br><span style="font-size:9px;color:#6b7280;">Grade '+grade+' | Confidence '+conf+'</span></div>';
        html+='<div class="kpi-grid"><div class="kpi-card"><div class="kpi-val" style="font-size:13px;">'+tier.replace('+','')+'</div><div class="kpi-lbl">Uptime Inst.</div></div><div class="kpi-card"><div class="kpi-val" style="font-size:13px;">'+tia+'</div><div class="kpi-lbl">TIA-942-B</div></div><div class="kpi-card"><div class="kpi-val" style="font-size:13px;">'+en+'</div><div class="kpi-lbl">EN 50600</div></div><div class="kpi-card"><div class="kpi-val" style="font-size:13px;">'+bicsi+'</div><div class="kpi-lbl">BICSI 002</div></div></div>';
        html+='</div></div>';

        // Executive Narrative
        html+='<h2>Executive Summary</h2>';
        html+='<div class="narr">'+execNarrative+'</div>';

        // Input Parameters
        html+='<h2>Facility Configuration</h2>';
        html+='<table>'+inputRows+'</table>';

        // Subsystem Analysis: Radar + Detail bars
        html+='<h2>Subsystem Analysis</h2>';
        html+='<div class="chart-row"><div>'+svgR+'</div><div>'+svgDetail+'</div></div>';

        // Per-subsystem narratives
        html+='<h2>Subsystem Assessment</h2>';
        html+='<h3><span class="section-badge" style="background:#f59e0b22;color:#f59e0b;">POWER — '+Math.round(pwr)+'/100</span></h3>';
        html+='<div class="sub-narr" style="border-left-color:#f59e0b;">'+pwrNarr+'</div>';
        html+='<h3><span class="section-badge" style="background:#3b82f622;color:#3b82f6;">COOLING — '+Math.round(cool)+'/100</span></h3>';
        html+='<div class="sub-narr" style="border-left-color:#3b82f6;">'+coolNarr+'</div>';
        html+='<h3><span class="section-badge" style="background:#10b98122;color:#10b981;">NETWORK — '+Math.round(net)+'/100</span></h3>';
        html+='<div class="sub-narr" style="border-left-color:#10b981;">'+netNarr+'</div>';
        html+='<h3><span class="section-badge" style="background:#ef444422;color:#ef4444;">PHYSICAL SECURITY — '+Math.round(phys)+'/100</span></h3>';
        html+='<div class="sub-narr" style="border-left-color:#ef4444;">'+physNarr+'</div>';
        html+='<h3><span class="section-badge" style="background:#6366f122;color:#6366f1;">MONITORING — '+Math.round(mon)+'/100</span></h3>';
        html+='<div class="sub-narr" style="border-left-color:#6366f1;">'+monNarr+'</div>';

        // Gap Analysis
        html+='<h2>Tier Gap Analysis</h2>';
        html+='<div style="padding:8px;background:#f8fafc;border-radius:6px;border:1px solid #e5e7eb;">'+gap+'</div>';

        // Monte Carlo + Tornado side by side
        html+='<h2>Statistical Analysis</h2>';
        html+='<div class="chart-row"><div>'+svgHist+'</div><div>'+svgTornado+'</div></div>';
        html+='<div class="narr" style="border-left-color:#7c3aed;">Monte Carlo simulation (10,000 iterations, &plusmn;12.5% input variation) yields P5='+p5+', P50='+p50+', P95='+p95+'. ';
        var targetScore = score < 75 ? 75 : 90;
        var targetName = score < 75 ? 'Tier III' : 'Tier IV';
        var aboveTarget = mcResults.filter(function(r){return r>=targetScore;}).length;
        html+='Probability of achieving '+targetName+' under real-world conditions: <strong>'+Math.round(aboveTarget/100)+'%</strong>. ';
        factors.sort(function(a,b){return b.impact-a.impact;});
        html+='The most influential parameters are '+factors[0].label+' (impact: '+Math.round(factors[0].impact*10)/10+') and '+factors[1].label+' (impact: '+Math.round(factors[1].impact*10)/10+'), indicating these should be prioritized for maximum tier improvement.</div>';

        // Cost-to-Upgrade
        if(costItems.length>0){
            html+='<h2>Cost-to-Upgrade Estimate</h2>';
            html+=costTable;
        }

        // Regional Compliance
        html+=regionTable;

        // Methodology
        html+='<h2>Methodology</h2>';
        html+='<p style="font-size:9px;color:#6b7280;line-height:1.6;">This report uses a 6-dimension weighted scorecard model: Power (35%), Cooling (20%), Network (15%), Physical Security (10%), Monitoring (5%), and Regional Compliance (15%). Each subsystem is scored 0-100 based on component-level inputs mapped to industry benchmarks. Floor constraints prevent over-classification: Tier III requires dual utility feeds and N+1 redundancy in power; Tier IV requires 2N/2(N+1) across all critical systems. Monte Carlo analysis runs 10,000 iterations with &plusmn;12.5% uniform random variation on the composite score. Framework mappings (Uptime Institute, TIA-942-B, EN 50600, BICSI 002) are based on published standard requirements as of 2026. Regional compliance overlays reference jurisdiction-specific regulatory frameworks including MAS TRM, EU DORA, FISC, APRA CPS 234, and others. Cost estimates are indicative ranges based on industry averages and should be validated with local contractors.</p>';

        // Footer
        html+='<div style="text-align:center;margin-top:20px;padding-top:12px;border-top:2px solid #8b5cf6;font-size:8px;color:#94a3b8;">resistancezero.com &middot; Generated '+dateStr+' &middot; All calculations performed client-side &middot; Tier Advisor v1.0 &middot; &copy; 2026 Bagus Dwi Permana</div>';
        html+='</body></html>';
        w.document.write(html);
        w.document.close();
        setTimeout(function(){w.print();},600);
    }

    // ═══ AUTH SYSTEM ═══
    (function checkPremiumSession() {
        var session = localStorage.getItem('rz_premium_session');
        if (session) {
            try {
                var data = JSON.parse(session);
                var expiresMs = typeof data.expires === 'string' ? new Date(data.expires).getTime() : data.expires;
                if (expiresMs > Date.now()) { isPremiumUser = true; userTier = data.tier || 'pro'; activatePremiumUI(); return; }
                else { localStorage.removeItem('rz_premium_session'); }
            } catch(e) { localStorage.removeItem('rz_premium_session'); }
        }
        var dcmocAuth = localStorage.getItem('dcmoc-auth');
        if (dcmocAuth) {
            try { var data = JSON.parse(dcmocAuth); if (data.state && data.state.user) { isPremiumUser = true; userTier = 'pro'; activatePremiumUI(); return; } } catch(e) {}
        }
    })();

    window.addEventListener('rz-auth-change', function(e) {
        if (e.detail && e.detail.action === 'login') { isPremiumUser = true; userTier = e.detail.tier || 'pro'; activatePremiumUI(); }
        else if (e.detail && e.detail.action === 'logout') { isPremiumUser = false; userTier = 'free'; setMode('free'); updateNavbarAuthUI(); }
    });

    function handlePremiumTab() {
        if (isPremiumUser) { setMode('pro'); return; }
        var modal = document.getElementById('loginModal');
        modal.style.display = 'flex';
        document.getElementById('loginError').style.display = 'none';
        document.getElementById('loginEmail').value = '';
        document.getElementById('loginPassword').value = '';
        setTimeout(function(){ document.getElementById('loginEmail').focus(); }, 100);
    }
    function closeLoginModal() { document.getElementById('loginModal').style.display = 'none'; }
    document.getElementById('loginModal').addEventListener('click', function(e) { if (e.target === this) closeLoginModal(); });
    document.addEventListener('keydown', function(e) { if (e.key === 'Escape') closeLoginModal(); });

    function attemptLogin() {
        var email = document.getElementById('loginEmail').value.trim();
        var password = document.getElementById('loginPassword').value;
        var errorEl = document.getElementById('loginError');
        if (!email || !password) { errorEl.textContent = 'Please enter email and password'; errorEl.style.display = 'block'; return; }
        var validUsers = [{ email: 'demo@resistancezero.com', password: 'demo2026', tier: 'pro' }];
        var match = validUsers.find(function(u) { return u.email === email && u.password === password; });
        if (match) {
            var expDate = new Date(); expDate.setDate(expDate.getDate() + 30);
            localStorage.setItem('rz_premium_session', JSON.stringify({ email: match.email, tier: match.tier, role: (match.email === 'admin@resistancezero.com' || match.email === 'bagus@resistancezero.com') ? 'root' : 'pro', expires: expDate.toISOString() }));
            isPremiumUser = true; userTier = match.tier;
            closeLoginModal(); activatePremiumUI();
            window.dispatchEvent(new CustomEvent('rz-auth-change', { detail: { email: match.email, tier: match.tier, role: (match.email === 'admin@resistancezero.com' || match.email === 'bagus@resistancezero.com') ? 'root' : 'pro', action: 'login' } }));
        } else {
            errorEl.textContent = 'Invalid email or password'; errorEl.style.display = 'block';
            document.getElementById('loginPassword').value = ''; document.getElementById('loginPassword').focus();
        }
    }

    function activatePremiumUI() {
        var btnPro = document.getElementById('btnProMode');
        if (btnPro) btnPro.classList.remove('locked-hint');
        setMode('pro');
        updateNavbarAuthUI();
    }

    function logoutPremium() {
        if (!confirm('Logout from your account?')) return;
        isPremiumUser = false; userTier = 'free';
        localStorage.removeItem('rz_premium_session');
        var btnPro = document.getElementById('btnProMode');
        if (btnPro) btnPro.classList.add('locked-hint');
        setMode('free');
        updateNavbarAuthUI();
        window.dispatchEvent(new CustomEvent('rz-auth-change', { detail: { action: 'logout' } }));
    }

    function updateNavbarAuthUI() {
        var loginBtn = document.getElementById('navLoginBtn'), userBtn = document.getElementById('navUserBtn');
        if (isPremiumUser) {
            var session = JSON.parse(localStorage.getItem('rz_premium_session') || '{}');
            var email = session.email || 'PRO User';
            loginBtn.style.display = 'none'; userBtn.style.display = 'flex';
            document.getElementById('navUserAvatar').textContent = email.charAt(0).toUpperCase();
            document.getElementById('navUserEmail').textContent = email;
            document.getElementById('navDdEmail').textContent = email;
        } else { loginBtn.style.display = 'flex'; userBtn.style.display = 'none'; }
    }

    function toggleUserDropdown() {
        var dd = document.getElementById('navUserDropdown');
        var btn = document.getElementById('navUserBtn');
        dd.classList.toggle('show'); btn.classList.toggle('open');
    }
    document.addEventListener('click', function(e) {
        if (!e.target.closest('.nav-auth-wrap')) {
            document.getElementById('navUserDropdown').classList.remove('show');
            document.getElementById('navUserBtn').classList.remove('open');
        }
    });

    // ═══ MODE TOGGLE ═══
    function setMode(mode) {
        if (mode === 'pro' && !isPremiumUser) { handlePremiumTab(); return; }
        currentMode = mode;
        var btnFree = document.getElementById('btnFreeMode'), btnPro = document.getElementById('btnProMode'), indicator = document.getElementById('modeIndicator');
        var pdf = document.getElementById('btnExportPDF');
        if (mode === 'free') {
            btnFree.classList.add('active'); btnPro.classList.remove('active');
            indicator.className = 'pue-mode-indicator free-active'; indicator.textContent = 'FREE MODE';
            pdf.classList.add('disabled');
            document.querySelectorAll('.pro-section').forEach(function(el) { el.classList.add('locked'); });
        } else {
            btnPro.classList.add('active'); btnFree.classList.remove('active');
            indicator.className = 'pue-mode-indicator pro-active'; indicator.textContent = 'PRO MODE';
            pdf.classList.remove('disabled');
            document.querySelectorAll('.pro-section').forEach(function(el) { el.classList.remove('locked'); });
        }
        calculate();
    }

    // ═══ THEME TOGGLE ═══
    function toggleTheme() {
        var html = document.documentElement;
        var current = html.getAttribute('data-theme');
        var next = current === 'dark' ? 'light' : 'dark';
        html.setAttribute('data-theme', next);
        localStorage.setItem('rz-theme', next);
        var icon = document.querySelector('#themeToggle i');
        icon.className = next === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        calculate(); // refresh charts with new colors
    }
    (function loadTheme() {
        var saved = localStorage.getItem('rz-theme');
        if (saved === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
            var icon = document.querySelector('#themeToggle i');
            if (icon) icon.className = 'fas fa-sun';
        }
    })();

    // ═══ PRESETS & RESET ═══
    function setPreset(load, type) {
        document.getElementById('itLoad').value = load;
        document.getElementById('facilityType').value = type;
        document.querySelectorAll('.preset-btn').forEach(function(b){ b.classList.remove('active'); });
        event.target.classList.add('active');
        calculate();
    }

    function resetDefaults() {
        document.getElementById('facilityType').value = 'colocation';
        document.getElementById('itLoad').value = 2000;
        document.getElementById('numFloors').value = '2';
        document.getElementById('buildingAge').value = 5;
        document.getElementById('utilityFeeds').value = 'dual_same';
        document.getElementById('genConfig').value = 'n1';
        document.getElementById('upsConfig').value = 'n1';
        document.getElementById('upsTopo').value = 'double_conversion';
        document.getElementById('atsConfig').value = 'single';
        document.getElementById('pduRedundancy').value = 'dual';
        document.getElementById('fuelAutonomy').value = 48;
        document.getElementById('coolRedundancy').value = 'n1';
        document.getElementById('coolDistribution').value = 'dual';
        document.getElementById('coolType').value = 'chilled_water';
        document.getElementById('netEntry').value = 'dual_diverse';
        document.getElementById('carrierDiv').value = 'two';
        document.getElementById('meetMeRoom').value = 'single';
        document.getElementById('fireSuppression').value = 'preaction';
        document.getElementById('accessControl').value = 'card';
        document.getElementById('monitoring').value = 'bms';
        document.getElementById('regionSelect').value = 'global';
        document.getElementById('verticalSelect').value = 'general';
        document.querySelectorAll('.preset-btn').forEach(function(b,i){ b.classList.toggle('active', i===1); });
        calculate();
    }

    // ═══ MOBILE MENU ═══
    function toggleMobileMenu() { document.getElementById('navLinks').classList.toggle('open'); }

    // ═══ DEBOUNCED CALCULATE ═══
    var calcTimer;
    function debouncedCalculate() {
        clearTimeout(calcTimer);
        calcTimer = setTimeout(calculate, 150);
    }

    // ═══ INIT ═══
    var chartJsReady = typeof Chart !== 'undefined';
    function onChartsReady() {
        chartJsReady = true;
        calculate();
    }
    document.addEventListener('DOMContentLoaded', function() {
        updateNavbarAuthUI();
        if (chartJsReady) calculate();
    });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js" onload="if(typeof onChartsReady==='function')onChartsReady();" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation" defer></script>

    <!-- Cookie Consent Banner -->
    <div class="cookie-banner hidden" id="cookieBanner">
        <p>We use cookies for analytics to improve your experience. <a href="privacy.html">Learn more</a></p>
        <div class="cookie-actions">
            <button class="cookie-accept" id="cookieAccept">Accept</button>
            <button class="cookie-decline" id="cookieDecline">Decline</button>
        </div>
    </div>
    <script>
    (function(){
        var cb = document.getElementById('cookieBanner');
        var consent = localStorage.getItem('rz_cookie_consent');
        if (!consent && cb) cb.classList.remove('hidden');
        var acceptBtn = document.getElementById('cookieAccept');
        var declineBtn = document.getElementById('cookieDecline');
        if (acceptBtn) acceptBtn.addEventListener('click', function(){ localStorage.setItem('rz_cookie_consent','accepted'); cb.classList.add('hidden'); });
        if (declineBtn) declineBtn.addEventListener('click', function(){ localStorage.setItem('rz_cookie_consent','declined'); cb.classList.add('hidden'); window['ga-disable-G-GED7FX8RTV'] = true; });
    })();
    </script>
</body>
</html>
