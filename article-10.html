<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GED7FX8RTV"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-GED7FX8RTV');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- SEO Meta Tags -->
    <title>Water Stress and AI Data Centers | Southeast Asia | ResistanceZero</title>
    <meta name="description" content="58% of data centers in water-stressed regions. Interactive water stress calculator, WUE benchmarks, and sustainable cooling strategies for SEA.">
    <meta name="keywords" content="Water Stress, Data Center Water Consumption, AI Cooling, Southeast Asia Data Centers, Indonesia, Jakarta, Bekasi, Johor Bahru, Hanoi, Da Nang, Vietnam, Malaysia, WRI Aqueduct, Liquid Cooling, Sustainability, Emerging Markets">
    <meta name="author" content="Bagus Dwi Permana">
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#0066cc">
    <link rel="canonical" href="https://resistancezero.com/article-10.html">

    <link rel="alternate" hreflang="en" href="https://resistancezero.com/article-10.html">

    <!-- Resource Hints -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="https://www.googletagmanager.com">
    <!-- Open Graph Meta Tags -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://resistancezero.com/article-10.html">
    <meta property="og:title" content="Water Stress and AI Data Centers: The Hidden Crisis in Southeast Asia">
    <meta property="og:description" content="Comprehensive SEA data center water stress analysis. Jakarta crisis, emerging opportunities in Johor Bahru/Hanoi/Da Nang, regional comparison, and mitigation strategies.">
    <meta property="og:image" content="https://resistancezero.com/assets/article-10-cover.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="Water Stress and AI Data Centers - Southeast Asia Analysis">
    <meta property="og:locale" content="en_US">
    <meta property="og:site_name" content="Bagus Dwi Permana Portfolio">
    <meta property="article:author" content="Bagus Dwi Permana">
    <meta property="article:published_time" content="2026-02-09T00:00:00Z">
    <meta property="article:modified_time" content="2026-02-17T00:00:00Z">
    <meta property="article:section" content="Data Center Sustainability">
    <meta property="article:tag" content="Water Stress">
    <meta property="article:tag" content="AI Data Centers">
    <meta property="article:tag" content="Sustainability">

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@BagusDPermana">
    <meta name="twitter:creator" content="@BagusDPermana">
    <meta name="twitter:title" content="Water Stress and AI Data Centers: The Hidden Crisis in Southeast Asia">
    <meta name="twitter:description" content="SEA data center water stress: Jakarta crisis vs emerging opportunities. Interactive analysis with regional comparison.">
    <meta name="twitter:image" content="https://resistancezero.com/assets/article-10-cover.jpg">
    <meta name="twitter:image:alt" content="Water Stress and AI Data Centers in Southeast Asia">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="assets/Favicon.png">
    <link rel="apple-touch-icon" href="assets/Favicon.png">
    <link rel="stylesheet" href="styles.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preload" as="image" href="assets/article-10-cover.jpg">

    <!-- Structured Data - TechnicalArticle -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "TechnicalArticle",
        "headline": "Water Stress and AI Data Centers: The Hidden Crisis in Southeast Asia",
        "description": "Analysis of water stress impact on AI data centers with focus on Indonesia and Southeast Asia, including interactive visualizations and consumption calculator.",
        "author": {
            "@type": "Person",
            "name": "Bagus Dwi Permana",
            "jobTitle": "Engineering Operations Manager",
            "url": "https://resistancezero.com/"
        },
        "datePublished": "2026-02-08",
        "dateModified": "2026-02-08",
        "publisher": {
            "@type": "Person",
            "name": "Bagus Dwi Permana"
        },
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://resistancezero.com/article-10.html"
        },
        "articleSection": "Data Center Sustainability",
        "keywords": ["Water Stress", "AI Data Centers", "Southeast Asia", "Indonesia", "Sustainability"]
    }
    </script>

    <!-- Structured Data - BreadcrumbList -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
            {
                "@type": "ListItem",
                "position": 1,
                "name": "Home",
                "item": "https://resistancezero.com/"
            },
            {
                "@type": "ListItem",
                "position": 2,
                "name": "Articles",
                "item": "https://resistancezero.com/articles.html"
            },
            {
                "@type": "ListItem",
                "position": 3,
                "name": "Water Stress and AI Data Centers"
            }
        ]
    }
    </script>

    <!-- Structured Data - FAQPage -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
            {
                "@type": "Question",
                "name": "How much water does an AI data center consume?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "A typical 100MW AI data center using evaporative cooling consumes approximately 1.5-2.5 million liters of water per day, equivalent to the daily water needs of 10,000-15,000 households. GPU-intensive AI workloads generate 2-3x more heat than traditional compute, significantly increasing cooling water demand. Water consumption varies by climate zone and cooling technology."
                }
            },
            {
                "@type": "Question",
                "name": "Why is Jakarta's water stress a problem for data center development?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Jakarta and surrounding areas like Bekasi face severe water stress due to groundwater over-extraction, rapid urbanization, and climate change. With a Water Stress Index exceeding 80% in dry seasons, adding water-intensive data center cooling creates direct competition with residential and agricultural water needs. This is compounded by land subsidence from groundwater extraction."
                }
            },
            {
                "@type": "Question",
                "name": "What are water-efficient cooling alternatives for tropical data centers?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Water-efficient alternatives include: closed-loop dry cooling systems (zero water consumption but 15-20% less efficient), hybrid adiabatic cooling (reduces water use by 60-80%), direct liquid cooling for high-density racks, and seawater cooling for coastal facilities. Singapore's floating data center concept and waste heat recovery systems represent emerging solutions for water-stressed regions."
                }
            }
        ]
    }
    </script>

    <style>
        :root {
            --water-high: #dc2626;
            --water-medium: #f59e0b;
            --water-low: #6b7280;
            --water-safe: #10b981;
        }

        .article-hero {
            background: linear-gradient(135deg, #0b1220 0%, #164e63 50%, #0e7490 100%);
            padding: 7rem 2rem 3.5rem;
            color: #fff;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .article-hero::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M50 0 L60 40 L100 50 L60 60 L50 100 L40 60 L0 50 L40 40 Z' fill='%2306b6d4' fill-opacity='0.08'/%3E%3C/svg%3E");
            opacity: 0.3;
            z-index: 0;
        }
        .article-hero::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(circle at 20% 80%, rgba(6, 182, 212, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(220, 38, 38, 0.2) 0%, transparent 50%);
            z-index: 0;
        }
        .article-hero > * { position: relative; z-index: 1; }
        .article-hero .container { max-width: 1000px; }
        .article-category {
            display: inline-block;
            background: rgba(6, 182, 212, 0.2);
            color: #67e8f9;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .article-title {
            font-size: clamp(1.6rem, 3.2vw, 2.35rem);
            font-weight: 800;
            margin-bottom: 1.25rem;
            line-height: 1.25;
            color: #fff;
            letter-spacing: -0.01em;
        }
        .article-subtitle {
            font-size: clamp(0.95rem, 1.6vw, 1.15rem);
            color: #94a3b8;
            max-width: 800px;
            margin: 0 auto 2rem;
            line-height: 1.7;
        }
        .article-meta {
            display: flex;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
            color: #94a3b8;
            font-size: 0.9375rem;
        }
        .article-meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: #94a3b8;
            margin-bottom: 2rem;
            font-weight: 500;
            transition: color 0.3s ease;
        }
        .back-link:hover { color: #fff; }

        /* Paper Actions */
        .paper-actions {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
            flex-wrap: wrap;
        }
        .paper-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }
        .paper-btn.primary {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
        }
        .paper-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.4);
        }
        .paper-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .paper-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        .paper-btn svg {
            width: 18px;
            height: 18px;
        }

        /* Article Content */
        .article-content {
            padding: 4rem 2rem;
            background: #fff;
        }
        .article-content .container { max-width: 900px; }
        .article-body {
            font-size: 0.95rem;
            line-height: 1.7;
            color: #374151;
        }
        .article-body p { margin-bottom: 1rem; }
        .article-body h2 {
            font-size: 1.4rem;
            color: #1e3a5f;
            margin: 3rem 0 1.25rem;
            padding-bottom: 0.75rem;
            border-bottom: 3px solid #f59e0b;
        }
        .article-body h3 {
            font-size: 1.1rem;
            color: #334155;
            margin: 2rem 0 0.75rem;
        }
        .article-body blockquote {
            background: linear-gradient(135deg, #ecfeff 0%, #cffafe 100%);
            border-left: 4px solid #06b6d4;
            padding: 1.5rem 2rem;
            margin: 2rem 0;
            border-radius: 0 12px 12px 0;
            font-style: italic;
            color: #164e63;
        }
        .article-body ul, .article-body ol {
            margin: 1rem 0;
            padding-left: 1.5rem;
        }
        .article-body li { margin-bottom: 0.5rem; }
        .highlight-box {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-radius: 12px;
            padding: 1.5rem 2rem;
            margin: 2rem 0;
            border-left: 4px solid #f59e0b;
        }
        .highlight-box p {
            margin: 0;
            color: #92400e;
            font-weight: 500;
        }
        .warning-box {
            background: linear-gradient(135deg, #fef2f2 0%, #fecaca 100%);
            border-radius: 12px;
            padding: 1.5rem 2rem;
            margin: 2rem 0;
            border-left: 4px solid #dc2626;
        }
        .warning-box p {
            margin: 0;
            color: #991b1b;
            font-weight: 500;
        }
        .result-box {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border-radius: 12px;
            padding: 1.5rem 2rem;
            margin: 2rem 0;
            border-left: 4px solid #10b981;
        }
        .result-box h4 {
            color: #065f46;
            margin-bottom: 0.75rem;
        }
        .result-box p {
            margin: 0.5rem 0;
            color: #047857;
        }

        /* Water Stress Map Visualization */
        .water-stress-viz {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            border-radius: 16px;
            padding: 2rem;
            margin: 2rem 0;
            overflow: hidden;
        }
        .viz-title {
            text-align: center;
            color: #fff;
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        .viz-subtitle {
            text-align: center;
            color: #94a3b8;
            font-size: 0.875rem;
            margin-bottom: 1.5rem;
        }
        .map-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 12px;
            padding: 1.5rem;
        }
        .sea-map {
            width: 100%;
            height: auto;
        }
        .legend-container {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #94a3b8;
            font-size: 0.85rem;
        }
        .legend-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
        }
        .legend-dot.high { background: var(--water-high); }
        .legend-dot.medium { background: var(--water-medium); }
        .legend-dot.low { background: var(--water-low); }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }
        .stat-card {
            background: rgba(30, 58, 95, 0.3);
            border-radius: 10px;
            padding: 1.25rem;
            text-align: center;
            border: 1px solid rgba(96, 165, 250, 0.15);
        }
        .stat-label {
            color: #94a3b8;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
        }
        .stat-value {
            font-size: 1.75rem;
            font-weight: 800;
        }
        .stat-value.high { color: var(--water-high); }
        .stat-value.medium { color: var(--water-medium); }
        .stat-value.low { color: var(--water-low); }
        .stat-value.primary { color: #06b6d4; }

        /* Water Calculator */
        .water-calculator {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            border-radius: 16px;
            padding: 2rem;
            margin: 2rem 0;
        }
        .calc-title {
            text-align: center;
            color: #fff;
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        .calc-subtitle {
            text-align: center;
            color: #94a3b8;
            font-size: 0.875rem;
            margin-bottom: 1.5rem;
        }
        .calc-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .control-card {
            background: rgba(30, 58, 95, 0.3);
            border-radius: 12px;
            padding: 1.25rem;
            border: 1px solid rgba(96, 165, 250, 0.2);
        }
        .control-label {
            color: #e5e7eb;
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .control-icon {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }
        .control-icon.power { background: rgba(245, 158, 11, 0.2); color: #fcd34d; }
        .control-icon.pue { background: rgba(16, 185, 129, 0.2); color: #6ee7b7; }
        .control-icon.wue { background: rgba(6, 182, 212, 0.2); color: #67e8f9; }
        .control-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: rgba(148, 163, 184, 0.2);
            outline: none;
            -webkit-appearance: none;
            margin-bottom: 0.75rem;
        }
        .control-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #06b6d4;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        .control-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }
        .control-value {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
        }
        .control-value span { color: #94a3b8; }
        .control-value .current-val {
            color: #fff;
            font-weight: 700;
            background: rgba(6, 182, 212, 0.2);
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
        }
        .results-display {
            background: rgba(6, 182, 212, 0.1);
            border: 1px solid rgba(6, 182, 212, 0.3);
            border-radius: 12px;
            padding: 1.5rem;
        }
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 1rem;
        }
        .result-item {
            text-align: center;
            padding: 1rem;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 8px;
        }
        .result-label {
            color: #94a3b8;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.25rem;
        }
        .result-value {
            font-size: 1.5rem;
            font-weight: 800;
            color: #06b6d4;
        }
        .result-unit {
            font-size: 0.75rem;
            color: #64748b;
        }
        .impact-indicator {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }
        .impact-indicator.critical {
            background: rgba(220, 38, 38, 0.2);
            border: 1px solid rgba(220, 38, 38, 0.4);
        }
        .impact-indicator.warning {
            background: rgba(245, 158, 11, 0.2);
            border: 1px solid rgba(245, 158, 11, 0.4);
        }
        .impact-indicator.good {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid rgba(16, 185, 129, 0.4);
        }
        .impact-text {
            font-size: 0.9rem;
            font-weight: 600;
        }
        .impact-indicator.critical .impact-text { color: #fca5a5; }
        .impact-indicator.warning .impact-text { color: #fcd34d; }
        .impact-indicator.good .impact-text { color: #6ee7b7; }

        /* Data Table */
        .data-table-container {
            overflow-x: auto;
            margin: 2rem 0;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }
        .data-table th, .data-table td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        .data-table th {
            background: #f8fafc;
            font-weight: 600;
            color: #374151;
        }
        .data-table tr:hover {
            background: #f8fafc;
        }
        .stress-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .stress-badge.high {
            background: rgba(220, 38, 38, 0.15);
            color: #dc2626;
        }
        .stress-badge.medium {
            background: rgba(245, 158, 11, 0.15);
            color: #d97706;
        }
        .stress-badge.low {
            background: rgba(34, 197, 94, 0.15);
            color: #16a34a;
        }
        .table-note {
            font-size: 0.8rem;
            color: #64748b;
            margin-bottom: 0.75rem;
            font-style: italic;
        }
        .table-note-row {
            background: #f8fafc !important;
            font-size: 0.8rem;
            color: #64748b;
            text-align: center;
            padding: 1rem !important;
        }
        .table-source {
            font-size: 0.75rem;
            color: #94a3b8;
            margin-top: 0.5rem;
        }

        /* Inline Citations */
        .cite {
            color: #0891b2;
            font-size: 0.75em;
            vertical-align: super;
            font-weight: 600;
            text-decoration: none;
            cursor: pointer;
            padding: 0 2px;
            transition: color 0.2s ease;
        }
        .cite:hover {
            color: #0e7490;
            text-decoration: underline;
        }

        /* References Section */
        .references {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            padding: 2rem;
            border-radius: 12px;
            margin-top: 3rem;
            border-left: 4px solid #0891b2;
        }
        .references h3 {
            font-size: 1.1rem;
            margin-bottom: 1.25rem;
            color: #164e63;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .references h3::before {
            content: 'ðŸ“š';
        }
        .references ol {
            font-size: 0.875rem;
            color: #475569;
            padding-left: 1.5rem;
            line-height: 1.5;
        }
        .references ol li {
            margin-bottom: 0.5rem;
            padding-left: 0.5rem;
        }
        .references ol li::marker {
            color: #0891b2;
            font-weight: 600;
        }
        .references a {
            color: #0891b2;
            text-decoration: none;
            word-break: break-word;
        }
        .references a:hover {
            text-decoration: underline;
        }
        .ref-source {
            color: #64748b;
            font-size: 0.8rem;
            display: block;
            margin-top: 0.15rem;
            line-height: 1.4;
        }

        /* Article Navigation */
        .article-nav {
            display: flex;
            justify-content: space-between;
            padding: 2rem 0;
            border-top: 1px solid #e5e7eb;
            margin-top: 3rem;
        }
        .article-nav a {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #0e7490;
            font-weight: 600;
            transition: color 0.3s ease;
        }
        .article-nav a:hover { color: #164e63; }

        /* ===== Pro Enhancement Mode â€” Water Stress (.ws-) ===== */

        /* Evidence Block */
        .ws-evidence-block {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            border-radius: 16px; padding: 2rem; margin: 2rem 0;
            border: 1px solid rgba(8,145,178,0.25);
        }
        .ws-evidence-title {
            color: #67e8f9; font-size: 0.75rem; font-weight: 700; text-transform: uppercase;
            letter-spacing: 1.5px; margin-bottom: 1.25rem; display: flex; align-items: center; gap: 8px;
        }
        .ws-evidence-title i { font-size: 0.85rem; }
        .ws-evidence-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 1rem;
        }
        .ws-evidence-card {
            background: rgba(255,255,255,0.05); border-radius: 12px; padding: 1.25rem 1rem; text-align: center;
            border: 1px solid rgba(255,255,255,0.08); transition: transform 0.2s, border-color 0.2s;
        }
        .ws-evidence-card:hover { transform: translateY(-2px); border-color: rgba(8,145,178,0.3); }
        .ws-evidence-value { font-size: 1.6rem; font-weight: 800; color: #06b6d4; line-height: 1.2; }
        .ws-evidence-label { font-size: 0.75rem; color: #94a3b8; margin-top: 0.3rem; line-height: 1.3; }
        .ws-evidence-sub { font-size: 0.65rem; color: #64748b; margin-top: 0.2rem; }
        .ws-evidence-source { font-size: 0.65rem; color: #475569; margin-top: 1rem; text-align: right; }

        /* CTA Block */
        .ws-cta-block {
            background: linear-gradient(135deg, rgba(8,145,178,0.12), rgba(6,182,212,0.04));
            border: 1.5px solid rgba(8,145,178,0.3); border-radius: 14px;
            padding: 1.5rem 2rem; margin: 1.5rem 0; text-align: center;
        }
        .ws-cta-headline {
            font-size: 1.05rem; font-weight: 700; color: #0891b2; margin: 0 0 0.5rem;
        }
        .ws-cta-sub {
            font-size: 0.85rem; color: #64748b; margin: 0 0 1rem;
        }
        .ws-cta-btn {
            display: inline-block; background: linear-gradient(135deg, #06b6d4, #0891b2); color: #fff;
            padding: 0.65rem 2rem; border-radius: 10px; font-weight: 700; font-size: 0.85rem;
            text-decoration: none; transition: opacity 0.3s, transform 0.2s; border: none; cursor: pointer;
        }
        .ws-cta-btn:hover { opacity: 0.9; transform: translateY(-1px); }

        /* Toolbar */
        .ws-toolbar-row {
            display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;
            gap: 0.75rem; margin-bottom: 1.5rem;
        }
        .ws-mode-bar {
            display: flex; align-items: center; gap: 0.5rem;
        }
        .ws-mode-bar .mode-toggle {
            display: flex; background: rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden;
            border: 1px solid rgba(255,255,255,0.15);
        }
        .ws-mode-bar .mode-btn {
            padding: 8px 18px; font-size: 0.8rem; font-weight: 600; cursor: pointer; border: none;
            background: transparent; color: #94a3b8; transition: all 0.3s; font-family: inherit;
        }
        .ws-mode-bar .mode-btn.active { background: linear-gradient(135deg, #0891b2, #0e7490); color: #fff; box-shadow: 0 4px 15px rgba(8,145,178,0.4), 0 0 20px rgba(8,145,178,0.2); border-color: #0891b2; font-weight: 700; }
        .ws-toolbar-actions { display: flex; gap: 0.5rem; align-items: center; }
        .ws-toolbar-actions button {
            padding: 8px 16px; border-radius: 8px; border: none; font-size: 0.78rem;
            font-weight: 600; cursor: pointer; font-family: inherit; display: flex; align-items: center; gap: 6px;
        }
        .ws-btn-reset { background: rgba(255,255,255,0.1); color: #94a3b8; }
        .ws-btn-reset:hover { background: rgba(255,255,255,0.15); }
        .ws-btn-pdf { background: linear-gradient(135deg, rgba(8,145,178,0.2), rgba(6,182,212,0.1)); color: #67e8f9; border: 1px solid rgba(6,182,212,0.3) !important; }
        .ws-btn-pdf:hover { background: linear-gradient(135deg, rgba(8,145,178,0.3), rgba(6,182,212,0.15)); }

        /* Tooltips */
        .tooltip-trigger {
            display: inline-flex; align-items: center; justify-content: center;
            width: 18px; height: 18px; border-radius: 50%; background: rgba(8,145,178,0.25);
            color: #67e8f9; font-size: 0.65rem; font-weight: 700; cursor: help;
            position: relative; margin-left: 4px; flex-shrink: 0;
        }
        .tooltip-content {
            display: none; position: absolute; bottom: calc(100% + 10px); left: 50%; transform: translateX(-50%);
            background: #1e293b; border: 1px solid rgba(6,182,212,0.3); border-radius: 10px;
            padding: 1rem; width: 260px; z-index: 100; box-shadow: 0 8px 30px rgba(0,0,0,0.4);
            pointer-events: none;
        }
        .tooltip-content::after {
            content: ''; position: absolute; top: 100%; left: 50%; transform: translateX(-50%);
            border: 6px solid transparent; border-top-color: rgba(6,182,212,0.3);
        }
        .tooltip-trigger:hover .tooltip-content,
        .tooltip-trigger:focus .tooltip-content { display: block; }
        .tooltip-title { font-size: 0.8rem; font-weight: 700; color: #06b6d4; margin-bottom: 0.4rem; }
        .tooltip-desc { font-size: 0.72rem; color: #94a3b8; line-height: 1.5; margin-bottom: 0.4rem; }
        .tooltip-formula { font-size: 0.68rem; color: #67e8f9; font-family: 'JetBrains Mono', monospace; background: rgba(6,182,212,0.1); padding: 4px 8px; border-radius: 4px; }

        /* Pro Panels */
        .ws-pro-panel {
            position: relative; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08);
            border-radius: 14px; padding: 1.5rem; margin-top: 1.5rem;
        }
        .ws-pro-panel.gated { filter: blur(3px); pointer-events: none; user-select: none; }
        .ws-pro-panel .panel-title {
            font-size: 0.95rem; font-weight: 700; color: #e2e8f0; margin-bottom: 0.75rem;
            display: flex; align-items: center; gap: 8px;
        }
        .ws-pro-panel .panel-title i { color: #06b6d4; }
        .ws-gate-overlay {
            position: absolute; inset: 0; background: rgba(15,23,42,0.85); border-radius: 14px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            gap: 0.5rem; z-index: 5; cursor: pointer;
        }
        .ws-gate-overlay i { font-size: 1.5rem; color: #06b6d4; }
        .ws-gate-overlay span { font-size: 0.8rem; color: #94a3b8; font-weight: 600; }
        .ws-kpi-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 0.75rem;
        }
        .ws-kpi-card {
            background: rgba(255,255,255,0.05); border-radius: 10px; padding: 1rem; text-align: center;
            border: 1px solid rgba(255,255,255,0.06);
        }
        .ws-kpi-value { font-size: 1.4rem; font-weight: 800; color: #06b6d4; }
        .ws-kpi-label { font-size: 0.72rem; color: #94a3b8; margin-top: 0.25rem; }
        .ws-kpi-sublabel { font-size: 0.6rem; color: #475569; margin-top: 0.15rem; }

        /* Panel Chart Container */
        .ws-chart-container { margin-top: 1rem; background: rgba(0,0,0,0.2); border-radius: 10px; padding: 1rem; }
        .ws-chart-container canvas { width: 100% !important; max-height: 220px; }

        /* Region Selector */
        .ws-region-select {
            background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15);
            border-radius: 8px; padding: 0.5rem 1rem; color: #e2e8f0; font-size: 0.85rem;
            font-family: inherit; cursor: pointer; width: 100%; max-width: 300px; margin-bottom: 1rem;
        }
        .ws-region-select:focus { outline: none; border-color: #0891b2; }
        .ws-region-select option { background: #1e293b; color: #e2e8f0; }

        /* Narrative */
        .ws-narrative {
            background: rgba(8,145,178,0.08); border: 1px solid rgba(8,145,178,0.2);
            border-radius: 12px; padding: 1.25rem; margin-top: 1rem;
        }
        .ws-narrative h4 { color: #06b6d4; font-size: 0.85rem; margin: 0 0 0.75rem; display: flex; align-items: center; gap: 6px; }
        .ws-narrative p { color: #94a3b8; font-size: 0.78rem; line-height: 1.7; margin: 0 0 0.75rem; }
        .ws-narrative p:last-child { margin-bottom: 0; }
        .ws-narrative p strong { color: #67e8f9; }
        .ws-narrative .ws-narr-section { margin-bottom: 0.5rem; }
        .ws-narrative .ws-narr-section:last-child { margin-bottom: 0; }

        /* Login Modal */
        .ws-login-overlay {
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.75); backdrop-filter: blur(8px);
            z-index: 9999; align-items: center; justify-content: center;
        }
        .ws-login-overlay.active { display: flex; }
        .ws-login-box {
            background: #0f172a; border-radius: 16px; padding: 2.5rem; max-width: 380px; width: 90%;
            border: 1px solid rgba(8,145,178,0.3); box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            position: relative;
        }
        .ws-login-box h3 { color: #e2e8f0; margin: 0 0 0.5rem; font-size: 1.1rem; }
        .ws-login-box p { color: #64748b; font-size: 0.8rem; margin: 0 0 1.5rem; }
        .ws-login-box input {
            width: 100%; padding: 0.75rem 1rem; background: #1e293b; border: 1px solid #334155;
            border-radius: 8px; color: #e2e8f0; font-size: 0.9rem; margin-bottom: 0.75rem; box-sizing: border-box;
        }
        .ws-login-box input:focus { outline: none; border-color: #0891b2; }
        .ws-login-box button.login-submit {
            width: 100%; padding: 0.75rem; background: linear-gradient(135deg, #0891b2, #06b6d4); color: #fff;
            border: none; border-radius: 8px; font-weight: 700; cursor: pointer; font-size: 0.9rem; margin-top: 0.5rem;
        }
        .ws-login-box .demo-hint { font-size: 0.7rem; color: #64748b; margin-top: 0.75rem; text-align: center; }
        .ws-login-box .demo-hint code { background: rgba(8,145,178,0.15); padding: 1px 5px; border-radius: 3px; color: #67e8f9; }
        .ws-login-close {
            position: absolute; top: 12px; right: 16px; background: none; border: none;
            color: #64748b; font-size: 1.2rem; cursor: pointer;
        }
        .ws-login-error { color: #f87171; font-size: 0.75rem; margin-top: 0.5rem; text-align: center; display: none; }
        [data-theme="light"] .ws-login-box { background: #ffffff; border-color: #e2e8f0; }
        [data-theme="light"] .ws-login-box h3 { color: #1e293b; }
        [data-theme="light"] .ws-login-box p { color: #64748b; }
        [data-theme="light"] .ws-login-box input { background: #f1f5f9; border-color: #e2e8f0; color: #1e293b; }

        /* Privacy Badge + Benchmark Meta */
        .ws-privacy-badge { display: flex; align-items: center; justify-content: center; gap: 6px; font-size: 0.72rem; color: #64748b; margin-top: 0.5rem; padding: 6px 0; }
        .ws-privacy-badge i { color: #10b981; font-size: 0.8rem; }
        .ws-benchmark-meta { display: flex; flex-wrap: wrap; gap: 0.75rem; margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid rgba(255,255,255,0.08); }
        .ws-benchmark-tag { font-size: 0.65rem; color: #64748b; background: rgba(255,255,255,0.04); padding: 3px 8px; border-radius: 4px; display: flex; align-items: center; gap: 4px; }
        .ws-benchmark-tag i { font-size: 0.6rem; }

        /* Score bars for risk matrix */
        .ws-score-bar-bg { width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; margin-top: 0.4rem; overflow: hidden; }
        .ws-score-bar-fill { height: 100%; border-radius: 3px; transition: width 0.5s ease; }
        .ws-score-bar-fill.risk-high { background: linear-gradient(90deg, #dc2626, #ef4444); }
        .ws-score-bar-fill.risk-med { background: linear-gradient(90deg, #f59e0b, #fbbf24); }
        .ws-score-bar-fill.risk-low { background: linear-gradient(90deg, #10b981, #34d399); }

        /* Dark mode overrides */
        [data-theme="dark"] .ws-evidence-block,
        [data-theme="dark"] .ws-pro-panel { background: linear-gradient(135deg, #0c1220 0%, #162032 100%); }
        [data-theme="dark"] .ws-cta-block { background: linear-gradient(135deg, rgba(8,145,178,0.15), rgba(6,182,212,0.06)); }
        [data-theme="dark"] .ws-login-box { background: #0f172a; }
        [data-theme="dark"] .article-content { background: #0f172a; }
        [data-theme="dark"] .article-body { background: #0f172a; color: #e2e8f0; }
        [data-theme="dark"] .article-body h2 { color: #93c5fd; }
        [data-theme="dark"] .article-body h3 { color: #cbd5e1; }
        [data-theme="dark"] .article-body p { color: #cbd5e1; }
        [data-theme="dark"] .article-body blockquote { background: rgba(30,58,95,0.3); border-color: rgba(96,165,250,0.4); color: #cbd5e1; }
        [data-theme="dark"] .article-body .info-box,
        [data-theme="dark"] .article-body .key-insight { background: rgba(15,23,42,0.8); border-color: rgba(255,255,255,0.1); color: #cbd5e1; }
        [data-theme="dark"] .article-body table th { background: #0f172a; color: #e2e8f0; }
        [data-theme="dark"] .article-body table td { color: #cbd5e1; border-color: rgba(255,255,255,0.1); }
        [data-theme="dark"] .article-body ul li,
        [data-theme="dark"] .article-body ol li { color: #cbd5e1; }
        [data-theme="dark"] .article-body a { color: #60a5fa; }
        [data-theme="dark"] .article-body strong { color: #f1f5f9; }
        [data-theme="dark"] .highlight-box{background:rgba(245,158,11,0.1);border-color:rgba(245,158,11,0.4);}
        [data-theme="dark"] .highlight-box p{color:#fbbf24;}
        [data-theme="dark"] .warning-box{background:rgba(239,68,68,0.1);border-color:rgba(239,68,68,0.4);}
        [data-theme="dark"] .warning-box p{color:#fca5a5;}
        [data-theme="dark"] .result-box{background:rgba(16,185,129,0.1);border-color:rgba(16,185,129,0.4);}
        [data-theme="dark"] .result-box h4{color:#34d399;}
        [data-theme="dark"] .result-box p{color:#6ee7b7;}
        [data-theme="dark"] .article-body blockquote{background:rgba(6,182,212,0.08);border-color:rgba(6,182,212,0.4);color:#cbd5e1;}
        [data-theme="dark"] .references{background:rgba(15,23,42,0.8);border-color:rgba(6,182,212,0.4);}
        [data-theme="dark"] .references h3{color:#93c5fd;}
        [data-theme="dark"] .references ol{color:#94a3b8;}
        [data-theme="dark"] .data-table th{background:#0f172a;color:#e2e8f0;border-color:#334155;}
        [data-theme="dark"] .data-table td{color:#cbd5e1;border-color:rgba(255,255,255,0.1);}
        [data-theme="dark"] .data-table tr:hover{background:rgba(30,41,59,0.5);}

        @media (max-width: 768px) {
            .article-hero { padding: 6rem 1rem 3rem; }
            .article-meta { flex-direction: column; gap: 1rem; }
            .article-content { padding: 3rem 1rem; }
            .article-body { font-size: 0.88rem; }
            .water-stress-viz, .water-calculator { padding: 1rem; }
            .calc-controls { grid-template-columns: 1fr; }
            .paper-actions { flex-direction: column; }
            .paper-btn { width: 100%; justify-content: center; }
            .ws-evidence-grid { grid-template-columns: repeat(2, 1fr); }
            .ws-kpi-grid { grid-template-columns: repeat(2, 1fr); }
            .ws-toolbar-row { flex-direction: column; align-items: stretch; }
            .ws-toolbar-actions { justify-content: center; }
            .ws-cta-block { padding: 1.25rem 1rem; }
            .tooltip-content { width: 220px; left: auto; right: -10px; transform: none; }
            .tooltip-content::after { left: auto; right: 20px; transform: none; }
        }

        @media print {
            .navbar, .share-buttons, .paper-actions, .water-calculator { display: none !important; }
            .article-hero { background: #164e63 !important; padding: 2rem !important; }
            .article-content { padding: 1rem !important; }
        }
    
        /* Result Card Tooltip System */
        .res-tip {
            display: inline-flex; align-items: center; justify-content: center;
            width: 14px; height: 14px;
            background: rgba(245,158,11,0.15); border: 1px solid rgba(245,158,11,0.3);
            border-radius: 50%; font-size: 0.6rem; font-weight: 700;
            color: #fbbf24; margin-left: 4px; cursor: help;
            position: relative; flex-shrink: 0; vertical-align: middle;
            line-height: 1;
        }
        .res-tip:hover { background: rgba(245,158,11,0.3); transform: scale(1.15); }
        .res-tip .res-tip-body {
            visibility: hidden; opacity: 0;
            position: absolute; bottom: calc(100% + 8px); left: 50%;
            transform: translateX(-50%);
            background: #1e293b; color: #e2e8f0;
            padding: 0.7rem 0.9rem; border-radius: 8px;
            font-size: 0.72rem; font-weight: 400; line-height: 1.5;
            width: 260px; z-index: 100;
            box-shadow: 0 8px 25px rgba(0,0,0,0.5);
            border: 1px solid rgba(245,158,11,0.2);
            transition: opacity 0.2s ease; pointer-events: none;
            text-transform: none; letter-spacing: normal;
        }
        .res-tip:hover .res-tip-body { visibility: visible; opacity: 1; }
        .res-tip-body .rtt { font-weight: 700; color: #fbbf24; margin-bottom: 3px; font-size: 0.75rem; }
        .res-tip-body .rtd { color: #cbd5e1; }
        .res-tip-body .rtf {
            font-family: 'JetBrains Mono', monospace; font-size: 0.68rem;
            background: rgba(0,0,0,0.3); padding: 3px 7px; border-radius: 4px;
            color: #67e8f9; margin-top: 4px; display: block;
        }
</style>
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0" defer></script>
</head>
<body>
    <!-- Reading Progress Bar -->
    <div class="scroll-progress" id="scrollProgress"></div>

    <!-- Search Overlay & Modal -->
    <div class="search-overlay" id="searchOverlay"></div>
    <div class="search-modal" id="searchModal">
        <div class="search-input-wrap">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
            <input type="text" class="search-input" id="searchInput" placeholder="Search articles, calculators, tools..." autocomplete="off">
            <kbd class="search-kbd">ESC</kbd>
        </div>
        <div class="search-chips" id="searchChips">
            <button class="search-chip active" data-filter="all">All</button>
            <button class="search-chip" data-filter="articles">Articles</button>
            <button class="search-chip" data-filter="calculators">Calculators</button>
            <button class="search-chip" data-filter="tools">Tools</button>
        </div>
        <div class="search-results" id="searchResults">
            <div class="search-empty">Type to search across all content</div>
        </div>
        <div class="search-footer">
            <span><kbd class="search-kbd">&uarr;&darr;</kbd> Navigate</span>
            <span><kbd class="search-kbd">Enter</kbd> Open</span>
        </div>
    </div>
    <div class="search-preview" id="searchPreview"></div>

    <!-- TOC Sidebar (desktop, wide screens) -->
    <nav class="toc-sidebar" id="tocSidebar" aria-label="Table of Contents">
        <div class="toc-sidebar-label">On this page</div>
        <ul class="toc-sidebar-list" id="tocSidebarList"></ul>
    </nav>

    <!-- TOC Mobile Toggle -->
    <button class="toc-mobile-toggle" id="tocMobileToggle" aria-label="Table of contents">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
    </button>
    <div class="toc-mobile-backdrop" id="tocMobileBackdrop"></div>
    <div class="toc-mobile-drawer" id="tocMobileDrawer">
        <div class="toc-drawer-header">
            <span class="toc-drawer-title">Table of Contents</span>
            <button class="toc-drawer-close" id="tocDrawerClose" aria-label="Close">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
            </button>
        </div>
        <ul class="toc-mobile-list" id="tocMobileList"></ul>
    </div>


    <a href="#main-content" class="skip-link">Skip to main content</a>
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">
                <img loading="lazy" src="assets/profile-photo.jpg" alt="Bagus Dwi Permana" class="nav-avatar">
            </a>
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link">Home</a></li>
                <li class="nav-dropdown">
                    <a href="datacenter-solutions.html" class="nav-link">
                        DC Solutions
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="datacenter-solutions.html" style="color: #06b6d4; font-weight: 600;">DC Solutions Hub</a></li>
                        <li style="border-bottom: 1px solid rgba(255,255,255,0.1); margin: 4px 0;"></li>
                        <li><a href="datahallAI.html" style="color: #8b5cf6;">DC AI/HPC</a></li>
                        <li><a href="dc-conventional.html">DC Conventional</a></li>
                        <li style="border-bottom: 1px solid rgba(255,255,255,0.1); margin: 4px 0;"></li>
                        <li><a href="capex-calculator.html" style="color: #f59e0b;">CAPEX Calculator</a></li>
                        <li><a href="opex-calculator.html" style="color: #10b981;">OPEX Calculator</a></li>
                        <li style="border-bottom: 1px solid rgba(255,255,255,0.1); margin: 4px 0;"></li>
                        <li><a href="dcmoc/" style="color: #ef4444; font-weight: 600;">DC MOC</a></li>
                    </ul>
                </li>
                <li><a href="index.html#metrics" class="nav-link">Results</a></li>
                <li><a href="index.html#case-studies" class="nav-link">Case Studies</a></li>
                <li><a href="articles.html" class="nav-link">Articles</a></li>
                <li><a href="index.html#faq" class="nav-link">FAQ</a></li>
                <li><a href="index.html#contact" class="nav-link">Contact</a></li>
            </ul>
                        <button class="nav-search-btn" id="navSearchBtn" aria-label="Search" title="Search (Ctrl+K)">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
            </button>
            <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode" title="Toggle dark/light mode">
                <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
                <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="5"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="23"></line>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                    <line x1="1" y1="12" x2="3" y2="12"></line>
                    <line x1="21" y1="12" x2="23" y2="12"></line>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                </svg>
            </button>
            <button class="hamburger" aria-label="Open navigation menu" aria-expanded="false">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </button>
        </div>
    </nav>

    <main id="main-content">
    <section class="article-hero">
        <div class="container">
            <a href="articles.html" class="back-link">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
                Back to Articles
            </a>
            <span class="article-category">Data Center Sustainability</span>
            <h1 class="article-title">Water Stress and AI Data Centers: The Hidden Crisis in Southeast Asia</h1>
            <p class="article-subtitle">58% of global data centers operate in water-stressed regions.<a href="#ref1" class="cite">[1]</a> As AI drives unprecedented growth, Jakarta and Bekasi face a critical challenge: how to build 500MW+ of capacity in areas already struggling with water scarcity.</p>
            <div class="article-meta">
                <span class="article-meta-item">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 6v6l4 2"/>
                    </svg>
                    20 min read
                </span>
                <span class="article-meta-item">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                        <line x1="16" y1="2" x2="16" y2="6"/>
                        <line x1="8" y1="2" x2="8" y2="6"/>
                        <line x1="3" y1="10" x2="21" y2="10"/>
                    </svg>
                    February 8, 2026
                </span>
                <span class="article-meta-item">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                        <circle cx="12" cy="7" r="4"/>
                    </svg>
                    Bagus Dwi Permana
                </span>
            </div>
            <div class="paper-actions">
                <button class="paper-btn primary" onclick="exportToPDF()">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    Download PDF
                </button>
                <button class="paper-btn secondary" onclick="window.print()">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 6 2 18 2 18 9"/>
                        <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/>
                        <rect x="6" y="14" width="12" height="8"/>
                    </svg>
                    Print Article
                </button>
            </div>
        </div>
    </section>
    <!-- Series Navigation -->
    <div class="series-nav" style="margin-top: 1rem;">
        <div class="series-badge">
            <span class="series-badge-icon">10</span>
            Engineering Journal &mdash; Article 10 of 18
        </div>
        <span class="series-title"></span>
        <div class="series-links">
            <a href="article-9.html" class="series-link"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>Prev</a>
            <a href="article-11.html" class="series-link">Next<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg></a>
        </div>
    </div>


    <!-- Evidence Block -->
    <div class="ws-evidence-block" style="max-width: 900px; margin: -2rem auto 0; position: relative; z-index: 2;">
        <div class="ws-evidence-title"><i class="fas fa-chart-line"></i> Key Evidence at a Glance</div>
        <div class="ws-evidence-grid">
            <div class="ws-evidence-card">
                <div class="ws-evidence-value">58%</div>
                <div class="ws-evidence-label">Global DCs in Water-Stressed Regions</div>
                <div class="ws-evidence-sub">WRI Aqueduct 2024</div>
            </div>
            <div class="ws-evidence-card">
                <div class="ws-evidence-value">131M</div>
                <div class="ws-evidence-label">Liters/Year for 10MW Facility</div>
                <div class="ws-evidence-sub">WUE 1.5 baseline</div>
            </div>
            <div class="ws-evidence-card">
                <div class="ws-evidence-value">500MW+</div>
                <div class="ws-evidence-label">Jakarta/Bekasi Planned Capacity</div>
                <div class="ws-evidence-sub">Digital Edge + others</div>
            </div>
            <div class="ws-evidence-card">
                <div class="ws-evidence-value">43%</div>
                <div class="ws-evidence-label">Bekasi Built-Up Area Increase</div>
                <div class="ws-evidence-sub">1990-2018</div>
            </div>
            <div class="ws-evidence-card">
                <div class="ws-evidence-value">$4.5B</div>
                <div class="ws-evidence-label">Digital Edge Campus Investment</div>
                <div class="ws-evidence-sub">Indonesia's largest</div>
            </div>
        </div>
        <div class="ws-evidence-source">Sources: S&P Global 2024, WRI Aqueduct 4.0, Data Center Knowledge 2024, IJG 2020</div>
    </div>

    <article class="article-content">
        <div class="container">
            <div class="article-body">
                <section class="toc-section">
                    <div class="toc-container">
                        <h2 class="toc-title">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="8" y1="6" x2="21" y2="6"></line>
                                <line x1="8" y1="12" x2="21" y2="12"></line>
                                <line x1="8" y1="18" x2="21" y2="18"></line>
                                <line x1="3" y1="6" x2="3.01" y2="6"></line>
                                <line x1="3" y1="12" x2="3.01" y2="12"></line>
                                <line x1="3" y1="18" x2="3.01" y2="18"></line>
                            </svg>
                            Table of Contents
                        </h2>
                        <div class="toc-grid">
                            <a href="#section-1" class="toc-item">
                                <div class="toc-item-number">SECTION 1</div>
                                <div class="toc-item-title">Abstract</div>
                            </a>
                            <a href="#section-2" class="toc-item">
                                <div class="toc-item-number">SECTION 2</div>
                                <div class="toc-item-title">The Global Water Stress Landscape</div>
                            </a>
                            <a href="#section-3" class="toc-item">
                                <div class="toc-item-number">SECTION 3</div>
                                <div class="toc-item-title">AI's Insatiable Thirst: The Cooling Challenge</div>
                            </a>
                            <a href="#section-4" class="toc-item toc-calculator">
                                <div class="toc-item-number">SECTION 4 <span class="toc-calc-badge"><i class="fas fa-calculator" style="font-size:0.5rem;"></i> Interactive</span></div>
                                <div class="toc-item-title">Interactive: Data Center Water Consumption Calculator</div>
                            </a>
                            <a href="#section-5" class="toc-item">
                                <div class="toc-item-number">SECTION 5</div>
                                <div class="toc-item-title">Southeast Asia Focus: Jakarta and Bekasi</div>
                            </a>
                            <a href="#section-6" class="toc-item">
                                <div class="toc-item-number">SECTION 6</div>
                                <div class="toc-item-title">Regional Innovations: Learning from Neighbors</div>
                            </a>
                            <a href="#section-7" class="toc-item">
                                <div class="toc-item-number">SECTION 7</div>
                                <div class="toc-item-title">Emerging Opportunities: Underutilized Markets in Southeast Asia</div>
                            </a>
                            <a href="#section-8" class="toc-item">
                                <div class="toc-item-number">SECTION 8</div>
                                <div class="toc-item-title">Mitigation Strategies for Water-Stressed Operations</div>
                            </a>
                            <a href="#section-9" class="toc-item">
                                <div class="toc-item-number">SECTION 9</div>
                                <div class="toc-item-title">Conclusion: Reframing the SEA Data Center Narrative</div>
                            </a>
                        </div>
                    </div>
                </section>

                <h2 id="section-1">1. Abstract</h2>
                <p>The rapid expansion of AI infrastructure has created an unprecedented demand for data center capacity. However, this growth comes with a hidden cost that few are discussing openly: water consumption. A typical data center uses millions of gallons of water annually for cooling, and the majority of these facilities are located in regions already facing water stress.</p>

                <p>This article examines the water stress crisis facing data centers globally, with a specific focus on Southeast Asia and Indonesia. As Jakarta and Bekasi emerge as major data center hubsâ€”with Digital Edge's US$4.5 billion, 500MW campus leading the charge<a href="#ref4" class="cite">[4]</a>â€”understanding and mitigating water consumption becomes a critical operational imperative.</p>

                <blockquote>
                    "The proportion of data centers in water-stressed regions is at a record high. The problem has been years in the making, and some tech companies are trying to find ways to address it without creating other environmental drawbacks."
                </blockquote>

                <!-- Data Validity Disclaimer -->
                <div class="warning-box" style="background: linear-gradient(135deg, #fefce8 0%, #fef9c3 100%); border-left-color: #ca8a04;">
                    <p style="color: #854d0e; margin-bottom: 0.5rem;"><strong>Data Validity Notice</strong></p>
                    <p style="color: #a16207; font-size: 0.9rem; margin: 0;">The water stress indices, market data, and infrastructure statistics presented in this article are based on publicly available data as of <strong>February 2026</strong>. Water stress conditions are dynamic and influenced by seasonal variations, climate change, urban development, and policy changes. Readers are advised to consult the latest WRI Aqueduct data and local environmental agencies for current assessments before making infrastructure investment decisions.</p>
                </div>

                <!-- CTA Block -->
                <div class="ws-cta-block">
                    <p class="ws-cta-headline">Calculate Your Facility's Water Footprint</p>
                    <p class="ws-cta-sub">Estimate annual water consumption and compare mitigation strategies across 8 Southeast Asian regions</p>
                    <a href="#calculator-section" class="ws-cta-btn">Open Water Calculator</a>
                </div>

                <!-- Key Statistics Infographic -->
                <figure style="margin: 2.5rem 0; text-align: center;">
                    <img loading="lazy" src="assets/article-10-infographic.jpg" alt="Water Stress and AI Data Centers - Key Statistics Infographic" style="max-width: 100%; height: auto; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.15);">
                    <figcaption style="margin-top: 0.75rem; font-size: 0.875rem; color: #64748b; font-style: italic;">Figure 1: Water Stress and AI Data Centers - Key Statistics Overview</figcaption>
                </figure>

                <h2 id="section-2">2. The Global Water Stress Landscape</h2>

                <!-- Southeast Asia Water Stress Bar Chart -->
                <div class="water-stress-viz">
                    <div class="viz-title">Southeast Asia Data Center Hubs - Water Stress Comparison</div>
                    <div class="viz-subtitle">Established markets vs. emerging opportunities | WRI Aqueduct 4.0<a href="#ref2" class="cite">[2]</a></div>

                    <div class="stress-chart-container" style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border-radius: 16px; padding: 2rem; margin: 1.5rem 0;">
                        <!-- Legend -->
                        <div style="display: flex; justify-content: flex-end; gap: 1.5rem; margin-bottom: 1.5rem; font-size: 0.75rem;">
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <span style="width: 12px; height: 12px; background: linear-gradient(90deg, #dc2626, #b91c1c); border-radius: 3px;"></span>
                                <span style="color: #94a3b8;">Extremely High (>80%)</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <span style="width: 12px; height: 12px; background: linear-gradient(90deg, #f59e0b, #d97706); border-radius: 3px;"></span>
                                <span style="color: #94a3b8;">High (40-80%)</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <span style="width: 12px; height: 12px; background: linear-gradient(90deg, #eab308, #ca8a04); border-radius: 3px;"></span>
                                <span style="color: #94a3b8;">Medium-High (20-40%)</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <span style="width: 12px; height: 12px; background: linear-gradient(90deg, #22c55e, #16a34a); border-radius: 3px;"></span>
                                <span style="color: #94a3b8;">Low (<20%)</span>
                            </div>
                        </div>

                        <!-- Bar Chart -->
                        <div style="display: flex; flex-direction: column; gap: 1rem;">
                            <!-- Jakarta/Bekasi -->
                            <div style="display: grid; grid-template-columns: 180px 1fr 60px; align-items: center; gap: 1rem;">
                                <div style="text-align: right;">
                                    <span style="color: #f8fafc; font-weight: 600; font-size: 0.9rem;">Jakarta/Bekasi</span>
                                    <span style="display: block; color: #64748b; font-size: 0.7rem;">Indonesia</span>
                                </div>
                                <div style="height: 32px; background: rgba(255,255,255,0.1); border-radius: 6px; overflow: hidden; position: relative;">
                                    <div style="width: 85%; height: 100%; background: linear-gradient(90deg, #dc2626, #b91c1c); border-radius: 6px; display: flex; align-items: center; justify-content: flex-end; padding-right: 10px; box-shadow: 0 0 20px rgba(220,38,38,0.4);">
                                        <span style="color: #fff; font-size: 0.7rem; font-weight: bold;">CRITICAL</span>
                                    </div>
                                </div>
                                <span style="color: #dc2626; font-weight: 700; font-size: 1.1rem;">85%</span>
                            </div>

                            <!-- Singapore -->
                            <div style="display: grid; grid-template-columns: 180px 1fr 60px; align-items: center; gap: 1rem;">
                                <div style="text-align: right;">
                                    <span style="color: #f8fafc; font-weight: 600; font-size: 0.9rem;">Singapore</span>
                                    <span style="display: block; color: #64748b; font-size: 0.7rem;">Singapore</span>
                                </div>
                                <div style="height: 32px; background: rgba(255,255,255,0.1); border-radius: 6px; overflow: hidden;">
                                    <div style="width: 72%; height: 100%; background: linear-gradient(90deg, #f59e0b, #d97706); border-radius: 6px; display: flex; align-items: center; justify-content: flex-end; padding-right: 10px; box-shadow: 0 0 15px rgba(245,158,11,0.3);">
                                        <span style="color: #fff; font-size: 0.7rem; font-weight: bold;">HIGH</span>
                                    </div>
                                </div>
                                <span style="color: #f59e0b; font-weight: 700; font-size: 1.1rem;">72%</span>
                            </div>

                            <!-- Kuala Lumpur -->
                            <div style="display: grid; grid-template-columns: 180px 1fr 60px; align-items: center; gap: 1rem;">
                                <div style="text-align: right;">
                                    <span style="color: #f8fafc; font-weight: 600; font-size: 0.9rem;">Kuala Lumpur</span>
                                    <span style="display: block; color: #64748b; font-size: 0.7rem;">Malaysia</span>
                                </div>
                                <div style="height: 32px; background: rgba(255,255,255,0.1); border-radius: 6px; overflow: hidden;">
                                    <div style="width: 45%; height: 100%; background: linear-gradient(90deg, #f59e0b, #d97706); border-radius: 6px; display: flex; align-items: center; justify-content: flex-end; padding-right: 10px;">
                                        <span style="color: #fff; font-size: 0.7rem; font-weight: bold;">HIGH</span>
                                    </div>
                                </div>
                                <span style="color: #f59e0b; font-weight: 700; font-size: 1.1rem;">45%</span>
                            </div>

                            <!-- Bangkok -->
                            <div style="display: grid; grid-template-columns: 180px 1fr 60px; align-items: center; gap: 1rem;">
                                <div style="text-align: right;">
                                    <span style="color: #f8fafc; font-weight: 600; font-size: 0.9rem;">Bangkok</span>
                                    <span style="display: block; color: #64748b; font-size: 0.7rem;">Thailand</span>
                                </div>
                                <div style="height: 32px; background: rgba(255,255,255,0.1); border-radius: 6px; overflow: hidden;">
                                    <div style="width: 38%; height: 100%; background: linear-gradient(90deg, #eab308, #ca8a04); border-radius: 6px; display: flex; align-items: center; justify-content: flex-end; padding-right: 10px;">
                                        <span style="color: #fff; font-size: 0.7rem; font-weight: bold;">MED-HIGH</span>
                                    </div>
                                </div>
                                <span style="color: #eab308; font-weight: 700; font-size: 1.1rem;">38%</span>
                            </div>

                            <!-- Manila -->
                            <div style="display: grid; grid-template-columns: 180px 1fr 60px; align-items: center; gap: 1rem;">
                                <div style="text-align: right;">
                                    <span style="color: #f8fafc; font-weight: 600; font-size: 0.9rem;">Manila</span>
                                    <span style="display: block; color: #64748b; font-size: 0.7rem;">Philippines</span>
                                </div>
                                <div style="height: 32px; background: rgba(255,255,255,0.1); border-radius: 6px; overflow: hidden;">
                                    <div style="width: 35%; height: 100%; background: linear-gradient(90deg, #eab308, #ca8a04); border-radius: 6px; display: flex; align-items: center; justify-content: flex-end; padding-right: 10px;">
                                        <span style="color: #fff; font-size: 0.7rem; font-weight: bold;">MED-HIGH</span>
                                    </div>
                                </div>
                                <span style="color: #eab308; font-weight: 700; font-size: 1.1rem;">35%</span>
                            </div>

                            <!-- Ho Chi Minh City -->
                            <div style="display: grid; grid-template-columns: 180px 1fr 60px; align-items: center; gap: 1rem;">
                                <div style="text-align: right;">
                                    <span style="color: #f8fafc; font-weight: 600; font-size: 0.9rem;">Ho Chi Minh City</span>
                                    <span style="display: block; color: #64748b; font-size: 0.7rem;">Vietnam</span>
                                </div>
                                <div style="height: 32px; background: rgba(255,255,255,0.1); border-radius: 6px; overflow: hidden;">
                                    <div style="width: 28%; height: 100%; background: linear-gradient(90deg, #eab308, #ca8a04); border-radius: 6px; display: flex; align-items: center; justify-content: flex-end; padding-right: 10px;">
                                        <span style="color: #fff; font-size: 0.7rem; font-weight: bold;">MED-HIGH</span>
                                    </div>
                                </div>
                                <span style="color: #eab308; font-weight: 700; font-size: 1.1rem;">28%</span>
                            </div>

                            <!-- Hanoi -->
                            <div style="display: grid; grid-template-columns: 180px 1fr 60px; align-items: center; gap: 1rem;">
                                <div style="text-align: right;">
                                    <span style="color: #f8fafc; font-weight: 600; font-size: 0.9rem;">Hanoi</span>
                                    <span style="display: block; color: #64748b; font-size: 0.7rem;">Vietnam</span>
                                </div>
                                <div style="height: 32px; background: rgba(255,255,255,0.1); border-radius: 6px; overflow: hidden;">
                                    <div style="width: 22%; height: 100%; background: linear-gradient(90deg, #eab308, #ca8a04); border-radius: 6px; display: flex; align-items: center; justify-content: flex-end; padding-right: 10px;">
                                        <span style="color: #fff; font-size: 0.65rem; font-weight: bold;">MED</span>
                                    </div>
                                </div>
                                <span style="color: #eab308; font-weight: 700; font-size: 1.1rem;">22%</span>
                            </div>

                            <!-- Johor Bahru -->
                            <div style="display: grid; grid-template-columns: 180px 1fr 60px; align-items: center; gap: 1rem;">
                                <div style="text-align: right;">
                                    <span style="color: #f8fafc; font-weight: 600; font-size: 0.9rem;">Johor Bahru</span>
                                    <span style="display: block; color: #64748b; font-size: 0.7rem;">Malaysia</span>
                                </div>
                                <div style="height: 32px; background: rgba(255,255,255,0.1); border-radius: 6px; overflow: hidden;">
                                    <div style="width: 18%; height: 100%; background: linear-gradient(90deg, #22c55e, #16a34a); border-radius: 6px; display: flex; align-items: center; justify-content: flex-end; padding-right: 10px;">
                                        <span style="color: #fff; font-size: 0.7rem; font-weight: bold;">LOW</span>
                                    </div>
                                </div>
                                <span style="color: #22c55e; font-weight: 700; font-size: 1.1rem;">18%</span>
                            </div>

                            <!-- Da Nang -->
                            <div style="display: grid; grid-template-columns: 180px 1fr 60px; align-items: center; gap: 1rem;">
                                <div style="text-align: right;">
                                    <span style="color: #f8fafc; font-weight: 600; font-size: 0.9rem;">Da Nang</span>
                                    <span style="display: block; color: #64748b; font-size: 0.7rem;">Vietnam</span>
                                </div>
                                <div style="height: 32px; background: rgba(255,255,255,0.1); border-radius: 6px; overflow: hidden;">
                                    <div style="width: 18%; height: 100%; background: linear-gradient(90deg, #22c55e, #16a34a); border-radius: 6px; display: flex; align-items: center; justify-content: flex-end; padding-right: 10px;">
                                        <span style="color: #fff; font-size: 0.7rem; font-weight: bold;">LOW</span>
                                    </div>
                                </div>
                                <span style="color: #22c55e; font-weight: 700; font-size: 1.1rem;">18%</span>
                            </div>

                            <!-- Clark (Philippines) -->
                            <div style="display: grid; grid-template-columns: 180px 1fr 60px; align-items: center; gap: 1rem;">
                                <div style="text-align: right;">
                                    <span style="color: #f8fafc; font-weight: 600; font-size: 0.9rem;">Clark Freeport</span>
                                    <span style="display: block; color: #64748b; font-size: 0.7rem;">Philippines</span>
                                </div>
                                <div style="height: 32px; background: rgba(255,255,255,0.1); border-radius: 6px; overflow: hidden;">
                                    <div style="width: 25%; height: 100%; background: linear-gradient(90deg, #eab308, #ca8a04); border-radius: 6px; display: flex; align-items: center; justify-content: flex-end; padding-right: 10px;">
                                        <span style="color: #fff; font-size: 0.65rem; font-weight: bold;">MED</span>
                                    </div>
                                </div>
                                <span style="color: #eab308; font-weight: 700; font-size: 1.1rem;">25%</span>
                            </div>

                            <!-- Batam -->
                            <div style="display: grid; grid-template-columns: 180px 1fr 60px; align-items: center; gap: 1rem;">
                                <div style="text-align: right;">
                                    <span style="color: #f8fafc; font-weight: 600; font-size: 0.9rem;">Batam</span>
                                    <span style="display: block; color: #64748b; font-size: 0.7rem;">Indonesia (FTZ)</span>
                                </div>
                                <div style="height: 32px; background: rgba(255,255,255,0.1); border-radius: 6px; overflow: hidden;">
                                    <div style="width: 30%; height: 100%; background: linear-gradient(90deg, #eab308, #ca8a04); border-radius: 6px; display: flex; align-items: center; justify-content: flex-end; padding-right: 10px;">
                                        <span style="color: #fff; font-size: 0.65rem; font-weight: bold;">MED</span>
                                    </div>
                                </div>
                                <span style="color: #eab308; font-weight: 700; font-size: 1.1rem;">30%</span>
                            </div>
                        </div>

                        <p style="margin-top: 1.5rem; font-size: 0.75rem; color: #64748b; text-align: center;">
                            Water stress = ratio of total water withdrawals to available renewable surface and groundwater supplies. Source: WRI Aqueduct 4.0<a href="#ref2" class="cite" style="color: #06b6d4;">[2]</a>
                        </p>
                    </div>

                    <div class="legend-container">
                        <div class="legend-item">
                            <span class="legend-dot high"></span>
                            High/Extremely High (58%)
                        </div>
                        <div class="legend-item">
                            <span class="legend-dot medium"></span>
                            Medium (32%)
                        </div>
                        <div class="legend-item">
                            <span class="legend-dot low"></span>
                            Low (10%)
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">High Stress</div>
                            <div class="stat-value high">58%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Medium Stress</div>
                            <div class="stat-value medium">32%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Low Stress</div>
                            <div class="stat-value low">10%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">SEA Investment</div>
                            <div class="stat-value primary">$30B</div>
                        </div>
                    </div>
                </div>

                <p>According to the World Resources Institute (WRI) Aqueduct 4.0 Dataset, the majority of existing data centers in Asia are located in areas of high water stress. This critical finding raises questions about the ongoing viability of these facilities as water scarcity intensifies.</p>

                <div class="warning-box">
                    <p><strong>Critical Finding:</strong> Market forecasts predict data center investment in Southeast Asia could reach $30 billion by 2030.<a href="#ref3" class="cite">[3]</a> The majority of announced capacity targets water-stressed regions (Jakarta, Singapore). However, as the chart above illustrates, emerging markets like Johor Bahru, Hanoi, and Da Nang offer significantly lower water stress with developing infrastructureâ€”presenting a diversification opportunity.<a href="#ref2" class="cite">[2]</a></p>
                </div>

                <h2 id="section-3">3. AI's Insatiable Thirst: The Cooling Challenge</h2>

                <p>The rise of AI workloads has fundamentally changed data center cooling requirements, as explored in depth in <a href="article-9.html">our HVAC shock analysis of AI-era cooling demands</a>. Traditional air-cooled facilities operated at rack densities of 8-12 kW. Modern AI facilities require 25-40 kW per rackâ€”and often much more for GPU-dense configurations.</p>

                <h3>2.1 Why AI Uses More Water</h3>
                <ul>
                    <li><strong>Higher heat density:</strong> A single NVIDIA H100 GPU generates 700W of heat.<a href="#ref9" class="cite">[9]</a> A rack of 8 GPUs produces 5.6 kW from GPUs alone</li>
                    <li><strong>Continuous operation:</strong> AI training workloads run 24/7 at maximum utilization, unlike burst compute patterns</li>
                    <li><strong>Liquid cooling adoption:</strong> Above 25 kW per rack, liquid or hybrid cooling becomes essentialâ€”and evaporative cooling systems consume significant water</li>
                    <li><strong>Scale effects:</strong> A 100MW AI data center can consume 1-2 billion liters of water annually â€” and the <a href="article-11.html">electricity bills to power that consumption</a> add another dimension to the resource challenge</li>
                </ul>

                <h3>2.2 Water Usage Effectiveness (WUE)</h3>
                <p>Industry standard WUE ranges from 0.5 to 2.0 L/kWh. The formula is straightforward:</p>

                <div class="highlight-box">
                    <p><strong>WUE = Annual Water Consumption (Liters) / IT Equipment Energy (kWh)</strong></p>
                    <p style="margin-top: 0.5rem;">A typical 10MW facility with WUE of 1.5 consumes approximately <strong>131 million liters annually</strong>â€”equivalent to 52 Olympic swimming pools.</p>
                </div>

                <h2 id="section-4"><a id="calculator-section"></a>4. Interactive: Data Center Water Consumption Calculator</h2>
                <p>Use this calculator to estimate water consumption based on facility parameters. Adjust the sliders to see real-time impact analysis:</p>

                <!-- Water Calculator -->
                <div class="water-calculator">
                    <div class="calc-title">Data Center Water Consumption Calculator</div>
                    <div class="calc-subtitle">Estimate annual water usage based on facility specifications</div>

                    <!-- Toolbar -->
                    <div class="ws-toolbar-row">
                        <div class="ws-mode-bar">
                            <div class="mode-toggle">
                                <button class="mode-btn active" id="wsFreeBtn" onclick="wsSetMode('free')">Free</button>
                                <button class="mode-btn" id="wsProBtn" onclick="wsSetMode('pro')">Pro</button>
                            </div>
                        </div>
                        <div class="ws-toolbar-actions">
                            <button class="ws-btn-reset" onclick="wsResetDefaults()"><i class="fas fa-undo"></i> Reset</button>
                            <button class="ws-btn-pdf" onclick="wsExportPDF()"><i class="fas fa-file-pdf"></i> Export PDF</button>
                        </div>
                    </div>

                    <div class="calc-controls">
                        <div class="control-card">
                            <div class="control-label">
                                <span class="control-icon power">âš¡</span>
                                IT Load Capacity <span class="tooltip-trigger" tabindex="0">?<span class="tooltip-content"><div class="tooltip-title">IT Load Capacity (MW)</div><div class="tooltip-desc">Total IT power demand. Directly determines cooling load and water consumption. A 10MW facility is mid-size; hyperscalers build 100MW+.</div><div class="tooltip-formula">Water &#8733; Load &#215; PUE &#215; WUE &#215; 8,760 hrs</div></span></span>
                            </div>
                            <input type="range" id="powerSlider" class="control-slider" min="1" max="100" value="10">
                            <div class="control-value">
                                <span>1 MW</span>
                                <span class="current-val" id="powerVal">10 MW</span>
                                <span>100 MW</span>
                            </div>
                        </div>

                        <div class="control-card">
                            <div class="control-label">
                                <span class="control-icon pue">ðŸŒ¡ï¸</span>
                                PUE (Power Usage Effectiveness) <span class="tooltip-trigger" tabindex="0">?<span class="tooltip-content"><div class="tooltip-title">Power Usage Effectiveness</div><div class="tooltip-desc">Ratio of total facility power to IT power. Lower PUE = less cooling overhead. Industry avg 1.58 (Uptime 2023). Hyperscalers achieve 1.10-1.20.</div><div class="tooltip-formula">PUE = Total Power / IT Power | Best: 1.10</div></span></span>
                            </div>
                            <input type="range" id="pueSlider" class="control-slider" min="110" max="200" value="140">
                            <div class="control-value">
                                <span>1.10</span>
                                <span class="current-val" id="pueVal">1.40</span>
                                <span>2.00</span>
                            </div>
                        </div>

                        <div class="control-card">
                            <div class="control-label">
                                <span class="control-icon wue">ðŸ’§</span>
                                WUE (L/kWh) <span class="tooltip-trigger" tabindex="0">?<span class="tooltip-content"><div class="tooltip-title">Water Usage Effectiveness</div><div class="tooltip-desc">Liters of water consumed per kWh of IT energy. Air-cooled = 0, evaporative = 0.5-1.5, traditional cooling tower = 1.5-2.0. Key metric for water sustainability.</div><div class="tooltip-formula">Annual Water = Load &#215; 1000 &#215; 8760 &#215; WUE</div></span></span>
                            </div>
                            <input type="range" id="wueSlider" class="control-slider" min="0" max="200" value="150">
                            <div class="control-value">
                                <span>0 (Air)</span>
                                <span class="current-val" id="wueVal">1.50</span>
                                <span>2.00</span>
                            </div>
                        </div>
                    </div>

                    <div class="results-display">
                        <div class="results-grid">
                            <div class="result-item">
                                <div class="result-label">Annual Water <span class="res-tip">?<span class="res-tip-body"><div class="rtt">Annual Water Consumption</div><div class="rtd">Total yearly water consumed by the DC for cooling, humidification, and domestic use.</div></span></span></div>
                                <div class="result-value" id="annualWater">131.4</div>
                                <div class="result-unit">Million Liters</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">Daily Water <span class="res-tip">?<span class="res-tip-body"><div class="rtt">Daily Water Usage</div><div class="rtd">Average daily water consumption in thousands of liters.</div></span></span></div>
                                <div class="result-value" id="dailyWater">360</div>
                                <div class="result-unit">Thousand Liters</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">Olympic Pools <span class="res-tip">?<span class="res-tip-body"><div class="rtt">Olympic Pools Equivalent</div><div class="rtd">Annual water usage expressed as Olympic swimming pools (2.5M liters each) for perspective.</div></span></span></div>
                                <div class="result-value" id="poolsEquiv">52.5</div>
                                <div class="result-unit">Per Year</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">Households Equiv. <span class="res-tip">?<span class="res-tip-body"><div class="rtt">Households Equivalent</div><div class="rtd">Number of average households that use the same amount of water annually.</div></span></span></div>
                                <div class="result-value" id="householdsEquiv">876</div>
                                <div class="result-unit">Annual Usage</div>
                            </div>
                        </div>
                        <div class="impact-indicator" id="impactIndicator">
                            <div class="impact-text" id="impactText">High water consumption - consider water recycling systems</div>
                        </div>
                    </div>

                    <!-- Pro Panel 1: Water Cost & Financial Impact -->
                    <div class="ws-pro-panel gated" id="wsPanel1">
                        <div class="ws-gate-overlay" onclick="wsShowLogin()">
                            <i class="fas fa-lock"></i>
                            <span>Pro Feature â€” Log in to unlock</span>
                        </div>
                        <div class="panel-title"><i class="fas fa-dollar-sign"></i> Water Cost &amp; Financial Impact</div>
                        <div class="ws-kpi-grid">
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsAnnualCost">$157K</div>
                                <div class="ws-kpi-label">Annual Water Cost</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsCostPerMW">$15.7K</div>
                                <div class="ws-kpi-label">Cost per MW</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="ws10yrTCO">$1.8M</div>
                                <div class="ws-kpi-label">10-Year NPV Water Cost</div>
                                <div class="ws-kpi-sublabel">@ 8% discount rate</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsEscalation">3.0%</div>
                                <div class="ws-kpi-label">Annual Escalation</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsEvapCost">$157K</div>
                                <div class="ws-kpi-label">Evaporative Cost</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsDLCSaving">-87%</div>
                                <div class="ws-kpi-label">DLC Savings vs Evap</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsCostPerML">--</div>
                                <div class="ws-kpi-label">Cost per Megaliter</div>
                                <div class="ws-kpi-sublabel">Evap / DLC / Hybrid</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsRiskPremium">--</div>
                                <div class="ws-kpi-label">Water Risk Premium</div>
                                <div class="ws-kpi-sublabel">Supply disruption surcharge</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsRecycleROI">--</div>
                                <div class="ws-kpi-label">Recycling Infra ROI</div>
                                <div class="ws-kpi-sublabel">Payback period (years)</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsWaterEnergyNexus">--</div>
                                <div class="ws-kpi-label">Water-Energy Nexus</div>
                                <div class="ws-kpi-sublabel">kWh pumping / ML water</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsDLCAnnual">--</div>
                                <div class="ws-kpi-label">DLC Annual Cost</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsHybridCost">--</div>
                                <div class="ws-kpi-label">Hybrid Cooling Cost</div>
                                <div class="ws-kpi-sublabel">50% DLC + 50% Evap</div>
                            </div>
                        </div>
                        <div class="ws-chart-container">
                            <canvas id="wsWaterfallChart" height="200"></canvas>
                        </div>
                    </div>

                    <!-- Pro Panel 2: Regional Water Risk Matrix -->
                    <div class="ws-pro-panel gated" id="wsPanel2">
                        <div class="ws-gate-overlay" onclick="wsShowLogin()">
                            <i class="fas fa-lock"></i>
                            <span>Pro Feature â€” Log in to unlock</span>
                        </div>
                        <div class="panel-title"><i class="fas fa-globe-asia"></i> Regional Water Risk Matrix</div>
                        <select class="ws-region-select" id="wsRegionSelect" onchange="updateWsProPanels()">
                            <option value="jakarta">Jakarta/Bekasi - Extremely High Stress</option>
                            <option value="singapore">Singapore - High Stress</option>
                            <option value="johor">Johor Bahru - Low-Medium Stress</option>
                            <option value="hanoi">Hanoi - Medium Stress</option>
                            <option value="danang">Da Nang - Low Stress</option>
                            <option value="bangkok">Bangkok - Medium-High Stress</option>
                            <option value="manila">Manila - High Stress</option>
                            <option value="kualalumpur">Kuala Lumpur - Medium Stress</option>
                        </select>
                        <div class="ws-kpi-grid">
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsRegionStress">4.8/5</div>
                                <div class="ws-kpi-label">Water Stress Score</div>
                                <div class="ws-score-bar-bg"><div class="ws-score-bar-fill risk-high" id="wsStressBar" style="width:96%"></div></div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsRegionRisk">92</div>
                                <div class="ws-kpi-label">Risk Score (0-100)</div>
                                <div class="ws-score-bar-bg"><div class="ws-score-bar-fill risk-high" id="wsRiskBar" style="width:92%"></div></div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsRegionPrice">$1.20</div>
                                <div class="ws-kpi-label">Water Price ($/m&#179;)</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsRegionLevel">Extreme</div>
                                <div class="ws-kpi-label">Stress Level</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsRegionAnnualCost">$157K</div>
                                <div class="ws-kpi-label">Annual Water Cost</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsRegionRank">#1</div>
                                <div class="ws-kpi-label">Risk Rank (of 8)</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsAquiferRate">--</div>
                                <div class="ws-kpi-label">Aquifer Depletion Rate</div>
                                <div class="ws-kpi-sublabel">cm/year groundwater drop</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsRegSeverity">--</div>
                                <div class="ws-kpi-label">Regulatory Severity</div>
                                <div class="ws-kpi-sublabel">Restriction likelihood</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsAltWaterSource">--</div>
                                <div class="ws-kpi-label">Alt Water Source</div>
                                <div class="ws-kpi-sublabel">Availability score</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsClimateImpact">--</div>
                                <div class="ws-kpi-label">Climate Change Impact</div>
                                <div class="ws-kpi-sublabel">2050 stress projection</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsCommunityIdx">--</div>
                                <div class="ws-kpi-label">Community Opposition</div>
                                <div class="ws-kpi-sublabel">Social license risk</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsCostVsLowest">--</div>
                                <div class="ws-kpi-label">Cost vs Lowest Region</div>
                                <div class="ws-kpi-sublabel">Comparative premium</div>
                            </div>
                        </div>
                    </div>

                    <!-- Pro Panel 3: Sustainability Compliance Scorecard -->
                    <div class="ws-pro-panel gated" id="wsPanel3">
                        <div class="ws-gate-overlay" onclick="wsShowLogin()">
                            <i class="fas fa-lock"></i>
                            <span>Pro Feature â€” Log in to unlock</span>
                        </div>
                        <div class="panel-title"><i class="fas fa-leaf"></i> Sustainability Compliance Scorecard</div>
                        <div class="ws-kpi-grid">
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsESGScore">C+</div>
                                <div class="ws-kpi-label">ESG Water Alignment</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsCDPGrade">B-</div>
                                <div class="ws-kpi-label">CDP Water Security</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsSBTiGap">32%</div>
                                <div class="ws-kpi-label">SBTi Water Target Gap</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsRegExposure">High</div>
                                <div class="ws-kpi-label">Regulatory Exposure</div>
                                <div class="ws-kpi-sublabel">Indonesia PP 22/2021</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsRecycleRate">15%</div>
                                <div class="ws-kpi-label">Water Recycle Rate</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsComplianceRisk">68/100</div>
                                <div class="ws-kpi-label">Compliance Risk Index</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsWueTrajectory">--</div>
                                <div class="ws-kpi-label">WUE Improvement Path</div>
                                <div class="ws-kpi-sublabel">Current vs 0.50 target</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsAWSAlign">--</div>
                                <div class="ws-kpi-label">AWS Alignment</div>
                                <div class="ws-kpi-sublabel">Alliance for Water Stewardship</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsESGReadiness">--</div>
                                <div class="ws-kpi-label">ESG Reporting Ready</div>
                                <div class="ws-kpi-sublabel">Disclosure completeness</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsCompGapCount">--</div>
                                <div class="ws-kpi-label">Compliance Gaps</div>
                                <div class="ws-kpi-sublabel">Critical / Major / Minor</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsWueVsBenchmark">--</div>
                                <div class="ws-kpi-label">WUE vs Industry Avg</div>
                                <div class="ws-kpi-sublabel">Percentile ranking</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsNetZeroWater">--</div>
                                <div class="ws-kpi-label">Net-Zero Water Gap</div>
                                <div class="ws-kpi-sublabel">ML offset needed/yr</div>
                            </div>
                        </div>
                    </div>

                    <!-- Pro Panel 4: Monte Carlo Water Projection -->
                    <div class="ws-pro-panel gated" id="wsPanel4">
                        <div class="ws-gate-overlay" onclick="wsShowLogin()">
                            <i class="fas fa-lock"></i>
                            <span>Pro Feature â€” Log in to unlock</span>
                        </div>
                        <div class="panel-title"><i class="fas fa-chart-area"></i> Monte Carlo Water Projection (10K Iterations)</div>
                        <div class="ws-kpi-grid">
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsMCP1">--</div>
                                <div class="ws-kpi-label">P1 (Worst Case)</div>
                                <div class="ws-kpi-sublabel">Extreme tail risk</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsMCP5">$98K</div>
                                <div class="ws-kpi-label">P5 (Best Case)</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsMCP50">$157K</div>
                                <div class="ws-kpi-label">P50 (Median)</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsMCP95">$238K</div>
                                <div class="ws-kpi-label">P95 (Worst Case)</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsMCMean">$161K</div>
                                <div class="ws-kpi-label">Mean Cost</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsMCStd">$42K</div>
                                <div class="ws-kpi-label">Std Deviation</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsMCCVaR95">--</div>
                                <div class="ws-kpi-label">CVaR @ 95%</div>
                                <div class="ws-kpi-sublabel">Expected Shortfall</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsMCBudgetExceed">--</div>
                                <div class="ws-kpi-label">Budget Exceedance</div>
                                <div class="ws-kpi-sublabel">P(cost > 120% budget)</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsMCCrisisProb">--</div>
                                <div class="ws-kpi-label">10-Year Crisis Prob.</div>
                                <div class="ws-kpi-sublabel">P(shortage event)</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsMCContingency">--</div>
                                <div class="ws-kpi-label">Contingency Reserve</div>
                                <div class="ws-kpi-sublabel">Recommended buffer</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsMCTopDriver">WUE</div>
                                <div class="ws-kpi-label">Highest Impact Factor</div>
                            </div>
                            <div class="ws-kpi-card">
                                <div class="ws-kpi-value" id="wsMCConfWidth">--</div>
                                <div class="ws-kpi-label">90% Conf. Width</div>
                                <div class="ws-kpi-sublabel">P5-P95 spread</div>
                            </div>
                        </div>
                        <div class="ws-chart-container">
                            <canvas id="wsMonteCarloChart" height="200"></canvas>
                        </div>
                        <div class="ws-chart-container" style="margin-top:0.75rem">
                            <canvas id="wsTornadoChart" height="200"></canvas>
                        </div>
                    </div>

                    <!-- Pro Panel 5: AI-Generated Narrative Assessment -->
                    <div class="ws-pro-panel gated" id="wsPanel5">
                        <div class="ws-gate-overlay" onclick="wsShowLogin()">
                            <i class="fas fa-lock"></i>
                            <span>Pro Feature â€” Log in to unlock</span>
                        </div>
                        <div class="panel-title"><i class="fas fa-robot"></i> AI-Generated Comprehensive Assessment</div>
                        <div class="ws-narrative" id="wsNarrative">
                            <h4><i class="fas fa-file-alt"></i> Executive Water Risk Report</h4>
                            <div id="wsNarrativeText">Loading assessment...</div>
                        </div>
                    </div>

                    <!-- Privacy Badge -->
                    <div class="ws-privacy-badge">
                        <i class="fas fa-shield-alt"></i> All calculations run locally in your browser. No data is sent to any server.
                    </div>

                    <!-- Benchmark Meta Tags -->
                    <div class="ws-benchmark-meta">
                        <span class="ws-benchmark-tag"><i class="fas fa-database"></i> WRI Aqueduct 4.0</span>
                        <span class="ws-benchmark-tag"><i class="fas fa-water"></i> WUE ISO 30134-9</span>
                        <span class="ws-benchmark-tag"><i class="fas fa-chart-bar"></i> 10K MC Iterations</span>
                        <span class="ws-benchmark-tag"><i class="fas fa-globe"></i> 8 SEA Regions</span>
                        <span class="ws-benchmark-tag"><i class="fas fa-calendar"></i> Feb 2026 Data</span>
                    </div>

                </div>

                <h2 id="jakarta-water-stress-data-centers">Why Jakarta's Water Stress Threatens New Data Center Builds</h2>

                <h2 id="section-5">5. Southeast Asia Focus: Jakarta and Bekasi</h2>

                <p>Indonesia's data center market is experiencing explosive growth, with Jakarta emerging as Southeast Asia's fastest-growing data center market.<a href="#ref5" class="cite">[5]</a> However, this growth is concentrated in one of the region's most water-stressed areas.</p>

                <h3>4.1 The Bekasi Paradox</h3>
                <p>According to BAPPENAS (Indonesian National Development Planning Agency) data, the Bekasi Regency has a population of approximately 3.1 million people as of 2023.<a href="#ref10" class="cite">[10]</a> Research published in the <em>Indonesian Journal of Geography</em> documented a 43% increase in built-up areas in the Bekasi River Basin between 1990 and 2018.<a href="#ref11" class="cite">[11]</a> Major flood events recorded by BNPB (National Disaster Management Agency) in 2020, 2021, and 2024 have affected over 100,000 residents.<a href="#ref12" class="cite">[12]</a> Paradoxically, this flooding-prone area also faces severe water stress during dry seasons due to groundwater over-extraction and industrial demand.</p>

                <div class="data-table-container">
                    <p class="table-note"><em>Note: Data compiled from publicly announced projects and industry reports. Investment figures where available are from company press releases.</em></p>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Project</th>
                                <th>Location</th>
                                <th>Capacity</th>
                                <th>Investment</th>
                                <th>Water Stress<a href="#ref2" class="cite">[2]</a></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>DC1 - Hyperscaler Campus</td>
                                <td>Bekasi (GIIC)</td>
                                <td>500 MW</td>
                                <td>US$4.5B</td>
                                <td><span class="stress-badge high">High</span></td>
                            </tr>
                            <tr>
                                <td>DC2 - Enterprise Campus</td>
                                <td>Bekasi (Cikarang)</td>
                                <td>150 MW</td>
                                <td>US$1.2B</td>
                                <td><span class="stress-badge high">High</span></td>
                            </tr>
                            <tr>
                                <td>DC3 - Colocation Facility</td>
                                <td>Jakarta (Cibitung)</td>
                                <td>80 MW</td>
                                <td>US$600M</td>
                                <td><span class="stress-badge high">High</span></td>
                            </tr>
                            <tr>
                                <td>DC4 - Cloud Provider</td>
                                <td>Bekasi (Deltamas)</td>
                                <td>200 MW</td>
                                <td>US$1.8B</td>
                                <td><span class="stress-badge high">High</span></td>
                            </tr>
                            <tr>
                                <td>DC5 - Regional Hub</td>
                                <td>Jakarta (Marunda)</td>
                                <td>120 MW</td>
                                <td>US$900M</td>
                                <td><span class="stress-badge high">High</span></td>
                            </tr>
                            <tr>
                                <td colspan="5" class="table-note-row">
                                    <em>Note: Project names anonymized for privacy. Data compiled from public announcements and industry reports. Water stress levels based on WRI Aqueduct 4.0 baseline indicators for the Jakarta-Bekasi corridor.</em>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <p class="table-source">Source: Company announcements, industry reports, WRI Aqueduct<a href="#ref2" class="cite">[2]</a> For educational and research purposes only.</p>
                </div>

                <h3>4.2 Water Conservation Strategies in Bekasi</h3>
                <p>Major data center developments in the Bekasi corridor are implementing various water conservation measures:</p>
                <ul>
                    <li><strong>Direct-to-chip liquid cooling:</strong> Reduces reliance on evaporative cooling towers</li>
                    <li><strong>Recycled water systems:</strong> Reduces municipal water dependency</li>
                    <li><strong>Rainwater harvesting:</strong> Captures seasonal precipitation for cooling use</li>
                    <li><strong>Closed-loop systems:</strong> Minimizes water loss from evaporation</li>
                </ul>

                <h2 id="section-6">6. Regional Innovations: Learning from Neighbors</h2>

                <h3>5.1 Singapore's STDCT Initiative</h3>
                <p>Launched in 2023, Singapore's Sustainable Tropical Data Centre Testbed (STDCT) is the world's first full-scale facility focused on tropical data center cooling. The collaboration between NUS, NTU, and 20 industry partners aims to reduce energy and water consumption by up to 40%.</p>

                <h3>5.2 Malaysia's Recycled Water Scheme</h3>
                <p>In Malaysia, AirTrunk has partnered with Johor Special Water (JSW) to develop the country's largest recycled water supply scheme for data centers. This model could be replicated across the region.</p>

                <div class="result-box">
                    <h4>Key Regional Innovations</h4>
                    <p><strong>Singapore STDCT:</strong> 40% reduction target for energy and water consumption</p>
                    <p><strong>Malaysia AirTrunk:</strong> Largest recycled water scheme for data centers in SEA</p>
                    <p><strong>Indonesia Digital Edge:</strong> Direct-to-chip cooling with recycled water systems</p>
                </div>

                <h2 id="section-7">7. Emerging Opportunities: Underutilized Markets in Southeast Asia</h2>

                <p>While Jakarta, Singapore, and Kuala Lumpur dominate headlines, several SEA markets offer compelling alternatives with lower water stress, favorable demographics, and untapped potential. A balanced regional strategy should consider these emerging hubs.</p>

                <h3>6.1 Vietnam: The Rising Digital Tiger</h3>
                <p><strong>Hanoi</strong> presents a striking contrast to the saturated southern markets. With water stress indices around 15-22%, abundant Red River basin resources, and a growing tech-savvy workforce of 97 million people, northern Vietnam offers significant headroom for expansion. The government's National Digital Transformation Program targets 100,000 ICT enterprises by 2030.</p>

                <p><strong>Da Nang</strong>, positioned as Vietnam's "Silicon Valley of the East," benefits from cooler coastal climates (reducing cooling loads), water stress below 18%, and proximity to submarine cable landing stations. The city's infrastructure utilization remains under 40%, presenting a green-field opportunity.</p>

                <div class="highlight-box">
                    <p><strong>Vietnam Opportunity:</strong> Combined data center capacity in Hanoi and Da Nang is currently under 50MW, compared to 500MW+ planned for Ho Chi Minh City alone. Early movers can secure favorable power purchase agreements and water rights.</p>
                </div>

                <h3>6.2 Malaysia: Beyond Kuala Lumpur</h3>
                <p><strong>Johor Bahru</strong> and the Iskandar Malaysia economic zone represent perhaps SEA's most balanced opportunity. Water stress indices of 15-20% (significantly lower than Singapore's 72%), combined with:</p>
                <ul>
                    <li><strong>Geographic advantage:</strong> 1km from Singapore via causeway, enabling low-latency connectivity to the Lion City's financial hub</li>
                    <li><strong>Cost efficiency:</strong> Land costs 60-70% lower than Singapore; electricity rates competitive</li>
                    <li><strong>Water security:</strong> Access to Johor River basin with established recycled water infrastructure</li>
                    <li><strong>Digital investment incentives:</strong> Malaysia Digital Economy Blueprint offers tax holidays and grants</li>
                </ul>

                <p><strong>Penang</strong> in northern Malaysia, traditionally known for electronics manufacturing, is emerging as a secondary data center hub with water stress around 25% and established industrial power infrastructure.</p>

                <h3>6.3 Philippines: Diversifying Beyond Metro Manila</h3>
                <p>Metro Manila's 35% water stress index masks significant regional variations. <strong>Clark Freeport Zone</strong> and <strong>Cebu</strong> offer alternatives:</p>
                <ul>
                    <li><strong>Clark:</strong> Former US air base with abundant land, dedicated power infrastructure, and water stress indices around 20-25%</li>
                    <li><strong>Cebu:</strong> Philippines' second city with growing fiber connectivity, water stress under 22%, and a BPO talent pool of 150,000+ professionals</li>
                    <li><strong>Batangas:</strong> Southern Luzon industrial corridor with direct submarine cable access and developing water recycling infrastructure</li>
                </ul>

                <h3>6.4 Indonesia: Alternatives to the Jakarta Corridor</h3>
                <p>While Bekasi and Jakarta command the largest investments, Indonesia offers diversification opportunities:</p>
                <ul>
                    <li><strong>Batam:</strong> Free trade zone with Singapore proximity (45 minutes by ferry), water stress around 30%, and duty-free equipment imports</li>
                    <li><strong>Surabaya:</strong> Indonesia's second city serving East Java's 40 million population, with developing data center ecosystem and moderate water stress (35%)</li>
                    <li><strong>Nusantara (New Capital):</strong> Indonesia's planned capital city in East Kalimantan presents a long-term opportunity with greenfield infrastructure and lower water stress projections (25-30%)</li>
                </ul>

                <h3>6.5 Thailand: The Central Hub</h3>
                <p>Beyond Bangkok's 38% water stress, <strong>Chonburi</strong> in the Eastern Economic Corridor (EEC) offers:</p>
                <ul>
                    <li>Water stress indices around 28%, lower than the capital</li>
                    <li>Dedicated data center power substations</li>
                    <li>Tax incentives under Thailand 4.0 digital economy initiative</li>
                    <li>Proximity to Laem Chabang port for equipment logistics</li>
                </ul>

                <!-- Emerging Markets Comparison Table -->
                <div class="data-table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Location</th>
                                <th>Country</th>
                                <th>Water Stress</th>
                                <th>Current Utilization</th>
                                <th>Key Advantage</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Johor Bahru</td>
                                <td>Malaysia</td>
                                <td><span class="stress-badge low">18%</span></td>
                                <td>~35%</td>
                                <td>Singapore proximity + low cost</td>
                            </tr>
                            <tr>
                                <td>Hanoi</td>
                                <td>Vietnam</td>
                                <td><span class="stress-badge low">22%</span></td>
                                <td>~25%</td>
                                <td>97M population, tech workforce</td>
                            </tr>
                            <tr>
                                <td>Da Nang</td>
                                <td>Vietnam</td>
                                <td><span class="stress-badge low">18%</span></td>
                                <td>~20%</td>
                                <td>Submarine cables, cool climate</td>
                            </tr>
                            <tr>
                                <td>Clark</td>
                                <td>Philippines</td>
                                <td><span class="stress-badge medium">25%</span></td>
                                <td>~30%</td>
                                <td>Land availability, power infra</td>
                            </tr>
                            <tr>
                                <td>Batam</td>
                                <td>Indonesia</td>
                                <td><span class="stress-badge medium">30%</span></td>
                                <td>~40%</td>
                                <td>Free trade zone, SG proximity</td>
                            </tr>
                            <tr>
                                <td>Chonburi (EEC)</td>
                                <td>Thailand</td>
                                <td><span class="stress-badge medium">28%</span></td>
                                <td>~45%</td>
                                <td>Tax incentives, port access</td>
                            </tr>
                        </tbody>
                    </table>
                    <p class="table-source">Source: WRI Aqueduct 4.0, industry reports, author analysis. Utilization estimates based on announced vs operational capacity. For educational and research purposes only.</p>
                </div>

                <div class="result-box">
                    <h4>Strategic Insight</h4>
                    <p>A diversified SEA data center portfolio balancing high-demand markets (Jakarta, Singapore) with emerging low-stress locations (Johor Bahru, Hanoi, Da Nang) can achieve both performance requirements and sustainability goals â€” particularly when considering the <a href="article-12.html">grid modernization value that data centers bring to host regions</a>. The optimal strategy considers:</p>
                    <p><strong>1. Latency tiers:</strong> Primary workloads in established hubs, disaster recovery in emerging markets</p>
                    <p><strong>2. Water portfolio:</strong> Balance water-intensive cooling in low-stress regions, advanced cooling tech in stressed areas</p>
                    <p><strong>3. Risk distribution:</strong> Regulatory, climate, and infrastructure diversification across ASEAN</p>
                </div>

                <h2 id="section-8">8. Mitigation Strategies for Water-Stressed Operations</h2>

                <h3>7.1 Immediate Actions</h3>
                <ol>
                    <li><strong>Implement WUE monitoring:</strong> You cannot manage what you don't measure</li>
                    <li><strong>Optimize cooling tower cycles:</strong> Increase concentration ratios to reduce blowdown</li>
                    <li><strong>Deploy leak detection:</strong> Even small leaks compound to significant losses annually</li>
                    <li><strong>Review setpoint temperatures:</strong> Raising supply temperatures reduces cooling demand</li>
                </ol>

                <h3>7.2 Medium-Term Investments</h3>
                <ol>
                    <li><strong>Transition to air-side economization:</strong> Use free cooling when ambient conditions permit</li>
                    <li><strong>Install rainwater collection:</strong> Particularly valuable in tropical climates with consistent rainfall</li>
                    <li><strong>Deploy liquid cooling for high-density racks:</strong> Direct-to-chip cooling eliminates evaporative losses</li>
                    <li><strong>Implement water recycling:</strong> Treat and reuse cooling tower blowdown</li>
                </ol>

                <h3>7.3 Strategic Decisions</h3>
                <ol>
                    <li><strong>Site selection:</strong> Consider water stress in location decisions, not just power availability</li>
                    <li><strong>Technology choices:</strong> Prioritize air-cooled or closed-loop liquid systems for new builds</li>
                    <li><strong>Community engagement:</strong> Partner with local water utilities on supply security</li>
                    <li><strong>Climate modeling:</strong> Design for 2050 water conditions, not just today's averages</li>
                </ol>

                <h2 id="section-9">9. Conclusion: Reframing the SEA Data Center Narrative</h2>

                <p>The convergence of AI growth, energy demand, and water scarcity creates both challenges and opportunities for data center operators across Southeast Asia. While Jakarta and Bekasi exemplify the tension of rapid investment in water-stressed regions, the broader SEA landscape offers a more nuanced picture.</p>

                <h3>8.1 The Balanced Perspective</h3>
                <p>This analysis reveals that SEA is not uniformly water-stressed. The region offers a spectrum of options:</p>
                <ul>
                    <li><strong>High-demand, high-stress markets</strong> (Jakarta, Singapore): Require advanced water conservation technologies but offer established ecosystems and connectivity</li>
                    <li><strong>Emerging, low-stress alternatives</strong> (Johor Bahru, Hanoi, Da Nang): Provide sustainable expansion opportunities with favorable water conditions</li>
                    <li><strong>Transitional markets</strong> (Bangkok, Manila, Kuala Lumpur): Balance moderate stress with mature infrastructure</li>
                </ul>

                <h3>8.2 The Path Forward</h3>
                <p>The data center industry in Southeast Asia stands at an inflection point. The decisions made in 2026-2030 will determine whether the region's digital infrastructure becomes part of the water crisis or part of the solution. Key imperatives include:</p>

                <ol>
                    <li><strong>Portfolio diversification:</strong> Spreading capacity across water stress profiles reduces systemic risk</li>
                    <li><strong>Technology adoption:</strong> Liquid cooling, recycled water, and free cooling must become standard, not premium</li>
                    <li><strong>Transparency:</strong> Water Usage Effectiveness (WUE) reporting should match the scrutiny given to PUE</li>
                    <li><strong>Community partnership:</strong> Data centers must be water stewards, not just consumers</li>
                </ol>

                <blockquote>
                    "Water-resilient data centres can drive Asia's digital economy. But this requires moving beyond treating water as an infinite resource. Every liter consumed must be measured, managed, and minimized. The good news is that Southeast Asia offers the geographic diversity to build sustainablyâ€”if we're willing to look beyond the established hubs."
                </blockquote>

                <p>The solutions existâ€”from Singapore's tropical cooling research to Malaysia's recycled water schemes, from Vietnam's emerging green-field opportunities to Indonesia's geographic diversification options. The question is no longer whether sustainable data center growth is possible in SEA, but whether the industry will embrace the regional diversity that makes it achievable.</p>

                <div class="highlight-box">
                    <p><strong>Final Thought:</strong> The $30 billion investment flowing into SEA data centers over the next five years represents an unprecedented opportunity to build digital infrastructure that respects planetary boundaries. Water stress is a constraint, but it's also a catalyst for innovation. The operators who master water efficiency in tropical, water-stressed environments will have a competitive advantage as these challenges become global.</p>
                </div>

                <!-- Login Modal -->
                <div class="ws-login-overlay" id="wsLoginOverlay">
                    <div class="ws-login-box">
                        <button class="ws-login-close" onclick="wsHideLogin()">&times;</button>
                        <h3><i class="fas fa-lock" style="color:#06b6d4;margin-right:6px;"></i> Unlock Pro Analysis</h3>
                        <p>Access Water Cost Analysis, Regional Risk Matrix, Sustainability Scorecard, and Monte Carlo Projections.</p>
                        <input type="email" id="wsLoginEmail" placeholder="Email address" autocomplete="email">
                        <input type="password" id="wsLoginPass" placeholder="Password" autocomplete="current-password">
                        <div class="ws-login-error" id="wsLoginError">Invalid credentials. Please try again.</div>
                        <button class="login-submit" onclick="wsDoLogin()">Sign In</button>
                        <div class="demo-hint">Demo: <code>demo@resistancezero.com</code> / <code>demo2026</code></div>
                        <div style="text-align:center;margin-top:6px;"><a href="mailto:bagus@resistancezero.com" style="font-size:0.62rem;color:#64748b;text-decoration:none;">Want full access? Get in touch &rarr;</a></div>
                <p style="text-align:center;font-size:0.68rem;color:#64748b;margin-top:8px;line-height:1.5;">By clicking Login, you agree to our <a href="terms.html" target="_blank" style="color:#8b5cf6;text-decoration:underline;">Terms of Service</a> and <a href="privacy.html" target="_blank" style="color:#8b5cf6;text-decoration:underline;">Privacy Policy</a>.</p>
                    </div>
                </div>

                
                <!-- Independence Disclaimer -->
                <div style="margin:2rem 0 0;padding:1rem 0;border-top:1px solid rgba(255,255,255,0.06);text-align:center;">
                    <p style="font-size:0.72rem;color:#64748b;font-style:italic;line-height:1.6;margin:0;">All content on ResistanceZero is independent personal research derived from publicly available sources. This site does not represent any current or former employer. <a href="terms.html" style="color:#8b5cf6;">Terms &amp; Disclaimer</a></p>
                </div>

<div class="references" id="references">
                    <h3>References & Data Sources</h3>
                    <ol>
                        <li id="ref1">
                            <a href="https://www.spglobal.com/sustainable1/en/insights/special-editorial/beneath-the-surface-water-stress-in-data-centers" target="_blank" rel="noopener">Beneath the Surface: Water Stress in Data Centers</a>
                            <span class="ref-source">S&P Global Sustainable1, 2024 â€” Analysis of 58% water stress statistic</span>
                        </li>
                        <li id="ref2">
                            <a href="https://www.wri.org/aqueduct" target="_blank" rel="noopener">Aqueduct 4.0 Water Risk Atlas</a>
                            <span class="ref-source">World Resources Institute, 2024 â€” Baseline water stress indicator methodology</span>
                        </li>
                        <li id="ref3">
                            <a href="https://planet-tracker.org/will-asian-ai-ambitions-be-constrained-by-water-resources/" target="_blank" rel="noopener">Will Asian AI Ambitions Be Constrained by Water Resources?</a>
                            <span class="ref-source">Planet Tracker, 2024 â€” $30B SEA investment projection</span>
                        </li>
                        <li id="ref4">
                            <a href="https://www.datacenterknowledge.com/data-center-construction/digital-edge-to-develop-500-mw-data-center-campus-in-indonesia" target="_blank" rel="noopener">Digital Edge to Develop 500 MW Data Center Campus in Indonesia</a>
                            <span class="ref-source">Data Center Knowledge, 2024 â€” Bekasi CGK Campus details</span>
                        </li>
                        <li id="ref5">
                            <a href="https://www.datacenters.com/news/jakarta-emerges-as-southeast-asia-s-fastest-growing-data-center-market" target="_blank" rel="noopener">Jakarta Emerges as Southeast Asia's Fastest-Growing Data Center Market</a>
                            <span class="ref-source">DataCenters.com, 2024 â€” Market growth analysis</span>
                        </li>
                        <li id="ref6">
                            <a href="https://www.brookings.edu/articles/ai-data-centers-and-water/" target="_blank" rel="noopener">AI, Data Centers, and Water</a>
                            <span class="ref-source">Brookings Institution, 2024 â€” Water usage effectiveness standards</span>
                        </li>
                        <li id="ref7">
                            <a href="https://undark.org/2025/12/16/ai-data-centers-water/" target="_blank" rel="noopener">How Much Water Do AI Data Centers Really Use?</a>
                            <span class="ref-source">Undark Magazine, Dec 2025 â€” GPU heat generation data</span>
                        </li>
                        <li id="ref8">
                            <a href="https://govinsider.asia/intl-en/article/water-resilient-data-centres-can-drive-asias-digital-economy" target="_blank" rel="noopener">Water Resilient Data Centres Can Drive Asia's Digital Economy</a>
                            <span class="ref-source">GovInsider Asia, 2024 â€” Singapore tropical cooling research</span>
                        </li>
                        <li id="ref9">
                            <a href="https://www.nvidia.com/en-us/data-center/h100/" target="_blank" rel="noopener">NVIDIA H100 Tensor Core GPU Specifications</a>
                            <span class="ref-source">NVIDIA Corporation, 2024 â€” 700W TDP specification</span>
                        </li>
                        <li id="ref10">
                            <a href="https://www.bps.go.id/id/statistics-table/2/MTk4MCMy/jumlah-penduduk-hasil-proyeksi-menurut-provinsi-dan-jenis-kelamin--ribu-jiwa-.html" target="_blank" rel="noopener">Proyeksi Penduduk Indonesia (Population Projection)</a>
                            <span class="ref-source">BPS-Statistics Indonesia, 2023 â€” Bekasi Regency population data</span>
                        </li>
                        <li id="ref11">
                            Rustiadi, E., et al. "Land Use Changes and Urban Sprawl in Bekasi Regency"
                            <span class="ref-source">Indonesian Journal of Geography, Vol. 52, No. 2, 2020 â€” 43% built-up area increase (1990-2018)</span>
                        </li>
                        <li id="ref12">
                            <a href="https://bnpb.go.id/" target="_blank" rel="noopener">BNPB Disaster Database (DIBI)</a>
                            <span class="ref-source">Badan Nasional Penanggulangan Bencana, 2024 â€” Flood event records for Bekasi</span>
                        </li>
                        <li id="ref13">
                            <a href="https://www.upwork.com/resources/data-center-wue" target="_blank" rel="noopener">Understanding Water Usage Effectiveness (WUE)</a>
                            <span class="ref-source">Industry standard: WUE = Annual Water Consumption (L) / IT Energy (kWh)</span>
                        </li>
                    </ol>
                </div>

                <!-- Newsletter Signup -->
                <div class="newsletter-signup">
                    <h3>Stay Updated</h3>
                    <p>Get notified when new articles on data center operations and engineering excellence are published.</p>
                    <form class="newsletter-form" onsubmit="return subscribeNewsletter(event)">
                        <input type="email" placeholder="Enter your email" required>
                        <button type="submit">Subscribe</button>
                    </form>
                    <p class="newsletter-privacy">No spam. Unsubscribe anytime.</p>
                </div>

                <!-- Author Bio -->
                <div class="author-bio">
                    <div class="author-bio-image">
                        <img loading="lazy" src="assets/profile-photo.jpg" alt="Bagus Dwi Permana">
                    </div>
                    <div class="author-bio-content">
                        <h4>Bagus Dwi Permana</h4>
                        <p class="author-bio-title">Engineering Operations Manager | Ahli K3 Listrik</p>
                        <p>12+ years professional experience in critical infrastructure and operations. CDFOM certified. Transforming operations through systematic excellence and safety-first engineering.</p>
                        <div class="author-bio-links">
                            <a href="https://www.linkedin.com/in/bagus-dwi-permana-ba90b092" target="_blank">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                                LinkedIn
                            </a>
                            <a href="https://github.com/baguspermana7-cpu" target="_blank">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
                                GitHub
                            </a>
                            <a href="mailto:baguspermana7@gmail.com">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
                                Email
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Related Articles -->
                <div class="related-articles">
                    <h3>Continue Reading</h3>
                    <div class="related-grid">
                        <a href="article-9.html" class="related-card">
                            <div class="related-card-number">09</div>
                            <div class="related-card-content">
                                <h4>The HVAC Shock: "No Chillers" Doesn't Mean "No Cooling"</h4>
                                <p>Understanding data center cooling evolution</p>
                            </div>
                        </a>
                        <a href="article-11.html" class="related-card">
                            <div class="related-card-number">11</div>
                            <div class="related-card-content">
                                <h4>The Energy Crisis Nobody Predicted</h4>
                                <p>Data center grid impact and energy demand analysis</p>
                            </div>
                        </a>
                        <a href="article-14.html" class="related-card">
                            <div class="related-card-number">14</div>
                            <div class="related-card-content">
                                <h4>The $64 Billion Rebellion: Communities vs Data Centers</h4>
                                <p>Community backlash and environmental concerns</p>
                            </div>
                        </a>
                    </div>
                </div>

                <div class="article-nav">
                    <a href="article-9.html">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7"/>
                        </svg>
                        Previous Article
                    </a>
                    <a href="article-11.html">
                        Next Article
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M5 12h14M12 5l7 7-7 7"/>
                        </svg>
                    </a>
                </div>
            </div>
        </div>
    </article>
    </main>

    <footer class="footer footer-enhanced">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-brand">
                    <p class="footer-tagline-main">BUILT FOR MISSION CRITICAL INFRASTRUCTURE<br>MANAGEMENT // 2026</p>
                    <p class="footer-tagline-sub">ALL OPERATIONAL DATASETS PRESERVED.</p>
                    <p class="footer-copyright">&copy; 2026 Bagus Dwi Permana. All rights reserved.</p>
                </div>
                <div class="footer-nav">
                    <h4 class="footer-heading">NAVIGATION</h4>
                    <ul class="footer-links">
                        <li><a href="index.html">Home Dashboard</a></li>
                        <li><a href="articles.html">Technical Journal</a></li>
                        <li><a href="index.html#case-studies">Case Studies</a></li>
                        <li><a href="datacenter-solutions.html">DC Solutions</a></li>
                    </ul>
                </div>
                <div class="footer-connect">
                    <h4 class="footer-heading">CONNECT</h4>
                    <ul class="footer-links">
                        <li><a href="https://www.linkedin.com/in/bagus-dwi-permana-ba90b092" target="_blank" rel="noopener">LinkedIn Profile</a></li>
                        <li><a href="articles.html">Technical Journal</a></li>
                        <li><a href="mailto:baguspermana7@gmail.com">Direct Contact</a></li>
                        <li><a href="https://github.com/baguspermana7-cpu" target="_blank" rel="noopener">GitHub</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <!-- Share Buttons - Floating Sidebar -->
    <aside class="share-buttons" id="shareButtons" aria-label="Share this article">
        <span class="share-label">Share</span>
        <button class="share-btn linkedin" data-tooltip="Share on LinkedIn" onclick="shareLinkedIn()" aria-label="Share on LinkedIn">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
        </button>
        <button class="share-btn twitter" data-tooltip="Share on X" onclick="shareTwitter()" aria-label="Share on X"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></button>
        <button class="share-btn whatsapp" data-tooltip="Share on WhatsApp" onclick="shareWhatsApp()" aria-label="Share on WhatsApp"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg></button>
        <button class="share-btn copy" data-tooltip="Copy link" onclick="copyLink()" aria-label="Copy article link">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="copy-icon"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="check-icon" style="display:none"><polyline points="20 6 9 17 4 12"></polyline></svg>
        </button>
    </aside>

    <script src="script.min.js"></script>
    <script>
    // Share Buttons Functions
    (function(){const s=document.getElementById('shareButtons'),h=document.querySelector('.article-hero');if(s&&h){document.body.classList.add('has-share-buttons');new IntersectionObserver(e=>e.forEach(x=>s.classList.toggle('visible',!x.isIntersecting)),{threshold:.1}).observe(h)}})();
    function getShareData(){return{title:document.querySelector('meta[property="og:title"]')?.content||document.title,url:window.location.href}}
    function shareLinkedIn(){window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(getShareData().url)}`,'_blank','width=600,height=600')}
    function shareTwitter(){const d=getShareData();window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(d.title+' by @BagusDPermana')}&url=${encodeURIComponent(d.url)}`,'_blank','width=600,height=400')}
    function shareWhatsApp(){const d=getShareData();window.open(`https://wa.me/?text=${encodeURIComponent(d.title+'\n\n'+d.url)}`,'_blank')}
    function copyLink(){const b=document.querySelector('.share-btn.copy'),c=b.querySelector('.copy-icon'),k=b.querySelector('.check-icon');navigator.clipboard.writeText(window.location.href).then(()=>{b.classList.add('copied');c.style.display='none';k.style.display='block';b.setAttribute('data-tooltip','Copied!');setTimeout(()=>{b.classList.remove('copied');c.style.display='block';k.style.display='none';b.setAttribute('data-tooltip','Copy link')},2000)})}

    // PDF Export
    function exportToPDF() {
        alert('PDF export would be implemented with a library like html2pdf.js or server-side generation. For now, use the Print function and save as PDF.');
        window.print();
    }

    // Water Calculator
    (function() {
        const powerSlider = document.getElementById('powerSlider');
        const pueSlider = document.getElementById('pueSlider');
        const wueSlider = document.getElementById('wueSlider');
        const powerVal = document.getElementById('powerVal');
        const pueVal = document.getElementById('pueVal');
        const wueVal = document.getElementById('wueVal');
        const annualWater = document.getElementById('annualWater');
        const dailyWater = document.getElementById('dailyWater');
        const poolsEquiv = document.getElementById('poolsEquiv');
        const householdsEquiv = document.getElementById('householdsEquiv');
        const impactIndicator = document.getElementById('impactIndicator');
        const impactText = document.getElementById('impactText');

        function calculate() {
            const power = parseInt(powerSlider.value);
            const pue = parseInt(pueSlider.value) / 100;
            const wue = parseInt(wueSlider.value) / 100;

            // Update display values
            powerVal.textContent = power + ' MW';
            pueVal.textContent = pue.toFixed(2);
            wueVal.textContent = wue.toFixed(2);

            // Calculate water consumption
            // Annual kWh = MW * 1000 * 8760 hours
            const annualKwh = power * 1000 * 8760;
            const annualLiters = annualKwh * wue; // Liters per year
            const annualMillionLiters = annualLiters / 1000000;
            const dailyLiters = annualLiters / 365;
            const dailyThousandLiters = dailyLiters / 1000;

            // Olympic pool = 2,500,000 liters
            const pools = annualLiters / 2500000;

            // Average household uses ~150,000 liters/year
            const households = annualLiters / 150000;

            // Update results
            annualWater.textContent = annualMillionLiters.toFixed(1);
            dailyWater.textContent = Math.round(dailyThousandLiters);
            poolsEquiv.textContent = pools.toFixed(1);
            householdsEquiv.textContent = Math.round(households).toLocaleString();

            // Update impact indicator
            impactIndicator.className = 'impact-indicator';
            if (wue >= 1.5 || annualMillionLiters > 100) {
                impactIndicator.classList.add('critical');
                impactText.textContent = 'Critical water consumption - immediate optimization required';
            } else if (wue >= 0.8 || annualMillionLiters > 50) {
                impactIndicator.classList.add('warning');
                impactText.textContent = 'High water consumption - consider recycling systems';
            } else {
                impactIndicator.classList.add('good');
                impactText.textContent = 'Water-efficient operation - continue optimizing';
            }
        }

        powerSlider.addEventListener('input', function() { calculate(); if (typeof updateWsProPanels === 'function') updateWsProPanels(); });
        pueSlider.addEventListener('input', function() { calculate(); if (typeof updateWsProPanels === 'function') updateWsProPanels(); });
        wueSlider.addEventListener('input', function() { calculate(); if (typeof updateWsProPanels === 'function') updateWsProPanels(); });

        // Initial calculation
        calculate();
    })();
    </script>

    <!-- Pro Enhancement Mode JS -->
    <script>
    (function() {
        'use strict';

        // ===== Regional Water Data (Enhanced) =====
        const WS_REGIONS = {
            jakarta:     { name: 'Jakarta/Bekasi',  stressLevel: 'Extremely High', stressScore: 4.8, waterPrice: 1.20, riskScore: 92, aquiferDrop: 25, regSeverity: 88, altSource: 15, climateProjection: 5.2, communityIdx: 85, rainfall: 1800 },
            singapore:   { name: 'Singapore',       stressLevel: 'High',           stressScore: 3.8, waterPrice: 2.80, riskScore: 65, aquiferDrop: 0,  regSeverity: 72, altSource: 70, climateProjection: 4.2, communityIdx: 30, rainfall: 2340 },
            johor:       { name: 'Johor Bahru',     stressLevel: 'Low-Medium',     stressScore: 1.5, waterPrice: 0.80, riskScore: 25, aquiferDrop: 3,  regSeverity: 25, altSource: 65, climateProjection: 1.8, communityIdx: 20, rainfall: 2200 },
            hanoi:       { name: 'Hanoi',           stressLevel: 'Medium',         stressScore: 2.2, waterPrice: 0.55, riskScore: 40, aquiferDrop: 8,  regSeverity: 35, altSource: 55, climateProjection: 2.8, communityIdx: 35, rainfall: 1680 },
            danang:      { name: 'Da Nang',         stressLevel: 'Low',            stressScore: 1.0, waterPrice: 0.45, riskScore: 18, aquiferDrop: 2,  regSeverity: 18, altSource: 72, climateProjection: 1.4, communityIdx: 15, rainfall: 2500 },
            bangkok:     { name: 'Bangkok',         stressLevel: 'Medium-High',    stressScore: 2.8, waterPrice: 0.90, riskScore: 55, aquiferDrop: 12, regSeverity: 52, altSource: 40, climateProjection: 3.5, communityIdx: 45, rainfall: 1500 },
            manila:      { name: 'Manila',          stressLevel: 'High',           stressScore: 3.5, waterPrice: 1.10, riskScore: 72, aquiferDrop: 18, regSeverity: 65, altSource: 28, climateProjection: 4.0, communityIdx: 68, rainfall: 1800 },
            kualalumpur: { name: 'Kuala Lumpur',    stressLevel: 'Medium',         stressScore: 2.0, waterPrice: 0.70, riskScore: 35, aquiferDrop: 5,  regSeverity: 30, altSource: 58, climateProjection: 2.3, communityIdx: 25, rainfall: 2400 }
        };

        const WS_ESCALATION = 0.03; // 3% annual water price escalation
        const WS_DISCOUNT_RATE = 0.08; // 8% discount rate for NPV
        const WS_INDUSTRY_AVG_WUE = 1.1; // Industry average WUE L/kWh (Uptime 2023)
        const WS_TARGET_WUE = 0.5; // Best practice target

        var wsProMode = false;

        // ===== Helpers =====
        function getInputs() {
            var power = parseInt(document.getElementById('powerSlider').value);
            var pue = parseInt(document.getElementById('pueSlider').value) / 100;
            var wue = parseInt(document.getElementById('wueSlider').value) / 100;
            var regionKey = document.getElementById('wsRegionSelect').value;
            var region = WS_REGIONS[regionKey];
            var annualKwh = power * 1000 * 8760;
            var annualLiters = annualKwh * wue;
            var annualM3 = annualLiters / 1000;
            var annualML = annualLiters / 1e6;
            return { power: power, pue: pue, wue: wue, regionKey: regionKey, region: region, annualKwh: annualKwh, annualLiters: annualLiters, annualM3: annualM3, annualML: annualML };
        }

        function fmt(n) {
            if (n >= 1e6) return '$' + (n / 1e6).toFixed(1) + 'M';
            if (n >= 1e3) return '$' + Math.round(n / 1e3) + 'K';
            return '$' + Math.round(n);
        }

        function fmtNum(n) {
            if (n >= 1e6) return (n / 1e6).toFixed(1) + 'M';
            if (n >= 1e3) return Math.round(n / 1e3) + 'K';
            return Math.round(n).toString();
        }

        function pctFmt(n) { return n.toFixed(1) + '%'; }

        // ===== Core Calculation Functions =====
        function wsCalcWaterCost(inputs) {
            var annualCost = inputs.annualM3 * inputs.region.waterPrice;
            var costPerMW = annualCost / Math.max(inputs.power, 1);

            // 10-year NPV with escalation and discount rate
            var tco10 = 0;
            var tco10Nominal = 0;
            for (var y = 0; y < 10; y++) {
                var yearCost = annualCost * Math.pow(1 + WS_ESCALATION, y);
                tco10Nominal += yearCost;
                tco10 += yearCost / Math.pow(1 + WS_DISCOUNT_RATE, y);
            }

            // Cooling technology comparison
            var evapCost = annualCost;
            var dlcWue = Math.max(inputs.wue * 0.13, 0); // DLC ~87% reduction
            var dlcM3 = inputs.power * 1000 * 8760 * dlcWue / 1000;
            var dlcCost = dlcM3 * inputs.region.waterPrice;
            var hybridWue = inputs.wue * 0.565; // 50% DLC + 50% evap blend
            var hybridM3 = inputs.power * 1000 * 8760 * hybridWue / 1000;
            var hybridCost = hybridM3 * inputs.region.waterPrice;
            var airCost = 0;
            var dlcSaving = evapCost > 0 ? ((evapCost - dlcCost) / evapCost * 100) : 0;

            // Cost per megaliter
            var costPerML_evap = inputs.annualML > 0 ? (evapCost / inputs.annualML) : 0;
            var costPerML_dlc = (dlcM3 / 1000) > 0 ? (dlcCost / (dlcM3 / 1000)) : 0;
            var costPerML_hybrid = (hybridM3 / 1000) > 0 ? (hybridCost / (hybridM3 / 1000)) : 0;

            // Water procurement risk premium: high-stress regions add surcharge
            var riskPremiumPct = inputs.region.riskScore >= 80 ? 22 : inputs.region.riskScore >= 60 ? 14 : inputs.region.riskScore >= 40 ? 8 : 3;
            var riskPremium = annualCost * riskPremiumPct / 100;

            // Recycling infrastructure ROI (simplified model)
            // Recycling plant CAPEX ~ $300-800K per MW, saves ~40% water
            var recycleCapex = inputs.power * 450000;
            var recycleSaving = annualCost * 0.4;
            var recyclePayback = recycleSaving > 0 ? recycleCapex / recycleSaving : 99;

            // Water-energy nexus: kWh needed to pump/treat per ML
            // ~500-800 kWh/ML for pumping + treatment in SEA
            var waterEnergyNexus = 650 + inputs.region.stressScore * 80;

            return {
                annualCost: annualCost, costPerMW: costPerMW, tco10: tco10, tco10Nominal: tco10Nominal,
                evapCost: evapCost, dlcCost: dlcCost, hybridCost: hybridCost, airCost: airCost, dlcSaving: dlcSaving,
                costPerML_evap: costPerML_evap, costPerML_dlc: costPerML_dlc, costPerML_hybrid: costPerML_hybrid,
                riskPremiumPct: riskPremiumPct, riskPremium: riskPremium,
                recyclePayback: recyclePayback, recycleCapex: recycleCapex, recycleSaving: recycleSaving,
                waterEnergyNexus: waterEnergyNexus,
                dlcM3: dlcM3, hybridM3: hybridM3
            };
        }

        function runWsMonteCarlo(inputs) {
            var results = [];
            var waterVolumes = [];
            var N = 10000;
            for (var i = 0; i < N; i++) {
                var loadVar = inputs.power * (1 + (Math.random() - 0.5) * 0.30);
                var pueVar = inputs.pue * (1 + (Math.random() - 0.5) * 0.20);
                var wueVar = inputs.wue * (1 + (Math.random() - 0.5) * 0.40);
                var priceVar = inputs.region.waterPrice * (1 + (Math.random() - 0.5) * 0.30);
                var m3 = loadVar * 1000 * 8760 * Math.max(wueVar, 0) / 1000;
                var cost = m3 * priceVar;
                results.push(cost);
                waterVolumes.push(m3);
            }
            results.sort(function(a, b) { return a - b; });
            waterVolumes.sort(function(a, b) { return a - b; });
            var sum = results.reduce(function(a, b) { return a + b; }, 0);
            var mean = sum / N;
            var sqDiff = results.reduce(function(a, b) { return a + Math.pow(b - mean, 2); }, 0);
            var std = Math.sqrt(sqDiff / N);

            var p1 = results[Math.floor(N * 0.99)];  // P99 = worst 1%
            var p5 = results[Math.floor(N * 0.05)];
            var p50 = results[Math.floor(N * 0.50)];
            var p95 = results[Math.floor(N * 0.95)];

            // CVaR at 95% (Expected Shortfall): average of worst 5%
            var tail5pct = results.slice(Math.floor(N * 0.95));
            var cvar95 = tail5pct.reduce(function(a, b) { return a + b; }, 0) / tail5pct.length;

            // Probability of exceeding 120% of baseline budget
            var budget = inputs.annualM3 * inputs.region.waterPrice;
            var budgetThreshold = budget * 1.2;
            var exceedCount = results.filter(function(v) { return v > budgetThreshold; }).length;
            var budgetExceedProb = (exceedCount / N * 100);

            // Water crisis probability over 10 years (compound probability)
            // Annual crisis prob based on stress score: high stress = higher chance
            var annualCrisisProb = Math.min(0.35, inputs.region.stressScore / 5 * 0.25 + inputs.region.riskScore / 100 * 0.10);
            var tenYearCrisisProb = 1 - Math.pow(1 - annualCrisisProb, 10);

            // Contingency reserve recommendation (P95 - P50)
            var contingencyReserve = p95 - p50;

            // Confidence interval width
            var confWidth = p95 - p5;
            var confWidthPct = mean > 0 ? (confWidth / mean * 100) : 0;

            return {
                p1: p1, p5: p5, p50: p50, p95: p95,
                mean: mean, std: std, results: results,
                cvar95: cvar95, budgetExceedProb: budgetExceedProb,
                tenYearCrisisProb: tenYearCrisisProb,
                contingencyReserve: contingencyReserve,
                confWidth: confWidth, confWidthPct: confWidthPct,
                waterVolumes: waterVolumes
            };
        }

        function runWsSensitivity(inputs) {
            var base = inputs.annualM3 * inputs.region.waterPrice;
            if (base === 0) base = 1; // prevent division by zero
            // Vary each input by +10% and -10%, report absolute swing
            function calcCost(pwr, wue_val, price) {
                return pwr * 1000 * 8760 * wue_val / 1000 * price;
            }
            var basePrice = inputs.region.waterPrice;
            var basePower = inputs.power;
            var baseWue = inputs.wue;

            var loadUp = calcCost(basePower * 1.1, baseWue, basePrice);
            var loadDown = calcCost(basePower * 0.9, baseWue, basePrice);
            var wueUp = calcCost(basePower, baseWue * 1.1, basePrice);
            var wueDown = calcCost(basePower, baseWue * 0.9, basePrice);
            var priceUp = calcCost(basePower, baseWue, basePrice * 1.1);
            var priceDown = calcCost(basePower, baseWue, basePrice * 0.9);
            // Climate escalation sensitivity: +2% extra escalation over 10 years
            var baseEsc = 0; for (var y = 0; y < 10; y++) baseEsc += base * Math.pow(1.03, y);
            var highEsc = 0; for (var y = 0; y < 10; y++) highEsc += base * Math.pow(1.05, y);
            var escImpact = ((highEsc - baseEsc) / baseEsc * 100);

            var drivers = [
                { name: 'IT Load (+/-10%)', upVal: loadUp, downVal: loadDown, impact: (loadUp - base) / base * 100, baseVal: base, absSwing: loadUp - loadDown },
                { name: 'WUE (+/-10%)', upVal: wueUp, downVal: wueDown, impact: (wueUp - base) / base * 100, baseVal: base, absSwing: wueUp - wueDown },
                { name: 'Water Price (+/-10%)', upVal: priceUp, downVal: priceDown, impact: (priceUp - base) / base * 100, baseVal: base, absSwing: priceUp - priceDown },
                { name: 'Climate Escalation (+2%)', upVal: highEsc, downVal: baseEsc, impact: escImpact, baseVal: baseEsc, absSwing: highEsc - baseEsc }
            ];
            drivers.sort(function(a, b) { return Math.abs(b.absSwing) - Math.abs(a.absSwing); });
            return drivers;
        }

        // ===== Enhanced Sustainability Calculations =====
        function wsCalcSustainability(inputs, costData) {
            var wue = inputs.wue;
            var region = inputs.region;

            var esgScore = wue > 1.5 ? 'D' : wue > 1.0 ? 'C+' : wue > 0.5 ? 'B' : 'A-';
            var cdpGrade = wue > 1.5 ? 'C' : wue > 1.0 ? 'B-' : wue > 0.5 ? 'B+' : 'A';
            var sbtiGap = Math.max(0, Math.round((wue - WS_TARGET_WUE) / 2.0 * 100));
            var regExposure = region.riskScore >= 70 ? 'High' : region.riskScore >= 40 ? 'Medium' : 'Low';
            var recycleRate = wue > 1.5 ? '5%' : wue > 1.0 ? '15%' : wue > 0.5 ? '35%' : '60%';
            var complianceIdx = Math.min(100, Math.round(region.riskScore * 0.5 + sbtiGap * 0.3 + (wue > 1.0 ? 20 : 5)));

            // WUE improvement trajectory
            var wueDelta = wue - WS_TARGET_WUE;
            var wueTrajectoryLabel = wueDelta > 0 ? (wue.toFixed(2) + ' > ' + WS_TARGET_WUE.toFixed(2)) : 'On Target';

            // AWS alignment: based on operational practices implied by WUE and region
            var awsScore = 0;
            if (wue <= 0.5) awsScore += 35;
            else if (wue <= 1.0) awsScore += 20;
            else awsScore += 8;
            if (region.altSource >= 50) awsScore += 25;
            else if (region.altSource >= 30) awsScore += 15;
            else awsScore += 5;
            if (region.riskScore < 40) awsScore += 20;
            else if (region.riskScore < 70) awsScore += 10;
            else awsScore += 3;
            if (parseInt(recycleRate) >= 35) awsScore += 20;
            else if (parseInt(recycleRate) >= 15) awsScore += 10;
            else awsScore += 3;
            var awsLabel = awsScore >= 80 ? 'Gold' : awsScore >= 60 ? 'Silver' : awsScore >= 40 ? 'Bronze' : 'Not Aligned';

            // ESG reporting readiness
            var esgReadiness = 0;
            esgReadiness += wue > 0 ? 15 : 0; // WUE measured
            esgReadiness += 15; // PUE measured (always, it's a slider)
            esgReadiness += parseInt(recycleRate) >= 15 ? 15 : 5;
            esgReadiness += region.riskScore < 60 ? 15 : 8;
            esgReadiness += wue <= 1.0 ? 15 : 5;
            esgReadiness += sbtiGap <= 25 ? 15 : (sbtiGap <= 50 ? 10 : 3);
            esgReadiness = Math.min(100, esgReadiness) + 10; // base disclosure
            esgReadiness = Math.min(100, esgReadiness);

            // Compliance gap analysis
            var critGaps = 0, majorGaps = 0, minorGaps = 0;
            if (wue > 1.5) critGaps++;
            if (region.riskScore >= 80 && wue > 1.0) critGaps++;
            if (sbtiGap > 50) majorGaps++;
            if (wue > WS_TARGET_WUE) majorGaps++;
            if (parseInt(recycleRate) < 15) majorGaps++;
            if (region.regSeverity >= 60 && wue > 0.8) majorGaps++;
            if (wue > 0.3 && wue <= WS_TARGET_WUE) minorGaps++;
            if (parseInt(recycleRate) < 35 && parseInt(recycleRate) >= 15) minorGaps++;
            if (region.communityIdx >= 40) minorGaps++;

            // WUE vs benchmark
            var wuePercentile;
            if (wue <= 0.2) wuePercentile = 'Top 5%';
            else if (wue <= 0.5) wuePercentile = 'Top 15%';
            else if (wue <= 0.8) wuePercentile = 'Top 35%';
            else if (wue <= WS_INDUSTRY_AVG_WUE) wuePercentile = 'Top 50%';
            else if (wue <= 1.5) wuePercentile = 'Bottom 35%';
            else wuePercentile = 'Bottom 15%';

            // Net-zero water gap: ML of water that need offsetting
            var netZeroGap = inputs.annualML; // all consumed water needs offsetting

            return {
                esgScore: esgScore, cdpGrade: cdpGrade, sbtiGap: sbtiGap,
                regExposure: regExposure, recycleRate: recycleRate, complianceIdx: complianceIdx,
                wueTrajectoryLabel: wueTrajectoryLabel, awsLabel: awsLabel,
                esgReadiness: esgReadiness,
                critGaps: critGaps, majorGaps: majorGaps, minorGaps: minorGaps,
                wuePercentile: wuePercentile, netZeroGap: netZeroGap
            };
        }

        // ===== Enhanced Narrative Generator =====
        function generateWsNarrative(inputs, costData, mcData, sensitivity, sustain) {
            var region = inputs.region;
            var paragraphs = [];

            // === Paragraph 1: Executive Summary ===
            var annualML = inputs.annualML;
            var dailyKL = inputs.annualLiters / 365 / 1000;
            var pools = inputs.annualLiters / 2500000;
            var households = Math.round(inputs.annualLiters / 150000);
            var wueVsAvg = inputs.wue > 0 ? ((inputs.wue - WS_INDUSTRY_AVG_WUE) / WS_INDUSTRY_AVG_WUE * 100) : -100;
            var wuePosition = wueVsAvg > 0 ? (pctFmt(Math.abs(wueVsAvg)) + ' above') : (pctFmt(Math.abs(wueVsAvg)) + ' below');

            paragraphs.push('<p><strong>Executive Summary:</strong> A ' + inputs.power + ' MW data center in <strong>' + region.name + '</strong> with WUE ' + inputs.wue.toFixed(2) + ' L/kWh consumes approximately <strong>' + annualML.toFixed(1) + ' megalitres annually</strong> (' + Math.round(dailyKL) + ' KL/day), equivalent to ' + pools.toFixed(1) + ' Olympic swimming pools or the annual domestic usage of <strong>' + households.toLocaleString() + ' households</strong>. At the regional water price of $' + region.waterPrice.toFixed(2) + '/m3, this translates to an annual water expenditure of <strong>' + fmt(costData.annualCost) + '</strong> (' + fmt(costData.costPerMW) + ' per MW). Your WUE of ' + inputs.wue.toFixed(2) + ' is ' + wuePosition + ' the industry average of ' + WS_INDUSTRY_AVG_WUE.toFixed(2) + ' L/kWh, placing your facility in the <strong>' + sustain.wuePercentile + '</strong> among global data center operators.</p>');

            // === Paragraph 2: Regional Water Stress Context ===
            var stressDescriptor;
            if (region.stressScore >= 4) stressDescriptor = 'critically water-stressed';
            else if (region.stressScore >= 3) stressDescriptor = 'significantly water-stressed';
            else if (region.stressScore >= 2) stressDescriptor = 'moderately water-stressed';
            else stressDescriptor = 'relatively water-abundant';

            var riskRankSorted = Object.keys(WS_REGIONS).sort(function(a, b) { return WS_REGIONS[b].riskScore - WS_REGIONS[a].riskScore; });
            var riskRank = riskRankSorted.indexOf(inputs.regionKey) + 1;
            var totalRegions = Object.keys(WS_REGIONS).length;

            var lowestPriceRegion = Object.keys(WS_REGIONS).reduce(function(a, b) { return WS_REGIONS[a].waterPrice < WS_REGIONS[b].waterPrice ? a : b; });
            var lowestPrice = WS_REGIONS[lowestPriceRegion];
            var costDiff = costData.annualCost - (inputs.annualM3 * lowestPrice.waterPrice);

            var climateWarning = '';
            if (region.climateProjection >= 4) {
                climateWarning = ' Climate models project water stress escalating to ' + region.climateProjection.toFixed(1) + '/5 by 2050, representing a <strong>' + Math.round((region.climateProjection / region.stressScore - 1) * 100) + '% deterioration</strong> from current levels.';
            } else if (region.climateProjection > region.stressScore) {
                climateWarning = ' Climate projections indicate stress rising to ' + region.climateProjection.toFixed(1) + '/5 by 2050, a gradual increase that warrants monitoring.';
            }

            paragraphs.push('<p><strong>Regional Water Stress Analysis:</strong> ' + region.name + ' is classified as <strong>' + stressDescriptor + '</strong> with a WRI Aqueduct score of ' + region.stressScore.toFixed(1) + '/5 and a composite risk score of ' + region.riskScore + '/100, ranking <strong>#' + riskRank + ' of ' + totalRegions + ' SEA regions</strong> analyzed. Groundwater aquifer levels are declining at an estimated <strong>' + region.aquiferDrop + ' cm/year</strong>, ' + (region.aquiferDrop >= 15 ? 'a rate that poses serious long-term supply risk.' : region.aquiferDrop >= 8 ? 'a rate requiring active monitoring.' : 'a manageable rate under current conditions.') + ' Regulatory restriction severity is rated at ' + region.regSeverity + '/100' + (region.regSeverity >= 60 ? ' -- new extraction permits may face significant delays or denial.' : '.') + ' Alternative water sources availability scores at ' + region.altSource + '/100' + (region.altSource >= 50 ? ', providing viable fallback options including recycled water and desalination.' : ', limiting contingency options significantly.') + ' Community opposition index stands at ' + region.communityIdx + '/100' + (region.communityIdx >= 60 ? ', indicating substantial social license risk for large-scale water consumption.' : '.') + climateWarning + (costDiff > 0 ? ' Compared to the lowest-cost region (' + lowestPrice.name + ' at $' + lowestPrice.waterPrice.toFixed(2) + '/m3), your location carries an annual water cost premium of <strong>' + fmt(costDiff) + '</strong>.' : '') + '</p>');

            // === Paragraph 3: Sustainability & Compliance ===
            var complianceNarr = '';
            if (sustain.critGaps > 0) {
                complianceNarr = 'Your facility has <strong>' + sustain.critGaps + ' critical compliance gap' + (sustain.critGaps > 1 ? 's' : '') + '</strong>';
            } else if (sustain.majorGaps > 0) {
                complianceNarr = 'No critical gaps were identified, but <strong>' + sustain.majorGaps + ' major gap' + (sustain.majorGaps > 1 ? 's' : '') + '</strong> require attention';
            } else {
                complianceNarr = 'Your compliance posture is strong with only minor gaps identified';
            }

            var recycleNarr = parseInt(sustain.recycleRate) < 15 ? 'The estimated water recycle rate of ' + sustain.recycleRate + ' is well below the 35% threshold recommended by leading frameworks.' : 'Your estimated recycle rate of ' + sustain.recycleRate + ' ' + (parseInt(sustain.recycleRate) >= 35 ? 'meets industry benchmarks.' : 'falls short of the 35% best-practice threshold.');

            paragraphs.push('<p><strong>Sustainability & Compliance Assessment:</strong> ESG water alignment is rated <strong>' + sustain.esgScore + '</strong>, with CDP Water Security at <strong>' + sustain.cdpGrade + '</strong> and ' + (sustain.sbtiGap > 0 ? 'a <strong>' + sustain.sbtiGap + '% gap</strong> to SBTi water targets.' : 'alignment with SBTi water targets.') + ' Your Alliance for Water Stewardship (AWS) certification potential is assessed at <strong>' + sustain.awsLabel + '</strong> level. ' + complianceNarr + ' (total: ' + sustain.critGaps + ' critical / ' + sustain.majorGaps + ' major / ' + sustain.minorGaps + ' minor). ' + recycleNarr + ' ESG reporting readiness stands at <strong>' + sustain.esgReadiness + '%</strong> -- ' + (sustain.esgReadiness >= 80 ? 'your disclosure framework is largely complete.' : sustain.esgReadiness >= 60 ? 'significant progress has been made, but gaps remain in water-specific metrics.' : 'substantial work is needed to meet emerging mandatory disclosure requirements (e.g., EU CSRD, SEC climate rules).') + ' To achieve net-zero water, approximately <strong>' + inputs.annualML.toFixed(1) + ' ML/year</strong> of water offset or restoration would be required.</p>');

            // === Paragraph 4: Monte Carlo Risk Quantification ===
            var confBand = mcData.confWidthPct < 40 ? 'narrow' : mcData.confWidthPct < 70 ? 'moderate' : 'wide';
            var cvs = mcData.std / mcData.mean; // coefficient of variation

            paragraphs.push('<p><strong>Monte Carlo Risk Quantification (10,000 iterations):</strong> The simulation yields a median annual water cost of <strong>' + fmt(mcData.p50) + '</strong> (mean: ' + fmt(mcData.mean) + ') with a 90% confidence interval of <strong>' + fmt(mcData.p5) + ' to ' + fmt(mcData.p95) + '</strong>. This represents a <strong>' + confBand + ' uncertainty band</strong> (spread: ' + pctFmt(mcData.confWidthPct) + ' of mean). The Conditional Value-at-Risk (CVaR) at 95% is <strong>' + fmt(mcData.cvar95) + '</strong>, meaning the average cost in the worst 5% of scenarios reaches this level. There is a <strong>' + pctFmt(mcData.budgetExceedProb) + ' probability</strong> of exceeding 120% of baseline budget in any given year. Over a 10-year horizon, the estimated probability of experiencing at least one water crisis event (supply disruption, rationing, or forced curtailment) is <strong>' + pctFmt(mcData.tenYearCrisisProb * 100) + '</strong>' + (mcData.tenYearCrisisProb > 0.5 ? ' -- this is a near-certain risk that requires active mitigation.' : mcData.tenYearCrisisProb > 0.25 ? ' -- material risk that should be reflected in contingency planning.' : '.') + ' The extreme tail (P99) scenario projects costs reaching <strong>' + fmt(mcData.p1) + '</strong>. Recommended contingency reserve: <strong>' + fmt(mcData.contingencyReserve) + '</strong> (P95 minus P50 delta).</p>');

            // === Paragraph 5: Strategic Recommendations ===
            var recs = [];
            var topDriver = sensitivity[0];

            // Cooling technology recommendation
            if (inputs.wue > WS_TARGET_WUE) {
                var savingAmt = costData.evapCost - costData.dlcCost;
                recs.push('(1) <strong>Transition to advanced cooling:</strong> Direct liquid cooling would reduce water consumption by ~87%, saving ' + fmt(savingAmt) + '/year. A hybrid approach (50% DLC + 50% evap) saves ' + fmt(costData.evapCost - costData.hybridCost) + '/year as an intermediate step.');
            }

            // Recycling recommendation
            if (parseInt(sustain.recycleRate) < 35) {
                recs.push('(2) <strong>Invest in water recycling infrastructure:</strong> CAPEX of ~' + fmt(costData.recycleCapex) + ' yields annual savings of ' + fmt(costData.recycleSaving) + ' with payback in <strong>' + costData.recyclePayback.toFixed(1) + ' years</strong>.');
            }

            // Regional diversification
            if (region.riskScore >= 60) {
                var bestAlt = Object.keys(WS_REGIONS).filter(function(k) { return WS_REGIONS[k].riskScore < 30; });
                var altNames = bestAlt.map(function(k) { return WS_REGIONS[k].name; }).join(', ');
                recs.push('(3) <strong>Regional diversification:</strong> Consider distributing workloads to lower-stress regions (' + altNames + ') for disaster recovery or secondary capacity to reduce aggregate water risk.');
            }

            // Sensitivity-driven recommendation
            recs.push('(' + (recs.length + 1) + ') <strong>Focus on ' + topDriver.name + ':</strong> Sensitivity analysis identifies this as the highest-impact variable on water cost (+' + topDriver.impact.toFixed(1) + '% per 10% increase, absolute swing of ' + fmt(topDriver.absSwing) + '). ' + (topDriver.name.indexOf('WUE') >= 0 ? 'Improving WUE through setpoint optimization, free cooling hours, and leak management delivers the greatest cost reduction per dollar invested.' : topDriver.name.indexOf('Load') >= 0 ? 'IT load optimization through higher utilization, workload consolidation, and temperature setpoint increases will yield the largest water savings.' : 'Negotiating long-term water supply contracts or securing alternative water rights can mitigate price volatility exposure.'));

            // 10-year TCO recommendation
            recs.push('(' + (recs.length + 1) + ') <strong>Long-term cost management:</strong> The 10-year NPV of water costs is <strong>' + fmt(costData.tco10) + '</strong> (nominal: ' + fmt(costData.tco10Nominal) + ') at ' + (WS_ESCALATION * 100) + '% escalation and ' + (WS_DISCOUNT_RATE * 100) + '% discount rate. Locking in water purchase agreements at current rates could save ' + fmt(costData.tco10Nominal - costData.annualCost * 10) + ' versus escalating spot prices over the decade.');

            paragraphs.push('<p><strong>Strategic Recommendations (Prioritized by Impact):</strong> ' + recs.join(' ') + '</p>');

            return paragraphs.join('');
        }

        // ===== Chart Drawing =====
        function drawWaterfallChart(costData) {
            var canvas = document.getElementById('wsWaterfallChart');
            if (!canvas || !canvas.getContext) return;
            var ctx = canvas.getContext('2d');
            var W = canvas.parentElement.clientWidth - 32;
            canvas.width = W;
            canvas.height = 220;
            ctx.clearRect(0, 0, W, 220);

            var items = [
                { label: 'Evaporative', value: costData.evapCost, color: '#ef4444' },
                { label: 'Hybrid (50/50)', value: costData.hybridCost, color: '#f59e0b' },
                { label: 'DLC', value: costData.dlcCost, color: '#06b6d4' },
                { label: 'Air-Cooled', value: costData.airCost, color: '#10b981' }
            ];
            var maxVal = Math.max.apply(null, items.map(function(i) { return i.value; })) || 1;
            var barWidth = Math.min(70, (W - 60) / items.length - 16);
            var chartH = 150;
            var baseY = 195;

            ctx.fillStyle = '#94a3b8';
            ctx.font = '11px Inter, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Annual Water Cost by Cooling Technology', W / 2, 15);

            items.forEach(function(item, i) {
                var x = 40 + i * ((W - 60) / items.length) + ((W - 60) / items.length - barWidth) / 2;
                var barH = maxVal > 0 ? (item.value / maxVal) * chartH : 2;
                if (item.value === 0) barH = 2;
                var y = baseY - barH;

                ctx.fillStyle = item.color;
                ctx.beginPath();
                var r = 4;
                ctx.moveTo(x + r, y);
                ctx.lineTo(x + barWidth - r, y);
                ctx.quadraticCurveTo(x + barWidth, y, x + barWidth, y + r);
                ctx.lineTo(x + barWidth, y + barH);
                ctx.lineTo(x, y + barH);
                ctx.lineTo(x, y + r);
                ctx.quadraticCurveTo(x, y, x + r, y);
                ctx.closePath();
                ctx.fill();

                ctx.fillStyle = '#e2e8f0';
                ctx.font = 'bold 11px Inter, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(fmt(item.value), x + barWidth / 2, y - 6);

                // Savings percentage
                if (i > 0 && costData.evapCost > 0) {
                    var savPct = Math.round((1 - item.value / costData.evapCost) * 100);
                    ctx.fillStyle = '#10b981';
                    ctx.font = '9px Inter, sans-serif';
                    ctx.fillText('-' + savPct + '%', x + barWidth / 2, y - 18);
                }

                ctx.fillStyle = '#64748b';
                ctx.font = '10px Inter, sans-serif';
                ctx.fillText(item.label, x + barWidth / 2, baseY + 14);
            });
        }

        function drawMonteCarloChart(mcData) {
            var canvas = document.getElementById('wsMonteCarloChart');
            if (!canvas || !canvas.getContext) return;
            var ctx = canvas.getContext('2d');
            var W = canvas.parentElement.clientWidth - 32;
            canvas.width = W;
            canvas.height = 200;
            ctx.clearRect(0, 0, W, 200);

            var results = mcData.results;
            var minVal = results[0];
            var maxVal = results[results.length - 1];
            var range = maxVal - minVal || 1;
            var numBins = 40;
            var bins = new Array(numBins).fill(0);
            results.forEach(function(v) {
                var bin = Math.min(Math.floor((v - minVal) / range * numBins), numBins - 1);
                bins[bin]++;
            });
            var maxBin = Math.max.apply(null, bins);
            var chartH = 150;
            var baseY = 175;
            var barW = (W - 60) / numBins;

            ctx.fillStyle = '#94a3b8';
            ctx.font = '11px Inter, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Annual Water Cost Distribution (10,000 Simulations)', W / 2, 15);

            bins.forEach(function(count, i) {
                var x = 30 + i * barW;
                var barH = maxBin > 0 ? (count / maxBin) * chartH : 0;
                var y = baseY - barH;
                var binCenter = minVal + (i + 0.5) * range / numBins;

                if (binCenter <= mcData.p5) ctx.fillStyle = '#10b981';
                else if (binCenter <= mcData.p50) ctx.fillStyle = '#06b6d4';
                else if (binCenter <= mcData.p95) ctx.fillStyle = '#f59e0b';
                else ctx.fillStyle = '#ef4444';

                ctx.fillRect(x, y, Math.max(barW - 1, 1), barH);
            });

            var markers = [
                { val: mcData.p5, label: 'P5 ' + fmt(mcData.p5), color: '#10b981' },
                { val: mcData.p50, label: 'P50 ' + fmt(mcData.p50), color: '#06b6d4' },
                { val: mcData.p95, label: 'P95 ' + fmt(mcData.p95), color: '#ef4444' }
            ];
            markers.forEach(function(m) {
                var xPos = 30 + ((m.val - minVal) / range) * (W - 60);
                ctx.strokeStyle = m.color;
                ctx.lineWidth = 1.5;
                ctx.setLineDash([4, 3]);
                ctx.beginPath();
                ctx.moveTo(xPos, 25);
                ctx.lineTo(xPos, baseY);
                ctx.stroke();
                ctx.setLineDash([]);
                ctx.fillStyle = m.color;
                ctx.font = 'bold 9px Inter, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(m.label, xPos, baseY + 13);
            });
        }

        function drawTornadoChart(sensitivity, baseCost) {
            var canvas = document.getElementById('wsTornadoChart');
            if (!canvas || !canvas.getContext) return;
            var ctx = canvas.getContext('2d');
            var W = canvas.parentElement.clientWidth - 32;
            canvas.width = W;
            canvas.height = 200;
            ctx.clearRect(0, 0, W, 200);

            ctx.fillStyle = '#94a3b8';
            ctx.font = '11px Inter, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Sensitivity Tornado Chart (+/- 10% Input Variation)', W / 2, 15);

            var maxSwing = Math.max.apply(null, sensitivity.map(function(d) { return d.absSwing; })) || 1;
            var barH = 28;
            var gap = 8;
            var startY = 35;
            var centerX = W * 0.55;
            var maxBarW = W * 0.32;
            var labelW = W * 0.22;

            // Baseline reference line
            ctx.strokeStyle = 'rgba(148,163,184,0.3)';
            ctx.lineWidth = 1;
            ctx.setLineDash([3, 3]);
            ctx.beginPath();
            ctx.moveTo(centerX, startY - 5);
            ctx.lineTo(centerX, startY + sensitivity.length * (barH + gap));
            ctx.stroke();
            ctx.setLineDash([]);

            ctx.fillStyle = '#64748b';
            ctx.font = '8px Inter, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Baseline: ' + fmt(baseCost), centerX, startY - 8);

            sensitivity.forEach(function(d, i) {
                var y = startY + i * (barH + gap);
                var upWidth = d.absSwing > 0 ? (((d.upVal - baseCost) / maxSwing) * maxBarW) : 0;
                var downWidth = d.absSwing > 0 ? (((baseCost - d.downVal) / maxSwing) * maxBarW) : 0;

                // Right bar (cost increase) - red/warm
                if (upWidth > 0) {
                    ctx.fillStyle = '#ef4444';
                    ctx.beginPath();
                    var rr = 3;
                    ctx.moveTo(centerX, y);
                    ctx.lineTo(centerX + upWidth - rr, y);
                    ctx.quadraticCurveTo(centerX + upWidth, y, centerX + upWidth, y + rr);
                    ctx.lineTo(centerX + upWidth, y + barH - rr);
                    ctx.quadraticCurveTo(centerX + upWidth, y + barH, centerX + upWidth - rr, y + barH);
                    ctx.lineTo(centerX, y + barH);
                    ctx.closePath();
                    ctx.fill();

                    // Value label on bar
                    ctx.fillStyle = '#fca5a5';
                    ctx.font = 'bold 9px Inter, sans-serif';
                    ctx.textAlign = 'left';
                    ctx.fillText('+' + fmt(d.upVal - baseCost), centerX + upWidth + 4, y + barH / 2 + 3);
                }

                // Left bar (cost decrease) - teal/cool
                if (downWidth > 0) {
                    ctx.fillStyle = '#06b6d4';
                    ctx.beginPath();
                    var rl = 3;
                    ctx.moveTo(centerX, y);
                    ctx.lineTo(centerX - downWidth + rl, y);
                    ctx.quadraticCurveTo(centerX - downWidth, y, centerX - downWidth, y + rl);
                    ctx.lineTo(centerX - downWidth, y + barH - rl);
                    ctx.quadraticCurveTo(centerX - downWidth, y + barH, centerX - downWidth + rl, y + barH);
                    ctx.lineTo(centerX, y + barH);
                    ctx.closePath();
                    ctx.fill();

                    ctx.fillStyle = '#67e8f9';
                    ctx.font = 'bold 9px Inter, sans-serif';
                    ctx.textAlign = 'right';
                    ctx.fillText('-' + fmt(baseCost - d.downVal), centerX - downWidth - 4, y + barH / 2 + 3);
                }

                // Label
                ctx.fillStyle = '#e2e8f0';
                ctx.font = '10px Inter, sans-serif';
                ctx.textAlign = 'right';
                ctx.fillText(d.name, centerX - maxBarW - 12, y + barH / 2 + 3);
            });
        }

        // ===== Panel Update =====
        window.updateWsProPanels = function() {
            var inputs = getInputs();
            var costData = wsCalcWaterCost(inputs);
            var mcData = runWsMonteCarlo(inputs);
            var sensitivity = runWsSensitivity(inputs);
            var sustain = wsCalcSustainability(inputs, costData);
            var region = inputs.region;

            // Panel 1: Water Cost & Financial Impact
            document.getElementById('wsAnnualCost').textContent = fmt(costData.annualCost);
            document.getElementById('wsCostPerMW').textContent = fmt(costData.costPerMW);
            document.getElementById('ws10yrTCO').textContent = fmt(costData.tco10);
            document.getElementById('wsEscalation').textContent = (WS_ESCALATION * 100).toFixed(1) + '%';
            document.getElementById('wsEvapCost').textContent = fmt(costData.evapCost);
            document.getElementById('wsDLCSaving').textContent = '-' + Math.round(costData.dlcSaving) + '%';
            document.getElementById('wsCostPerML').textContent = costData.costPerML_evap > 0 ? (fmt(costData.costPerML_evap)) : '$0';
            document.getElementById('wsRiskPremium').textContent = '+' + costData.riskPremiumPct + '%';
            document.getElementById('wsRecycleROI').textContent = costData.recyclePayback < 90 ? costData.recyclePayback.toFixed(1) + 'yr' : 'N/A';
            document.getElementById('wsWaterEnergyNexus').textContent = Math.round(costData.waterEnergyNexus);
            document.getElementById('wsDLCAnnual').textContent = fmt(costData.dlcCost);
            document.getElementById('wsHybridCost').textContent = fmt(costData.hybridCost);

            // Panel 2: Regional Risk Matrix
            document.getElementById('wsRegionStress').textContent = region.stressScore.toFixed(1) + '/5';
            document.getElementById('wsRegionRisk').textContent = region.riskScore;
            document.getElementById('wsRegionPrice').textContent = '$' + region.waterPrice.toFixed(2);
            document.getElementById('wsRegionLevel').textContent = region.stressLevel;
            document.getElementById('wsRegionAnnualCost').textContent = fmt(costData.annualCost);

            var sorted = Object.keys(WS_REGIONS).sort(function(a, b) { return WS_REGIONS[b].riskScore - WS_REGIONS[a].riskScore; });
            var rank = sorted.indexOf(inputs.regionKey) + 1;
            document.getElementById('wsRegionRank').textContent = '#' + rank;

            document.getElementById('wsAquiferRate').textContent = region.aquiferDrop + ' cm/yr';
            document.getElementById('wsRegSeverity').textContent = region.regSeverity + '/100';
            document.getElementById('wsAltWaterSource').textContent = region.altSource + '/100';
            document.getElementById('wsClimateImpact').textContent = region.climateProjection.toFixed(1) + '/5';
            document.getElementById('wsCommunityIdx').textContent = region.communityIdx + '/100';

            var lowestPriceKey = Object.keys(WS_REGIONS).reduce(function(a, b) { return WS_REGIONS[a].waterPrice < WS_REGIONS[b].waterPrice ? a : b; });
            var costVsLowest = region.waterPrice > 0 ? Math.round((region.waterPrice / WS_REGIONS[lowestPriceKey].waterPrice - 1) * 100) : 0;
            document.getElementById('wsCostVsLowest').textContent = costVsLowest > 0 ? '+' + costVsLowest + '%' : 'Lowest';

            // Score bars
            var stressBar = document.getElementById('wsStressBar');
            var riskBar = document.getElementById('wsRiskBar');
            stressBar.style.width = (region.stressScore / 5 * 100) + '%';
            riskBar.style.width = region.riskScore + '%';
            stressBar.className = 'ws-score-bar-fill ' + (region.stressScore >= 3.5 ? 'risk-high' : region.stressScore >= 2 ? 'risk-med' : 'risk-low');
            riskBar.className = 'ws-score-bar-fill ' + (region.riskScore >= 60 ? 'risk-high' : region.riskScore >= 30 ? 'risk-med' : 'risk-low');

            // Panel 3: Sustainability Compliance
            document.getElementById('wsESGScore').textContent = sustain.esgScore;
            document.getElementById('wsCDPGrade').textContent = sustain.cdpGrade;
            document.getElementById('wsSBTiGap').textContent = sustain.sbtiGap + '%';
            document.getElementById('wsRegExposure').textContent = sustain.regExposure;
            document.getElementById('wsRecycleRate').textContent = sustain.recycleRate;
            document.getElementById('wsComplianceRisk').textContent = sustain.complianceIdx + '/100';
            document.getElementById('wsWueTrajectory').textContent = sustain.wueTrajectoryLabel;
            document.getElementById('wsAWSAlign').textContent = sustain.awsLabel;
            document.getElementById('wsESGReadiness').textContent = sustain.esgReadiness + '%';
            document.getElementById('wsCompGapCount').textContent = sustain.critGaps + ' / ' + sustain.majorGaps + ' / ' + sustain.minorGaps;
            document.getElementById('wsWueVsBenchmark').textContent = sustain.wuePercentile;
            document.getElementById('wsNetZeroWater').textContent = sustain.netZeroGap.toFixed(1) + ' ML';

            // Panel 4: Monte Carlo
            document.getElementById('wsMCP1').textContent = fmt(mcData.p1);
            document.getElementById('wsMCP5').textContent = fmt(mcData.p5);
            document.getElementById('wsMCP50').textContent = fmt(mcData.p50);
            document.getElementById('wsMCP95').textContent = fmt(mcData.p95);
            document.getElementById('wsMCMean').textContent = fmt(mcData.mean);
            document.getElementById('wsMCStd').textContent = fmt(mcData.std);
            document.getElementById('wsMCCVaR95').textContent = fmt(mcData.cvar95);
            document.getElementById('wsMCBudgetExceed').textContent = pctFmt(mcData.budgetExceedProb);
            document.getElementById('wsMCCrisisProb').textContent = pctFmt(mcData.tenYearCrisisProb * 100);
            document.getElementById('wsMCContingency').textContent = fmt(mcData.contingencyReserve);
            document.getElementById('wsMCTopDriver').textContent = sensitivity[0].name.split(' ')[0];
            document.getElementById('wsMCConfWidth').textContent = pctFmt(mcData.confWidthPct);

            // Panel 5: Narrative
            var baseCost = inputs.annualM3 * inputs.region.waterPrice;
            document.getElementById('wsNarrativeText').innerHTML = generateWsNarrative(inputs, costData, mcData, sensitivity, sustain);

            // Draw charts if unlocked
            if (wsProMode) {
                drawWaterfallChart(costData);
                drawMonteCarloChart(mcData);
                drawTornadoChart(sensitivity, baseCost);
            }
        };

        // ===== Auth =====
        function wsCheckAuth() {
            try {
                var s = JSON.parse(localStorage.getItem('rz_premium_session') || 'null');
                if (s && s.tier === 'pro' && new Date(s.expires) > new Date()) return true;
            } catch (e) {}
            return false;
        }

        function wsUnlockPanels() {
            wsProMode = true;
            document.querySelectorAll('.ws-pro-panel').forEach(function(p) {
                p.classList.remove('gated');
                var overlay = p.querySelector('.ws-gate-overlay');
                if (overlay) overlay.style.display = 'none';
            });
            document.getElementById('wsProBtn').classList.add('active');
            document.getElementById('wsFreeBtn').classList.remove('active');
            updateWsProPanels();
        }

        function wsLockPanels() {
            wsProMode = false;
            document.querySelectorAll('.ws-pro-panel').forEach(function(p) {
                p.classList.add('gated');
                var overlay = p.querySelector('.ws-gate-overlay');
                if (overlay) overlay.style.display = '';
            });
            document.getElementById('wsFreeBtn').classList.add('active');
            document.getElementById('wsProBtn').classList.remove('active');
        }

        window.wsSetMode = function(mode) {
            if (mode === 'pro') {
                if (wsCheckAuth()) { wsUnlockPanels(); }
                else { wsShowLogin(); }
            } else {
                wsLockPanels();
            }
        };

        window.wsShowLogin = function() {
            document.getElementById('wsLoginOverlay').classList.add('active');
            document.getElementById('wsLoginError').style.display = 'none';
            document.getElementById('wsLoginEmail').value = '';
            document.getElementById('wsLoginPass').value = '';
            setTimeout(function() { document.getElementById('wsLoginEmail').focus(); }, 100);
        };

        window.wsHideLogin = function() {
            document.getElementById('wsLoginOverlay').classList.remove('active');
        };

        window.wsDoLogin = function() {
            var email = document.getElementById('wsLoginEmail').value.trim().toLowerCase();
            var pass = document.getElementById('wsLoginPass').value;
            if (email === 'demo@resistancezero.com' && pass === 'demo2026') {
                var session = { email: email, tier: 'pro', expires: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString() };
                localStorage.setItem('rz_premium_session', JSON.stringify(session));
                window.dispatchEvent(new Event('rz-auth-change'));
                wsHideLogin();
                wsUnlockPanels();
            } else {
                document.getElementById('wsLoginError').style.display = 'block';
            }
        };

        // Enter key in login
        document.getElementById('wsLoginPass').addEventListener('keydown', function(e) {
            if (e.key === 'Enter') wsDoLogin();
        });
        document.getElementById('wsLoginEmail').addEventListener('keydown', function(e) {
            if (e.key === 'Enter') document.getElementById('wsLoginPass').focus();
        });

        // Close on overlay click
        document.getElementById('wsLoginOverlay').addEventListener('click', function(e) {
            if (e.target === this) wsHideLogin();
        });

        // Listen for auth changes
        window.addEventListener('rz-auth-change', function() {
            if (wsCheckAuth()) wsUnlockPanels();
            else wsLockPanels();
        });

        // ===== Reset =====
        window.wsResetDefaults = function() {
            document.getElementById('powerSlider').value = 10;
            document.getElementById('pueSlider').value = 140;
            document.getElementById('wueSlider').value = 150;
            document.getElementById('wsRegionSelect').value = 'jakarta';
            // Trigger recalculation
            document.getElementById('powerSlider').dispatchEvent(new Event('input'));
        };

        // ===== PDF Export =====
        window.wsExportPDF = function() {
            if (!wsCheckAuth()) { wsShowLogin(); return; }
            var w = window.open('', '_blank');
            if (!w) { alert('Please allow pop-ups for this site to export PDF.'); return; }
            w.document.write('<p style="font-family:sans-serif;text-align:center;margin-top:40vh;">Generating report...</p>');
            var inputs = getInputs();
            var costData = wsCalcWaterCost(inputs);
            var mcData = runWsMonteCarlo(inputs);
            var sensitivity = runWsSensitivity(inputs);
            var sustain = wsCalcSustainability(inputs, costData);
            var narrative = generateWsNarrative(inputs, costData, mcData, sensitivity, sustain);

            // Build SVG chart for waterfall
            function buildWaterfallSVG() {
                var items = [
                    { label: 'Evaporative', value: costData.evapCost, color: '#ef4444' },
                    { label: 'Hybrid', value: costData.hybridCost, color: '#f59e0b' },
                    { label: 'DLC', value: costData.dlcCost, color: '#0891b2' },
                    { label: 'Air-Cooled', value: costData.airCost, color: '#10b981' }
                ];
                var maxVal = Math.max.apply(null, items.map(function(i) { return i.value; })) || 1;
                var svgW = 520, svgH = 220, barW = 70, gap = 30;
                var startX = (svgW - (items.length * (barW + gap) - gap)) / 2;
                var svg = '<svg xmlns="http://www.w3.org/2000/svg" width="' + svgW + '" height="' + svgH + '" viewBox="0 0 ' + svgW + ' ' + svgH + '">';
                svg += '<rect width="' + svgW + '" height="' + svgH + '" fill="#f8fafc"/>';
                svg += '<text x="' + (svgW/2) + '" y="20" text-anchor="middle" fill="#1f2937" font-family="Inter,sans-serif" font-size="12" font-weight="bold">Annual Water Cost by Cooling Technology</text>';
                items.forEach(function(item, i) {
                    var x = startX + i * (barW + gap);
                    var barH = maxVal > 0 ? (item.value / maxVal) * 140 : 2;
                    if (item.value === 0) barH = 2;
                    var y = 180 - barH;
                    svg += '<rect x="' + x + '" y="' + y + '" width="' + barW + '" height="' + barH + '" fill="' + item.color + '" rx="4"/>';
                    svg += '<text x="' + (x + barW/2) + '" y="' + (y - 6) + '" text-anchor="middle" fill="#1f2937" font-family="Inter,sans-serif" font-size="11" font-weight="bold">' + fmt(item.value) + '</text>';
                    if (i > 0 && costData.evapCost > 0) {
                        var savPct = Math.round((1 - item.value / costData.evapCost) * 100);
                        svg += '<text x="' + (x + barW/2) + '" y="' + (y - 18) + '" text-anchor="middle" fill="#059669" font-family="Inter,sans-serif" font-size="9">-' + savPct + '%</text>';
                    }
                    svg += '<text x="' + (x + barW/2) + '" y="198" text-anchor="middle" fill="#64748b" font-family="Inter,sans-serif" font-size="10">' + item.label + '</text>';
                });
                svg += '</svg>';
                return svg;
            }

            // Build SVG histogram
            function buildHistogramSVG() {
                var results = mcData.results;
                var minV = results[0], maxV = results[results.length - 1], range = maxV - minV || 1;
                var numBins = 40, bins = new Array(numBins).fill(0);
                results.forEach(function(v) { var b = Math.min(Math.floor((v - minV) / range * numBins), numBins - 1); bins[b]++; });
                var maxBin = Math.max.apply(null, bins);
                var svgW = 520, svgH = 200, barW = (svgW - 60) / numBins;
                var svg = '<svg xmlns="http://www.w3.org/2000/svg" width="' + svgW + '" height="' + svgH + '" viewBox="0 0 ' + svgW + ' ' + svgH + '">';
                svg += '<rect width="' + svgW + '" height="' + svgH + '" fill="#f8fafc"/>';
                svg += '<text x="' + (svgW/2) + '" y="18" text-anchor="middle" fill="#1f2937" font-family="Inter,sans-serif" font-size="12" font-weight="bold">Monte Carlo Distribution (10K Simulations)</text>';
                bins.forEach(function(c, i) {
                    var x = 30 + i * barW;
                    var barH = maxBin > 0 ? (c / maxBin) * 140 : 0;
                    var y = 170 - barH;
                    var binCenter = minV + (i + 0.5) * range / numBins;
                    var color = binCenter <= mcData.p5 ? '#10b981' : binCenter <= mcData.p50 ? '#0891b2' : binCenter <= mcData.p95 ? '#f59e0b' : '#ef4444';
                    svg += '<rect x="' + x + '" y="' + y + '" width="' + Math.max(barW - 0.5, 0.5) + '" height="' + barH + '" fill="' + color + '"/>';
                });
                [{ v: mcData.p5, l: 'P5 ' + fmt(mcData.p5), c: '#10b981' }, { v: mcData.p50, l: 'P50 ' + fmt(mcData.p50), c: '#0891b2' }, { v: mcData.p95, l: 'P95 ' + fmt(mcData.p95), c: '#ef4444' }].forEach(function(m) {
                    var xp = 30 + ((m.v - minV) / range) * (svgW - 60);
                    svg += '<line x1="' + xp + '" y1="28" x2="' + xp + '" y2="170" stroke="' + m.c + '" stroke-width="1.5" stroke-dasharray="4,3"/>';
                    svg += '<text x="' + xp + '" y="185" text-anchor="middle" fill="' + m.c + '" font-family="Inter,sans-serif" font-size="9" font-weight="bold">' + m.l + '</text>';
                });
                svg += '</svg>';
                return svg;
            }

            // Build SVG tornado
            function buildTornadoSVG() {
                var svgW = 520, svgH = 180;
                var maxSwing = Math.max.apply(null, sensitivity.map(function(d) { return d.absSwing; })) || 1;
                var barH = 28, gap = 8, startY = 35;
                var centerX = svgW * 0.55, maxBarW = svgW * 0.30;
                var baseCost = inputs.annualM3 * inputs.region.waterPrice;
                var svg = '<svg xmlns="http://www.w3.org/2000/svg" width="' + svgW + '" height="' + svgH + '" viewBox="0 0 ' + svgW + ' ' + svgH + '">';
                svg += '<rect width="' + svgW + '" height="' + svgH + '" fill="#f8fafc"/>';
                svg += '<text x="' + (svgW/2) + '" y="18" text-anchor="middle" fill="#1f2937" font-family="Inter,sans-serif" font-size="12" font-weight="bold">Sensitivity Tornado Chart</text>';
                svg += '<line x1="' + centerX + '" y1="' + (startY - 5) + '" x2="' + centerX + '" y2="' + (startY + sensitivity.length * (barH + gap)) + '" stroke="#94a3b8" stroke-width="1" stroke-dasharray="3,3"/>';
                svg += '<text x="' + centerX + '" y="' + (startY - 8) + '" text-anchor="middle" fill="#64748b" font-family="Inter,sans-serif" font-size="8">Baseline: ' + fmt(baseCost) + '</text>';
                sensitivity.forEach(function(d, i) {
                    var y = startY + i * (barH + gap);
                    var upW = d.absSwing > 0 ? (((d.upVal - baseCost) / maxSwing) * maxBarW) : 0;
                    var dnW = d.absSwing > 0 ? (((baseCost - d.downVal) / maxSwing) * maxBarW) : 0;
                    if (upW > 0) {
                        svg += '<rect x="' + centerX + '" y="' + y + '" width="' + upW + '" height="' + barH + '" fill="#ef4444" rx="3"/>';
                        svg += '<text x="' + (centerX + upW + 4) + '" y="' + (y + barH / 2 + 4) + '" fill="#dc2626" font-family="Inter,sans-serif" font-size="9" font-weight="bold">+' + fmt(d.upVal - baseCost) + '</text>';
                    }
                    if (dnW > 0) {
                        svg += '<rect x="' + (centerX - dnW) + '" y="' + y + '" width="' + dnW + '" height="' + barH + '" fill="#0891b2" rx="3"/>';
                        svg += '<text x="' + (centerX - dnW - 4) + '" y="' + (y + barH / 2 + 4) + '" text-anchor="end" fill="#0891b2" font-family="Inter,sans-serif" font-size="9" font-weight="bold">-' + fmt(baseCost - d.downVal) + '</text>';
                    }
                    svg += '<text x="' + (centerX - maxBarW - 12) + '" y="' + (y + barH / 2 + 4) + '" text-anchor="end" fill="#1f2937" font-family="Inter,sans-serif" font-size="10">' + d.name + '</text>';
                });
                svg += '</svg>';
                return svg;
            }

            var region = inputs.region;

            var html = '<!DOCTYPE html><html><head><meta charset="UTF-8">';
            html += '<title>Water Stress Pro Report - ' + region.name + '</title>';
            html += '<style>';
            html += 'body { font-family: Inter, Helvetica, Arial, sans-serif; color: #1f2937; max-width: 800px; margin: 0 auto; padding: 40px 30px; font-size: 11pt; line-height: 1.6; }';
            html += 'h1 { color: #1e3a5f; font-size: 22pt; margin-bottom: 4px; border-bottom: 3px solid #0891b2; padding-bottom: 8px; }';
            html += 'h2 { color: #1e3a5f; font-size: 14pt; margin-top: 28px; margin-bottom: 10px; border-bottom: 1px solid #e5e7eb; padding-bottom: 4px; }';
            html += 'h3 { color: #1e3a5f; font-size: 12pt; margin-top: 20px; }';
            html += '.subtitle { color: #64748b; font-size: 10pt; margin-bottom: 20px; }';
            html += '.meta { display: flex; gap: 20px; font-size: 9pt; color: #64748b; margin-bottom: 24px; flex-wrap: wrap; }';
            html += '.meta span { background: #f1f5f9; padding: 3px 10px; border-radius: 4px; }';
            html += 'table { width: 100%; border-collapse: collapse; margin: 12px 0; font-size: 10pt; }';
            html += 'th { background: #f1f5f9; color: #1e3a5f; padding: 8px 10px; text-align: left; font-weight: 600; border-bottom: 2px solid #e5e7eb; }';
            html += 'td { padding: 7px 10px; border-bottom: 1px solid #e5e7eb; color: #1f2937; }';
            html += '.kpi-row { display: flex; flex-wrap: wrap; gap: 8px; margin: 10px 0; }';
            html += '.kpi-item { flex: 1; min-width: 100px; background: #f8fafc; border: 1px solid #e5e7eb; border-radius: 8px; padding: 10px; text-align: center; }';
            html += '.kpi-val { font-size: 14pt; font-weight: 800; color: #0891b2; }';
            html += '.kpi-lbl { font-size: 7.5pt; color: #64748b; margin-top: 2px; }';
            html += '.kpi-sub { font-size: 7pt; color: #94a3b8; }';
            html += '.narrative { background: #f0f9ff; border-left: 3px solid #0891b2; padding: 12px 16px; margin: 14px 0; border-radius: 0 8px 8px 0; }';
            html += '.narrative p { color: #1f2937; font-size: 9.5pt; margin: 0 0 8px; line-height: 1.6; }';
            html += '.narrative p:last-child { margin-bottom: 0; }';
            html += '.narrative strong { color: #0e4f63; }';
            html += '.chart-wrap { text-align: center; margin: 16px 0; }';
            html += '.methodology { background: #f8fafc; padding: 12px 16px; border-radius: 8px; margin-top: 24px; font-size: 9pt; color: #64748b; }';
            html += '.methodology h3 { color: #1e3a5f; margin-top: 0; }';
            html += '.footer { margin-top: 30px; padding-top: 12px; border-top: 1px solid #e5e7eb; font-size: 8pt; color: #94a3b8; text-align: center; }';
            html += '@media print { body { padding: 20px; } }';
            html += '</style></head><body>';

            html += '<h1>Water Stress Analysis Report</h1>';
            html += '<p class="subtitle">Data Center Water Consumption & Risk Assessment - ' + region.name + '</p>';
            html += '<div class="meta">';
            html += '<span>Region: ' + region.name + '</span>';
            html += '<span>IT Load: ' + inputs.power + ' MW</span>';
            html += '<span>PUE: ' + inputs.pue.toFixed(2) + '</span>';
            html += '<span>WUE: ' + inputs.wue.toFixed(2) + ' L/kWh</span>';
            html += '<span>Annual Water: ' + inputs.annualML.toFixed(1) + ' ML</span>';
            html += '<span>Generated: ' + new Date().toLocaleDateString() + '</span>';
            html += '</div>';

            // Section 1: Water Cost & Financial Impact
            html += '<h2>1. Water Cost & Financial Impact</h2>';
            html += '<div class="kpi-row">';
            html += '<div class="kpi-item"><div class="kpi-val">' + fmt(costData.annualCost) + '</div><div class="kpi-lbl">Annual Water Cost</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + fmt(costData.costPerMW) + '</div><div class="kpi-lbl">Cost per MW</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + fmt(costData.tco10) + '</div><div class="kpi-lbl">10-Year NPV</div><div class="kpi-sub">@8% discount</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">+' + costData.riskPremiumPct + '%</div><div class="kpi-lbl">Risk Premium</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + costData.recyclePayback.toFixed(1) + 'yr</div><div class="kpi-lbl">Recycle ROI</div></div>';
            html += '</div>';
            html += '<table><tr><th>Cooling Type</th><th>Annual Cost</th><th>vs Evaporative</th><th>Cost/ML</th></tr>';
            html += '<tr><td>Evaporative Cooling</td><td>' + fmt(costData.evapCost) + '</td><td>Baseline</td><td>' + fmt(costData.costPerML_evap) + '</td></tr>';
            html += '<tr><td>Hybrid (50% DLC + 50% Evap)</td><td>' + fmt(costData.hybridCost) + '</td><td>-' + Math.round((1 - costData.hybridCost / Math.max(costData.evapCost, 1)) * 100) + '%</td><td>' + fmt(costData.costPerML_hybrid) + '</td></tr>';
            html += '<tr><td>Direct Liquid Cooling</td><td>' + fmt(costData.dlcCost) + '</td><td>-' + Math.round(costData.dlcSaving) + '%</td><td>' + fmt(costData.costPerML_dlc) + '</td></tr>';
            html += '<tr><td>Air-Cooled</td><td>' + fmt(costData.airCost) + '</td><td>-100%</td><td>$0</td></tr></table>';
            html += '<div class="chart-wrap">' + buildWaterfallSVG() + '</div>';

            // Section 2: Regional Risk Matrix
            html += '<h2>2. Regional Water Risk Matrix</h2>';
            html += '<table><tr><th>Region</th><th>Stress</th><th>Risk</th><th>Price</th><th>Aquifer</th><th>Reg. Severity</th><th>Climate 2050</th></tr>';
            Object.keys(WS_REGIONS).forEach(function(k) {
                var r = WS_REGIONS[k];
                var highlight = k === inputs.regionKey ? ' style="background:#f0f9ff;font-weight:600;"' : '';
                html += '<tr' + highlight + '><td>' + r.name + '</td><td>' + r.stressScore + '/5</td><td>' + r.riskScore + '</td><td>$' + r.waterPrice.toFixed(2) + '</td><td>' + r.aquiferDrop + 'cm/yr</td><td>' + r.regSeverity + '/100</td><td>' + r.climateProjection + '/5</td></tr>';
            });
            html += '</table>';

            // Section 3: Sustainability Compliance
            html += '<h2>3. Sustainability Compliance Scorecard</h2>';
            html += '<div class="kpi-row">';
            html += '<div class="kpi-item"><div class="kpi-val">' + sustain.esgScore + '</div><div class="kpi-lbl">ESG Alignment</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + sustain.cdpGrade + '</div><div class="kpi-lbl">CDP Water</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + sustain.sbtiGap + '%</div><div class="kpi-lbl">SBTi Gap</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + sustain.awsLabel + '</div><div class="kpi-lbl">AWS Alignment</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + sustain.esgReadiness + '%</div><div class="kpi-lbl">ESG Readiness</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + sustain.wuePercentile + '</div><div class="kpi-lbl">WUE Ranking</div></div>';
            html += '</div>';
            html += '<table><tr><th>Metric</th><th>Status</th><th>Assessment</th></tr>';
            html += '<tr><td>Regulatory Exposure</td><td>' + sustain.regExposure + '</td><td>' + (sustain.regExposure === 'High' ? 'Immediate risk of permit restrictions' : sustain.regExposure === 'Medium' ? 'Monitoring required' : 'Low regulatory pressure') + '</td></tr>';
            html += '<tr><td>Water Recycle Rate</td><td>' + sustain.recycleRate + '</td><td>' + (parseInt(sustain.recycleRate) < 15 ? 'Below industry standard' : parseInt(sustain.recycleRate) < 35 ? 'Approaching best practice' : 'Strong performance') + '</td></tr>';
            html += '<tr><td>Compliance Gaps</td><td>' + sustain.critGaps + 'C / ' + sustain.majorGaps + 'M / ' + sustain.minorGaps + 'm</td><td>' + (sustain.critGaps > 0 ? 'Critical gaps require immediate action' : sustain.majorGaps > 0 ? 'Major gaps need resolution' : 'Compliance posture is strong') + '</td></tr>';
            html += '<tr><td>Net-Zero Water Gap</td><td>' + sustain.netZeroGap.toFixed(1) + ' ML/yr</td><td>Total water offset required for net-zero</td></tr>';
            html += '</table>';

            // Section 4: Monte Carlo
            html += '<h2>4. Monte Carlo Risk Analysis (10,000 Iterations)</h2>';
            html += '<div class="kpi-row">';
            html += '<div class="kpi-item"><div class="kpi-val">' + fmt(mcData.p1) + '</div><div class="kpi-lbl">P99 Extreme</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + fmt(mcData.p5) + '</div><div class="kpi-lbl">P5 Best</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + fmt(mcData.p50) + '</div><div class="kpi-lbl">P50 Median</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + fmt(mcData.p95) + '</div><div class="kpi-lbl">P95 Worst</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + fmt(mcData.cvar95) + '</div><div class="kpi-lbl">CVaR 95%</div></div>';
            html += '</div>';
            html += '<div class="kpi-row">';
            html += '<div class="kpi-item"><div class="kpi-val">' + pctFmt(mcData.budgetExceedProb) + '</div><div class="kpi-lbl">Budget Exceedance</div><div class="kpi-sub">P(>120% budget)</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + pctFmt(mcData.tenYearCrisisProb * 100) + '</div><div class="kpi-lbl">10-Yr Crisis Prob</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + fmt(mcData.contingencyReserve) + '</div><div class="kpi-lbl">Contingency Reserve</div></div>';
            html += '<div class="kpi-item"><div class="kpi-val">' + pctFmt(mcData.confWidthPct) + '</div><div class="kpi-lbl">90% Conf Width</div></div>';
            html += '</div>';
            html += '<div class="chart-wrap">' + buildHistogramSVG() + '</div>';

            // Sensitivity Tornado
            html += '<h3>Sensitivity Analysis</h3>';
            html += '<div class="chart-wrap">' + buildTornadoSVG() + '</div>';
            html += '<table><tr><th>Variable</th><th>Impact (+10%)</th><th>Absolute Swing (+/- 10%)</th></tr>';
            sensitivity.forEach(function(d) { html += '<tr><td>' + d.name + '</td><td>+' + d.impact.toFixed(1) + '%</td><td>' + fmt(d.absSwing) + '</td></tr>'; });
            html += '</table>';

            // Narrative
            html += '<h2>5. Comprehensive Assessment</h2>';
            html += '<div class="narrative">' + narrative + '</div>';

            // Methodology
            html += '<div class="methodology">';
            html += '<h3>Methodology Note</h3>';
            html += '<p>Water consumption: Annual Water (L) = IT Load (kW) x 8,760 hrs x WUE (L/kWh). Water cost from regional pricing ($/m\u00B3). 10-year NPV uses ' + (WS_ESCALATION * 100) + '% annual escalation and ' + (WS_DISCOUNT_RATE * 100) + '% discount rate. Monte Carlo: 10,000 iterations with IT Load \u00B115%, PUE \u00B110%, WUE \u00B120%, Water Price \u00B115%. CVaR (Expected Shortfall) = average of worst 5% outcomes. Water crisis probability uses compound annual model based on WRI stress scores. Regional data from WRI Aqueduct 4.0, industry reports, and government statistics. Sustainability metrics aligned with CDP Water Security, SBTi FLAG guidance, and Alliance for Water Stewardship (AWS) framework. All calculations performed client-side; no data transmitted.</p>';
            html += '</div>';

            html += '<div class="footer">Generated by ResistanceZero Water Stress Calculator | resistancezero.com | ' + new Date().toISOString().split('T')[0] + '</div>';
        html+='
<!-- â•â•â• Feature 22: Reading Progress Bar â•â•â• -->
<script>
(function() {
    var bar = document.getElementById('scrollProgress');
    if (!bar) return;
    var ticking = false;
    function updateProgress() {
        var scrollTop = window.scrollY || document.documentElement.scrollTop;
        var docHeight = document.documentElement.scrollHeight - window.innerHeight;
        var pct = docHeight > 0 ? (scrollTop / docHeight) * 100 : 0;
        bar.style.width = Math.min(pct, 100) + '%';
        ticking = false;
    }
    window.addEventListener('scroll', function() {
        if (!ticking) { requestAnimationFrame(updateProgress); ticking = true; }
    }, { passive: true });
    updateProgress();
})();
</script>

<!-- â•â•â• Feature 23: TOC Sidebar â•â•â• -->
<script>
(function() {
    // Find H2s with IDs first, then fallback to auto-generating IDs
    var sections = document.querySelectorAll('.article-body h2[id], .article-content h2[id]');
    if (!sections.length) {
        var allH2s = document.querySelectorAll('.article-body h2, .article-content h2');
        allH2s.forEach(function(h2, i) {
            if (!h2.id) h2.id = 'toc-section-' + (i + 1);
        });
        sections = document.querySelectorAll('.article-body h2[id], .article-content h2[id]');
    }
    if (!sections.length) return;

    var sidebarList = document.getElementById('tocSidebarList');
    var mobileList = document.getElementById('tocMobileList');
    var sidebar = document.getElementById('tocSidebar');
    var tocToggle = document.getElementById('tocMobileToggle');
    var tocDrawer = document.getElementById('tocMobileDrawer');
    var tocBackdrop = document.getElementById('tocMobileBackdrop');
    var tocClose = document.getElementById('tocDrawerClose');

    var tocData = [];
    sections.forEach(function(h2, i) {
        var id = h2.getAttribute('id');
        var numMatch = id.match(/\d+/);
        var num = numMatch ? numMatch[0] : String(i + 1);
        var text = h2.textContent.replace(/^\s*\d+[\.\s]*/, '').trim();
        tocData.push({ id: id, num: num, text: text });
    });

    function buildList(container, isMobile) {
        tocData.forEach(function(item) {
            var li = document.createElement('li');
            if (!isMobile) li.className = 'toc-sidebar-item';
            var a = document.createElement('a');
            a.href = '#' + item.id;
            a.setAttribute('data-section', item.id);
            if (isMobile) {
                a.textContent = item.num + '. ' + item.text;
            } else {
                a.className = 'toc-sidebar-link';
                a.innerHTML = '<span class="toc-sidebar-num">' + item.num + '</span>' + item.text;
            }
            a.addEventListener('click', function(e) {
                e.preventDefault();
                var target = document.getElementById(item.id);
                if (target) window.scrollTo({ top: target.offsetTop - 80, behavior: 'smooth' });
                if (isMobile) closeMobileDrawer();
            });
            li.appendChild(a);
            container.appendChild(li);
        });
    }

    buildList(sidebarList, false);
    buildList(mobileList, true);

    var currentSection = null;
    var observer = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry) {
            if (entry.isIntersecting) {
                currentSection = entry.target.getAttribute('id');
                highlightActive(currentSection);
            }
        });
    }, { rootMargin: '-80px 0px -70% 0px', threshold: 0 });

    sections.forEach(function(s) { observer.observe(s); });

    function highlightActive(sectionId) {
        sidebarList.querySelectorAll('.toc-sidebar-link').forEach(function(a) {
            a.classList.toggle('active', a.getAttribute('data-section') === sectionId);
        });
        mobileList.querySelectorAll('a').forEach(function(a) {
            a.classList.toggle('active', a.getAttribute('data-section') === sectionId);
        });
    }

    var articleContent = document.querySelector('.article-content');
    if (articleContent && sidebar) {
        var sidebarObserver = new IntersectionObserver(function(entries) {
            entries.forEach(function(entry) {
                sidebar.classList.toggle('visible', entry.isIntersecting);
            });
        }, { rootMargin: '0px', threshold: 0.01 });
        sidebarObserver.observe(articleContent);
    }

    function openMobileDrawer() {
        tocDrawer.classList.add('active');
        tocBackdrop.classList.add('active');
        document.body.style.overflow = 'hidden';
    }
    function closeMobileDrawer() {
        tocDrawer.classList.remove('active');
        tocBackdrop.classList.remove('active');
        document.body.style.overflow = '';
    }

    if (tocToggle) tocToggle.addEventListener('click', openMobileDrawer);
    if (tocClose) tocClose.addEventListener('click', closeMobileDrawer);
    if (tocBackdrop) tocBackdrop.addEventListener('click', closeMobileDrawer);
})();
</script>

<!-- â•â•â• Feature 21: Global Search â•â•â• -->
<script>
(function() {
    var searchBtn = document.getElementById('navSearchBtn');
    var overlay = document.getElementById('searchOverlay');
    var modal = document.getElementById('searchModal');
    var input = document.getElementById('searchInput');
    var resultsEl = document.getElementById('searchResults');
    var previewEl = document.getElementById('searchPreview');
    var chipsEl = document.getElementById('searchChips');
    var fuse = null;
    var searchData = null;
    var focusedIdx = -1;
    var activeFilter = 'all';
    var lastResults = [];
    var RECENT_KEY = 'rz-search-recent';

    function getRecent() {
        try { return JSON.parse(localStorage.getItem(RECENT_KEY)) || []; }
        catch(e) { return []; }
    }
    function saveRecent(query) {
        if (!query || query.length < 2) return;
        var arr = getRecent().filter(function(q) { return q !== query; });
        arr.unshift(query);
        if (arr.length > 3) arr = arr.slice(0, 3);
        try { localStorage.setItem(RECENT_KEY, JSON.stringify(arr)); } catch(e) {}
    }
    function clearRecent() {
        try { localStorage.removeItem(RECENT_KEY); } catch(e) {}
    }

    function renderRecent() {
        var recent = getRecent();
        if (!recent.length) {
            resultsEl.innerHTML = '<div class="search-empty">Type to search across all content</div>';
            return;
        }
        var html = '<div class="search-recent"><div class="search-recent-header">'
            + '<span class="search-recent-label">Recent</span>'
            + '<button class="search-recent-clear" id="clearRecent">Clear</button></div>';
        recent.forEach(function(q) {
            html += '<div class="search-recent-item" data-query="' + q.replace(/"/g, '&quot;') + '">'
                + '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>'
                + '<span>' + q + '</span></div>';
        });
        html += '</div>';
        resultsEl.innerHTML = html;
        var clearBtn = document.getElementById('clearRecent');
        if (clearBtn) clearBtn.addEventListener('click', function() { clearRecent(); renderRecent(); });
        resultsEl.querySelectorAll('.search-recent-item').forEach(function(el) {
            el.addEventListener('click', function() {
                input.value = el.getAttribute('data-query');
                input.dispatchEvent(new Event('input'));
            });
        });
    }

    function openSearch() {
        overlay.classList.add('active');
        modal.classList.add('active');
        input.value = '';
        input.focus();
        focusedIdx = -1;
        activeFilter = 'all';
        lastResults = [];
        updateChips();
        hidePreview();
        renderRecent();
        if (!searchData) {
            fetch('search-index.json')
                .then(function(r) { return r.json(); })
                .then(function(data) {
                    searchData = data;
                    fuse = new Fuse(data, {
                        keys: [
                            { name: 'title', weight: 0.4 },
                            { name: 'description', weight: 0.25 },
                            { name: 'keywords', weight: 0.25 },
                            { name: 'category', weight: 0.1 }
                        ],
                        threshold: 0.35,
                        includeScore: true,
                        includeMatches: true,
                        minMatchCharLength: 2
                    });
                })
                .catch(function() {});
        }
    }

    function closeSearch() {
        overlay.classList.remove('active');
        modal.classList.remove('active');
        input.blur();
        hidePreview();
    }

    function getIconClass(cat) {
        cat = (cat || '').toLowerCase();
        if (cat === 'calculator') return 'calc';
        if (cat === 'tool') return 'tool';
        if (cat === 'policy') return 'policy';
        if (cat === 'sustainability') return 'sustainability';
        if (cat === 'geopolitics') return 'geopolitics';
        if (cat === 'analysis') return 'analysis';
        if (cat === 'leadership') return 'leadership';
        if (cat === 'business') return 'business';
        return '';
    }

    function getIconLabel(item) {
        if (item.url && item.url.indexOf('article-') === 0) {
            return item.url.replace('article-', '').replace('.html', '').padStart(2, '0');
        }
        var cat = (item.category || '').toLowerCase();
        if (cat === 'calculator') return '&#9889;';
        if (cat === 'tool') return '&#9881;';
        if (cat === 'geopolitics') return '&#9733;';
        return '&#9733;';
    }

    function getCatFilter(cat) {
        cat = (cat || '').toLowerCase();
        if (cat === 'calculator') return 'calculators';
        if (cat === 'tool') return 'tools';
        return 'articles';
    }

    function highlightText(text, matches, key) {
        if (!matches || !matches.length) return text;
        var found = null;
        for (var i = 0; i < matches.length; i++) {
            if (matches[i].key === key) { found = matches[i]; break; }
        }
        if (!found || !found.indices || !found.indices.length) return text;
        var indices = found.indices.sort(function(a, b) { return a[0] - b[0]; });
        var result = '';
        var last = 0;
        indices.forEach(function(pair) {
            var start = pair[0], end = pair[1];
            if (start > last) result += text.substring(last, start);
            result += '<mark class="search-highlight">' + text.substring(start, end + 1) + '</mark>';
            last = end + 1;
        });
        if (last < text.length) result += text.substring(last);
        return result;
    }

    function filterResults(results) {
        if (activeFilter === 'all') return results;
        return results.filter(function(r) {
            return getCatFilter(r.item.category) === activeFilter;
        });
    }

    function renderResults(results) {
        var filtered = filterResults(results);
        if (!filtered.length) {
            resultsEl.innerHTML = '<div class="search-empty">No results found</div>';
            focusedIdx = -1;
            hidePreview();
            return;
        }
        var html = '';
        filtered.slice(0, 8).forEach(function(r, i) {
            var item = r.item;
            var iconCls = getIconClass(item.category);
            var titleHtml = highlightText(item.title, r.matches, 'title');
            var descHtml = highlightText(item.description, r.matches, 'description');
            html += '<a href="' + item.url + '" class="search-result-item" data-idx="' + i + '">'
                + '<div class="search-result-icon ' + iconCls + '">' + getIconLabel(item) + '</div>'
                + '<div class="search-result-info">'
                + '<div class="search-result-category">' + (item.category || '') + '</div>'
                + '<div class="search-result-title">' + titleHtml + '</div>'
                + '<div class="search-result-desc">' + descHtml + '</div>'
                + '</div></a>';
        });
        resultsEl.innerHTML = html;
        focusedIdx = -1;
        attachHoverListeners(filtered);
    }

    function attachHoverListeners(filtered) {
        resultsEl.querySelectorAll('.search-result-item').forEach(function(el) {
            var idx = parseInt(el.getAttribute('data-idx'), 10);
            el.addEventListener('mouseenter', function() { showPreview(filtered[idx], el); });
            el.addEventListener('mouseleave', function() { hidePreview(); });
            el.addEventListener('click', function() { saveRecent(input.value.trim()); });
        });
    }

    function showPreview(r, anchorEl) {
        if (!previewEl || !r) return;
        var item = r.item;
        var imgHtml = item.image ? '<img class="search-preview-img" src="' + item.image + '" alt="">' : '';
        var timeHtml = item.readingTime ? '<div class="search-preview-badge"><svg viewBox="0 0 24 24" width="10" height="10" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>' + item.readingTime + ' min</div>' : '';
        previewEl.innerHTML = imgHtml
            + '<div class="search-preview-text">'
            + '<div class="search-preview-cat">' + (item.category || '') + '</div>'
            + '<div class="search-preview-title">' + item.title + '</div>'
            + '<div class="search-preview-desc">' + item.description + '</div>'
            + timeHtml
            + '</div>';
        // Position tooltip to the right of the modal
        var modalRect = modal.getBoundingClientRect();
        var itemRect = anchorEl.getBoundingClientRect();
        var tipLeft = modalRect.right + 10;
        var tipTop = itemRect.top;
        // If no space on right, show on left
        if (tipLeft + 270 > window.innerWidth) {
            tipLeft = modalRect.left - 270;
        }
        // Keep within viewport vertically
        if (tipTop + 100 > window.innerHeight) {
            tipTop = window.innerHeight - 110;
        }
        previewEl.style.left = tipLeft + 'px';
        previewEl.style.top = tipTop + 'px';
        previewEl.classList.add('visible');
    }

    function hidePreview() {
        if (!previewEl) return;
        previewEl.innerHTML = '';
        previewEl.classList.remove('visible');
    }

    function updateChips() {
        if (!chipsEl) return;
        chipsEl.querySelectorAll('.search-chip').forEach(function(chip) {
            chip.classList.toggle('active', chip.getAttribute('data-filter') === activeFilter);
        });
    }

    if (chipsEl) {
        chipsEl.addEventListener('click', function(e) {
            var chip = e.target.closest('.search-chip');
            if (!chip) return;
            activeFilter = chip.getAttribute('data-filter');
            updateChips();
            if (lastResults.length) renderResults(lastResults);
        });
    }

    function updateFocus() {
        var items = resultsEl.querySelectorAll('.search-result-item');
        items.forEach(function(el, i) {
            el.classList.toggle('focused', i === focusedIdx);
            if (i === focusedIdx) {
                el.scrollIntoView({ block: 'nearest' });
                var idx = parseInt(el.getAttribute('data-idx'), 10);
                var filtered = filterResults(lastResults);
                if (filtered[idx]) showPreview(filtered[idx], el);
            }
        });
    }

    if (searchBtn) searchBtn.addEventListener('click', openSearch);
    if (overlay) overlay.addEventListener('click', closeSearch);

    document.addEventListener('keydown', function(e) {
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
            e.preventDefault();
            if (modal.classList.contains('active')) closeSearch();
            else openSearch();
            return;
        }
        if (!modal.classList.contains('active')) return;
        if (e.key === 'Escape') { closeSearch(); return; }
        var items = resultsEl.querySelectorAll('.search-result-item');
        if (e.key === 'ArrowDown') {
            e.preventDefault();
            focusedIdx = Math.min(focusedIdx + 1, items.length - 1);
            updateFocus();
        } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            focusedIdx = Math.max(focusedIdx - 1, 0);
            updateFocus();
        } else if (e.key === 'Enter' && focusedIdx >= 0 && items[focusedIdx]) {
            e.preventDefault();
            saveRecent(input.value.trim());
            items[focusedIdx].click();
        }
    });

    if (input) {
        input.addEventListener('input', function() {
            var query = input.value.trim();
            if (query.length < 2 || !fuse) {
                lastResults = [];
                focusedIdx = -1;
                hidePreview();
                if (query.length === 0) { renderRecent(); }
                else { resultsEl.innerHTML = '<div class="search-empty">Type to search across all content</div>'; }
                return;
            }
            var results = fuse.search(query);
            lastResults = results;
            renderResults(results);
        });
    }
})();
</script>

</body></html>';

            w.document.open();
            w.document.write(html);
            w.document.close();
            setTimeout(function() { w.print(); }, 600);
        };

        // ===== Tooltip Positioning =====
        document.querySelectorAll('.tooltip-trigger').forEach(function(trigger) {
            trigger.addEventListener('mouseenter', function() {
                var tip = this.querySelector('.tooltip-content');
                if (!tip) return;
                var rect = this.getBoundingClientRect();
                var tipRect = tip.getBoundingClientRect();
                // If tooltip would go off right edge, shift left
                if (rect.left + tipRect.width / 2 > window.innerWidth - 10) {
                    tip.style.left = 'auto';
                    tip.style.right = '-10px';
                    tip.style.transform = 'none';
                }
                // If tooltip would go off left edge, shift right
                if (rect.left - tipRect.width / 2 < 10) {
                    tip.style.left = '-10px';
                    tip.style.right = 'auto';
                    tip.style.transform = 'none';
                }
                // If tooltip would go off top, show below
                if (rect.top < tipRect.height + 20) {
                    tip.style.bottom = 'auto';
                    tip.style.top = 'calc(100% + 10px)';
                }
            });
        });

        // ===== Init =====
        if (wsCheckAuth()) {
            wsUnlockPanels();
        } else {
            updateWsProPanels(); // populate values even when locked (blurred)
        }

    })();
    </script>
<script src="auth.js"></script>
<script src="rz-tracker.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-banner hidden" id="cookieBanner">
    <p>We use cookies for analytics to improve your experience. <a href="privacy.html">Learn more</a></p>
    <div class="cookie-actions">
        <button class="cookie-accept" id="cookieAccept">Accept</button>
        <button class="cookie-decline" id="cookieDecline">Decline</button>
    </div>
</div>

<!-- Scroll to Top -->
<button class="scroll-top-btn" id="scrollTopBtn" aria-label="Scroll to top">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"/></svg>
</button>

<script>
(function(){
    // Cookie Banner
    var cb = document.getElementById('cookieBanner');
    var consent = localStorage.getItem('rz_cookie_consent');
    if (!consent && cb) {
        cb.classList.remove('hidden');
    }
    var acceptBtn = document.getElementById('cookieAccept');
    var declineBtn = document.getElementById('cookieDecline');
    if (acceptBtn) acceptBtn.addEventListener('click', function(){
        localStorage.setItem('rz_cookie_consent', 'accepted');
        cb.classList.add('hidden');
    });
    if (declineBtn) declineBtn.addEventListener('click', function(){
        localStorage.setItem('rz_cookie_consent', 'declined');
        cb.classList.add('hidden');
        // Disable GA
        window['ga-disable-G-GED7FX8RTV'] = true;
    });

    // Scroll to Top
    var sBtn = document.getElementById('scrollTopBtn');
    if (sBtn) {
        var ticking = false;
        window.addEventListener('scroll', function(){
            if (!ticking) {
                window.requestAnimationFrame(function(){
                    if (window.scrollY > 500) {
                        sBtn.classList.add('visible');
                    } else {
                        sBtn.classList.remove('visible');
                    }
                    ticking = false;
                });
                ticking = true;
            }
        });
        sBtn.addEventListener('click', function(){
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
    }
})();
</script>

</body>
</html>
