<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GED7FX8RTV"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-GED7FX8RTV');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- SEO Meta Tags -->
    <title>The HVAC Shock | Chiller-Free Cooling | ResistanceZero</title>
    <meta name="description" content="Nvidia Rubin's direct-to-chip cooling doesn't eliminate HVAC. Tropical climate analysis, hybrid cooling, and fault scenario implementation guide.">
    <meta name="keywords" content="Data Center Cooling, Chiller-Free, Direct Liquid Cooling, DLC, Warm Water Cooling, Tropical Data Center, Nvidia Rubin, CDU, Dry Cooler, PUE Optimization, HVAC">
    <meta name="author" content="Bagus Dwi Permana">
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#0066cc">
    <link rel="canonical" href="https://resistancezero.com/article-9.html">

    <link rel="alternate" hreflang="en" href="https://resistancezero.com/article-9.html">

    <!-- Resource Hints -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="https://www.googletagmanager.com">
    <!-- Open Graph Meta Tags -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://resistancezero.com/article-9.html">
    <meta property="og:title" content="The HVAC Shock: No Chillers Doesn't Mean No Cooling">
    <meta property="og:description" content="Deep technical analysis of chiller-free cooling revolution in data centers, with tropical climate implementation guide and fault scenario analysis.">
    <meta property="og:image" content="https://resistancezero.com/assets/article-9-cover_.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="The HVAC Shock: No Chillers Doesn't Mean No Cooling - Data Center Cooling Revolution">
    <meta property="og:locale" content="en_US">
    <meta property="og:site_name" content="Bagus Dwi Permana Portfolio">
    <meta property="article:author" content="Bagus Dwi Permana">
    <meta property="article:published_time" content="2026-02-07T00:00:00Z">
    <meta property="article:modified_time" content="2026-02-17T00:00:00Z">
    <meta property="article:section" content="Data Center Cooling">
    <meta property="article:tag" content="Chiller-Free Cooling">
    <meta property="article:tag" content="Direct Liquid Cooling">
    <meta property="article:tag" content="HVAC Engineering">

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@BagusDPermana">
    <meta name="twitter:creator" content="@BagusDPermana">
    <meta name="twitter:title" content="The HVAC Shock: No Chillers Doesn't Mean No Cooling">
    <meta name="twitter:description" content="Chiller-free cooling analysis for data centers with tropical implementation guide.">
    <meta name="twitter:image" content="https://resistancezero.com/assets/article-9-cover_.jpg">
    <meta name="twitter:image:alt" content="HVAC Systems Optimization for Tropical Data Centers">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="assets/Favicon.png">
    <link rel="apple-touch-icon" href="assets/Favicon.png">
    <link rel="stylesheet" href="styles.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preload" as="image" href="assets/article-9-cover_.jpg">

    <!-- Structured Data - TechnicalArticle -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "TechnicalArticle",
        "headline": "The HVAC Shock: No Chillers Doesn't Mean No Cooling",
        "description": "Deep technical analysis of chiller-free cooling for data centers, with tropical climate implementation guide and fault scenario analysis.",
        "author": {
            "@type": "Person",
            "name": "Bagus Dwi Permana",
            "jobTitle": "Data Center Operations Lead",
            "url": "https://resistancezero.com/"
        },
        "datePublished": "2026-02-07",
        "dateModified": "2026-02-07",
        "publisher": {
            "@type": "Person",
            "name": "Bagus Dwi Permana"
        },
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://resistancezero.com/article-9.html"
        },
        "articleSection": "Data Center Cooling",
        "keywords": ["Chiller-Free Cooling", "Direct Liquid Cooling", "DLC", "HVAC Engineering"]
    }
    </script>

    <!-- Structured Data - BreadcrumbList -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
            {
                "@type": "ListItem",
                "position": 1,
                "name": "Home",
                "item": "https://resistancezero.com/"
            },
            {
                "@type": "ListItem",
                "position": 2,
                "name": "Articles",
                "item": "https://resistancezero.com/articles.html"
            },
            {
                "@type": "ListItem",
                "position": 3,
                "name": "The HVAC Shock: No Chillers Doesn't Mean No Cooling"
            }
        ]
    }
    </script>

    <!-- Structured Data - FAQPage -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
            {
                "@type": "Question",
                "name": "Can a data center operate without chillers in tropical climates?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Not entirely. While Direct Liquid Cooling (DLC) and rear-door heat exchangers can eliminate traditional chillers for IT load cooling, heat rejection to the environment still requires cooling towers or dry coolers. In tropical climates with 28-35°C wet-bulb temperatures, completely chiller-free operation faces physics constraints that limit effectiveness to approximately 60-70% of total cooling capacity."
                }
            },
            {
                "@type": "Question",
                "name": "What is the ROI of switching from air cooling to liquid cooling in data centers?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "The ROI varies by climate zone and rack density. For high-density AI/HPC deployments (>30kW/rack), liquid cooling delivers 30-40% energy savings with a 2-3 year payback period. For standard enterprise loads (<10kW/rack), the business case is weaker with payback periods of 5-7 years. Tropical deployments see slower ROI due to higher ambient temperatures reducing free cooling hours."
                }
            },
            {
                "@type": "Question",
                "name": "What does Nvidia's 'no chillers needed' claim mean for GB200 NVL72?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Nvidia's claim refers to eliminating mechanical refrigeration chillers from the IT cooling loop by using warm-water direct liquid cooling at 40-45°C supply temperatures. However, this does not eliminate the need for heat rejection infrastructure. Cooling towers, dry coolers, or hybrid systems are still required to reject heat to the atmosphere, especially in warm climates."
                }
            }
        ]
    }
    </script>

    <style>
        :root {
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --spacing-2xl: 3rem;
        }

        .article-hero {
            background: linear-gradient(135deg, #0b1220 0%, #1a365d 50%, #2d5a87 100%);
            padding: 7rem 2rem 3.5rem;
            color: #fff;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .article-hero::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%239C92AC' fill-opacity='0.15'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            opacity: 0.15;
            z-index: 0;
        }
        .article-hero::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(circle at 20% 80%, rgba(59, 130, 246, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(16, 185, 129, 0.2) 0%, transparent 50%);
            z-index: 0;
        }
        .article-hero > * { position: relative; z-index: 1; }
        .article-hero .container { max-width: 1000px; }
        .article-category {
            display: inline-block;
            background: rgba(59, 130, 246, 0.2);
            color: #93c5fd;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: var(--spacing-lg);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .article-title {
            font-size: clamp(1.6rem, 3.2vw, 2.35rem);
            font-weight: 800;
            margin-bottom: 1.25rem;
            line-height: 1.25;
            color: #fff;
            letter-spacing: -0.01em;
        }
        .article-subtitle {
            font-size: clamp(0.95rem, 1.6vw, 1.15rem);
            color: #94a3b8;
            max-width: 700px;
            margin: 0 auto var(--spacing-xl);
            line-height: 1.7;
        }
        .article-meta {
            display: flex;
            justify-content: center;
            gap: var(--spacing-xl);
            flex-wrap: wrap;
            color: #94a3b8;
            font-size: 0.9375rem;
        }
        .article-meta-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        /* Download Button */
        .download-section {
            display: flex;
            justify-content: center;
            gap: var(--spacing-md);
            margin-top: var(--spacing-xl);
            flex-wrap: wrap;
        }
        .download-btn {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-sm);
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: #fff;
            padding: 0.875rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9375rem;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }
        .download-btn svg {
            width: 20px;
            height: 20px;
        }

        .article-content {
            padding: var(--spacing-2xl) var(--spacing-xl);
            background: #fff;
        }
        .article-content .container { max-width: 1150px; }
        .article-body {
            font-size: 0.95rem;
            line-height: 1.7;
            color: #374151;
        }
        .article-body p {
            margin-bottom: var(--spacing-md);
        }
        .article-body h2 {
            font-size: 1.4rem;
            color: #1e3a5f;
            margin: var(--spacing-xl) 0 var(--spacing-md);
            padding-bottom: var(--spacing-sm);
            border-bottom: 3px solid #e5e7eb;
        }
        .article-body h3 {
            font-size: 1.1rem;
            color: #2d5a87;
            margin: var(--spacing-lg) 0 var(--spacing-sm);
        }
        .article-body h4 {
            font-size: 0.9rem;
            color: #1e3a5f;
            margin: var(--spacing-md) 0 var(--spacing-xs);
        }
        .article-body blockquote {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-left: 4px solid #3b82f6;
            padding: var(--spacing-lg) var(--spacing-xl);
            margin: var(--spacing-lg) 0;
            border-radius: 0 12px 12px 0;
            font-style: italic;
            color: #1e40af;
        }
        .article-body ul, .article-body ol {
            margin: var(--spacing-md) 0;
            padding-left: var(--spacing-lg);
        }
        .article-body li {
            margin-bottom: var(--spacing-sm);
        }

        /* Key Insight Box */
        .key-insight {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-radius: 12px;
            padding: var(--spacing-lg) var(--spacing-xl);
            margin: var(--spacing-lg) 0;
            border-left: 4px solid #f59e0b;
        }
        .key-insight h4 {
            color: #92400e;
            margin: 0 0 var(--spacing-sm) 0;
            font-size: 0.9375rem;
        }
        .key-insight p {
            margin: 0;
            color: #78350f;
            font-weight: 500;
        }

        /* Market Impact Box */
        .market-impact {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border-radius: 12px;
            padding: var(--spacing-lg) var(--spacing-xl);
            margin: var(--spacing-lg) 0;
            border-left: 4px solid #ef4444;
        }
        .market-impact h4 {
            color: #991b1b;
            margin: 0 0 var(--spacing-md) 0;
        }
        .market-impact .stock-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--spacing-md);
        }
        .market-impact .stock-item {
            background: rgba(255,255,255,0.7);
            padding: var(--spacing-md);
            border-radius: 8px;
            text-align: center;
        }
        .market-impact .stock-name {
            font-weight: 600;
            color: #374151;
        }
        .market-impact .stock-change {
            font-size: 1.5rem;
            font-weight: 800;
            color: #dc2626;
        }

        /* Enhanced Technical Box */
        .tech-box {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            border-radius: 16px;
            padding: var(--spacing-xl);
            margin: var(--spacing-lg) 0;
            color: #e2e8f0;
            border: 1px solid rgba(59, 130, 246, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        .tech-box-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 1px solid rgba(148, 163, 184, 0.2);
        }
        .tech-box-header h4 {
            color: #60a5fa;
            margin: 0;
            font-size: 1.125rem;
        }
        .tech-box-icon {
            width: 32px;
            height: 32px;
            background: rgba(59, 130, 246, 0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .tech-box-icon svg {
            width: 18px;
            height: 18px;
            color: #60a5fa;
        }
        .tech-box pre {
            background: rgba(0,0,0,0.4);
            padding: var(--spacing-lg);
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8125rem;
            line-height: 1.7;
            color: #94a3b8;
            margin: 0;
            border: 1px solid rgba(148, 163, 184, 0.1);
        }
        .tech-box .diagram-section {
            margin-bottom: var(--spacing-lg);
        }
        .tech-box .diagram-section:last-child {
            margin-bottom: 0;
        }
        .tech-box .section-label {
            color: #f59e0b;
            font-weight: 600;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: var(--spacing-sm);
        }
        .tech-box .highlight-line {
            color: #22c55e;
        }
        .tech-box .warning-line {
            color: #f59e0b;
        }
        .tech-box .danger-line {
            color: #ef4444;
        }
        .tech-box .info-line {
            color: #60a5fa;
        }

        /* Humidity Visualization */
        .humidity-viz {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: var(--spacing-lg);
        }
        .humidity-viz h5 {
            color: #60a5fa;
            font-size: 0.9rem;
            margin: 0 0 var(--spacing-md) 0;
        }
        .humidity-bar-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .humidity-bar-row {
            display: grid;
            grid-template-columns: 60px 1fr 100px 150px;
            gap: 12px;
            align-items: center;
        }
        .humidity-bar-row .rh-label {
            font-size: 0.85rem;
            font-weight: 600;
            color: #e2e8f0;
        }
        .humidity-bar-track {
            height: 24px;
            background: rgba(148, 163, 184, 0.1);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }
        .humidity-bar-fill {
            height: 100%;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
            font-size: 0.75rem;
            font-weight: 600;
            color: #fff;
            transition: width 0.3s ease;
        }
        .humidity-bar-fill.excellent { background: linear-gradient(90deg, #22c55e, #16a34a); }
        .humidity-bar-fill.good { background: linear-gradient(90deg, #3b82f6, #2563eb); }
        .humidity-bar-fill.limited { background: linear-gradient(90deg, #f59e0b, #d97706); }
        .humidity-bar-fill.minimal { background: linear-gradient(90deg, #ef4444, #dc2626); }
        .humidity-bar-row .rating {
            font-size: 0.8rem;
            padding: 4px 8px;
            border-radius: 6px;
            text-align: center;
        }
        .rating.excellent { background: rgba(34, 197, 94, 0.2); color: #4ade80; }
        .rating.good { background: rgba(59, 130, 246, 0.2); color: #60a5fa; }
        .rating.limited { background: rgba(245, 158, 11, 0.2); color: #fbbf24; }
        .rating.minimal { background: rgba(239, 68, 68, 0.2); color: #f87171; }
        .humidity-note {
            margin-top: var(--spacing-md);
            padding: var(--spacing-sm) var(--spacing-md);
            background: rgba(239, 68, 68, 0.1);
            border-left: 3px solid #ef4444;
            border-radius: 0 8px 8px 0;
            font-size: 0.85rem;
            color: #f87171;
        }

        /* Diurnal Temperature Swing Visualization */
        .diurnal-viz {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: var(--spacing-lg);
        }
        .diurnal-viz h5 {
            color: #60a5fa;
            font-size: 0.9rem;
            margin: 0 0 var(--spacing-md) 0;
        }
        .temp-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }
        .temp-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: var(--spacing-md);
            border: 1px solid rgba(148, 163, 184, 0.1);
        }
        .temp-card.temperate { border-color: rgba(34, 197, 94, 0.3); }
        .temp-card.tropical { border-color: rgba(239, 68, 68, 0.3); }
        .temp-card h6 {
            font-size: 0.8rem;
            margin: 0 0 var(--spacing-sm) 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .temp-card.temperate h6 { color: #4ade80; }
        .temp-card.tropical h6 { color: #f87171; }
        .temp-range {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: var(--spacing-sm) 0;
        }
        .temp-point {
            text-align: center;
        }
        .temp-point .label {
            font-size: 0.7rem;
            color: #94a3b8;
            margin-bottom: 4px;
        }
        .temp-point .value {
            font-size: 1.2rem;
            font-weight: 700;
        }
        .temp-card.temperate .temp-point .value { color: #4ade80; }
        .temp-card.tropical .temp-point .value { color: #f87171; }
        .temp-swing-bar {
            height: 8px;
            flex: 1;
            margin: 0 12px;
            border-radius: 4px;
            position: relative;
        }
        .temp-card.temperate .temp-swing-bar { background: linear-gradient(90deg, #22c55e, #86efac); }
        .temp-card.tropical .temp-swing-bar { background: linear-gradient(90deg, #ef4444, #fca5a5); }
        .swing-result {
            text-align: center;
            padding: var(--spacing-sm);
            border-radius: 8px;
            margin-top: var(--spacing-sm);
        }
        .temp-card.temperate .swing-result { background: rgba(34, 197, 94, 0.1); color: #4ade80; }
        .temp-card.tropical .swing-result { background: rgba(239, 68, 68, 0.1); color: #f87171; }
        .swing-result .swing-value { font-weight: 700; font-size: 1.1rem; }
        .swing-result .swing-hours { font-size: 0.85rem; opacity: 0.9; }

        /* Free Cooling Hours Table */
        .free-cooling-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: var(--spacing-md);
        }
        .free-cooling-table th {
            background: rgba(0, 0, 0, 0.4);
            color: #f59e0b;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 12px;
            text-align: left;
        }
        .free-cooling-table th:first-child { border-radius: 8px 0 0 0; }
        .free-cooling-table th:last-child { border-radius: 0 8px 0 0; }
        .free-cooling-table td {
            padding: 12px;
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
            font-size: 0.9rem;
        }
        .free-cooling-table tr:last-child td:first-child { border-radius: 0 0 0 8px; }
        .free-cooling-table tr:last-child td:last-child { border-radius: 0 0 8px 0; }
        .free-cooling-table .location { color: #e2e8f0; font-weight: 500; }
        .free-cooling-table .hours { color: #94a3b8; }
        .free-cooling-table .percent-bar {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .percent-track {
            flex: 1;
            height: 8px;
            background: rgba(148, 163, 184, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        .percent-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        .percent-fill.high { background: linear-gradient(90deg, #22c55e, #4ade80); }
        .percent-fill.medium { background: linear-gradient(90deg, #3b82f6, #60a5fa); }
        .percent-fill.low { background: linear-gradient(90deg, #f59e0b, #fbbf24); }
        .percent-fill.critical { background: linear-gradient(90deg, #ef4444, #f87171); }
        .percent-value {
            font-size: 0.85rem;
            font-weight: 600;
            min-width: 45px;
            text-align: right;
        }
        .percent-value.high { color: #4ade80; }
        .percent-value.medium { color: #60a5fa; }
        .percent-value.low { color: #fbbf24; }
        .percent-value.critical { color: #f87171; }

        /* Enhanced Comparison Flow */
        .comparison-flow {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: var(--spacing-lg);
            align-items: start;
            margin: var(--spacing-lg) 0;
        }
        .flow-column {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: var(--spacing-lg);
            border: 1px solid rgba(148, 163, 184, 0.15);
        }
        .flow-column h5 {
            color: #94a3b8;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 0 0 var(--spacing-md) 0;
            text-align: center;
        }
        .flow-column.before h5 { color: #f87171; }
        .flow-column.after h5 { color: #4ade80; }
        .flow-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm) var(--spacing-md);
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin-bottom: var(--spacing-sm);
            font-size: 0.875rem;
        }
        .flow-item:last-child {
            margin-bottom: 0;
        }
        .flow-item-icon {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
        }
        .flow-arrow {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #60a5fa;
        }
        .flow-arrow svg {
            width: 40px;
            height: 40px;
        }
        .flow-arrow span {
            font-size: 0.6875rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: var(--spacing-xs);
        }

        /* Failure Mode Cards */
        .failure-mode-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-md);
            margin: var(--spacing-lg) 0;
        }
        .failure-mode-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: var(--spacing-lg);
            border: 1px solid rgba(148, 163, 184, 0.15);
            transition: all 0.3s ease;
        }
        .failure-mode-card:hover {
            transform: translateY(-2px);
            border-color: rgba(59, 130, 246, 0.3);
        }
        .failure-mode-card .mode-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: var(--spacing-md);
            font-size: 1.25rem;
        }
        .failure-mode-card .mode-icon.pump { background: rgba(239, 68, 68, 0.2); }
        .failure-mode-card .mode-icon.seal { background: rgba(59, 130, 246, 0.2); }
        .failure-mode-card .mode-icon.motor { background: rgba(245, 158, 11, 0.2); }
        .failure-mode-card .mode-icon.control { background: rgba(168, 85, 247, 0.2); }
        .failure-mode-card h5 {
            color: #fff;
            font-size: 0.9375rem;
            margin: 0 0 var(--spacing-sm) 0;
        }
        .failure-mode-card p {
            color: #94a3b8;
            font-size: 0.8125rem;
            margin: 0 0 var(--spacing-md) 0;
            line-height: 1.5;
        }
        .failure-mode-card .severity {
            display: inline-block;
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: 4px;
            font-size: 0.6875rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        .failure-mode-card .severity.high { background: rgba(239, 68, 68, 0.2); color: #f87171; }
        .failure-mode-card .severity.medium { background: rgba(245, 158, 11, 0.2); color: #fbbf24; }
        .failure-mode-card .severity.low { background: rgba(34, 197, 94, 0.2); color: #4ade80; }

        /* Impact Timeline */
        .impact-timeline {
            margin: var(--spacing-lg) 0;
        }
        .timeline-header {
            display: grid;
            grid-template-columns: 80px 100px 1fr 120px;
            gap: var(--spacing-md);
            padding: var(--spacing-md);
            background: rgba(59, 130, 246, 0.1);
            border-radius: 8px 8px 0 0;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            color: #60a5fa;
        }
        .timeline-row {
            display: grid;
            grid-template-columns: 80px 100px 1fr 120px;
            gap: var(--spacing-md);
            padding: var(--spacing-md);
            background: rgba(0, 0, 0, 0.2);
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
            align-items: center;
            font-size: 0.875rem;
        }
        .timeline-row:last-child {
            border-radius: 0 0 8px 8px;
        }
        .timeline-row .time {
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }
        .timeline-row .temp {
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: 4px;
            text-align: center;
        }
        .timeline-row .temp.normal { background: rgba(34, 197, 94, 0.2); color: #4ade80; }
        .timeline-row .temp.elevated { background: rgba(245, 158, 11, 0.2); color: #fbbf24; }
        .timeline-row .temp.critical { background: rgba(239, 68, 68, 0.2); color: #f87171; }
        .timeline-row .status {
            color: #cbd5e1;
        }
        .timeline-row .risk {
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            text-align: center;
        }
        .timeline-row .risk.low { background: rgba(34, 197, 94, 0.2); color: #4ade80; }
        .timeline-row .risk.medium { background: rgba(245, 158, 11, 0.2); color: #fbbf24; }
        .timeline-row .risk.high { background: rgba(239, 68, 68, 0.2); color: #f87171; }
        .timeline-row .risk.critical { background: rgba(239, 68, 68, 0.4); color: #fff; }

        /* Comparison Table */
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: var(--spacing-lg) 0;
            font-size: 0.9375rem;
        }
        .comparison-table th {
            background: #1e3a5f;
            color: #fff;
            padding: var(--spacing-md);
            text-align: left;
            font-weight: 600;
        }
        .comparison-table td {
            padding: var(--spacing-md);
            border-bottom: 1px solid #e5e7eb;
        }
        .comparison-table tr:nth-child(even) {
            background: #f8fafc;
        }
        .comparison-table tr:hover {
            background: #eff6ff;
        }

        /* Pros/Cons Grid */
        .pros-cons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-lg);
            margin: var(--spacing-lg) 0;
        }
        .pros-box {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border-radius: 12px;
            padding: var(--spacing-lg);
            border-left: 4px solid #10b981;
        }
        .pros-box h4 {
            color: #065f46;
            margin: 0 0 var(--spacing-md) 0;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }
        .pros-box ul {
            margin: 0;
            padding-left: 1.25rem;
            color: #047857;
        }
        .cons-box {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border-radius: 12px;
            padding: var(--spacing-lg);
            border-left: 4px solid #ef4444;
        }
        .cons-box h4 {
            color: #991b1b;
            margin: 0 0 var(--spacing-md) 0;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }
        .cons-box ul {
            margin: 0;
            padding-left: 1.25rem;
            color: #b91c1c;
        }

        /* Regional Verdict Selector */
        .verdict-container {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: var(--spacing-lg);
            margin: var(--spacing-lg) 0;
            align-items: start;
        }
        .verdict-box {
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
            border-radius: 12px;
            padding: var(--spacing-lg);
            color: #fff;
            text-align: center;
            position: sticky;
            top: 100px;
            box-shadow: 0 8px 32px rgba(124, 58, 237, 0.3);
        }
        .verdict-box h4 {
            color: #c4b5fd;
            margin: 0 0 var(--spacing-xs) 0;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .verdict-box .verdict-region {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
            color: #e9d5ff;
        }
        .verdict-box .verdict-text {
            font-size: 1rem;
            font-weight: 800;
            margin-bottom: var(--spacing-sm);
        }
        .verdict-box .verdict-score-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-sm);
        }
        .verdict-box .score-ring {
            width: 70px;
            height: 70px;
            position: relative;
        }
        .verdict-box .score-ring svg {
            transform: rotate(-90deg);
            width: 70px;
            height: 70px;
        }
        .verdict-box .score-ring .bg {
            fill: none;
            stroke: rgba(255, 255, 255, 0.2);
            stroke-width: 6;
        }
        .verdict-box .score-ring .progress {
            fill: none;
            stroke: #fff;
            stroke-width: 6;
            stroke-linecap: round;
            transition: stroke-dasharray 0.5s ease;
        }
        .verdict-box .score-value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.1rem;
            font-weight: 800;
        }
        .verdict-box .verdict-details {
            text-align: left;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            padding: var(--spacing-sm);
            margin-top: var(--spacing-sm);
        }
        .verdict-box .verdict-details p {
            margin: 0;
            font-size: 0.75rem;
            color: #e9d5ff;
            line-height: 1.6;
        }

        .region-selector {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border-radius: 12px;
            padding: var(--spacing-lg);
            color: #fff;
        }
        .region-selector h4 {
            color: #94a3b8;
            margin: 0 0 var(--spacing-sm) 0;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .region-dropdown {
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-md);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 6px;
            color: #fff;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: var(--spacing-md);
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 8px center;
        }
        .region-dropdown option {
            background: #1e293b;
            color: #fff;
        }
        .region-stats {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }
        .region-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-xs) 0;
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
        }
        .region-stat:last-child {
            border-bottom: none;
        }
        .region-stat .label {
            color: #94a3b8;
            font-size: 0.7rem;
        }
        .region-stat .value {
            font-weight: 600;
            font-size: 0.75rem;
        }
        .region-stat .value.good { color: #4ade80; }
        .region-stat .value.moderate { color: #fbbf24; }
        .region-stat .value.challenging { color: #f87171; }

        /* Tropical Climate Box */
        .tropical-box {
            background: linear-gradient(135deg, #064e3b 0%, #065f46 100%);
            border-radius: 12px;
            padding: var(--spacing-xl);
            margin: var(--spacing-lg) 0;
            color: #d1fae5;
        }
        .tropical-box h4 {
            color: #6ee7b7;
            margin: 0 0 var(--spacing-md) 0;
        }
        .climate-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: var(--spacing-md);
            margin-top: var(--spacing-md);
        }
        .climate-card {
            background: rgba(255,255,255,0.1);
            padding: var(--spacing-md);
            border-radius: 8px;
            text-align: center;
        }
        .climate-city {
            font-weight: 600;
            color: #fff;
            margin-bottom: var(--spacing-xs);
        }
        .climate-temp {
            font-size: 1.5rem;
            font-weight: 800;
            color: #fbbf24;
        }
        .climate-rh {
            font-size: 0.875rem;
            color: #a7f3d0;
        }

        /* Chart Container */
        .chart-container {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            border-radius: 16px;
            padding: var(--spacing-xl);
            margin: var(--spacing-lg) 0;
        }
        .chart-title {
            text-align: center;
            color: #fff;
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: var(--spacing-xs);
        }
        .chart-subtitle {
            text-align: center;
            color: #94a3b8;
            font-size: 0.875rem;
            margin-bottom: var(--spacing-lg);
        }
        .chart-wrapper {
            background: rgba(2, 6, 23, 0.5);
            border-radius: 12px;
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }
        .chart-canvas {
            width: 100%;
            height: auto;
            display: block;
        }
        .control-row {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            flex-wrap: wrap;
            justify-content: center;
            margin-top: var(--spacing-md);
        }
        .control-label {
            color: #94a3b8;
            font-size: 0.9rem;
        }
        .control-slider {
            width: 200px;
            height: 8px;
            border-radius: 4px;
            background: rgba(148, 163, 184, 0.2);
            outline: none;
            -webkit-appearance: none;
        }
        .control-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
        }
        .control-value {
            background: rgba(59, 130, 246, 0.2);
            color: #93c5fd;
            padding: var(--spacing-xs) 0.75rem;
            border-radius: 999px;
            font-weight: 700;
            font-size: 0.9rem;
            min-width: 80px;
            text-align: center;
        }
        .legend-row {
            display: flex;
            justify-content: center;
            gap: var(--spacing-xl);
            margin-top: var(--spacing-md);
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            color: #94a3b8;
            font-size: 0.8rem;
        }
        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        .callout-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: var(--spacing-md);
            margin-top: var(--spacing-lg);
        }
        .callout-card {
            background: rgba(30, 58, 95, 0.3);
            border-radius: 10px;
            padding: var(--spacing-md);
            text-align: center;
            border: 1px solid rgba(59, 130, 246, 0.15);
        }
        .callout-label {
            color: #94a3b8;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .callout-value {
            font-size: 1.5rem;
            font-weight: 800;
            color: #3b82f6;
        }

        /* Featured Image */
        .featured-image {
            float: right;
            width: 280px;
            margin: 0 0 var(--spacing-lg) var(--spacing-xl);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(148, 163, 184, 0.2);
        }
        .featured-image img {
            width: 100%;
            height: auto;
            display: block;
        }
        .featured-image figcaption {
            background: rgba(15, 23, 42, 0.95);
            padding: var(--spacing-sm) var(--spacing-md);
            font-size: 0.75rem;
            color: #94a3b8;
            text-align: center;
        }
        @media (max-width: 768px) {
            .featured-image {
                float: none;
                width: 100%;
                margin: var(--spacing-lg) 0;
            }
        }

        /* TL;DR Box */
        .tldr-box {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            border-radius: 16px;
            padding: var(--spacing-xl);
            margin: var(--spacing-xl) 0;
            color: #fff;
            border: 1px solid rgba(59, 130, 246, 0.3);
            position: relative;
            overflow: hidden;
        }
        .tldr-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6, #06b6d4);
        }
        .tldr-box h4 {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            color: #fff;
            margin: 0 0 var(--spacing-md) 0;
            font-size: 1.25rem;
            font-weight: 700;
        }
        .tldr-box h4::before {
            content: '⚡';
            font-size: 1.5rem;
        }
        .tldr-box ul {
            margin: 0;
            padding: 0;
            list-style: none;
        }
        .tldr-box li {
            margin-bottom: var(--spacing-sm);
            padding-left: 1.75rem;
            position: relative;
            color: #cbd5e1;
            line-height: 1.45;
        }
        .tldr-box li::before {
            content: '→';
            position: absolute;
            left: 0;
            color: #3b82f6;
            font-weight: 700;
        }
        .tldr-box li:last-child {
            margin-bottom: 0;
        }
        .tldr-box li strong {
            color: #f8fafc;
        }

        /* Fault Scenario Box */
        .fault-scenario {
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
            border-radius: 16px;
            padding: var(--spacing-xl);
            margin: var(--spacing-lg) 0;
            color: #e0e7ff;
        }
        .fault-scenario h4 {
            color: #a5b4fc;
            margin: 0 0 var(--spacing-md) 0;
            font-size: 1.125rem;
        }

        .highlight-box {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border-radius: 12px;
            padding: var(--spacing-lg) var(--spacing-xl);
            margin: var(--spacing-lg) 0;
            border-left: 4px solid #ef4444;
        }
        .highlight-box p {
            margin: 0;
            color: #991b1b;
            font-weight: 500;
        }
        .warning-box {
            background: linear-gradient(135deg, #fefce8 0%, #fef9c3 100%);
            border-radius: 12px;
            padding: var(--spacing-lg) var(--spacing-xl);
            margin: var(--spacing-lg) 0;
            border-left: 4px solid #eab308;
        }
        .warning-box p {
            margin: 0;
            color: #854d0e;
            font-weight: 500;
        }
        .result-box {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border-radius: 12px;
            padding: var(--spacing-lg) var(--spacing-xl);
            margin: var(--spacing-lg) 0;
            border-left: 4px solid #10b981;
        }
        .result-box h4 {
            color: #065f46;
            margin-bottom: var(--spacing-sm);
        }
        .result-box ul {
            margin: var(--spacing-sm) 0;
            color: #047857;
        }
        .back-links {
            display: flex;
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-sm);
            color: #94a3b8;
            font-weight: 500;
            transition: color 0.3s ease;
        }
        .back-link:hover { color: #fff; }
        .back-link.primary:hover { color: #3b82f6; }
        .article-nav {
            display: flex;
            justify-content: space-between;
            padding: var(--spacing-xl) 0;
            border-top: 1px solid #e5e7eb;
            margin-top: var(--spacing-2xl);
        }
        .article-nav a {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            color: #2d5a87;
            font-weight: 600;
            transition: color 0.3s ease;
        }
        .article-nav a:hover { color: #1e3a5f; }
        .references {
            background: #f8fafc;
            padding: var(--spacing-lg) var(--spacing-xl);
            border-radius: 12px;
            margin-top: var(--spacing-xl);
        }
        .references h3 {
            font-size: 1rem;
            margin-bottom: var(--spacing-md);
            color: #1e3a5f;
        }
        .references ul {
            font-size: 0.9rem;
            color: #64748b;
        }
        .references a {
            color: #3b82f6;
            text-decoration: none;
        }
        .references a:hover {
            text-decoration: underline;
        }

        /* === HVAC PRO ENHANCEMENT MODE === */
        .hvac-evidence-block {
            margin: 2rem auto; max-width: 900px; padding: 2rem;
            background: linear-gradient(135deg, rgba(59,130,246,0.08) 0%, rgba(96,165,250,0.04) 100%);
            border: 1px solid rgba(59,130,246,0.25); border-radius: 16px;
        }
        .hvac-evidence-grid {
            display: grid; grid-template-columns: repeat(5, 1fr); gap: 1rem; margin-bottom: 1rem;
        }
        .hvac-evidence-card {
            text-align: center; padding: 1rem 0.5rem;
            background: rgba(59,130,246,0.06); border-radius: 10px;
        }
        .hvac-evidence-value {
            font-size: 1.5rem; font-weight: 800; color: #60a5fa;
            font-family: 'JetBrains Mono', monospace;
        }
        .hvac-evidence-label { font-size: 0.78rem; color: #94a3b8; margin-top: 0.25rem; }
        .hvac-evidence-sub { font-size: 0.68rem; color: #64748b; margin-top: 0.15rem; }
        .hvac-evidence-source {
            text-align: center; font-size: 0.72rem; color: #64748b;
            border-top: 1px solid rgba(59,130,246,0.15); padding-top: 0.75rem; margin-top: 0.5rem;
        }
        .hvac-cta-block {
            margin: 2rem 0; padding: 2rem; text-align: center;
            background: linear-gradient(135deg, rgba(59,130,246,0.12), rgba(96,165,250,0.06));
            border: 1px solid rgba(59,130,246,0.3); border-radius: 16px;
        }
        .hvac-cta-headline {
            font-size: 1.4rem; font-weight: 800; color: #e2e8f0; margin-bottom: 0.5rem;
        }
        .hvac-cta-subtitle { font-size: 0.92rem; color: #94a3b8; margin-bottom: 1.25rem; }
        .hvac-cta-btn {
            display: inline-block; padding: 0.75rem 2rem; font-weight: 700; font-size: 0.9rem;
            color: #fff; background: linear-gradient(135deg, #3b82f6, #60a5fa);
            border-radius: 10px; text-decoration: none; transition: transform 0.2s, box-shadow 0.2s;
        }
        .hvac-cta-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(59,130,246,0.4); }
        .hvac-toolbar {
            display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap;
            margin-bottom: 1.5rem; padding: 0.75rem 1rem;
            background: rgba(59,130,246,0.08); border: 1px solid rgba(59,130,246,0.2);
            border-radius: 10px;
        }
        .hvac-toolbar-btn {
            padding: 0.5rem 1rem; font-size: 0.82rem; font-weight: 600; border: none;
            border-radius: 8px; cursor: pointer; transition: all 0.2s;
            font-family: 'Inter', sans-serif;
        }
        .hvac-btn-free { background: rgba(59,130,246,0.15); color: #60a5fa; }
        .hvac-btn-free.active { background: #3b82f6; color: #fff; }
        .hvac-btn-pro { background: rgba(59,130,246,0.15); color: #60a5fa; }
        .hvac-btn-pro.active { background: linear-gradient(135deg, #3b82f6, #2563eb); color: #fff; }
        .hvac-btn-reset { background: rgba(148,163,184,0.15); color: #94a3b8; margin-left: auto; }
        .hvac-btn-reset:hover { background: rgba(148,163,184,0.25); }
        .hvac-btn-pdf { background: rgba(59,130,246,0.15); color: #60a5fa; }
        .hvac-btn-pdf:hover { background: rgba(59,130,246,0.3); }
        .hvac-pro-container { display: none; margin-top: 2rem; }
        .hvac-pro-container.visible { display: block; }
        .hvac-pro-panel {
            margin-bottom: 1.5rem; padding: 1.5rem;
            background: rgba(59,130,246,0.06); border: 1px solid rgba(59,130,246,0.2);
            border-radius: 14px; position: relative; overflow: hidden;
        }
        .hvac-pro-panel.gated .hvac-panel-content { filter: blur(6px); pointer-events: none; user-select: none; }
        .hvac-gate-overlay {
            position: absolute; inset: 0; display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 10; cursor: pointer;
            background: rgba(15,23,42,0.7); backdrop-filter: blur(4px);
        }
        .hvac-gate-overlay i { font-size: 2rem; color: #60a5fa; margin-bottom: 0.5rem; }
        .hvac-gate-overlay span { color: #cbd5e1; font-size: 0.85rem; font-weight: 600; }
        .hvac-panel-title {
            font-size: 0.95rem; font-weight: 700; color: #60a5fa; margin-bottom: 0.75rem;
            display: flex; align-items: center; gap: 0.5rem;
        }
        .hvac-kpi-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.75rem; }
        .hvac-kpi-card {
            padding: 0.75rem; background: rgba(59,130,246,0.08); border-radius: 10px;
            text-align: center;
        }
        .hvac-kpi-value {
            font-size: 1.4rem; font-weight: 800; color: #60a5fa;
            font-family: 'JetBrains Mono', monospace;
        }
        .hvac-kpi-label { font-size: 0.72rem; color: #94a3b8; margin-top: 0.2rem; }
        .hvac-chart-container { margin-top: 1rem; }
        .hvac-chart-container canvas { width: 100%; max-height: 280px; }
        .hvac-narrative-box {
            margin-top: 1rem; padding: 1rem; font-size: 0.85rem; line-height: 1.6;
            color: #cbd5e1; background: rgba(59,130,246,0.05);
            border-left: 3px solid #3b82f6; border-radius: 0 8px 8px 0;
        }
        .hvac-sensitivity-bar {
            display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;
        }
        .hvac-sensitivity-label { min-width: 110px; font-size: 0.78rem; color: #94a3b8; }
        .hvac-sensitivity-track {
            flex: 1; height: 20px; background: rgba(255,255,255,0.05);
            border-radius: 4px; position: relative; overflow: hidden;
        }
        .hvac-sensitivity-fill {
            height: 100%; border-radius: 4px; transition: width 0.3s;
        }
        .hvac-sensitivity-value {
            min-width: 60px; text-align: right; font-size: 0.78rem;
            color: #60a5fa; font-family: 'JetBrains Mono', monospace;
        }
        .hvac-kpi-grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; margin-top: 0.75rem; }
        .hvac-kpi-sublabel { font-size: 0.65rem; color: #64748b; margin-top: 0.1rem; }
        .hvac-section-divider {
            margin: 1rem 0 0.75rem; padding-top: 0.75rem;
            border-top: 1px solid rgba(59,130,246,0.15);
            font-size: 0.82rem; font-weight: 700; color: #94a3b8;
        }
        .hvac-tornado-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 0.75rem;
        }
        .hvac-tornado-header span { font-size: 0.85rem; font-weight: 700; color: #60a5fa; }
        .hvac-tornado-baseline {
            position: absolute; top: 0; bottom: 0; width: 2px;
            background: rgba(255,255,255,0.3); left: 50%; z-index: 1;
        }
        .hvac-tornado-track {
            flex: 1; height: 24px; background: rgba(255,255,255,0.05);
            border-radius: 4px; position: relative; overflow: hidden;
        }
        .hvac-tornado-fill-neg {
            position: absolute; height: 100%; right: 50%; border-radius: 4px 0 0 4px;
            transition: width 0.3s;
        }
        .hvac-tornado-fill-pos {
            position: absolute; height: 100%; left: 50%; border-radius: 0 4px 4px 0;
            transition: width 0.3s;
        }
        .hvac-tornado-val-left {
            min-width: 55px; text-align: right; font-size: 0.72rem;
            color: #f87171; font-family: 'JetBrains Mono', monospace;
        }
        .hvac-tornado-val-right {
            min-width: 55px; text-align: left; font-size: 0.72rem;
            color: #4ade80; font-family: 'JetBrains Mono', monospace;
        }
        .hvac-narrative-paragraph { margin-bottom: 0.75rem; }
        .hvac-narrative-paragraph:last-child { margin-bottom: 0; }
        .hvac-narrative-paragraph strong { color: #60a5fa; }
        .hvac-narrative-heading {
            font-size: 0.82rem; font-weight: 700; color: #60a5fa;
            margin-bottom: 0.35rem; display: flex; align-items: center; gap: 0.4rem;
        }
        .hvac-confidence-badge {
            display: inline-block; padding: 0.15rem 0.5rem; border-radius: 4px;
            font-size: 0.72rem; font-weight: 700; margin-left: 0.5rem;
        }
        .hvac-confidence-high { background: rgba(34,197,94,0.15); color: #4ade80; }
        .hvac-confidence-med { background: rgba(245,158,11,0.15); color: #fbbf24; }
        .hvac-confidence-low { background: rgba(239,68,68,0.15); color: #f87171; }
        .hvac-milestone-bar {
            display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.4rem;
        }
        .hvac-milestone-year {
            min-width: 50px; font-size: 0.75rem; font-weight: 600; color: #94a3b8;
            font-family: 'JetBrains Mono', monospace;
        }
        .hvac-milestone-track {
            flex: 1; height: 18px; background: rgba(255,255,255,0.05);
            border-radius: 4px; position: relative; overflow: hidden;
        }
        .hvac-milestone-fill {
            height: 100%; border-radius: 4px; transition: width 0.3s;
        }
        .hvac-milestone-label {
            font-size: 0.72rem; color: #cbd5e1; min-width: 90px;
        }
        .hvac-login-overlay {
            display: none; position: fixed; inset: 0; z-index: 9999;
            background: rgba(0,0,0,0.75); backdrop-filter: blur(8px);
            align-items: center; justify-content: center;
        }
        .hvac-login-overlay.visible { display: flex; }
        .hvac-login-box {
            background: #0f172a; border: 1px solid rgba(59,130,246,0.3);
            border-radius: 16px; padding: 2rem; width: 90%; max-width: 400px;
            position: relative;
        }
        .hvac-login-close {
            position: absolute; top: 1rem; right: 1rem; background: none; border: none;
            color: #94a3b8; font-size: 1.5rem; cursor: pointer;
        }
        .hvac-login-title { font-size: 1.2rem; font-weight: 700; color: #e2e8f0; margin-bottom: 0.25rem; }
        .hvac-login-subtitle { font-size: 0.85rem; color: #94a3b8; margin-bottom: 1.5rem; }
        .hvac-login-input {
            width: 100%; padding: 0.75rem 1rem; margin-bottom: 0.75rem;
            background: #1e293b; border: 1px solid #334155;
            border-radius: 8px; color: #e2e8f0; font-size: 0.9rem;
            font-family: 'Inter', sans-serif; box-sizing: border-box;
        }
        .hvac-login-input:focus { outline: none; border-color: #3b82f6; }
        .hvac-login-error { color: #f87171; font-size: 0.8rem; margin-bottom: 0.75rem; display: none; }
        .hvac-login-submit {
            width: 100%; padding: 0.75rem; font-weight: 700; font-size: 0.9rem;
            color: #fff; background: linear-gradient(135deg, #3b82f6, #2563eb);
            border: none; border-radius: 8px; cursor: pointer;
            font-family: 'Inter', sans-serif; transition: opacity 0.2s;
        }
        .hvac-login-submit:hover { opacity: 0.9; }
        .hvac-login-demo {
            text-align: center; margin-top: 1rem; font-size: 0.75rem; color: #64748b;
        }
        [data-theme="light"] .hvac-login-box { background: #ffffff; border-color: #e2e8f0; }
        [data-theme="light"] .hvac-login-title { color: #1e293b; }
        [data-theme="light"] .hvac-login-subtitle { color: #64748b; }
        [data-theme="light"] .hvac-login-input { background: #f1f5f9; border-color: #e2e8f0; color: #1e293b; }
        .hvac-privacy-badge {
            display: flex; align-items: center; justify-content: center; gap: 0.5rem;
            margin-top: 1.5rem; font-size: 0.75rem; color: #64748b;
        }
        .hvac-privacy-badge i { color: #3b82f6; }
        .hvac-benchmark-meta {
            display: none;
        }
        .tooltip-trigger {
            display: inline-flex; align-items: center; justify-content: center;
            width: 16px; height: 16px; border-radius: 50%; font-size: 0.65rem;
            font-weight: 700; color: #60a5fa; background: rgba(59,130,246,0.15);
            cursor: help; margin-left: 0.35rem; position: relative; vertical-align: middle;
        }
        .tooltip-content {
            display: none; position: fixed; z-index: 9998;
            width: 260px; padding: 0.85rem; background: #1e293b;
            border: 1px solid rgba(59,130,246,0.3); border-radius: 10px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.4);
        }
        .tooltip-content.visible { display: block; }
        .tooltip-title { font-size: 0.82rem; font-weight: 700; color: #60a5fa; margin-bottom: 0.35rem; }
        .tooltip-desc { font-size: 0.78rem; color: #cbd5e1; line-height: 1.5; margin-bottom: 0.35rem; }
        .tooltip-formula {
            font-size: 0.72rem; color: #3b82f6; font-family: 'JetBrains Mono', monospace;
            background: rgba(59,130,246,0.08); padding: 0.35rem 0.5rem; border-radius: 6px;
        }
        .hvac-region-select-row {
            display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;
        }
        .hvac-region-select-row label {
            color: #94a3b8; font-size: 0.85rem; font-weight: 600;
        }
        .hvac-region-dropdown {
            padding: 0.5rem 0.75rem; background: rgba(255,255,255,0.08);
            border: 1px solid rgba(59,130,246,0.25); border-radius: 8px;
            color: #e2e8f0; font-size: 0.85rem; font-family: 'Inter', sans-serif;
            cursor: pointer;
        }
        .hvac-region-dropdown option { background: #1e293b; color: #fff; }
        [data-theme="dark"] .hvac-evidence-block { background: linear-gradient(135deg, rgba(59,130,246,0.12) 0%, rgba(96,165,250,0.06) 100%); }
        [data-theme="dark"] .hvac-gate-overlay { background: rgba(15,23,42,0.8); }
        [data-theme="dark"] .hvac-cta-block { background: linear-gradient(135deg, rgba(59,130,246,0.15), rgba(96,165,250,0.08)); }
        [data-theme="dark"] .article-content { background: #0f172a; }
        [data-theme="dark"] .article-body { background: #0f172a; color: #e2e8f0; }
        [data-theme="dark"] .article-body h2 { color: #93c5fd; }
        [data-theme="dark"] .article-body h3 { color: #cbd5e1; }
        [data-theme="dark"] .article-body p { color: #cbd5e1; }
        [data-theme="dark"] .article-body blockquote { background: rgba(30,58,95,0.3); border-color: rgba(96,165,250,0.4); color: #cbd5e1; }
        [data-theme="dark"] .article-body .info-box,
        [data-theme="dark"] .article-body .key-insight { background: rgba(15,23,42,0.8); border-color: rgba(255,255,255,0.1); color: #cbd5e1; }
        [data-theme="dark"] .highlight-box { background: rgba(245,158,11,0.1); border-color: rgba(245,158,11,0.4); }
        [data-theme="dark"] .highlight-box p { color: #fbbf24; }
        [data-theme="dark"] .warning-box { background: rgba(239,68,68,0.1); border-color: rgba(239,68,68,0.4); }
        [data-theme="dark"] .warning-box p { color: #fca5a5; }
        [data-theme="dark"] .result-box { background: rgba(16,185,129,0.1); border-color: rgba(16,185,129,0.4); }
        [data-theme="dark"] .result-box h4 { color: #34d399; }
        [data-theme="dark"] .result-box p { color: #6ee7b7; }
        [data-theme="dark"] .references { background: rgba(15,23,42,0.8); border-color: rgba(6,182,212,0.4); }
        [data-theme="dark"] .references h3 { color: #93c5fd; }
        [data-theme="dark"] .references ol { color: #94a3b8; }
        [data-theme="dark"] .article-body table th { background: #0f172a; color: #e2e8f0; }
        [data-theme="dark"] .article-body table td { color: #cbd5e1; border-color: rgba(255,255,255,0.1); }
        [data-theme="dark"] .article-body ul li,
        [data-theme="dark"] .article-body ol li { color: #cbd5e1; }
        [data-theme="dark"] .article-body a { color: #60a5fa; }
        [data-theme="dark"] .article-body strong { color: #f1f5f9; }

        @media (max-width: 768px) {
            .article-hero { padding: 6rem 1rem 3rem; }
            .article-meta { flex-direction: column; gap: var(--spacing-md); }
            .article-content { padding: var(--spacing-xl) var(--spacing-md); }
            .article-body { font-size: 1rem; }
            .chart-container { padding: var(--spacing-md); }
            .pros-cons-grid { grid-template-columns: 1fr; }
            .comparison-table { font-size: 0.8rem; }
            .comparison-table th, .comparison-table td { padding: var(--spacing-sm); }
            .verdict-container { grid-template-columns: 1fr; }
            .verdict-box { position: static; }
            .comparison-flow { grid-template-columns: 1fr; }
            .flow-arrow { transform: rotate(90deg); padding: var(--spacing-md) 0; }
            .timeline-header, .timeline-row { grid-template-columns: 60px 70px 1fr; font-size: 0.75rem; }
            .timeline-header > :last-child, .timeline-row > :last-child { display: none; }
            .hvac-evidence-grid { grid-template-columns: repeat(2, 1fr); }
            .hvac-kpi-grid { grid-template-columns: repeat(2, 1fr); }
            .hvac-kpi-grid-4 { grid-template-columns: repeat(2, 1fr); }
            .hvac-toolbar { flex-wrap: wrap; }
            .hvac-region-select-row { flex-direction: column; align-items: flex-start; }
        }
    
        /* Result Card Tooltip System */
        .kpi-label { position: relative; }
        .kpi-tooltip {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 14px;
            height: 14px;
            background: rgba(245,158,11,0.15);
            border: 1px solid rgba(245,158,11,0.3);
            border-radius: 50%;
            font-size: 0.6rem;
            font-weight: 700;
            color: #fbbf24;
            margin-left: 4px;
            cursor: help;
            position: relative;
            flex-shrink: 0;
            vertical-align: middle;
        }
        .kpi-tooltip:hover { background: rgba(245,158,11,0.3); transform: scale(1.15); }
        .kpi-tooltip .kpi-tip {
            visibility: hidden;
            opacity: 0;
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            background: #1e293b;
            color: #e2e8f0;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            font-size: 0.72rem;
            font-weight: 400;
            line-height: 1.5;
            width: 260px;
            z-index: 100;
            box-shadow: 0 8px 25px rgba(0,0,0,0.5);
            border: 1px solid rgba(245,158,11,0.2);
            transition: opacity 0.2s ease;
            pointer-events: none;
            text-transform: none;
            letter-spacing: normal;
        }
        .kpi-tooltip:hover .kpi-tip { visibility: visible; opacity: 1; }
        .kpi-tip .tt { font-weight: 700; color: #fbbf24; margin-bottom: 3px; font-size: 0.75rem; }
        .kpi-tip .td { color: #cbd5e1; }
        .kpi-tip .tf { font-family: 'JetBrains Mono', monospace; font-size: 0.68rem; background: rgba(0,0,0,0.3); padding: 3px 7px; border-radius: 4px; color: #67e8f9; margin-top: 4px; display: block; }
</style>
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0" defer></script>
</head>
<body>
    <!-- Reading Progress Bar -->
    <div class="scroll-progress" id="scrollProgress"></div>

    <!-- Search Overlay & Modal -->
    <div class="search-overlay" id="searchOverlay"></div>
    <div class="search-modal" id="searchModal">
        <div class="search-input-wrap">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
            <input type="text" class="search-input" id="searchInput" placeholder="Search articles, calculators, tools..." autocomplete="off">
            <kbd class="search-kbd">ESC</kbd>
        </div>
        <div class="search-chips" id="searchChips">
            <button class="search-chip active" data-filter="all">All</button>
            <button class="search-chip" data-filter="articles">Articles</button>
            <button class="search-chip" data-filter="calculators">Calculators</button>
            <button class="search-chip" data-filter="tools">Tools</button>
        </div>
        <div class="search-results" id="searchResults">
            <div class="search-empty">Type to search across all content</div>
        </div>
        <div class="search-footer">
            <span><kbd class="search-kbd">&uarr;&darr;</kbd> Navigate</span>
            <span><kbd class="search-kbd">Enter</kbd> Open</span>
        </div>
    </div>
    <div class="search-preview" id="searchPreview"></div>

    <!-- TOC Sidebar (desktop, wide screens) -->
    <nav class="toc-sidebar" id="tocSidebar" aria-label="Table of Contents">
        <div class="toc-sidebar-label">On this page</div>
        <ul class="toc-sidebar-list" id="tocSidebarList"></ul>
    </nav>

    <!-- TOC Mobile Toggle -->
    <button class="toc-mobile-toggle" id="tocMobileToggle" aria-label="Table of contents">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
    </button>
    <div class="toc-mobile-backdrop" id="tocMobileBackdrop"></div>
    <div class="toc-mobile-drawer" id="tocMobileDrawer">
        <div class="toc-drawer-header">
            <span class="toc-drawer-title">Table of Contents</span>
            <button class="toc-drawer-close" id="tocDrawerClose" aria-label="Close">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
            </button>
        </div>
        <ul class="toc-mobile-list" id="tocMobileList"></ul>
    </div>


    <a href="#main-content" class="skip-link">Skip to main content</a>
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">
                <img loading="lazy" src="assets/profile-photo.jpg" alt="Bagus Dwi Permana" class="nav-avatar">
            </a>
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link">Home</a></li>
                <li class="nav-dropdown">
                    <a href="datacenter-solutions.html" class="nav-link">
                        DC Solutions
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="datacenter-solutions.html" style="color: #06b6d4; font-weight: 600;">DC Solutions Hub</a></li>
                        <li style="border-bottom: 1px solid rgba(255,255,255,0.1); margin: 4px 0;"></li>
                        <li><a href="datahallAI.html" style="color: #8b5cf6;">DC AI/HPC</a></li>
                        <li><a href="dc-conventional.html">DC Conventional</a></li>
                        <li style="border-bottom: 1px solid rgba(255,255,255,0.1); margin: 4px 0;"></li>
                        <li><a href="capex-calculator.html" style="color: #f59e0b;">CAPEX Calculator</a></li>
                        <li><a href="opex-calculator.html" style="color: #10b981;">OPEX Calculator</a></li>
                        <li style="border-bottom: 1px solid rgba(255,255,255,0.1); margin: 4px 0;"></li>
                        <li><a href="dcmoc/" style="color: #ef4444; font-weight: 600;">DC MOC</a></li>
                    </ul>
                </li>
                <li><a href="index.html#metrics" class="nav-link">Results</a></li>
                <li><a href="index.html#case-studies" class="nav-link">Case Studies</a></li>
                <li><a href="articles.html" class="nav-link">Articles</a></li>
                <li><a href="index.html#faq" class="nav-link">FAQ</a></li>
                <li><a href="index.html#contact" class="nav-link">Contact</a></li>
            </ul>
                        <button class="nav-search-btn" id="navSearchBtn" aria-label="Search" title="Search (Ctrl+K)">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
            </button>
            <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode" title="Toggle dark/light mode">
                <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
                <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="5"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="23"></line>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                    <line x1="1" y1="12" x2="3" y2="12"></line>
                    <line x1="21" y1="12" x2="23" y2="12"></line>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                </svg>
            </button>
            <button class="hamburger" aria-label="Open navigation menu" aria-expanded="false">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </button>
        </div>
    </nav>

    <main id="main-content">
    <section class="article-hero">
        <div class="container">
            <div class="back-links">
                <a href="articles.html" class="back-link primary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                    Back to Articles
                </a>
                <a href="index.html" class="back-link">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                        <polyline points="9 22 9 12 15 12 15 22"/>
                    </svg>
                    Back to Portfolio
                </a>
            </div>
            <span class="article-category">Critical Infrastructure</span>
            <h1 class="article-title">The HVAC Shock No One Priced In: "No Chillers" Doesn't Mean "No Cooling"</h1>
            <p class="article-subtitle">A comprehensive technical analysis of chiller-free cooling for data centers, with tropical climate implementation guide, fault scenario analysis, and operational considerations.</p>
            <div class="article-meta">
                <span class="article-meta-item">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 6v6l4 2"/>
                    </svg>
                    18 min read
                </span>
                <span class="article-meta-item">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                        <line x1="16" y1="2" x2="16" y2="6"/>
                        <line x1="8" y1="2" x2="8" y2="6"/>
                        <line x1="3" y1="10" x2="21" y2="10"/>
                    </svg>
                    February 7, 2026
                </span>
                <span class="article-meta-item">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                        <circle cx="12" cy="7" r="4"/>
                    </svg>
                    Bagus Dwi Permana
                </span>
            </div>

            <!-- Download Button -->
            <div class="download-section">
                <a href="article-9-paper.pdf" class="download-btn" download>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    Download Complete Paper (PDF)
                </a>
            </div>
        </div>
    </section>
    <!-- Series Navigation -->
    <div class="series-nav" style="margin-top: 1rem;">
        <div class="series-badge">
            <span class="series-badge-icon">09</span>
            Engineering Journal &mdash; Article 9 of 18
        </div>
        <span class="series-title"></span>
        <div class="series-links">
            <a href="article-8.html" class="series-link"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>Prev</a>
            <a href="article-10.html" class="series-link">Next<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg></a>
        </div>
    </div>


    <!-- Pro Evidence Block -->
    <div class="hvac-evidence-block">
        <div class="hvac-evidence-grid">
            <div class="hvac-evidence-card">
                <div class="hvac-evidence-value">7.5%</div>
                <div class="hvac-evidence-label">Johnson Controls Stock Drop</div>
                <div class="hvac-evidence-sub">Nvidia CES 2026</div>
            </div>
            <div class="hvac-evidence-card">
                <div class="hvac-evidence-value">$1.7B</div>
                <div class="hvac-evidence-label">Market Cap Lost in Hours</div>
                <div class="hvac-evidence-sub">HVAC sector panic</div>
            </div>
            <div class="hvac-evidence-card">
                <div class="hvac-evidence-value">3</div>
                <div class="hvac-evidence-label">Cooling Methods Compared</div>
                <div class="hvac-evidence-sub">Traditional, Hybrid, DLC</div>
            </div>
            <div class="hvac-evidence-card">
                <div class="hvac-evidence-value">15-45%</div>
                <div class="hvac-evidence-label">Energy Savings Range</div>
                <div class="hvac-evidence-sub">DLC vs Traditional</div>
            </div>
            <div class="hvac-evidence-card">
                <div class="hvac-evidence-value">8</div>
                <div class="hvac-evidence-label">Regions Analyzed</div>
                <div class="hvac-evidence-sub">Implementation verdict</div>
            </div>
        </div>
        <div class="hvac-evidence-source">
            <i class="fas fa-calculator" style="margin-right:4px;"></i> Based on operational data from 8 climate regions | PUE modeling from ASHRAE & Uptime Institute benchmarks
        </div>
    </div>

    <article class="article-content">
        <div class="container">
            <div class="article-body">

                <!-- TL;DR Section -->
                <div class="tldr-box">
                    <h4>Key Takeaways</h4>
                    <ul>
                        <li><strong>Nvidia's Rubin claim:</strong> Warm-water, single-phase direct liquid cooling (DLC) with ~45°C supply temperature; the company says no water chillers are necessary.</li>
                        <li><strong>Capex rotation, not deletion:</strong> The chiller plant shrinks, but pumps, coolant distribution units (CDUs), and controls grow significantly.</li>
                        <li><strong>Cooling doesn't go away:</strong> The bottleneck moves into distribution, controls, and commissioning. The real trade is in the plant room, not the silicon.</li>
                        <li><strong>Tropical implementation:</strong> Requires hybrid approach with 40-50% chiller backup capacity due to high ambient temperature and humidity.</li>
                        <li><strong>Fault dynamics change:</strong> Liquid cooling fails FASTER but recovers FASTER than traditional systems - requires enhanced monitoring.</li>
                    </ul>
                </div>

                <!-- Pro CTA Block -->
                <div class="hvac-cta-block">
                    <div class="hvac-cta-headline">Calculate Your Cooling Architecture Impact</div>
                    <div class="hvac-cta-subtitle">Compare PUE, energy cost, and ROI across 3 cooling strategies for your facility</div>
                    <a href="#pueChart" class="hvac-cta-btn"><i class="fas fa-calculator" style="margin-right:6px;"></i> Open PUE Calculator</a>
                </div>

                <section class="toc-section">
                    <div class="toc-container">
                        <h2 class="toc-title">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="8" y1="6" x2="21" y2="6"></line>
                                <line x1="8" y1="12" x2="21" y2="12"></line>
                                <line x1="8" y1="18" x2="21" y2="18"></line>
                                <line x1="3" y1="6" x2="3.01" y2="6"></line>
                                <line x1="3" y1="12" x2="3.01" y2="12"></line>
                                <line x1="3" y1="18" x2="3.01" y2="18"></line>
                            </svg>
                            Table of Contents
                        </h2>
                        <div class="toc-grid">
                            <a href="#section-1" class="toc-item">
                                <div class="toc-item-number">SECTION 1</div>
                                <div class="toc-item-title">The Moment: One Sentence, Billions of Market Cap</div>
                            </a>
                            <a href="#section-2" class="toc-item">
                                <div class="toc-item-number">SECTION 2</div>
                                <div class="toc-item-title">What Nvidia Actually Announced</div>
                            </a>
                            <a href="#section-3" class="toc-item">
                                <div class="toc-item-number">SECTION 3</div>
                                <div class="toc-item-title">"No Chillers" ≠ "No Cooling": The Plant-Room Reality</div>
                            </a>
                            <a href="#section-4" class="toc-item">
                                <div class="toc-item-number">SECTION 4</div>
                                <div class="toc-item-title">Tropical Climate: The Physics Problem</div>
                            </a>
                            <a href="#section-5" class="toc-item">
                                <div class="toc-item-number">SECTION 5</div>
                                <div class="toc-item-title">Fault Scenario Analysis: In-Depth</div>
                            </a>
                            <a href="#section-6" class="toc-item toc-calculator">
                                <div class="toc-item-number">SECTION 6 <span class="toc-calc-badge"><i class="fas fa-calculator" style="font-size:0.5rem;"></i> Interactive</span></div>
                                <div class="toc-item-title">Interactive: PUE Impact Calculator</div>
                            </a>
                            <a href="#section-7" class="toc-item">
                                <div class="toc-item-number">SECTION 7</div>
                                <div class="toc-item-title">Pros and Cons Analysis</div>
                            </a>
                            <a href="#section-8" class="toc-item">
                                <div class="toc-item-number">SECTION 8</div>
                                <div class="toc-item-title">Regional Implementation Verdict</div>
                            </a>
                            <a href="#section-9" class="toc-item">
                                <div class="toc-item-number">SECTION 9</div>
                                <div class="toc-item-title">Conclusion</div>
                            </a>
                        </div>
                    </div>
                </section>

                <h2 id="section-1">1. The Moment: One Sentence, Billions of Market Cap</h2>

                <figure class="featured-image">
                    <img loading="lazy" src="assets/article-9.1_.jpg" alt="Data Center Cooling Infrastructure">
                    <figcaption>Modern data center cooling architecture</figcaption>
                </figure>

                <p>CES 2026 wasn't supposed to be about HVAC, but a single line from Jensen Huang sent billions of market cap tumbling. Onstage, he declared that <strong>"no water chillers are necessary for data centres"</strong> when describing the warm-water DLC in Nvidia's Vera Rubin platform.</p>

                <div class="market-impact">
                    <h4>Street Reaction - Within Hours</h4>
                    <div class="stock-grid">
                        <div class="stock-item">
                            <div class="stock-name">Johnson Controls</div>
                            <div class="stock-change">-7.5%</div>
                        </div>
                        <div class="stock-item">
                            <div class="stock-name">Trane Technologies</div>
                            <div class="stock-change">-5.3%</div>
                        </div>
                        <div class="stock-item">
                            <div class="stock-name">Carrier Global</div>
                            <div class="stock-change">-1.1%</div>
                        </div>
                    </div>
                    <p style="margin-top: 1rem; font-size: 0.9rem; color: #991b1b;">Data centres represent roughly 10-15% of Johnson Controls' sales, ~10% for Trane, and 5% for Carrier. The market's linear assumption that "AI = more chiller demand" was suddenly under threat.</p>
                </div>

                <h2 id="section-2">2. What Nvidia Actually Announced</h2>

                <p>Rubin is not a single chip but a rack-scale platform co-designed across compute, networking, power, and cooling. It combines GPUs, CPUs, and networking into one rack with sixth-generation NVLink interconnects and an MGX architecture for serviceability &mdash; part of the broader shift toward <a href="article-18.html">AI factory infrastructure and GPU-dense computing</a> that is reshaping facility design.</p>

                <div class="key-insight">
                    <h4>The Interesting Bit for Facility Operators</h4>
                    <p>Nvidia's technical blog describes warm-water, single-phase direct liquid cooling operating at a supply temperature around <strong>45°C</strong>. Liquid captures heat more efficiently than air, enabling higher operating temperatures and reducing fan and chiller energy. The higher supply temperature allows dry-cooler operation with minimal water usage. Rubin also doubles liquid flow rates at the same CDU pressure head to ensure rapid heat removal under sustained extreme workloads.</p>
                </div>

                <blockquote>
                    "The air flow is about the same and the water that goes into it is the same temperature, 45°C... no water chillers are necessary for data centres." — Jensen Huang, CES 2026
                </blockquote>

                <p>The nuance lies in <strong>"necessary"</strong> — not "no cooling".</p>

                <h2 id="section-3">3. "No Chillers" ≠ "No Cooling": The Plant-Room Reality</h2>

                <h3>Understanding the Terminology</h3>

                <ul>
                    <li><strong>Chiller:</strong> A mechanical refrigeration plant that cools water to 6-12°C for CRAH/CRAC units. Energy-intensive (0.5-0.7 kW/ton) but decouples heat rejection from ambient temperature.</li>
                    <li><strong>Heat rejection:</strong> The unavoidable requirement to dump IT heat into the environment. Whether via evaporative towers, dry coolers, or district heating, the heat has to go somewhere.</li>
                    <li><strong>Direct Liquid Cooling (DLC):</strong> Coolant flows directly to heat-generating components via cold plates, capturing 70-80% of heat at the source.</li>
                    <li><strong>CDU (Coolant Distribution Unit):</strong> The heart of liquid cooling - pumps, heat exchangers, and controls that manage coolant flow.</li>
                </ul>

                <!-- Enhanced Before vs After Diagram -->
                <div class="tech-box">
                    <div class="tech-box-header">
                        <div class="tech-box-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"/>
                            </svg>
                        </div>
                        <h4>Before vs After: The Cooling Stack Transformation</h4>
                    </div>

                    <div class="comparison-flow">
                        <div class="flow-column before">
                            <h5>Traditional Chiller-Based</h5>
                            <div class="flow-item">
                                <div class="flow-item-icon" style="background: rgba(239, 68, 68, 0.2); color: #f87171;">1</div>
                                <span>CRAH/CRAC Units</span>
                            </div>
                            <div class="flow-item">
                                <div class="flow-item-icon" style="background: rgba(59, 130, 246, 0.2); color: #60a5fa;">2</div>
                                <span>Chilled Water Loop (7°C)</span>
                            </div>
                            <div class="flow-item">
                                <div class="flow-item-icon" style="background: rgba(168, 85, 247, 0.2); color: #a78bfa;">3</div>
                                <span>Chiller Plant</span>
                            </div>
                            <div class="flow-item">
                                <div class="flow-item-icon" style="background: rgba(34, 197, 94, 0.2); color: #4ade80;">4</div>
                                <span>Cooling Tower</span>
                            </div>
                        </div>

                        <div class="flow-arrow">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M5 12h14M12 5l7 7-7 7"/>
                            </svg>
                            <span>Transform</span>
                        </div>

                        <div class="flow-column after">
                            <h5>Warm-Water DLC System</h5>
                            <div class="flow-item">
                                <div class="flow-item-icon" style="background: rgba(34, 197, 94, 0.2); color: #4ade80;">1</div>
                                <span>Direct-to-Chip Cold Plates</span>
                            </div>
                            <div class="flow-item">
                                <div class="flow-item-icon" style="background: rgba(59, 130, 246, 0.2); color: #60a5fa;">2</div>
                                <span>CDU (Coolant Distribution)</span>
                            </div>
                            <div class="flow-item">
                                <div class="flow-item-icon" style="background: rgba(245, 158, 11, 0.2); color: #fbbf24;">3</div>
                                <span>Warm Water Loop (45°C)</span>
                            </div>
                            <div class="flow-item">
                                <div class="flow-item-icon" style="background: rgba(34, 197, 94, 0.2); color: #4ade80;">4</div>
                                <span>Dry Coolers (+ Optional Chiller)</span>
                            </div>
                        </div>
                    </div>

                    <div style="text-align: center; padding: var(--spacing-md); background: rgba(59, 130, 246, 0.1); border-radius: 8px; margin-top: var(--spacing-md);">
                        <span style="color: #60a5fa; font-weight: 600;">Key Insight:</span>
                        <span style="color: #94a3b8;"> Heat rejection NEVER disappears — only the METHOD changes. Components shift, complexity redistributes.</span>
                    </div>
                </div>

                <h3>Climate Matters: Where "No Chillers" Actually Works</h3>

                <ul>
                    <li><strong>Plausible "no chillers":</strong> Cold or temperate climates where ambient air rarely exceeds ~40°C (≈45°C supply minus ΔT). Dry coolers can reject heat for most of the year.</li>
                    <li><strong>Fewer chiller hours:</strong> Mixed or dry climates where warm months necessitate mechanical refrigeration during peak temperatures; hybrid designs use smaller chillers running fewer hours.</li>
                    <li><strong>Marketing spin:</strong> Hot/humid regions or tight SLA requirements where warm-water loops would drive unacceptable outlet temperatures; mechanical chillers remain primary, but marketing emphasises "reduced chiller load".</li>
                </ul>

                <h2 id="chiller-free-tropical">Is Chiller-Free Cooling Possible in Tropical Data Centers?</h2>

                <h2 id="section-4">4. Tropical Climate: The Physics Problem</h2>

                <!-- Enhanced Physics Problem Box -->
                <div class="tech-box">
                    <div class="tech-box-header">
                        <div class="tech-box-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z"/>
                            </svg>
                        </div>
                        <h4>Why Tropical Climate is the Worst-Case Scenario</h4>
                    </div>

                    <div class="diagram-section">
                        <div class="section-label">Challenge 1: High Ambient Temperature</div>
                        <pre>
<span class="info-line">Dry Cooler Physics:</span>
Heat Transfer = U × A × LMTD

Where LMTD (Log Mean Temperature Difference) requires:
  T_fluid_out > T_ambient + Approach_Temperature

<span class="highlight-line">Temperate Climate (Stockholm):</span>
  Design Ambient: 25°C (summer peak)
  Approach Temp:  5°C
  Fluid Out:      30°C minimum achievable
  45°C supply → 15°C margin ✓ WORKS YEAR-ROUND

<span class="danger-line">Tropical Climate (Jakarta):</span>
  Design Ambient: 35°C (frequent)
  Approach Temp:  5°C
  Fluid Out:      40°C minimum achievable
  45°C supply → 5°C margin ⚠️ MARGINAL

  Peak Ambient:   38-40°C (heat waves)
  Fluid Out:      43-45°C achievable
  45°C supply → 0-2°C margin ✗ INSUFFICIENT</pre>
                    </div>

                    <div class="diagram-section">
                        <div class="section-label">Challenge 2: High Humidity (Limits Evaporative Cooling)</div>
                        <div class="humidity-viz">
                            <h5>Adiabatic/Evaporative Cooling Effectiveness</h5>
                            <p style="color: #94a3b8; font-size: 0.85rem; margin-bottom: var(--spacing-md);">
                                <strong style="color: #60a5fa;">Wet Bulb Depression</strong> = T<sub>dry bulb</sub> - T<sub>wet bulb</sub>
                            </p>
                            <div class="humidity-bar-container">
                                <div class="humidity-bar-row">
                                    <span class="rh-label">30% RH</span>
                                    <div class="humidity-bar-track">
                                        <div class="humidity-bar-fill excellent" style="width: 100%;">10-12°C</div>
                                    </div>
                                    <span class="rating excellent">Excellent</span>
                                    <span style="color: #94a3b8; font-size: 0.8rem;">Desert Climate</span>
                                </div>
                                <div class="humidity-bar-row">
                                    <span class="rh-label">50% RH</span>
                                    <div class="humidity-bar-track">
                                        <div class="humidity-bar-fill good" style="width: 67%;">6-8°C</div>
                                    </div>
                                    <span class="rating good">Good</span>
                                    <span style="color: #94a3b8; font-size: 0.8rem;">Mediterranean</span>
                                </div>
                                <div class="humidity-bar-row">
                                    <span class="rh-label">70% RH</span>
                                    <div class="humidity-bar-track">
                                        <div class="humidity-bar-fill limited" style="width: 33%;">3-4°C</div>
                                    </div>
                                    <span class="rating limited">Limited</span>
                                    <span style="color: #94a3b8; font-size: 0.8rem;">Subtropical</span>
                                </div>
                                <div class="humidity-bar-row">
                                    <span class="rh-label">85% RH</span>
                                    <div class="humidity-bar-track">
                                        <div class="humidity-bar-fill minimal" style="width: 17%;">1-2°C</div>
                                    </div>
                                    <span class="rating minimal">Minimal</span>
                                    <span style="color: #94a3b8; font-size: 0.8rem;">Tropical</span>
                                </div>
                            </div>
                            <div class="humidity-note">
                                <strong>Jakarta/Singapore Average RH: 75-90%</strong><br>
                                Result: Evaporative pre-cooling provides minimal benefit
                            </div>
                        </div>
                    </div>

                    <div class="diagram-section">
                        <div class="section-label">Challenge 3: Limited Diurnal Temperature Swing</div>
                        <div class="diurnal-viz">
                            <h5>Nighttime Free Cooling Opportunity</h5>
                            <div class="temp-comparison">
                                <div class="temp-card temperate">
                                    <h6>
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="12" r="10"/>
                                            <path d="M12 2v4M12 18v4M2 12h4M18 12h4"/>
                                        </svg>
                                        Temperate Climate (Frankfurt)
                                    </h6>
                                    <div class="temp-range">
                                        <div class="temp-point">
                                            <div class="label">Summer Day</div>
                                            <div class="value">30°C</div>
                                        </div>
                                        <div class="temp-swing-bar"></div>
                                        <div class="temp-point">
                                            <div class="label">Summer Night</div>
                                            <div class="value">15°C</div>
                                        </div>
                                    </div>
                                    <div class="swing-result">
                                        <div class="swing-value">15°C Swing</div>
                                        <div class="swing-hours">8-10 hours of free cooling/day</div>
                                    </div>
                                </div>
                                <div class="temp-card tropical">
                                    <h6>
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M12 3v1M12 20v1M4.22 4.22l.71.71M18.36 18.36l.71.71M1 12h1M22 12h1M4.22 19.78l.71-.71M18.36 5.64l.71-.71"/>
                                            <circle cx="12" cy="12" r="5"/>
                                        </svg>
                                        Tropical Climate (Jakarta)
                                    </h6>
                                    <div class="temp-range">
                                        <div class="temp-point">
                                            <div class="label">Day</div>
                                            <div class="value">33°C</div>
                                        </div>
                                        <div class="temp-swing-bar"></div>
                                        <div class="temp-point">
                                            <div class="label">Night</div>
                                            <div class="value">25°C</div>
                                        </div>
                                    </div>
                                    <div class="swing-result">
                                        <div class="swing-value">8°C Swing</div>
                                        <div class="swing-hours">2-4 hours of marginal free cooling/day</div>
                                    </div>
                                </div>
                            </div>

                            <h5 style="color: #f59e0b; margin-top: var(--spacing-lg);">Annual Free Cooling Hours Comparison</h5>
                            <table class="free-cooling-table">
                                <thead>
                                    <tr>
                                        <th>Location</th>
                                        <th>Free Cooling Hours</th>
                                        <th>% of Year</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="location">Stockholm</td>
                                        <td class="hours">7,500 hrs</td>
                                        <td>
                                            <div class="percent-bar">
                                                <div class="percent-track">
                                                    <div class="percent-fill high" style="width: 86%;"></div>
                                                </div>
                                                <span class="percent-value high">86%</span>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="location">Frankfurt</td>
                                        <td class="hours">5,200 hrs</td>
                                        <td>
                                            <div class="percent-bar">
                                                <div class="percent-track">
                                                    <div class="percent-fill medium" style="width: 59%;"></div>
                                                </div>
                                                <span class="percent-value medium">59%</span>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="location">Virginia</td>
                                        <td class="hours">4,000 hrs</td>
                                        <td>
                                            <div class="percent-bar">
                                                <div class="percent-track">
                                                    <div class="percent-fill low" style="width: 46%;"></div>
                                                </div>
                                                <span class="percent-value low">46%</span>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="location">Singapore</td>
                                        <td class="hours">400 hrs</td>
                                        <td>
                                            <div class="percent-bar">
                                                <div class="percent-track">
                                                    <div class="percent-fill critical" style="width: 4.5%;"></div>
                                                </div>
                                                <span class="percent-value critical">4.5%</span>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="location">Jakarta</td>
                                        <td class="hours">600 hrs</td>
                                        <td>
                                            <div class="percent-bar">
                                                <div class="percent-track">
                                                    <div class="percent-fill critical" style="width: 6.8%;"></div>
                                                </div>
                                                <span class="percent-value critical">6.8%</span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <p class="table-source" style="font-size:0.72rem;color:#64748b;font-style:italic;margin:0.4rem 0 1.2rem;">Source: Publicly available industry data and published standards. For educational and research purposes only.</p>
                    </div>
                </div>

                <div class="tropical-box">
                    <h4>Southeast Asian Climate Conditions</h4>
                    <p>A warm and humid climate like Singapore or Jakarta is the <strong>worst-case scenario</strong> for free cooling. The combination of high temperature AND high humidity eliminates both primary free cooling mechanisms.</p>
                    <div class="climate-grid">
                        <div class="climate-card">
                            <div class="climate-city">Jakarta</div>
                            <div class="climate-temp">27-35°C</div>
                            <div class="climate-rh">RH: 75-85%</div>
                        </div>
                        <div class="climate-card">
                            <div class="climate-city">Singapore</div>
                            <div class="climate-temp">27-34°C</div>
                            <div class="climate-rh">RH: 80-90%</div>
                        </div>
                        <div class="climate-card">
                            <div class="climate-city">Bangkok</div>
                            <div class="climate-temp">29-38°C</div>
                            <div class="climate-rh">RH: 70-80%</div>
                        </div>
                        <div class="climate-card">
                            <div class="climate-city">Manila</div>
                            <div class="climate-temp">28-36°C</div>
                            <div class="climate-rh">RH: 75-85%</div>
                        </div>
                    </div>
                </div>

                <h2 id="section-5">5. Fault Scenario Analysis: In-Depth</h2>

                <div class="highlight-box">
                    <p><strong>Critical Understanding:</strong> Liquid cooling systems fail FASTER but also recover FASTER than traditional air-cooled systems. This changes the entire operational response paradigm and requires enhanced monitoring, faster detection, and more aggressive redundancy.</p>
                </div>

                <!-- Enhanced Failure Modes -->
                <div class="tech-box">
                    <div class="tech-box-header">
                        <div class="tech-box-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                                <line x1="12" y1="9" x2="12" y2="13"/>
                                <line x1="12" y1="17" x2="12.01" y2="17"/>
                            </svg>
                        </div>
                        <h4>CDU Failure Modes and Impact Analysis</h4>
                    </div>

                    <div class="failure-mode-grid">
                        <div class="failure-mode-card">
                            <div class="mode-icon pump">⚡</div>
                            <h5>Primary Pump Failure</h5>
                            <p>Motor burnout, impeller damage, or bearing seizure stops coolant flow to served racks.</p>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span class="severity high">High Severity</span>
                                <span style="color: #94a3b8; font-size: 0.75rem;">MTTR: 2-4 hrs</span>
                            </div>
                        </div>
                        <div class="failure-mode-card">
                            <div class="mode-icon seal">💧</div>
                            <h5>Seal/Gasket Failure</h5>
                            <p>Coolant leak at pump seals, heat exchanger gaskets, or quick-disconnect fittings.</p>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span class="severity high">High Severity</span>
                                <span style="color: #94a3b8; font-size: 0.75rem;">MTTR: 1-3 hrs</span>
                            </div>
                        </div>
                        <div class="failure-mode-card">
                            <div class="mode-icon motor">🔌</div>
                            <h5>VFD/Motor Controller</h5>
                            <p>Variable frequency drive failure, power supply issues, or control board malfunction.</p>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span class="severity medium">Medium Severity</span>
                                <span style="color: #94a3b8; font-size: 0.75rem;">MTTR: 1-2 hrs</span>
                            </div>
                        </div>
                        <div class="failure-mode-card">
                            <div class="mode-icon control">🖥️</div>
                            <h5>Control System Failure</h5>
                            <p>PLC/BMS communication loss, sensor failure, or control logic malfunction.</p>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span class="severity medium">Medium Severity</span>
                                <span style="color: #94a3b8; font-size: 0.75rem;">MTTR: 0.5-2 hrs</span>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: var(--spacing-xl);">
                        <div class="section-label">Single CDU Failure (N+1 Configuration)</div>
                        <div class="impact-timeline">
                            <div class="timeline-header">
                                <span>Time</span>
                                <span>Temp</span>
                                <span>System Status</span>
                                <span>Risk Level</span>
                            </div>
                            <div class="timeline-row">
                                <span class="time">T+0</span>
                                <span class="temp normal">+0°C</span>
                                <span class="status">CDU failure detected, failover initiated automatically</span>
                                <span class="risk low">LOW</span>
                            </div>
                            <div class="timeline-row">
                                <span class="time">T+15s</span>
                                <span class="temp normal">+1°C</span>
                                <span class="status">Backup pump ramping up, valves repositioning</span>
                                <span class="risk low">LOW</span>
                            </div>
                            <div class="timeline-row">
                                <span class="time">T+30s</span>
                                <span class="temp normal">+2°C</span>
                                <span class="status">Full flow restored via backup path</span>
                                <span class="risk low">LOW</span>
                            </div>
                            <div class="timeline-row">
                                <span class="time">T+60s</span>
                                <span class="temp normal">+2°C</span>
                                <span class="status">Stable operation on N configuration</span>
                                <span class="risk low">LOW</span>
                            </div>
                            <div class="timeline-row">
                                <span class="time">T+5min</span>
                                <span class="temp normal">+2°C</span>
                                <span class="status">Maintenance team notified, spare parts checked</span>
                                <span class="risk low">LOW</span>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: var(--spacing-xl);">
                        <div class="section-label" style="color: #ef4444;">Complete Cooling Loss (Catastrophic Scenario)</div>
                        <div class="impact-timeline">
                            <div class="timeline-header" style="background: rgba(239, 68, 68, 0.2);">
                                <span>Time</span>
                                <span>Chip Temp</span>
                                <span>System Status</span>
                                <span>Risk Level</span>
                            </div>
                            <div class="timeline-row">
                                <span class="time">T+0</span>
                                <span class="temp normal">70°C</span>
                                <span class="status">Normal operating temperature under load</span>
                                <span class="risk low">NORMAL</span>
                            </div>
                            <div class="timeline-row">
                                <span class="time">T+10s</span>
                                <span class="temp elevated">82°C</span>
                                <span class="status">NO COOLANT FLOW - Temperature rising rapidly</span>
                                <span class="risk medium">ELEVATED</span>
                            </div>
                            <div class="timeline-row">
                                <span class="time">T+20s</span>
                                <span class="temp critical">90°C</span>
                                <span class="status">Thermal throttling initiated by firmware</span>
                                <span class="risk high">HIGH</span>
                            </div>
                            <div class="timeline-row">
                                <span class="time">T+30s</span>
                                <span class="temp critical">98°C</span>
                                <span class="status">Emergency shutdown sequence triggered</span>
                                <span class="risk critical">CRITICAL</span>
                            </div>
                            <div class="timeline-row">
                                <span class="time">T+45s</span>
                                <span class="temp critical">105°C</span>
                                <span class="status">Hardware protection shutdown - IT equipment OFF</span>
                                <span class="risk critical">OFFLINE</span>
                            </div>
                        </div>
                        <div style="margin-top: var(--spacing-md); padding: var(--spacing-md); background: rgba(239, 68, 68, 0.1); border-radius: 8px; border-left: 3px solid #ef4444;">
                            <span style="color: #f87171; font-weight: 600;">Critical Insight:</span>
                            <span style="color: #fca5a5;"> Liquid cooling thermal runaway is 3-5x FASTER than air cooling. You have ~30-45 seconds vs 8-15 minutes. This demands 2N redundancy and sub-second detection.</span>
                        </div>
                    </div>
                </div>

                <h2 id="section-6">6. Interactive: PUE Impact Calculator</h2>

                <p>Explore how different cooling architectures affect your facility's Power Usage Effectiveness and annual operating costs:</p>

                <!-- Interactive Chart -->
                <div class="chart-container">
                    <div class="chart-title">Cooling Architecture PUE Comparison</div>
                    <div class="chart-subtitle">Annual energy cost impact based on your facility parameters</div>

                    <div class="hvac-toolbar">
                        <button class="hvac-toolbar-btn hvac-btn-free active" onclick="hvacSetMode('free')">Free Mode</button>
                        <button class="hvac-toolbar-btn hvac-btn-pro" onclick="hvacSetMode('pro')">
                            <i class="fas fa-crown" style="margin-right:4px;font-size:0.7rem;"></i> Pro Mode
                        </button>
                        <button class="hvac-toolbar-btn hvac-btn-reset" onclick="hvacReset()">
                            <i class="fas fa-undo" style="margin-right:4px;font-size:0.7rem;"></i> Reset
                        </button>
                        <button class="hvac-toolbar-btn hvac-btn-pdf" onclick="hvacExportPDF()">
                            <i class="fas fa-file-pdf" style="margin-right:4px;font-size:0.7rem;"></i> Export PDF
                        </button>
                    </div>

                    <div class="chart-wrapper">
                        <canvas id="pueChart" class="chart-canvas" width="800" height="400"></canvas>
                    </div>

                    <div class="control-row">
                        <span class="control-label">IT Load (MW): <span class="tooltip-trigger">?<span class="tooltip-content"><div class="tooltip-title">IT Load Capacity</div><div class="tooltip-desc">Total IT power demand in megawatts. Higher loads amplify the cost difference between cooling methods. A 10MW facility typically serves 1,500-2,000 racks.</div><div class="tooltip-formula">Range: 1-20 MW | Industry avg: 10 MW</div></span></span></span>
                        <input type="range" id="loadSlider" class="control-slider" min="1" max="20" value="10">
                        <span class="control-value" id="loadValue">10 MW</span>
                    </div>

                    <div class="control-row">
                        <span class="control-label">Electricity Rate ($/kWh): <span class="tooltip-trigger">?<span class="tooltip-content"><div class="tooltip-title">Electricity Rate</div><div class="tooltip-desc">Blended electricity cost per kilowatt-hour. Varies by region: $0.05 (SEA), $0.10 (US avg), $0.15 (Europe). Directly multiplies all cooling energy cost calculations.</div><div class="tooltip-formula">Range: $0.05-$0.20 | SEA avg: $0.08</div></span></span></span>
                        <input type="range" id="rateSlider" class="control-slider" min="5" max="20" value="10">
                        <span class="control-value" id="rateValue">$0.10</span>
                    </div>

                    <div class="legend-row">
                        <div class="legend-item">
                            <span class="legend-dot" style="background: #ef4444;"></span>
                            Traditional Chiller (PUE 1.67)
                        </div>
                        <div class="legend-item">
                            <span class="legend-dot" style="background: #f59e0b;"></span>
                            Hybrid DLC (PUE 1.35)
                        </div>
                        <div class="legend-item">
                            <span class="legend-dot" style="background: #22c55e;"></span>
                            Warm-Water DLC (PUE 1.15)
                        </div>
                    </div>

                    <div class="callout-row">
                        <div class="callout-card">
                            <div class="callout-label">Annual Savings (Hybrid)</div>
                            <div class="callout-value" id="savingsHybrid">$2.8M</div>
                        </div>
                        <div class="callout-card">
                            <div class="callout-label">Annual Savings (DLC)</div>
                            <div class="callout-value" id="savingsDLC" style="color: #22c55e;">$4.6M</div>
                        </div>
                        <div class="callout-card">
                            <div class="callout-label">CO2 Reduction</div>
                            <div class="callout-value" id="co2Reduction" style="color: #10b981;">31%</div>
                        </div>
                    </div>

                    <!-- Region Select for Pro -->
                    <div class="hvac-region-select-row" style="margin-top:1rem;">
                        <label for="hvacRegionSelect"><i class="fas fa-globe" style="margin-right:4px;"></i> Region: <span class="tooltip-trigger">?<span class="tooltip-content"><div class="tooltip-title">Deployment Region</div><div class="tooltip-desc">Select the geographic region for climate-adjusted cooling analysis. Affects ambient temperature, humidity, free cooling hours, and regulatory requirements.</div><div class="tooltip-formula">Tropical: PUE penalty +0.1-0.3 vs Nordic</div></span></span></label>
                        <select id="hvacRegionSelect" class="hvac-region-dropdown">
                            <option value="indonesia">Indonesia (Tropical)</option>
                            <option value="singapore">Singapore (Tropical)</option>
                            <option value="india">India (Mixed)</option>
                            <option value="uae">UAE (Hot-Arid)</option>
                            <option value="virginia" selected>Virginia, USA</option>
                            <option value="frankfurt">Frankfurt, Germany</option>
                            <option value="stockholm">Stockholm, Sweden</option>
                            <option value="ireland">Ireland (Maritime)</option>
                        </select>
                    </div>

                    <!-- Pro Analysis Container -->
                    <div class="hvac-pro-container" id="hvacProContainer">
                        <!-- Panel 1: 10-Year TCO Deep Model -->
                        <div class="hvac-pro-panel gated" id="hvacPanel1">
                            <div class="hvac-gate-overlay" onclick="hvacShowLogin()">
                                <i class="fas fa-lock"></i>
                                <span>Unlock Pro Analysis</span>
                            </div>
                            <div class="hvac-panel-content">
                                <div class="hvac-panel-title"><i class="fas fa-chart-line"></i> 10-Year TCO Deep Model</div>
                                <div class="hvac-kpi-grid" id="hvacTcoKPIs"></div>
                                <div class="hvac-section-divider"><i class="fas fa-bolt" style="margin-right:4px;"></i> Energy & Environmental Breakdown</div>
                                <div class="hvac-kpi-grid-4" id="hvacTcoEnergyKPIs"></div>
                                <div class="hvac-section-divider"><i class="fas fa-wrench" style="margin-right:4px;"></i> Lifecycle Cost per kW &amp; Maintenance</div>
                                <div class="hvac-kpi-grid-4" id="hvacTcoLifecycleKPIs"></div>
                                <div class="hvac-chart-container"><canvas id="hvacWaterfallChart" height="280"></canvas></div>
                                <div class="hvac-narrative-box" id="hvacTcoNarrative"></div>
                            </div>
                        </div>

                        <!-- Panel 2: Regional Risk Matrix -->
                        <div class="hvac-pro-panel gated" id="hvacPanel2">
                            <div class="hvac-gate-overlay" onclick="hvacShowLogin()">
                                <i class="fas fa-lock"></i>
                                <span>Unlock Pro Analysis</span>
                            </div>
                            <div class="hvac-panel-content">
                                <div class="hvac-panel-title"><i class="fas fa-map-marked-alt"></i> Regional Risk Matrix</div>
                                <div class="hvac-kpi-grid" id="hvacRiskKPIs"></div>
                                <div class="hvac-section-divider"><i class="fas fa-shield-alt" style="margin-right:4px;"></i> Extended Risk Dimensions</div>
                                <div class="hvac-kpi-grid-4" id="hvacRiskExtKPIs"></div>
                                <div class="hvac-narrative-box" id="hvacRiskNarrative"></div>
                            </div>
                        </div>

                        <!-- Panel 3: Transition Planning -->
                        <div class="hvac-pro-panel gated" id="hvacPanel3">
                            <div class="hvac-gate-overlay" onclick="hvacShowLogin()">
                                <i class="fas fa-lock"></i>
                                <span>Unlock Pro Analysis</span>
                            </div>
                            <div class="hvac-panel-content">
                                <div class="hvac-panel-title"><i class="fas fa-project-diagram"></i> Transition Planning</div>
                                <div class="hvac-kpi-grid" id="hvacTransitionKPIs"></div>
                                <div class="hvac-section-divider"><i class="fas fa-tasks" style="margin-right:4px;"></i> Operational Impact & ROI Milestones</div>
                                <div class="hvac-kpi-grid-4" id="hvacTransitionExtKPIs"></div>
                                <div id="hvacMilestoneTimeline" style="margin-top:1rem;"></div>
                                <div class="hvac-narrative-box" id="hvacTransitionNarrative"></div>
                            </div>
                        </div>

                        <!-- Panel 4: Monte Carlo Sensitivity -->
                        <div class="hvac-pro-panel gated" id="hvacPanel4">
                            <div class="hvac-gate-overlay" onclick="hvacShowLogin()">
                                <i class="fas fa-lock"></i>
                                <span>Unlock Pro Analysis</span>
                            </div>
                            <div class="hvac-panel-content">
                                <div class="hvac-panel-title"><i class="fas fa-brain"></i> Monte Carlo Sensitivity (10,000 iterations)</div>
                                <div class="hvac-kpi-grid" id="hvacMonteKPIs"></div>
                                <div class="hvac-section-divider"><i class="fas fa-exclamation-triangle" style="margin-right:4px;"></i> Tail Risk & Break-Even Analysis</div>
                                <div class="hvac-kpi-grid-4" id="hvacMonteTailKPIs"></div>
                                <div class="hvac-chart-container"><canvas id="hvacMonteChart" height="280"></canvas></div>
                                <div id="hvacTornadoBars" style="margin-top:1rem;"></div>
                                <div class="hvac-narrative-box" id="hvacMonteNarrative"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Privacy Badge -->
                    <div class="hvac-privacy-badge">
                        <i class="fas fa-shield-alt"></i>
                        PDF generated in your browser — no data sent to any server
                    </div>

                    <!-- Benchmark Meta -->
                    <div class="hvac-benchmark-meta">
                        <meta name="hvac-model-version" content="HVAC-TCO-v2.0">
                        <meta name="hvac-date" content="2026-02-16">
                        <meta name="hvac-sources" content="ASHRAE TC 9.9, Uptime Institute 2024, Nvidia Rubin Thermal Specs, DCD 2025">
                        <meta name="hvac-methodology" content="10-year NPV at 8% discount, Monte Carlo 10K iterations, 8-region climate analysis, bidirectional sensitivity tornado, tail risk CVaR">
                    </div>

                    <!-- Calculator Disclaimer -->
                    <div style="background:rgba(30,41,59,0.6);border:1px solid rgba(148,163,184,0.15);border-radius:12px;padding:1.25rem 1.5rem;margin-top:1.5rem;">
                        <div style="display:flex;align-items:flex-start;gap:0.75rem;">
                            <div style="color:#f59e0b;font-size:1rem;margin-top:2px;flex-shrink:0;"><i class="fas fa-triangle-exclamation"></i></div>
                            <div>
                                <div style="font-weight:700;font-size:0.8rem;color:#e2e8f0;margin-bottom:0.5rem;">Disclaimer &amp; Data Sources</div>
                                <p style="font-size:0.72rem;color:#94a3b8;line-height:1.65;margin:0 0 0.5rem 0;">This calculator is provided for <strong style="color:#cbd5e1;">educational and estimation purposes only</strong>. Results are approximations based on industry benchmarks and publicly available data. They should not be used as the sole basis for investment, procurement, or engineering decisions. Always consult qualified professionals for site-specific analysis.</p>
                                <p style="font-size:0.72rem;color:#94a3b8;line-height:1.65;margin:0 0 0.5rem 0;"><strong style="color:#cbd5e1;">Algorithm &amp; methodology sources:</strong> ASHRAE TC 9.9 thermal guidelines, Uptime Institute 2024 Global Survey, Nvidia Rubin thermal specifications, DCD 2025 cooling benchmarks, 10-year NPV at 8% discount rate, Monte Carlo 10K iterations, 8-region climate analysis.</p>
                                <p style="font-size:0.72rem;color:#94a3b8;line-height:1.65;margin:0 0 0.5rem 0;">All calculations are performed entirely in your browser. No data is transmitted to any server. See our <a href="privacy.html" style="color:#60a5fa;text-decoration:underline;">Privacy Policy</a> for details.</p>
                                <p style="font-size:0.68rem;color:#64748b;line-height:1.5;margin:0;">By using this tool you agree to our <a href="terms.html" style="color:#60a5fa;text-decoration:underline;">Terms of Service</a>. All content on ResistanceZero is independent personal research. This site does not represent any current or former employer.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <h2 id="dlc-vs-crac-roi">Direct Liquid Cooling vs Traditional CRAC: ROI Comparison</h2>

                <h2 id="section-7">7. Pros and Cons Analysis</h2>

                <h3>Short-Term (0-3 Years)</h3>
                <div class="pros-cons-grid">
                    <div class="pros-box">
                        <h4>
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                            PROS
                        </h4>
                        <ul>
                            <li><strong>Immediate OPEX reduction:</strong> 30-60% cooling energy savings</li>
                            <li><strong>Carbon credits:</strong> ESG compliance and reporting benefits</li>
                            <li><strong>Water conservation:</strong> 30-40% reduction with dry coolers &mdash; critical given the growing <a href="article-10.html">water stress challenges facing data centers</a></li>
                            <li><strong>Simplified maintenance:</strong> Fewer mechanical components</li>
                            <li><strong>No refrigerant compliance:</strong> Avoid HFC phase-out regulations</li>
                        </ul>
                    </div>
                    <div class="cons-box">
                        <h4>
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                            CONS
                        </h4>
                        <ul>
                            <li><strong>High initial CAPEX:</strong> $500-2,000/kW for liquid cooling</li>
                            <li><strong>Technology immaturity:</strong> Limited vendor ecosystem</li>
                            <li><strong>Staff retraining:</strong> New skill requirements for operations</li>
                            <li><strong>Compatibility issues:</strong> Not all servers support liquid cooling</li>
                            <li><strong>Supply chain:</strong> Limited component availability</li>
                        </ul>
                    </div>
                </div>

                <h3>Long-Term (3-10 Years)</h3>
                <div class="pros-cons-grid">
                    <div class="pros-box">
                        <h4>
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                            PROS
                        </h4>
                        <ul>
                            <li><strong>Future-proof architecture:</strong> Ready for 100+ kW/rack AI densities, complementing modern <a href="article-13.html">hyperscaler power distribution architectures</a></li>
                            <li><strong>Regulatory compliance:</strong> Ahead of environmental regulations</li>
                            <li><strong>Heat reuse potential:</strong> District heating revenue ($20-50/MWh)</li>
                            <li><strong>Market differentiation:</strong> Green credentials for premium pricing</li>
                            <li><strong>Lower TCO:</strong> 30-40% reduction over 10-year lifecycle</li>
                        </ul>
                    </div>
                    <div class="cons-box">
                        <h4>
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                            CONS
                        </h4>
                        <ul>
                            <li><strong>Stranded assets:</strong> Existing chiller infrastructure devaluation</li>
                            <li><strong>Technology lock-in:</strong> Vendor dependency risks</li>
                            <li><strong>Climate change impact:</strong> Rising ambient temperatures</li>
                            <li><strong>Fluid management:</strong> Dielectric fluid lifecycle and disposal</li>
                            <li><strong>Unknown failure modes:</strong> Emerging issues from new technology</li>
                        </ul>
                    </div>
                </div>

                <h2 id="section-8">8. Regional Implementation Verdict</h2>

                <p>Implementation feasibility varies dramatically by geography. Select a region to see the detailed analysis:</p>

                <!-- Regional Verdict with Dropdown -->
                <div class="verdict-container">
                    <div class="verdict-box" id="verdictBox">
                        <h4>Implementation Verdict</h4>
                        <div class="verdict-region" id="verdictRegion">Indonesia (Tropical)</div>
                        <div class="verdict-text" id="verdictText">PROCEED WITH CAUTION</div>
                        <div class="verdict-score-container">
                            <div class="score-ring">
                                <svg viewBox="0 0 70 70">
                                    <circle class="bg" cx="35" cy="35" r="28"/>
                                    <circle class="progress" id="scoreProgress" cx="35" cy="35" r="28" stroke-dasharray="126 176"/>
                                </svg>
                                <div class="score-value" id="scoreValue">7.2</div>
                            </div>
                        </div>
                        <div class="verdict-details">
                            <p id="verdictDetails">Requires hybrid approach with 40-50% chiller backup capacity. High humidity limits evaporative cooling. Design for worst-case ambient of 38-40°C. Enhanced monitoring and 2N redundancy essential.</p>
                        </div>
                    </div>

                    <div class="region-selector">
                        <h4>Select Region</h4>
                        <select class="region-dropdown" id="regionSelect">
                            <option value="indonesia">Indonesia (Tropical)</option>
                            <option value="singapore">Singapore (Tropical)</option>
                            <option value="india">India (Mixed)</option>
                            <option value="uae">UAE / Middle East (Hot-Arid)</option>
                            <option value="virginia">Virginia, USA (Temperate)</option>
                            <option value="frankfurt">Frankfurt, Germany (4-Season)</option>
                            <option value="stockholm">Stockholm, Sweden (Nordic)</option>
                            <option value="ireland">Ireland (Maritime)</option>
                        </select>

                        <div class="region-stats" id="regionStats">
                            <div class="region-stat">
                                <span class="label">Avg Temperature</span>
                                <span class="value challenging" id="statTemp">27-35°C</span>
                            </div>
                            <div class="region-stat">
                                <span class="label">Avg Humidity</span>
                                <span class="value challenging" id="statHumidity">75-85%</span>
                            </div>
                            <div class="region-stat">
                                <span class="label">Free Cooling Hours</span>
                                <span class="value challenging" id="statFreeHours">~600 hrs (7%)</span>
                            </div>
                            <div class="region-stat">
                                <span class="label">Chiller Backup Needed</span>
                                <span class="value challenging" id="statChillerBackup">40-50%</span>
                            </div>
                            <div class="region-stat">
                                <span class="label">Recommendation</span>
                                <span class="value moderate" id="statRecommendation">Hybrid</span>
                            </div>
                        </div>
                    </div>
                </div>

                <h2 id="section-9">9. Conclusion</h2>

                <p>The market panic-sold HVAC stocks after one line about "no chillers". Rubin doesn't kill cooling; it reprices the cooling stack. Heat still flows; investors and operators just need to follow it into pumps, CDUs, and control loops.</p>

                <blockquote>
                    "The edge is knowing where the new bottleneck sits — inside the plant room, not on a silicon slide."
                </blockquote>

                <p>For operations professionals managing critical infrastructure:</p>

                <ol>
                    <li><strong>Understand the physics:</strong> "No chillers" works in cool climates. In tropics, it's "fewer chiller hours" at best.</li>
                    <li><strong>Plan for hybrid:</strong> Target 60-70% chiller-free operation with robust backup for extreme conditions.</li>
                    <li><strong>Invest in monitoring:</strong> Liquid cooling's faster thermal dynamics demand faster detection and response.</li>
                    <li><strong>Train your teams:</strong> New technology introduces new failure modes requiring new skills and procedures.</li>
                    <li><strong>Design for climate change:</strong> Build margin for 2050 conditions, not just today's averages.</li>
                </ol>

                <!-- Login Modal -->
                <div class="hvac-login-overlay" id="hvacLoginOverlay">
                    <div class="hvac-login-box">
                        <button class="hvac-login-close" onclick="hvacHideLogin()">&times;</button>
                        <div class="hvac-login-title">Unlock Pro Analysis</div>
                        <div class="hvac-login-subtitle">Access 10-Year TCO modeling, regional risk matrix, transition planning, Monte Carlo simulation, and comprehensive PDF reports</div>
                        <input type="email" class="hvac-login-input" id="hvacLoginEmail" placeholder="Email address">
                        <input type="password" class="hvac-login-input" id="hvacLoginPass" placeholder="Password">
                        <div class="hvac-login-error" id="hvacLoginError">Invalid credentials</div>
                        <button class="hvac-login-submit" onclick="hvacDoLogin()">Sign In</button>
                        <div class="hvac-login-demo">Demo: demo@resistancezero.com / demo2026</div>
                        <div style="text-align:center;margin-top:6px;"><a href="mailto:bagus@resistancezero.com" style="font-size:0.62rem;color:#64748b;text-decoration:none;">Want full access? Get in touch &rarr;</a></div>
                <p style="text-align:center;font-size:0.68rem;color:#64748b;margin-top:8px;line-height:1.5;">By clicking Login, you agree to our <a href="terms.html" target="_blank" style="color:#8b5cf6;text-decoration:underline;">Terms of Service</a> and <a href="privacy.html" target="_blank" style="color:#8b5cf6;text-decoration:underline;">Privacy Policy</a>.</p>
                    </div>
                </div>

                
                <!-- Independence Disclaimer -->
                <div style="margin:2rem 0 0;padding:1rem 0;border-top:1px solid rgba(255,255,255,0.06);text-align:center;">
                    <p style="font-size:0.72rem;color:#64748b;font-style:italic;line-height:1.6;margin:0;">All content on ResistanceZero is independent personal research derived from publicly available sources. This site does not represent any current or former employer. <a href="terms.html" style="color:#8b5cf6;">Terms &amp; Disclaimer</a></p>
                </div>

<div class="references">
                    <h3>References & Further Reading</h3>
                    <ul>
                        <li><a href="https://www.datacenterdynamics.com/en/analysis/chilling-out-in-2025-a-year-in-data-center-cooling/" target="_blank">Data Center Dynamics - Chilling Out in 2025</a></li>
                        <li><a href="https://spectrum.ieee.org/data-centers-designed-for-tropics" target="_blank">IEEE Spectrum - Cool(ing) Ideas for Tropical Data Centers</a></li>
                        <li><a href="https://news.nus.edu.sg/worlds-first-tropical-climate-data-centre-testbed/" target="_blank">NUS - Sustainable Tropical Data Centre Testbed (STDCT)</a></li>
                        <li><a href="https://www.microsoft.com/en-us/microsoft-cloud/blog/2024/12/09/sustainable-by-design-next-generation-datacenters-consume-zero-water-for-cooling/" target="_blank">Microsoft - Zero Water Cooling Data Centers</a></li>
                        <li><a href="https://www.vertiv.com/en-in/about/news-and-insights/articles/educational-articles/how-n1-redundancy-supports-continuous-data-center-cooling/" target="_blank">Vertiv - N+1 Redundancy for Data Center Cooling</a></li>
                        <li>Original analysis inspired by <a href="https://medium.com/@Elongated_musk" target="_blank">@elongated_musk on Medium</a></li>
                    </ul>
                </div>

                <!-- Newsletter Signup -->
                <div class="newsletter-signup">
                    <h3>Stay Updated</h3>
                    <p>Get notified when new articles on data center operations and engineering excellence are published.</p>
                    <form class="newsletter-form" onsubmit="return subscribeNewsletter(event)">
                        <input type="email" placeholder="Enter your email" required>
                        <button type="submit">Subscribe</button>
                    </form>
                    <p class="newsletter-privacy">No spam. Unsubscribe anytime.</p>
                </div>

                <!-- Author Bio -->
                <div class="author-bio">
                    <div class="author-bio-image">
                        <img loading="lazy" src="assets/profile-photo.jpg" alt="Bagus Dwi Permana">
                    </div>
                    <div class="author-bio-content">
                        <h4>Bagus Dwi Permana</h4>
                        <p class="author-bio-title">Engineering Operations Manager | Ahli K3 Listrik</p>
                        <p>12+ years professional experience in critical infrastructure and operations. CDFOM certified. Transforming operations through systematic excellence and safety-first engineering.</p>
                        <div class="author-bio-links">
                            <a href="https://www.linkedin.com/in/bagus-dwi-permana-ba90b092" target="_blank">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                                LinkedIn
                            </a>
                            <a href="https://github.com/baguspermana7-cpu" target="_blank">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
                                GitHub
                            </a>
                            <a href="mailto:baguspermana7@gmail.com">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
                                Email
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Related Articles -->
                <div class="related-articles">
                    <h3>Continue Reading</h3>
                    <div class="related-grid">
                        <a href="article-8.html" class="related-card">
                            <div class="related-card-number">08</div>
                            <div class="related-card-content">
                                <h4>Why "No Incident" Is Not Evidence of Safety</h4>
                                <p>Weak signals that precede failure</p>
                            </div>
                        </a>
                        <a href="article-10.html" class="related-card">
                            <div class="related-card-number">10</div>
                            <div class="related-card-content">
                                <h4>Water Stress and AI Data Centers</h4>
                                <p>The hidden crisis in Southeast Asia</p>
                            </div>
                        </a>
                        <a href="article-13.html" class="related-card">
                            <div class="related-card-number">13</div>
                            <div class="related-card-content">
                                <h4>Data Center Power Distribution: Hyperscaler Architecture Deep Dive</h4>
                                <p>AWS vs Google vs Microsoft power design compared</p>
                            </div>
                        </a>
                    </div>
                </div>

                <div class="article-nav">
                    <a href="article-8.html">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7"/>
                        </svg>
                        Previous Article
                    </a>
                    <a href="article-10.html">
                        Next Article
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M5 12h14M12 5l7 7-7 7"/>
                        </svg>
                    </a>
                </div>
            </div>
        </div>
    </article>
    </main>

    <footer class="footer footer-enhanced">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-brand">
                    <p class="footer-tagline-main">BUILT FOR MISSION CRITICAL INFRASTRUCTURE<br>MANAGEMENT // 2026</p>
                    <p class="footer-tagline-sub">ALL OPERATIONAL DATASETS PRESERVED.</p>
                    <p class="footer-copyright">&copy; 2026 Bagus Dwi Permana. All rights reserved.</p>
                </div>
                <div class="footer-nav">
                    <h4 class="footer-heading">NAVIGATION</h4>
                    <ul class="footer-links">
                        <li><a href="index.html">Home Dashboard</a></li>
                        <li><a href="articles.html">Technical Journal</a></li>
                        <li><a href="index.html#case-studies">Case Studies</a></li>
                        <li><a href="datacenter-solutions.html">DC Solutions</a></li>
                    </ul>
                </div>
                <div class="footer-connect">
                    <h4 class="footer-heading">CONNECT</h4>
                    <ul class="footer-links">
                        <li><a href="https://www.linkedin.com/in/bagus-dwi-permana-ba90b092" target="_blank" rel="noopener">LinkedIn Profile</a></li>
                        <li><a href="articles.html">Technical Journal</a></li>
                        <li><a href="mailto:baguspermana7@gmail.com">Direct Contact</a></li>
                        <li><a href="https://github.com/baguspermana7-cpu" target="_blank" rel="noopener">GitHub</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <!-- Share Buttons - Floating Sidebar -->
    <aside class="share-buttons" id="shareButtons" aria-label="Share this article">
        <span class="share-label">Share</span>
        <button class="share-btn linkedin" data-tooltip="Share on LinkedIn" onclick="shareLinkedIn()" aria-label="Share on LinkedIn">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
        </button>
        <button class="share-btn twitter" data-tooltip="Share on X" onclick="shareTwitter()" aria-label="Share on X"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></button>
        <button class="share-btn whatsapp" data-tooltip="Share on WhatsApp" onclick="shareWhatsApp()" aria-label="Share on WhatsApp"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg></button>
        <button class="share-btn copy" data-tooltip="Copy link" onclick="copyLink()" aria-label="Copy article link">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="copy-icon"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="check-icon" style="display:none"><polyline points="20 6 9 17 4 12"></polyline></svg>
        </button>
    </aside>

    <script src="script.min.js"></script>
    <script>
    // Share Buttons Functions
    (function(){const s=document.getElementById('shareButtons'),h=document.querySelector('.article-hero');if(s&&h){document.body.classList.add('has-share-buttons');new IntersectionObserver(e=>e.forEach(x=>s.classList.toggle('visible',!x.isIntersecting)),{threshold:.1}).observe(h)}})();
    function getShareData(){return{title:document.querySelector('meta[property="og:title"]')?.content||document.title,url:window.location.href}}
    function shareLinkedIn(){window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(getShareData().url)}`,'_blank','width=600,height=600')}
    function shareTwitter(){const d=getShareData();window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(d.title+' by @BagusDPermana')}&url=${encodeURIComponent(d.url)}`,'_blank','width=600,height=400')}
    function shareWhatsApp(){const d=getShareData();window.open(`https://wa.me/?text=${encodeURIComponent(d.title+'\n\n'+d.url)}`,'_blank')}
    function copyLink(){const b=document.querySelector('.share-btn.copy'),c=b.querySelector('.copy-icon'),k=b.querySelector('.check-icon');navigator.clipboard.writeText(window.location.href).then(()=>{b.classList.add('copied');c.style.display='none';k.style.display='block';b.setAttribute('data-tooltip','Copied!');setTimeout(()=>{b.classList.remove('copied');c.style.display='block';k.style.display='none';b.setAttribute('data-tooltip','Copy link')},2000)})}
    </script>
    <script>
    // Regional Data
    const regionData = {
        indonesia: {
            name: 'Indonesia (Tropical)',
            score: 7.2,
            verdict: 'PROCEED WITH CAUTION',
            color: '#f59e0b',
            temp: '27-35°C',
            tempClass: 'challenging',
            humidity: '75-85%',
            humidityClass: 'challenging',
            freeHours: '~600 hrs (7%)',
            freeHoursClass: 'challenging',
            chillerBackup: '40-50%',
            chillerClass: 'challenging',
            recommendation: 'Hybrid Required',
            recommendationClass: 'moderate',
            details: 'Requires hybrid approach with 40-50% chiller backup capacity. High humidity limits evaporative cooling. Design for worst-case ambient of 38-40°C. Enhanced monitoring and 2N redundancy essential.'
        },
        singapore: {
            name: 'Singapore (Tropical)',
            score: 6.8,
            verdict: 'HYBRID ESSENTIAL',
            color: '#f59e0b',
            temp: '27-34°C',
            tempClass: 'challenging',
            humidity: '80-90%',
            humidityClass: 'challenging',
            freeHours: '~400 hrs (5%)',
            freeHoursClass: 'challenging',
            chillerBackup: '45-55%',
            chillerClass: 'challenging',
            recommendation: 'Hybrid + STDCT Tech',
            recommendationClass: 'moderate',
            details: 'Highest humidity in region limits all evaporative options. IMDA requires PUE <1.3. Consider desiccant-based technologies from STDCT research. Government incentives available for green DC.'
        },
        india: {
            name: 'India (Mixed Climate)',
            score: 7.5,
            verdict: 'LOCATION DEPENDENT',
            color: '#f59e0b',
            temp: '25-42°C',
            tempClass: 'challenging',
            humidity: '40-80%',
            humidityClass: 'moderate',
            freeHours: '~1,500 hrs (17%)',
            freeHoursClass: 'moderate',
            chillerBackup: '35-50%',
            chillerClass: 'moderate',
            recommendation: 'Hybrid (Region-Specific)',
            recommendationClass: 'moderate',
            details: 'Varies dramatically by location. Northern India (Delhi) has extreme summers requiring full backup. Bangalore/Pune offer better conditions. Monsoon season adds humidity challenges.'
        },
        uae: {
            name: 'UAE / Middle East (Hot-Arid)',
            score: 7.8,
            verdict: 'ADIABATIC VIABLE',
            color: '#22c55e',
            temp: '25-48°C',
            tempClass: 'challenging',
            humidity: '30-60%',
            humidityClass: 'good',
            freeHours: '~2,000 hrs (23%)',
            freeHoursClass: 'moderate',
            chillerBackup: '30-40%',
            chillerClass: 'moderate',
            recommendation: 'Adiabatic + Hybrid',
            recommendationClass: 'good',
            details: 'Low humidity enables effective adiabatic pre-cooling despite extreme temperatures. Night cooling viable (large diurnal swing). Water is precious - closed-loop systems preferred.'
        },
        virginia: {
            name: 'Virginia, USA (Temperate)',
            score: 8.5,
            verdict: 'HIGHLY VIABLE',
            color: '#22c55e',
            temp: '0-32°C',
            tempClass: 'good',
            humidity: '45-75%',
            humidityClass: 'moderate',
            freeHours: '~4,000 hrs (46%)',
            freeHoursClass: 'good',
            chillerBackup: '20-30%',
            chillerClass: 'good',
            recommendation: 'DLC + Seasonal Hybrid',
            recommendationClass: 'good',
            details: 'Four distinct seasons provide significant free cooling. Summer peaks require backup but limited duration. Large existing DC ecosystem with experienced workforce and suppliers.'
        },
        frankfurt: {
            name: 'Frankfurt, Germany (4-Season)',
            score: 9.0,
            verdict: 'EXCELLENT FIT',
            color: '#22c55e',
            temp: '-5-30°C',
            tempClass: 'good',
            humidity: '50-80%',
            humidityClass: 'moderate',
            freeHours: '~5,200 hrs (59%)',
            freeHoursClass: 'good',
            chillerBackup: '15-25%',
            chillerClass: 'good',
            recommendation: 'Primarily Free Cooling',
            recommendationClass: 'good',
            details: 'Ideal 4-season climate with cold winters and mild summers. District heating integration opportunities. Strong regulatory push for sustainability (PUE requirements tightening).'
        },
        stockholm: {
            name: 'Stockholm, Sweden (Nordic)',
            score: 9.5,
            verdict: 'IDEAL CONDITIONS',
            color: '#22c55e',
            temp: '-15-25°C',
            tempClass: 'good',
            humidity: '60-85%',
            humidityClass: 'moderate',
            freeHours: '~7,500 hrs (86%)',
            freeHoursClass: 'good',
            chillerBackup: '5-15%',
            chillerClass: 'good',
            recommendation: 'Full Free Cooling',
            recommendationClass: 'good',
            details: 'Near-ideal conditions for chiller-free operation. Cold climate enables year-round free cooling with minimal backup. Strong district heating demand creates revenue opportunity for waste heat.'
        },
        ireland: {
            name: 'Ireland (Maritime)',
            score: 9.2,
            verdict: 'EXCELLENT FIT',
            color: '#22c55e',
            temp: '4-20°C',
            tempClass: 'good',
            humidity: '75-90%',
            humidityClass: 'moderate',
            freeHours: '~7,000 hrs (80%)',
            freeHoursClass: 'good',
            chillerBackup: '10-20%',
            chillerClass: 'good',
            recommendation: 'Primarily Free Cooling',
            recommendationClass: 'good',
            details: 'Mild year-round temperatures ideal for free cooling despite high humidity. No extreme seasons. Growing DC hub with favorable energy costs and connectivity. High humidity requires attention to condensation management.'
        }
    };

    // Region Selector Logic
    const regionSelect = document.getElementById('regionSelect');
    const verdictRegion = document.getElementById('verdictRegion');
    const verdictText = document.getElementById('verdictText');
    const scoreValue = document.getElementById('scoreValue');
    const scoreProgress = document.getElementById('scoreProgress');
    const verdictDetails = document.getElementById('verdictDetails');
    const verdictBox = document.getElementById('verdictBox');

    function updateRegion(regionKey) {
        const data = regionData[regionKey];

        verdictRegion.textContent = data.name;
        verdictText.textContent = data.verdict;
        scoreValue.textContent = data.score.toFixed(1);
        verdictDetails.textContent = data.details;

        // Update score ring
        const circumference = 2 * Math.PI * 40;
        const progress = (data.score / 10) * circumference;
        scoreProgress.style.strokeDasharray = `${progress} ${circumference}`;
        scoreProgress.style.stroke = data.color;

        // Update verdict box gradient
        if (data.score >= 8.5) {
            verdictBox.style.background = 'linear-gradient(135deg, #059669 0%, #047857 100%)';
        } else if (data.score >= 7.0) {
            verdictBox.style.background = 'linear-gradient(135deg, #d97706 0%, #b45309 100%)';
        } else {
            verdictBox.style.background = 'linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)';
        }

        // Update stats
        document.getElementById('statTemp').textContent = data.temp;
        document.getElementById('statTemp').className = 'value ' + data.tempClass;
        document.getElementById('statHumidity').textContent = data.humidity;
        document.getElementById('statHumidity').className = 'value ' + data.humidityClass;
        document.getElementById('statFreeHours').textContent = data.freeHours;
        document.getElementById('statFreeHours').className = 'value ' + data.freeHoursClass;
        document.getElementById('statChillerBackup').textContent = data.chillerBackup;
        document.getElementById('statChillerBackup').className = 'value ' + data.chillerClass;
        document.getElementById('statRecommendation').textContent = data.recommendation;
        document.getElementById('statRecommendation').className = 'value ' + data.recommendationClass;
    }

    regionSelect.addEventListener('change', function() {
        updateRegion(this.value);
    });

    // Initialize
    updateRegion('indonesia');

    // PUE Chart
    (function() {
        const canvas = document.getElementById('pueChart');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const loadSlider = document.getElementById('loadSlider');
        const loadValue = document.getElementById('loadValue');
        const rateSlider = document.getElementById('rateSlider');
        const rateValue = document.getElementById('rateValue');
        const savingsHybrid = document.getElementById('savingsHybrid');
        const savingsDLC = document.getElementById('savingsDLC');
        const co2Reduction = document.getElementById('co2Reduction');

        const dpr = window.devicePixelRatio || 1;
        let W, H, padding, chartW, chartH;

        function setupCanvas() {
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            canvas.style.width = rect.width + 'px';
            canvas.style.height = rect.height + 'px';
            W = rect.width;
            H = rect.height;
            padding = { top: 60, right: 80, bottom: 60, left: 100 };
            chartW = W - padding.left - padding.right;
            chartH = H - padding.top - padding.bottom;
        }

        function calculate(itLoad, rate) {
            const hours = 8760;
            const traditional = { pue: 1.67 };
            const hybrid = { pue: 1.35 };
            const dlc = { pue: 1.15 };

            const traditionalCost = itLoad * 1000 * traditional.pue * hours * rate;
            const hybridCost = itLoad * 1000 * hybrid.pue * hours * rate;
            const dlcCost = itLoad * 1000 * dlc.pue * hours * rate;

            return {
                traditional: traditionalCost,
                hybrid: hybridCost,
                dlc: dlcCost,
                savingsHybrid: traditionalCost - hybridCost,
                savingsDLC: traditionalCost - dlcCost,
                co2Reduction: Math.round((1 - dlc.pue / traditional.pue) * 100)
            };
        }

        function formatCurrency(value) {
            if (value >= 1000000) return '$' + (value / 1000000).toFixed(1) + 'M';
            return '$' + (value / 1000).toFixed(0) + 'K';
        }

        function drawChart(itLoad, rate) {
            ctx.clearRect(0, 0, W, H);
            const data = calculate(itLoad, rate);
            const maxCost = data.traditional * 1.1;

            ctx.fillStyle = 'rgba(2, 6, 23, 0.5)';
            ctx.fillRect(0, 0, W, H);

            ctx.strokeStyle = 'rgba(148, 163, 184, 0.15)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 5; i++) {
                const y = padding.top + (chartH / 5) * i;
                ctx.beginPath();
                ctx.moveTo(padding.left, y);
                ctx.lineTo(W - padding.right, y);
                ctx.stroke();
            }

            ctx.fillStyle = 'rgba(148, 163, 184, 0.9)';
            ctx.font = '12px Inter, system-ui, sans-serif';
            ctx.textAlign = 'right';
            for (let i = 0; i <= 5; i++) {
                const y = padding.top + (chartH / 5) * i;
                const val = maxCost - (maxCost / 5) * i;
                ctx.fillText(formatCurrency(val), padding.left - 10, y + 4);
            }

            ctx.save();
            ctx.translate(30, H / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.textAlign = 'center';
            ctx.fillStyle = 'rgba(148, 163, 184, 0.7)';
            ctx.fillText('Annual Energy Cost', 0, 0);
            ctx.restore();

            const barWidth = chartW / 5;
            const gap = barWidth * 0.3;
            const systems = [
                { name: 'Traditional\nChiller', value: data.traditional, color: '#ef4444', pue: '1.67' },
                { name: 'Hybrid\nDLC', value: data.hybrid, color: '#f59e0b', pue: '1.35' },
                { name: 'Warm-Water\nDLC', value: data.dlc, color: '#22c55e', pue: '1.15' }
            ];

            systems.forEach((system, i) => {
                const x = padding.left + barWidth * 0.5 + (barWidth + gap) * i;
                const barH = (system.value / maxCost) * chartH;
                const y = padding.top + chartH - barH;

                const gradient = ctx.createLinearGradient(x, y, x, padding.top + chartH);
                gradient.addColorStop(0, system.color);
                gradient.addColorStop(1, system.color + '66');
                ctx.fillStyle = gradient;

                const radius = 6;
                ctx.beginPath();
                ctx.moveTo(x, y + radius);
                ctx.lineTo(x, padding.top + chartH);
                ctx.lineTo(x + barWidth - gap, padding.top + chartH);
                ctx.lineTo(x + barWidth - gap, y + radius);
                ctx.quadraticCurveTo(x + barWidth - gap, y, x + barWidth - gap - radius, y);
                ctx.lineTo(x + radius, y);
                ctx.quadraticCurveTo(x, y, x, y + radius);
                ctx.fill();

                ctx.fillStyle = '#fff';
                ctx.font = 'bold 14px Inter, system-ui, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(formatCurrency(system.value), x + (barWidth - gap) / 2, y - 25);

                ctx.fillStyle = system.color;
                ctx.font = 'bold 12px Inter, system-ui, sans-serif';
                ctx.fillText('PUE ' + system.pue, x + (barWidth - gap) / 2, y - 8);

                ctx.fillStyle = 'rgba(148, 163, 184, 0.9)';
                ctx.font = '11px Inter, system-ui, sans-serif';
                const lines = system.name.split('\n');
                lines.forEach((line, li) => {
                    ctx.fillText(line, x + (barWidth - gap) / 2, H - padding.bottom + 20 + li * 14);
                });
            });

            savingsHybrid.textContent = formatCurrency(data.savingsHybrid);
            savingsDLC.textContent = formatCurrency(data.savingsDLC);
            co2Reduction.textContent = data.co2Reduction + '%';
        }

        function refresh() {
            const itLoad = parseInt(loadSlider.value);
            const rate = parseInt(rateSlider.value) / 100;
            loadValue.textContent = itLoad + ' MW';
            rateValue.textContent = '$' + (rate).toFixed(2);
            drawChart(itLoad, rate);
        }

        setupCanvas();
        loadSlider.addEventListener('input', refresh);
        rateSlider.addEventListener('input', refresh);
        refresh();

        window.addEventListener('resize', function() {
            setupCanvas();
            refresh();
        });
    })();
    </script>

    <!-- HVAC Pro Enhancement Mode JS -->
    <script>
    (function() {
        'use strict';

        // === REGION DATA ===
        var HVAC_REGIONS = {
            indonesia: { temp: 31, humidity: 80, freeHours: 600, chillerBackup: 45, pueTraditional: 1.75, pueHybrid: 1.45, pueDLC: 1.25, riskScore: 7.2, label: 'Indonesia (Tropical)',
                regulatoryRisk: 4.5, trl: 5, supplyChain: 3.8, climateVolatility: 6.2,
                co2Factor: 0.78, waterFactor: 1.15, peakTemp: 38, climateType: 'tropical' },
            singapore: { temp: 30, humidity: 82, freeHours: 500, chillerBackup: 50, pueTraditional: 1.72, pueHybrid: 1.42, pueDLC: 1.22, riskScore: 7.0, label: 'Singapore (Tropical)',
                regulatoryRisk: 7.5, trl: 7, supplyChain: 8.2, climateVolatility: 4.8,
                co2Factor: 0.41, waterFactor: 1.10, peakTemp: 36, climateType: 'tropical' },
            india: { temp: 33, humidity: 65, freeHours: 2200, chillerBackup: 30, pueTraditional: 1.70, pueHybrid: 1.38, pueDLC: 1.20, riskScore: 6.5, label: 'India (Mixed)',
                regulatoryRisk: 5.0, trl: 5, supplyChain: 5.5, climateVolatility: 7.5,
                co2Factor: 0.82, waterFactor: 1.30, peakTemp: 45, climateType: 'mixed' },
            uae: { temp: 38, humidity: 55, freeHours: 800, chillerBackup: 55, pueTraditional: 1.80, pueHybrid: 1.50, pueDLC: 1.30, riskScore: 8.0, label: 'UAE (Hot-Arid)',
                regulatoryRisk: 6.0, trl: 6, supplyChain: 7.0, climateVolatility: 5.5,
                co2Factor: 0.58, waterFactor: 1.60, peakTemp: 50, climateType: 'hot-arid' },
            virginia: { temp: 15, humidity: 60, freeHours: 5500, chillerBackup: 15, pueTraditional: 1.55, pueHybrid: 1.28, pueDLC: 1.12, riskScore: 3.5, label: 'Virginia, USA',
                regulatoryRisk: 7.0, trl: 8, supplyChain: 9.0, climateVolatility: 3.5,
                co2Factor: 0.39, waterFactor: 0.85, peakTemp: 35, climateType: 'temperate' },
            frankfurt: { temp: 10, humidity: 70, freeHours: 6200, chillerBackup: 10, pueTraditional: 1.50, pueHybrid: 1.25, pueDLC: 1.10, riskScore: 3.0, label: 'Frankfurt, Germany',
                regulatoryRisk: 8.5, trl: 8, supplyChain: 8.5, climateVolatility: 3.0,
                co2Factor: 0.35, waterFactor: 0.75, peakTemp: 35, climateType: '4-season' },
            stockholm: { temp: 6, humidity: 75, freeHours: 7800, chillerBackup: 5, pueTraditional: 1.35, pueHybrid: 1.15, pueDLC: 1.05, riskScore: 1.5, label: 'Stockholm, Sweden',
                regulatoryRisk: 9.0, trl: 9, supplyChain: 7.5, climateVolatility: 2.0,
                co2Factor: 0.01, waterFactor: 0.60, peakTemp: 30, climateType: 'nordic' },
            ireland: { temp: 10, humidity: 80, freeHours: 7000, chillerBackup: 8, pueTraditional: 1.40, pueHybrid: 1.20, pueDLC: 1.08, riskScore: 2.0, label: 'Ireland (Maritime)',
                regulatoryRisk: 8.0, trl: 8, supplyChain: 7.8, climateVolatility: 2.5,
                co2Factor: 0.30, waterFactor: 0.70, peakTemp: 28, climateType: 'maritime' }
        };

        // === TCO MODEL CONSTANTS ===
        var COOLING_CONFIGS = {
            traditional: { capexPerMW: 800000, opexFactor: 1.0, maintenancePerMW: 50000, pueKey: 'pueTraditional' },
            hybrid: { capexPerMW: 1100000, opexFactor: 0.75, maintenancePerMW: 65000, pueKey: 'pueHybrid' },
            dlc: { capexPerMW: 1400000, opexFactor: 0.55, maintenancePerMW: 80000, pueKey: 'pueDLC' }
        };
        var DISCOUNT_RATE = 0.08;

        var proMode = false;
        var isAuthenticated = false;

        // === UTILITY ===
        function fmt(n) {
            if (n >= 1e9) return '$' + (n / 1e9).toFixed(2) + 'B';
            if (n >= 1e6) return '$' + (n / 1e6).toFixed(2) + 'M';
            if (n >= 1e3) return '$' + (n / 1e3).toFixed(1) + 'K';
            return '$' + n.toFixed(0);
        }
        function pct(n) { return (n * 100).toFixed(1) + '%'; }

        // === CORE CALCULATIONS ===
        function hvacCalcTCO(inputs) {
            var load = inputs.load;
            var rate = inputs.rate;
            var regionKey = inputs.region;
            var region = HVAC_REGIONS[regionKey];
            var results = {};

            ['traditional', 'hybrid', 'dlc'].forEach(function(arch) {
                var cfg = COOLING_CONFIGS[arch];
                var pue = region[cfg.pueKey];
                var capex = cfg.capexPerMW * load;
                var annualEnergy = load * 1000 * (pue - 1) * 8760 * rate * cfg.opexFactor;
                var annualMaint = cfg.maintenancePerMW * load;
                var annualOpex = annualEnergy + annualMaint;
                var npv = capex;
                var cashflows = [capex];
                for (var y = 1; y <= 10; y++) {
                    var discounted = annualOpex / Math.pow(1 + DISCOUNT_RATE, y);
                    npv += discounted;
                    cashflows.push(annualOpex);
                }
                results[arch] = {
                    capex: capex,
                    annualEnergy: annualEnergy,
                    annualMaint: annualMaint,
                    annualOpex: annualOpex,
                    npv10yr: npv,
                    pue: pue,
                    cashflows: cashflows
                };
            });

            // Payback: year when cumulative savings of DLC vs traditional exceed DLC capex premium
            var capexPremiumDLC = results.dlc.capex - results.traditional.capex;
            var annualSavingsDLC = results.traditional.annualOpex - results.dlc.annualOpex;
            var paybackDLC = annualSavingsDLC > 0 ? capexPremiumDLC / annualSavingsDLC : 99;

            var capexPremiumHybrid = results.hybrid.capex - results.traditional.capex;
            var annualSavingsHybrid = results.traditional.annualOpex - results.hybrid.annualOpex;
            var paybackHybrid = annualSavingsHybrid > 0 ? capexPremiumHybrid / annualSavingsHybrid : 99;

            // IRR approximation for DLC
            var irrDLC = annualSavingsDLC > 0 ? (annualSavingsDLC / capexPremiumDLC) * 0.85 : 0;

            results.paybackDLC = paybackDLC;
            results.paybackHybrid = paybackHybrid;
            results.irrDLC = irrDLC;
            results.savingsDLC10yr = results.traditional.npv10yr - results.dlc.npv10yr;
            results.savingsHybrid10yr = results.traditional.npv10yr - results.hybrid.npv10yr;

            // === EXTENDED METRICS ===
            // Energy savings in kWh/year
            var tradCoolingKWh = load * 1000 * (region.pueTraditional - 1) * 8760;
            var dlcCoolingKWh = load * 1000 * (region.pueDLC - 1) * 8760 * 0.55;
            var hybridCoolingKWh = load * 1000 * (region.pueHybrid - 1) * 8760 * 0.75;
            results.energySavingsDLC_kWh = tradCoolingKWh - dlcCoolingKWh;
            results.energySavingsHybrid_kWh = tradCoolingKWh - hybridCoolingKWh;
            results.tradCoolingKWh = tradCoolingKWh;
            results.dlcCoolingKWh = dlcCoolingKWh;

            // Carbon offset: tons CO2/year (region-specific emission factor)
            results.carbonOffsetDLC = (results.energySavingsDLC_kWh / 1000) * region.co2Factor; // tons CO2
            results.carbonOffsetHybrid = (results.energySavingsHybrid_kWh / 1000) * region.co2Factor;

            // Water savings (gallons/year): traditional uses ~1.8 gal/kWh for evaporative cooling
            // DLC/dry cooler uses ~0.2 gal/kWh
            var tradWaterGal = tradCoolingKWh * 1.8 * region.waterFactor;
            var dlcWaterGal = dlcCoolingKWh * 0.2;
            results.waterSavingsDLC = tradWaterGal - dlcWaterGal;
            results.tradWaterGal = tradWaterGal;
            results.dlcWaterGal = dlcWaterGal;

            // Lifecycle cost per kW of cooling capacity
            var coolingCapacityKW = load * 1000 * (region.pueTraditional - 1); // cooling kW needed
            results.lifecycleCostPerKW_trad = results.traditional.npv10yr / coolingCapacityKW;
            results.lifecycleCostPerKW_dlc = results.dlc.npv10yr / coolingCapacityKW;
            results.lifecycleCostPerKW_hybrid = results.hybrid.npv10yr / coolingCapacityKW;
            results.coolingCapacityKW = coolingCapacityKW;

            // Maintenance cost comparison (10yr NPV)
            var tradMaint10yr = 0, dlcMaint10yr = 0, hybridMaint10yr = 0;
            for (var m = 1; m <= 10; m++) {
                tradMaint10yr += COOLING_CONFIGS.traditional.maintenancePerMW * load / Math.pow(1 + DISCOUNT_RATE, m);
                dlcMaint10yr += COOLING_CONFIGS.dlc.maintenancePerMW * load / Math.pow(1 + DISCOUNT_RATE, m);
                hybridMaint10yr += COOLING_CONFIGS.hybrid.maintenancePerMW * load / Math.pow(1 + DISCOUNT_RATE, m);
            }
            results.tradMaint10yr = tradMaint10yr;
            results.dlcMaint10yr = dlcMaint10yr;
            results.hybridMaint10yr = hybridMaint10yr;

            // Energy cost savings (annual $)
            results.annualEnergySavingsDLC = results.traditional.annualEnergy - results.dlc.annualEnergy;
            results.annualEnergySavingsHybrid = results.traditional.annualEnergy - results.hybrid.annualEnergy;

            // Phased vs full deployment cost comparison
            // Phased adds 12% overhead for integration complexity over 5 years
            results.phasedDeploymentCost = results.dlc.capex * 1.12;
            results.fullDeploymentCost = results.dlc.capex;
            results.phasedOverhead = results.dlc.capex * 0.12;

            // Staff retraining cost estimate
            results.retrainingCost = load * 25000; // $25K per MW

            // Estimated downtime during transition (hours)
            results.downtimeHoursPhased = Math.round(load * 4.5); // 4.5 hrs/MW for phased
            results.downtimeHoursFull = Math.round(load * 12); // 12 hrs/MW for full cutover

            return results;
        }

        function runHvacMonteCarlo(base) {
            var iterations = 10000;
            var results = [];
            var load = base.load;
            var rate = base.rate;
            var region = HVAC_REGIONS[base.region];

            for (var i = 0; i < iterations; i++) {
                var loadVar = load * (1 + (Math.random() - 0.5) * 0.3); // +/-15%
                var rateVar = rate * (1 + (Math.random() - 0.5) * 0.3);
                var pueVar = region.pueDLC * (1 + (Math.random() - 0.5) * 0.1); // +/-5%

                var tradEnergy = loadVar * 1000 * (region.pueTraditional - 1) * 8760 * rateVar;
                var dlcEnergy = loadVar * 1000 * (pueVar - 1) * 8760 * rateVar * 0.55;
                var savings = tradEnergy - dlcEnergy;
                results.push(savings);
            }

            results.sort(function(a, b) { return a - b; });
            var sum = 0;
            results.forEach(function(v) { sum += v; });
            var mean = sum / iterations;

            var variance = 0;
            results.forEach(function(v) { variance += (v - mean) * (v - mean); });
            var stdDev = Math.sqrt(variance / iterations);

            // P1 (worst case tail)
            var p1 = results[Math.floor(iterations * 0.01)];
            var p5 = results[Math.floor(iterations * 0.05)];
            var p10 = results[Math.floor(iterations * 0.10)];
            var p25 = results[Math.floor(iterations * 0.25)];
            var p50 = results[Math.floor(iterations * 0.50)];
            var p75 = results[Math.floor(iterations * 0.75)];
            var p90 = results[Math.floor(iterations * 0.90)];
            var p95 = results[Math.floor(iterations * 0.95)];
            var p99 = results[Math.floor(iterations * 0.99)];

            // Expected Shortfall (CVaR) at 95% - average of worst 5%
            var tailCount = Math.floor(iterations * 0.05);
            var tailSum = 0;
            for (var t = 0; t < tailCount; t++) { tailSum += results[t]; }
            var cvar95 = tailSum / tailCount;

            // Probability of negative ROI (savings < capex premium / 10)
            var capexPremium = (1400000 - 800000) * base.load; // DLC vs trad capex premium
            var annualCapexRecovery = capexPremium / 10; // need this much per year to break even in 10yr
            var negativeROIcount = 0;
            var breakEvenCount = 0;
            for (var j = 0; j < iterations; j++) {
                if (results[j] < 0) negativeROIcount++;
                if (results[j] >= annualCapexRecovery) breakEvenCount++;
            }
            var probNegativeROI = negativeROIcount / iterations;
            var probBreakEven = breakEvenCount / iterations;

            return {
                results: results,
                mean: mean,
                stdDev: stdDev,
                p1: p1,
                p5: p5,
                p10: p10,
                p25: p25,
                p50: p50,
                p75: p75,
                p90: p90,
                p95: p95,
                p99: p99,
                min: results[0],
                max: results[iterations - 1],
                cvar95: cvar95,
                probNegativeROI: probNegativeROI,
                probBreakEven: probBreakEven,
                annualCapexRecovery: annualCapexRecovery,
                iqr: p75 - p25
            };
        }

        function runHvacSensitivity(base) {
            var region = HVAC_REGIONS[base.region];
            var baseEnergy = base.load * 1000 * (region.pueTraditional - 1) * 8760 * base.rate;
            var baseDLC = base.load * 1000 * (region.pueDLC - 1) * 8760 * base.rate * 0.55;
            var baseSavings = baseEnergy - baseDLC;

            function calcSavings(load, rate, pueDLC) {
                var trad = load * 1000 * (region.pueTraditional - 1) * 8760 * rate;
                var dlc = load * 1000 * (pueDLC - 1) * 8760 * rate * 0.55;
                return trad - dlc;
            }

            var swingPct = 0.15; // +/-15%
            var puePct = 0.05;   // +/-5%
            var maintPct = 0.20; // +/-20%

            // IT Load
            var loadHigh = calcSavings(base.load * (1 + swingPct), base.rate, region.pueDLC);
            var loadLow = calcSavings(base.load * (1 - swingPct), base.rate, region.pueDLC);

            // Electricity Rate
            var rateHigh = calcSavings(base.load, base.rate * (1 + swingPct), region.pueDLC);
            var rateLow = calcSavings(base.load, base.rate * (1 - swingPct), region.pueDLC);

            // PUE DLC Efficiency
            var pueHigh = calcSavings(base.load, base.rate, region.pueDLC * (1 + puePct));
            var pueLow = calcSavings(base.load, base.rate, region.pueDLC * (1 - puePct));

            // Maintenance cost impact (on total savings including maintenance delta)
            var baseMaintDelta = (50000 - 80000) * base.load; // trad-dlc maint (negative = DLC more expensive)
            var maintHigh = baseSavings + baseMaintDelta * (1 + maintPct) - baseMaintDelta;
            var maintLow = baseSavings + baseMaintDelta * (1 - maintPct) - baseMaintDelta;

            // Climate volatility (simulate peak temp impact on PUE)
            var climVolHigh = calcSavings(base.load, base.rate, region.pueDLC * (1 + region.climateVolatility * 0.008));
            var climVolLow = calcSavings(base.load, base.rate, region.pueDLC * (1 - region.climateVolatility * 0.003));

            var items = [
                { label: 'IT Load (MW)', highVal: loadHigh, lowVal: loadLow, base: baseSavings, color: '#3b82f6' },
                { label: 'Electricity Rate', highVal: rateHigh, lowVal: rateLow, base: baseSavings, color: '#f59e0b' },
                { label: 'PUE Efficiency', highVal: pueLow, lowVal: pueHigh, base: baseSavings, color: '#22c55e' },
                { label: 'Maintenance Cost', highVal: maintLow, lowVal: maintHigh, base: baseSavings, color: '#a78bfa' },
                { label: 'Climate Volatility', highVal: climVolLow, lowVal: climVolHigh, base: baseSavings, color: '#f472b6' }
            ];

            // Calculate bidirectional impact magnitude and sort
            items.forEach(function(item) {
                item.upside = item.highVal - item.base;
                item.downside = item.lowVal - item.base;
                item.totalSwing = Math.abs(item.upside) + Math.abs(item.downside);
                item.impact = item.totalSwing; // compat
            });

            items.sort(function(a, b) { return b.totalSwing - a.totalSwing; });
            var maxSwing = items[0].totalSwing;
            items.forEach(function(item) { item.pct = item.totalSwing / maxSwing; });

            return { items: items, baseSavings: baseSavings };
        }

        function generateHvacNarrative(inputs, selectedRegion, mcData, sensitivityData) {
            var region = HVAC_REGIONS[selectedRegion];
            var tco = hvacCalcTCO(inputs);
            var sizeCategory = inputs.load <= 5 ? 'small' : inputs.load <= 12 ? 'medium' : 'large';
            var paragraphs = [];

            // === PARAGRAPH 1: Executive Summary ===
            var execSummary = '';
            var capexPremium = tco.dlc.capex - tco.traditional.capex;
            var savingsPct = ((tco.savingsDLC10yr / tco.traditional.npv10yr) * 100).toFixed(1);

            if (tco.savingsDLC10yr <= 0) {
                execSummary += '<strong>Financial Headline:</strong> At current parameters, a DLC transition for this ' + inputs.load + ' MW facility in ' + region.label +
                    ' does not yield positive 10-year NPV savings. The DLC architecture costs ' + fmt(Math.abs(tco.savingsDLC10yr)) +
                    ' <em>more</em> than traditional cooling over the analysis period. ';
                execSummary += 'This suggests the current electricity rate of $' + inputs.rate.toFixed(2) + '/kWh is too low to justify the ' +
                    fmt(capexPremium) + ' capex premium. Consider the hybrid approach, which saves ' + fmt(tco.savingsHybrid10yr) + ' over 10 years.';
            } else if (tco.paybackDLC > 10) {
                execSummary += '<strong>Financial Headline:</strong> The ' + inputs.load + ' MW DLC deployment in ' + region.label +
                    ' generates ' + fmt(tco.savingsDLC10yr) + ' in 10-year NPV savings (' + savingsPct + '% reduction vs traditional), ' +
                    'but with a payback period of ' + tco.paybackDLC.toFixed(1) + ' years that extends beyond the analysis horizon. ';
                execSummary += 'The annual operating savings of ' + fmt(tco.annualEnergySavingsDLC) + ' are real but insufficient to recover the ' +
                    fmt(capexPremium) + ' capex premium within 10 years. ';
                execSummary += 'A hybrid approach (payback: ' + tco.paybackHybrid.toFixed(1) + ' years) may be more prudent as a stepping stone.';
            } else {
                execSummary += '<strong>Financial Headline:</strong> A ' + inputs.load + ' MW warm-water DLC deployment in ' + region.label +
                    ' delivers <strong>' + fmt(tco.savingsDLC10yr) + '</strong> in 10-year NPV savings, a ' + savingsPct + '% reduction vs traditional chiller-based cooling. ';
                execSummary += 'The DLC capex premium of ' + fmt(capexPremium) + ' pays back in <strong>' + tco.paybackDLC.toFixed(1) + ' years</strong> ' +
                    'through ' + fmt(tco.annualEnergySavingsDLC) + '/year in energy savings alone. ';
                execSummary += 'Estimated IRR on the DLC investment is ' + (tco.irrDLC * 100).toFixed(1) + '%, which is ' +
                    (tco.irrDLC > 0.25 ? 'significantly above' : tco.irrDLC > 0.15 ? 'above' : 'near') + ' typical infrastructure hurdle rates of 12-15%.';
            }
            paragraphs.push(execSummary);

            // === PARAGRAPH 2: Regional Context & Climate ===
            var regionCtx = '<strong>Regional Context:</strong> ';

            // Rank this region among all 8
            var regionKeys = Object.keys(HVAC_REGIONS);
            var regionsSorted = regionKeys.slice().sort(function(a, b) { return HVAC_REGIONS[a].riskScore - HVAC_REGIONS[b].riskScore; });
            var regionRank = regionsSorted.indexOf(selectedRegion) + 1;
            var riskLabel = region.riskScore >= 7 ? 'high-risk' : region.riskScore >= 5 ? 'moderate-risk' : region.riskScore >= 3 ? 'low-risk' : 'minimal-risk';

            regionCtx += region.label + ' ranks #' + regionRank + ' out of 8 regions in climate risk (score: ' + region.riskScore.toFixed(1) + '/10, ' + riskLabel + '). ';

            if (region.riskScore >= 6) {
                regionCtx += 'With ' + region.climateType + ' conditions averaging ' + region.temp + '\u00B0C / ' + region.humidity + '% RH ' +
                    '(peak: ' + region.peakTemp + '\u00B0C), free cooling is limited to ' + region.freeHours.toLocaleString() + ' hours/year (' +
                    (region.freeHours / 87.6).toFixed(0) + '% of annual hours) -- ' +
                    (regionKeys.filter(function(k) { return HVAC_REGIONS[k].freeHours < region.freeHours; }).length) + ' regions have even fewer free cooling hours. ';
                regionCtx += 'A hybrid approach with ' + region.chillerBackup + '% chiller backup capacity is strongly recommended. ';
                regionCtx += 'High humidity (' + region.humidity + '% RH) further limits evaporative cooling effectiveness and increases condensation risk on cold surfaces.';
            } else if (region.riskScore >= 3) {
                regionCtx += 'The ' + region.climateType + ' climate provides ' + region.freeHours.toLocaleString() + ' free cooling hours/year (' +
                    (region.freeHours / 87.6).toFixed(0) + '%), enabling significant chiller-free operation. ';
                regionCtx += 'Peak ambient temperature of ' + region.peakTemp + '\u00B0C still requires ' + region.chillerBackup + '% chiller backup for extreme events. ';
                regionCtx += 'DLC achieves PUE ' + region.pueDLC.toFixed(2) + ', which is ' +
                    ((region.pueTraditional - region.pueDLC) / region.pueTraditional * 100).toFixed(0) + '% better than the traditional baseline PUE of ' + region.pueTraditional.toFixed(2) + '.';
            } else {
                regionCtx += 'The ' + region.climateType + ' climate is highly favorable with ' + region.freeHours.toLocaleString() + ' free cooling hours/year (' +
                    (region.freeHours / 87.6).toFixed(0) + '%), among the best globally for chiller-free operation. ';
                regionCtx += 'DLC achieves an excellent PUE of ' + region.pueDLC.toFixed(2) + ', ' +
                    ((region.pueTraditional - region.pueDLC) / region.pueTraditional * 100).toFixed(0) + '% better than traditional (' + region.pueTraditional.toFixed(2) + '). ';
                regionCtx += 'Only ' + region.chillerBackup + '% emergency chiller backup is recommended.';
            }

            // Environmental impact
            regionCtx += ' On the environmental front, DLC saves approximately ' + Math.round(tco.energySavingsDLC_kWh).toLocaleString() + ' kWh/year in cooling energy, ';
            regionCtx += 'offsetting an estimated ' + Math.round(tco.carbonOffsetDLC).toLocaleString() + ' tons of CO2 annually' +
                (region.co2Factor < 0.1 ? ' (limited due to the region\'s already-low grid carbon intensity)' : '') + '. ';
            regionCtx += 'Water consumption drops from ' + Math.round(tco.tradWaterGal / 1e6).toLocaleString() + 'M gallons/year to ' +
                Math.round(tco.dlcWaterGal / 1e6).toLocaleString() + 'M gallons/year with dry cooler-based DLC.';
            paragraphs.push(regionCtx);

            // === PARAGRAPH 3: Risk & Sensitivity (if MC data available) ===
            if (mcData && sensitivityData) {
                var riskPara = '<strong>Risk & Sensitivity Assessment:</strong> ';
                var cv = mcData.stdDev / mcData.mean;
                var confidenceLevel = cv < 0.12 ? 'high' : cv < 0.20 ? 'moderate' : 'low';
                var p5p95range = mcData.p95 - mcData.p5;

                riskPara += 'Monte Carlo analysis (10,000 iterations) yields median annual DLC savings of ' + fmt(mcData.p50) +
                    ' with a 90% confidence interval of ' + fmt(mcData.p5) + ' to ' + fmt(mcData.p95) + '. ';

                // Confidence badge
                riskPara += 'The coefficient of variation is ' + (cv * 100).toFixed(1) + '%, indicating <strong>' + confidenceLevel + ' confidence</strong> in the savings projection. ';

                // Tail risk
                riskPara += 'In the worst 1% of scenarios (P1), annual savings drop to ' + fmt(mcData.p1) +
                    ', while the expected shortfall (CVaR at 95%) is ' + fmt(mcData.cvar95) + '. ';

                // Break-even probability
                riskPara += 'The probability that annual DLC savings exceed the capex recovery threshold (' + fmt(mcData.annualCapexRecovery) + '/year) is <strong>' +
                    (mcData.probBreakEven * 100).toFixed(1) + '%</strong>';

                if (mcData.probNegativeROI > 0) {
                    riskPara += ', while ' + (mcData.probNegativeROI * 100).toFixed(2) + '% of scenarios show negative savings';
                }
                riskPara += '. ';

                // Top sensitivity driver
                var topDriver = sensitivityData.items[0];
                var secondDriver = sensitivityData.items.length > 1 ? sensitivityData.items[1] : null;
                riskPara += 'Sensitivity analysis identifies <strong>' + topDriver.label + '</strong> as the dominant cost driver (total swing: ' +
                    fmt(topDriver.totalSwing) + ')';
                if (secondDriver) {
                    riskPara += ', followed by ' + secondDriver.label + ' (' + fmt(secondDriver.totalSwing) + ')';
                }
                riskPara += '. Upside potential from favorable ' + topDriver.label.toLowerCase() + ' conditions is ' + fmt(Math.abs(topDriver.upside)) +
                    ', while downside exposure is ' + fmt(Math.abs(topDriver.downside)) + '.';

                paragraphs.push(riskPara);
            }

            // === PARAGRAPH 4: Strategic Recommendation ===
            var strategy = '<strong>Strategic Recommendation:</strong> ';

            if (tco.savingsDLC10yr <= 0) {
                strategy += 'Given the negative NPV at current parameters, a full DLC transition is <em>not recommended</em> at this time. ';
                strategy += 'Consider: (1) a phased hybrid approach starting with highest-density racks only, ';
                strategy += '(2) re-evaluating when electricity rates exceed $' + ((capexPremium / (tco.tradCoolingKWh * 0.45)) / 8760).toFixed(3) + '/kWh, or ';
                strategy += '(3) targeting regions with lower PUE achievability. ';
                strategy += 'The hybrid architecture saves ' + fmt(tco.savingsHybrid10yr) + ' over 10 years with a payback of ' + tco.paybackHybrid.toFixed(1) + ' years, ';
                strategy += 'making it a viable intermediate step.';
            } else if (tco.paybackDLC > 7) {
                strategy += 'The long payback period of ' + tco.paybackDLC.toFixed(1) + ' years suggests a cautious phased deployment. ';
                strategy += 'Phase 1 (Year 0-1): Deploy CDU infrastructure for ' + fmt(tco.dlc.capex * 0.4) + ', targeting top 30% density racks. ';
                strategy += 'Phase 2 (Year 2-3): Expand to 70% DLC coverage for ' + fmt(tco.dlc.capex * 0.35) + ' as the team gains operational maturity. ';
                strategy += 'Phase 3 (Year 4-5): Complete migration and begin legacy decommission (' + fmt(tco.dlc.capex * 0.25) + '). ';
                strategy += 'Budget ' + fmt(tco.retrainingCost) + ' for workforce retraining. ';
                strategy += 'Estimated downtime: ' + tco.downtimeHoursPhased + ' hours (phased) vs ' + tco.downtimeHoursFull + ' hours (full cutover). ';
                strategy += 'The phased approach costs ' + fmt(tco.phasedOverhead) + ' more in integration overhead but reduces operational risk significantly.';
            } else {
                strategy += 'With a ' + tco.paybackDLC.toFixed(1) + '-year payback and ' + (tco.irrDLC * 100).toFixed(0) + '% IRR, ';
                strategy += 'DLC deployment presents a strong financial case. ';
                if (sizeCategory === 'large') {
                    strategy += 'At ' + inputs.load + ' MW scale, the absolute savings are substantial -- a 3-phase rollout over 3-4 years is recommended ';
                    strategy += 'to manage operational risk while capturing ' + fmt(tco.annualEnergySavingsDLC) + '/year in energy savings. ';
                } else if (sizeCategory === 'medium') {
                    strategy += 'For a ' + inputs.load + ' MW facility, a 2-phase deployment (Year 0-1 foundation, Year 2-3 completion) ';
                    strategy += 'balances speed-to-savings with risk management. ';
                } else {
                    strategy += 'For a ' + inputs.load + ' MW facility, consider accelerated single-phase deployment ';
                    strategy += 'given the smaller absolute risk and faster path to full savings. ';
                }
                strategy += 'Key milestones: break-even at Year ' + Math.ceil(tco.paybackDLC) + ', cumulative savings reach ' +
                    fmt(tco.annualEnergySavingsDLC * 5) + ' by Year 5. ';
                strategy += 'Lifecycle cost per kW drops from $' + tco.lifecycleCostPerKW_trad.toFixed(0) + '/kW (traditional) to $' +
                    tco.lifecycleCostPerKW_dlc.toFixed(0) + '/kW (DLC), a ' +
                    ((1 - tco.lifecycleCostPerKW_dlc / tco.lifecycleCostPerKW_trad) * 100).toFixed(0) + '% improvement.';
            }

            // Supply chain & readiness note
            strategy += ' Technology readiness for this region is TRL ' + region.trl + '/9 with supply chain availability rated ' +
                region.supplyChain.toFixed(1) + '/10' +
                (region.supplyChain < 6 ? ' (limited -- plan for longer lead times and local inventory buffers)' : '') + '.';

            paragraphs.push(strategy);

            return paragraphs;
        }

        // === CANVAS CHARTS ===
        function drawTCOWaterfall(canvas, data) {
            if (!canvas) return;
            var ctx = canvas.getContext('2d');
            var dpr = window.devicePixelRatio || 1;
            var W = canvas.parentElement.clientWidth || 700;
            var H = 280;
            canvas.width = W * dpr;
            canvas.height = H * dpr;
            canvas.style.width = W + 'px';
            canvas.style.height = H + 'px';
            ctx.scale(dpr, dpr);
            ctx.clearRect(0, 0, W, H);

            var pad = { top: 30, right: 20, bottom: 60, left: 70 };
            var chartW = W - pad.left - pad.right;
            var chartH = H - pad.top - pad.bottom;

            var items = [
                { label: 'Traditional\nCapex', value: data.traditional.capex, color: '#ef4444', type: 'bar' },
                { label: 'Traditional\n10yr Opex', value: data.traditional.npv10yr - data.traditional.capex, color: '#f87171', type: 'bar' },
                { label: 'Hybrid\nCapex', value: data.hybrid.capex, color: '#f59e0b', type: 'bar' },
                { label: 'Hybrid\n10yr Opex', value: data.hybrid.npv10yr - data.hybrid.capex, color: '#fbbf24', type: 'bar' },
                { label: 'DLC\nCapex', value: data.dlc.capex, color: '#22c55e', type: 'bar' },
                { label: 'DLC\n10yr Opex', value: data.dlc.npv10yr - data.dlc.capex, color: '#4ade80', type: 'bar' }
            ];

            var maxVal = 0;
            items.forEach(function(it) { if (it.value > maxVal) maxVal = it.value; });
            maxVal *= 1.15;

            // Y-axis
            ctx.strokeStyle = 'rgba(148,163,184,0.2)';
            ctx.fillStyle = 'rgba(148,163,184,0.7)';
            ctx.font = '10px Inter, sans-serif';
            ctx.textAlign = 'right';
            for (var i = 0; i <= 5; i++) {
                var y = pad.top + chartH - (i / 5) * chartH;
                var val = (i / 5) * maxVal;
                ctx.beginPath(); ctx.moveTo(pad.left, y); ctx.lineTo(W - pad.right, y); ctx.stroke();
                ctx.fillText(fmt(val), pad.left - 8, y + 4);
            }

            var barW = chartW / items.length;
            var gap = barW * 0.3;

            items.forEach(function(item, idx) {
                var x = pad.left + idx * barW + gap / 2;
                var barH = (item.value / maxVal) * chartH;
                var y = pad.top + chartH - barH;

                var grad = ctx.createLinearGradient(x, y, x, pad.top + chartH);
                grad.addColorStop(0, item.color);
                grad.addColorStop(1, item.color + '66');
                ctx.fillStyle = grad;

                ctx.beginPath();
                ctx.roundRect(x, y, barW - gap, barH, [4, 4, 0, 0]);
                ctx.fill();

                // Value
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 10px Inter, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(fmt(item.value), x + (barW - gap) / 2, y - 6);

                // Label
                ctx.fillStyle = 'rgba(148,163,184,0.9)';
                ctx.font = '9px Inter, sans-serif';
                var lines = item.label.split('\n');
                lines.forEach(function(line, li) {
                    ctx.fillText(line, x + (barW - gap) / 2, H - pad.bottom + 14 + li * 12);
                });
            });

            // Title
            ctx.fillStyle = '#60a5fa';
            ctx.font = 'bold 12px Inter, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('10-Year TCO Waterfall (NPV @ 8%)', W / 2, 18);
        }

        function drawMonteHistogram(canvas, mc) {
            if (!canvas || !mc) return;
            var ctx = canvas.getContext('2d');
            var dpr = window.devicePixelRatio || 1;
            var W = canvas.parentElement.clientWidth || 700;
            var H = 280;
            canvas.width = W * dpr;
            canvas.height = H * dpr;
            canvas.style.width = W + 'px';
            canvas.style.height = H + 'px';
            ctx.scale(dpr, dpr);
            ctx.clearRect(0, 0, W, H);

            var pad = { top: 30, right: 20, bottom: 50, left: 60 };
            var chartW = W - pad.left - pad.right;
            var chartH = H - pad.top - pad.bottom;

            // Build histogram bins
            var numBins = 40;
            var range = mc.max - mc.min;
            var binWidth = range / numBins;
            var bins = new Array(numBins).fill(0);
            mc.results.forEach(function(v) {
                var idx = Math.min(Math.floor((v - mc.min) / binWidth), numBins - 1);
                bins[idx]++;
            });
            var maxBin = Math.max.apply(null, bins);

            // Draw bins
            var barW = chartW / numBins;
            bins.forEach(function(count, i) {
                var x = pad.left + i * barW;
                var barH = (count / maxBin) * chartH;
                var y = pad.top + chartH - barH;

                ctx.fillStyle = 'rgba(59,130,246,0.6)';
                ctx.fillRect(x, y, barW - 1, barH);
            });

            // P5, P50, P95 lines
            function drawLine(val, label, color) {
                var x = pad.left + ((val - mc.min) / range) * chartW;
                ctx.strokeStyle = color;
                ctx.lineWidth = 2;
                ctx.setLineDash([4, 4]);
                ctx.beginPath(); ctx.moveTo(x, pad.top); ctx.lineTo(x, pad.top + chartH); ctx.stroke();
                ctx.setLineDash([]);
                ctx.fillStyle = color;
                ctx.font = 'bold 10px Inter, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(label + ': ' + fmt(val), x, pad.top - 6);
            }
            drawLine(mc.p5, 'P5', '#ef4444');
            drawLine(mc.p50, 'P50', '#f59e0b');
            drawLine(mc.p95, 'P95', '#22c55e');

            // X-axis labels
            ctx.fillStyle = 'rgba(148,163,184,0.7)';
            ctx.font = '9px Inter, sans-serif';
            ctx.textAlign = 'center';
            for (var i = 0; i <= 4; i++) {
                var val = mc.min + (i / 4) * range;
                var x = pad.left + (i / 4) * chartW;
                ctx.fillText(fmt(val), x, H - pad.bottom + 18);
            }

            // Title
            ctx.fillStyle = '#60a5fa';
            ctx.font = 'bold 12px Inter, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Monte Carlo: Annual DLC Savings Distribution (10K iterations)', W / 2, 18);
        }

        // === UPDATE PRO PANELS ===
        function updateHvacProPanels() {
            var loadSlider = document.getElementById('loadSlider');
            var rateSlider = document.getElementById('rateSlider');
            var regionSelect = document.getElementById('hvacRegionSelect');
            if (!loadSlider || !rateSlider || !regionSelect) return;

            var inputs = {
                load: parseInt(loadSlider.value),
                rate: parseInt(rateSlider.value) / 100,
                region: regionSelect.value
            };

            var region = HVAC_REGIONS[inputs.region];
            var tco = hvacCalcTCO(inputs);
            var mc = runHvacMonteCarlo(inputs);
            var sensitivity = runHvacSensitivity(inputs);
            var narrativeParagraphs = generateHvacNarrative(inputs, inputs.region, mc, sensitivity);

            // ========== Panel 1: 10-Year TCO ==========
            var tcoKPIs = document.getElementById('hvacTcoKPIs');
            if (tcoKPIs) {
                var savingsColor = tco.savingsDLC10yr > 0 ? '#22c55e' : '#ef4444';
                tcoKPIs.innerHTML =
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value">' + fmt(tco.traditional.npv10yr) + '</div><div class="hvac-kpi-label">Traditional TCO (10yr NPV) <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Traditional Cooling TCO</div><div class="td">Net Present Value of total ownership cost for conventional air-cooled CRAC/CRAH systems over 10 years.</div><span class="tf">Includes CAPEX, energy, maintenance, water, replacement</span></span></span></div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value">' + fmt(tco.hybrid.npv10yr) + '</div><div class="hvac-kpi-label">Hybrid TCO (10yr NPV) <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Hybrid Cooling TCO</div><div class="td">NPV of combined air + rear-door heat exchanger (RDHx) approach. Moderate CAPEX uplift with significant energy savings.</div></span></span></div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value" style="color:#22c55e;">' + fmt(tco.dlc.npv10yr) + '</div><div class="hvac-kpi-label">DLC TCO (10yr NPV) <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">DLC Total Cost of Ownership</div><div class="td">NPV of full direct-to-chip liquid cooling. Higher CAPEX but dramatically lower energy — essential for 40-100kW AI/GPU racks.</div></span></span></div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value" style="color:' + savingsColor + ';">' + fmt(tco.savingsDLC10yr) + '</div><div class="hvac-kpi-label">DLC Savings vs Traditional <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">DLC vs Traditional Savings</div><div class="td">Total cost advantage of DLC over traditional air cooling across the 10-year analysis period.</div><span class="tf">Typical: 25-45% of traditional TCO</span></span></span></div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value">' + tco.paybackDLC.toFixed(1) + ' yrs</div><div class="hvac-kpi-label">DLC Payback Period <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">DLC Payback Period</div><div class="td">Years for DLC higher initial investment to be recovered through energy and operational savings.</div><span class="tf">Good: &lt;3yr &middot; Acceptable: 3-5yr</span></span></span></div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value">' + (tco.irrDLC * 100).toFixed(1) + '%</div><div class="hvac-kpi-label">Estimated IRR (DLC) <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">DLC Internal Rate of Return</div><div class="td">Annualized return on DLC investment premium over traditional cooling.</div><span class="tf">Good: &gt;20% &middot; Excellent: &gt;35%</span></span></span></div></div>';
            }

            // Energy & Environmental KPIs
            var energyKPIs = document.getElementById('hvacTcoEnergyKPIs');
            if (energyKPIs) {
                energyKPIs.innerHTML =
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value">' + fmt(tco.annualEnergySavingsDLC) + '</div><div class="hvac-kpi-label">Annual Energy Savings (DLC) <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">DLC Energy Savings</div><div class="td">Yearly electricity savings from DLC vs traditional air cooling.</div></span></span></div><div class="hvac-kpi-sublabel">' + Math.round(tco.energySavingsDLC_kWh).toLocaleString() + ' kWh/yr</div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value" style="color:#10b981;">' + Math.round(tco.carbonOffsetDLC).toLocaleString() + '</div><div class="hvac-kpi-label">CO2 Offset (tons/yr)</div><div class="hvac-kpi-sublabel">Factor: ' + region.co2Factor.toFixed(2) + ' tCO2/MWh</div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value" style="color:#06b6d4;">' + (tco.waterSavingsDLC / 1e6).toFixed(1) + 'M</div><div class="hvac-kpi-label">Water Savings (gal/yr)</div><div class="hvac-kpi-sublabel">DLC: ' + (tco.dlcWaterGal / 1e6).toFixed(1) + 'M vs Trad: ' + (tco.tradWaterGal / 1e6).toFixed(1) + 'M</div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value">' + fmt(tco.annualEnergySavingsHybrid) + '</div><div class="hvac-kpi-label">Annual Energy Savings (Hybrid) <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Hybrid Energy Savings</div><div class="td">Yearly electricity savings from hybrid cooling (RDHx) vs traditional air-only.</div></span></span></div><div class="hvac-kpi-sublabel">' + Math.round(tco.energySavingsHybrid_kWh).toLocaleString() + ' kWh/yr</div></div>';
            }

            // Lifecycle & Maintenance KPIs
            var lifecycleKPIs = document.getElementById('hvacTcoLifecycleKPIs');
            if (lifecycleKPIs) {
                var lcImprovement = ((1 - tco.lifecycleCostPerKW_dlc / tco.lifecycleCostPerKW_trad) * 100).toFixed(0);
                lifecycleKPIs.innerHTML =
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value">$' + tco.lifecycleCostPerKW_trad.toFixed(0) + '</div><div class="hvac-kpi-label">Lifecycle $/kW (Traditional) <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Traditional Lifecycle Cost/kW</div><div class="td">Total lifecycle cost per kW for conventional air-cooled systems.</div></span></span></div><div class="hvac-kpi-sublabel">10yr NPV per cooling kW</div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value" style="color:#22c55e;">$' + tco.lifecycleCostPerKW_dlc.toFixed(0) + '</div><div class="hvac-kpi-label">Lifecycle $/kW (DLC) <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">DLC Lifecycle Cost/kW</div><div class="td">Total lifecycle cost per kW for direct liquid cooling.</div></span></span></div><div class="hvac-kpi-sublabel">' + lcImprovement + '% improvement</div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value">' + fmt(tco.tradMaint10yr) + '</div><div class="hvac-kpi-label">Trad Maintenance (10yr NPV) <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Traditional Maintenance</div><div class="td">NPV of 10-year maintenance for air cooling: filters, fan replacements, refrigerant, etc.</div></span></span></div><div class="hvac-kpi-sublabel">$' + (COOLING_CONFIGS.traditional.maintenancePerMW / 1000).toFixed(0) + 'K/MW/yr</div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value">' + fmt(tco.dlcMaint10yr) + '</div><div class="hvac-kpi-label">DLC Maintenance (10yr NPV) <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">DLC Maintenance</div><div class="td">NPV of 10-year maintenance for liquid cooling: pump seals, coolant, leak detection.</div></span></span></div><div class="hvac-kpi-sublabel">$' + (COOLING_CONFIGS.dlc.maintenancePerMW / 1000).toFixed(0) + 'K/MW/yr (leak det., fluid)</div></div>';
            }

            drawTCOWaterfall(document.getElementById('hvacWaterfallChart'), tco);

            // Panel 1 Narrative
            var tcoNar = document.getElementById('hvacTcoNarrative');
            if (tcoNar) {
                tcoNar.innerHTML = narrativeParagraphs.map(function(p) {
                    return '<div class="hvac-narrative-paragraph">' + p + '</div>';
                }).join('');
            }

            // ========== Panel 2: Regional Risk Matrix ==========
            var riskKPIs = document.getElementById('hvacRiskKPIs');
            var failProb = (region.riskScore / 10 * 100).toFixed(0);
            var adjustedPUE = (region.pueDLC * (1 + region.riskScore * 0.005)).toFixed(3);
            if (riskKPIs) {
                riskKPIs.innerHTML =
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value">' + region.temp + '\u00B0C</div><div class="hvac-kpi-label">Avg Ambient Temperature <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Avg Ambient Temperature</div><div class="td">Mean annual outdoor temperature. Higher temps reduce free cooling hours and increase energy costs.</div></span></span></div><div class="hvac-kpi-sublabel">Peak: ' + region.peakTemp + '\u00B0C</div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value">' + region.humidity + '%</div><div class="hvac-kpi-label">Avg Relative Humidity <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Avg Relative Humidity</div><div class="td">Mean annual humidity. High humidity limits economizer effectiveness and increases corrosion risk.</div></span></span></div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value">' + region.freeHours.toLocaleString() + '</div><div class="hvac-kpi-label">Free Cooling Hours/Year <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Free Cooling Hours</div><div class="td">Annual hours where outdoor conditions allow mechanical cooling bypass (economizer mode).</div><span class="tf">Nordic: &gt;6,000h &middot; Tropical: &lt;500h</span></span></span></div><div class="hvac-kpi-sublabel">' + (region.freeHours / 87.6).toFixed(0) + '% of annual hours</div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value" style="color:' + (region.riskScore >= 6 ? '#ef4444' : region.riskScore >= 3 ? '#f59e0b' : '#22c55e') + ';">' + region.riskScore.toFixed(1) + '/10</div><div class="hvac-kpi-label">Climate Risk Score <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Climate Risk Score</div><div class="td">Composite risk index (0-100) combining temperature extremes, humidity, disaster probability, grid resilience.</div></span></span></div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value">' + failProb + '%</div><div class="hvac-kpi-label">Failure Probability (High Heat) <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">High-Heat Failure Probability</div><div class="td">Estimated probability of cooling system failure during extreme heat events.</div></span></span></div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value">' + adjustedPUE + '</div><div class="hvac-kpi-label">Risk-Adjusted PUE (DLC) <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Risk-Adjusted PUE</div><div class="td">DLC PUE adjusted for climate risk — accounts for degradation during extreme weather.</div></span></span></div></div>';
            }

            // Extended Risk Dimensions
            var riskExtKPIs = document.getElementById('hvacRiskExtKPIs');
            if (riskExtKPIs) {
                var regCompColor = region.regulatoryRisk >= 7 ? '#22c55e' : region.regulatoryRisk >= 5 ? '#f59e0b' : '#ef4444';
                var trlColor = region.trl >= 7 ? '#22c55e' : region.trl >= 5 ? '#f59e0b' : '#ef4444';
                var scColor = region.supplyChain >= 7 ? '#22c55e' : region.supplyChain >= 5 ? '#f59e0b' : '#ef4444';
                var cvColor = region.climateVolatility <= 3 ? '#22c55e' : region.climateVolatility <= 5 ? '#f59e0b' : '#ef4444';
                riskExtKPIs.innerHTML =
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value" style="color:' + regCompColor + ';">' + region.regulatoryRisk.toFixed(1) + '/10</div><div class="hvac-kpi-label">Regulatory Compliance <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Regulatory Compliance</div><div class="td">Assessment of DC cooling against local environmental regulations.</div></span></span></div><div class="hvac-kpi-sublabel">' + (region.regulatoryRisk >= 7 ? 'Strong frameworks' : region.regulatoryRisk >= 5 ? 'Developing standards' : 'Limited regulation') + '</div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value" style="color:' + trlColor + ';">TRL ' + region.trl + '/9</div><div class="hvac-kpi-label">Technology Readiness <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Technology Readiness</div><div class="td">Maturity assessment of selected cooling technology for the deployment scenario.</div></span></span></div><div class="hvac-kpi-sublabel">' + (region.trl >= 8 ? 'Proven at scale' : region.trl >= 6 ? 'Demo validated' : 'Early adoption') + '</div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value" style="color:' + scColor + ';">' + region.supplyChain.toFixed(1) + '/10</div><div class="hvac-kpi-label">Supply Chain Availability <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Supply Chain Availability</div><div class="td">Regional availability of cooling equipment, spare parts, and qualified technicians.</div></span></span></div><div class="hvac-kpi-sublabel">' + (region.supplyChain >= 7 ? 'Multiple vendors' : region.supplyChain >= 5 ? 'Limited options' : 'Scarce supply') + '</div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value" style="color:' + cvColor + ';">' + region.climateVolatility.toFixed(1) + '/10</div><div class="hvac-kpi-label">Climate Volatility Index <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Climate Volatility Index</div><div class="td">Year-to-year climate variation measure. Higher volatility = less predictable cooling performance.</div></span></span></div><div class="hvac-kpi-sublabel">' + (region.climateVolatility <= 3 ? 'Stable climate' : region.climateVolatility <= 5 ? 'Moderate swings' : 'High variability') + '</div></div>';
            }

            var riskNar = document.getElementById('hvacRiskNarrative');
            if (riskNar) {
                // Rank region among all 8
                var regionKeys = Object.keys(HVAC_REGIONS);
                var regionsSorted = regionKeys.slice().sort(function(a, b) { return HVAC_REGIONS[a].riskScore - HVAC_REGIONS[b].riskScore; });
                var regionRank = regionsSorted.indexOf(inputs.region) + 1;
                var bestRegion = HVAC_REGIONS[regionsSorted[0]];
                var worstRegion = HVAC_REGIONS[regionsSorted[regionsSorted.length - 1]];

                var riskText = '<div class="hvac-narrative-paragraph"><strong>' + region.label + '</strong> ranks <strong>#' + regionRank + ' of 8 regions</strong> in climate risk (score: ' +
                    region.riskScore.toFixed(1) + '/10). ';
                if (region.riskScore >= 6) {
                    riskText += 'This is a <strong>high-risk region</strong> for chiller-free operation. Only ' + (region.freeHours / 87.6).toFixed(0) + '% of annual hours qualify for free cooling, ' +
                        'compared to ' + (bestRegion.freeHours / 87.6).toFixed(0) + '% in ' + bestRegion.label + ' (best-in-class). ';
                    riskText += 'Chiller backup capacity of <strong>' + region.chillerBackup + '%</strong> is required. Risk-adjusted PUE increases to ' + adjustedPUE + '.</div>';
                    riskText += '<div class="hvac-narrative-paragraph">Key concerns: ';
                    if (region.humidity >= 75) riskText += 'high humidity (' + region.humidity + '% RH) limits evaporative cooling and increases condensation risk; ';
                    if (region.peakTemp >= 40) riskText += 'peak temperatures of ' + region.peakTemp + '\u00B0C exceed dry cooler design limits; ';
                    if (region.supplyChain < 6) riskText += 'limited local supply chain (rated ' + region.supplyChain.toFixed(1) + '/10) may cause long lead times; ';
                    riskText += 'climate volatility index of ' + region.climateVolatility.toFixed(1) + '/10 indicates ' + (region.climateVolatility > 5 ? 'significant' : 'moderate') + ' weather unpredictability.</div>';
                } else {
                    riskText += 'This region is <strong>favorable</strong> for chiller-free operation with ' + (region.freeHours / 87.6).toFixed(0) + '% free cooling availability. ';
                    riskText += 'Only ' + region.chillerBackup + '% chiller backup is recommended. ';
                    riskText += 'Risk-adjusted PUE of ' + adjustedPUE + ' remains excellent.</div>';
                    riskText += '<div class="hvac-narrative-paragraph">Technology readiness (TRL ' + region.trl + '/9) and supply chain availability (' + region.supplyChain.toFixed(1) + '/10) support confident deployment. ';
                    riskText += 'Regulatory compliance rated ' + region.regulatoryRisk.toFixed(1) + '/10 ' +
                        (region.regulatoryRisk >= 7 ? 'with strong environmental standards that favor DLC adoption.' : 'with developing frameworks.') + '</div>';
                }
                riskNar.innerHTML = riskText;
            }

            // ========== Panel 3: Transition Planning ==========
            var transKPIs = document.getElementById('hvacTransitionKPIs');
            var phase1Capex = tco.dlc.capex * 0.4;
            var phase2Capex = tco.dlc.capex * 0.35;
            var phase3Capex = tco.dlc.capex * 0.25;
            var trainingCost = tco.retrainingCost;
            var totalTransition = tco.dlc.capex + trainingCost;
            if (transKPIs) {
                transKPIs.innerHTML =
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value">' + fmt(phase1Capex) + '</div><div class="hvac-kpi-label">Phase 1 (Year 0-1): Foundation <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Phase 1: Foundation</div><div class="td">Initial deployment — pilot installation, staff training, monitoring setup.</div></span></span></div><div class="hvac-kpi-sublabel">CDU, piping, controls</div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value">' + fmt(phase2Capex) + '</div><div class="hvac-kpi-label">Phase 2 (Year 2-3): Expansion <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Phase 2: Expansion</div><div class="td">Scale-up — expand DLC to additional rows/halls based on Phase 1 learnings.</div></span></span></div><div class="hvac-kpi-sublabel">High-density rack DLC</div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value">' + fmt(phase3Capex) + '</div><div class="hvac-kpi-label">Phase 3 (Year 4-5): Optimization <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Phase 3: Optimization</div><div class="td">Full deployment with performance tuning, predictive maintenance, operational maturity.</div></span></span></div><div class="hvac-kpi-sublabel">Full migration</div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value">' + fmt(trainingCost) + '</div><div class="hvac-kpi-label">Workforce Training <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Workforce Training</div><div class="td">Investment in retraining staff from air cooling to liquid cooling operations.</div></span></span></div><div class="hvac-kpi-sublabel">Certification & procedures</div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value">' + fmt(totalTransition) + '</div><div class="hvac-kpi-label">Total Transition Cost <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Total Transition Cost</div><div class="td">All-in migration cost: equipment, installation, training, and downtime.</div></span></span></div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value">' + fmt(tco.dlc.annualOpex) + '/yr</div><div class="hvac-kpi-label">Steady-State Opex <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Steady-State Opex</div><div class="td">Annual operating cost after full DLC deployment and optimization.</div></span></span></div></div>';
            }

            // Extended Transition KPIs
            var transExtKPIs = document.getElementById('hvacTransitionExtKPIs');
            if (transExtKPIs) {
                transExtKPIs.innerHTML =
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value">' + tco.downtimeHoursPhased + ' hrs</div><div class="hvac-kpi-label">Est. Downtime (Phased) <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Phased Downtime</div><div class="td">Estimated downtime for phased DLC deployment.</div></span></span></div><div class="hvac-kpi-sublabel">' + (tco.downtimeHoursPhased / 24).toFixed(1) + ' days over 5 years</div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value" style="color:#f59e0b;">' + tco.downtimeHoursFull + ' hrs</div><div class="hvac-kpi-label">Est. Downtime (Full Cutover) <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Full Cutover Downtime</div><div class="td">Estimated downtime for complete DLC migration.</div></span></span></div><div class="hvac-kpi-sublabel">' + (tco.downtimeHoursFull / 24).toFixed(1) + ' days single event</div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value">' + fmt(tco.phasedDeploymentCost) + '</div><div class="hvac-kpi-label">Phased Deployment Cost <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Phased Deployment Cost</div><div class="td">Total cost of phased DLC rollout.</div></span></span></div><div class="hvac-kpi-sublabel">+12% integration overhead</div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value" style="color:#22c55e;">' + fmt(tco.fullDeploymentCost) + '</div><div class="hvac-kpi-label">Full Deployment Cost <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Full Deploy Cost</div><div class="td">Total cost of one-time full DLC deployment.</div></span></span></div><div class="hvac-kpi-sublabel">Higher risk, lower cost</div></div>';
            }

            // ROI Milestone Timeline
            var milestoneDiv = document.getElementById('hvacMilestoneTimeline');
            if (milestoneDiv) {
                var annualSavings = tco.traditional.annualOpex - tco.dlc.annualOpex;
                var capexPremium = tco.dlc.capex - tco.traditional.capex;
                var milestoneHtml = '<div class="hvac-section-divider"><i class="fas fa-flag-checkered" style="margin-right:4px;"></i> ROI Timeline with Milestones</div>';
                var cumSavings = 0;
                var maxCum = annualSavings * 10;
                if (maxCum <= 0) maxCum = capexPremium * 2; // fallback
                for (var yr = 1; yr <= 10; yr++) {
                    cumSavings += annualSavings;
                    var fillPct = Math.min(100, Math.max(0, (cumSavings / maxCum) * 100));
                    var isBreakEven = cumSavings >= capexPremium && (cumSavings - annualSavings) < capexPremium;
                    var barColor = cumSavings < 0 ? '#ef4444' : cumSavings < capexPremium ? '#f59e0b' : '#22c55e';
                    var milestone = '';
                    if (yr === 1) milestone = 'Phase 1 complete';
                    else if (yr === 3) milestone = 'Phase 2 complete';
                    else if (yr === 5) milestone = 'Phase 3 complete';
                    else if (isBreakEven) milestone = 'BREAK-EVEN';
                    milestoneHtml += '<div class="hvac-milestone-bar">' +
                        '<div class="hvac-milestone-year">Y' + yr + '</div>' +
                        '<div class="hvac-milestone-track"><div class="hvac-milestone-fill" style="width:' + fillPct.toFixed(0) + '%;background:' + barColor + ';"></div></div>' +
                        '<div class="hvac-milestone-label">' + fmt(cumSavings) + (milestone ? ' <strong>' + milestone + '</strong>' : '') + '</div></div>';
                }
                milestoneDiv.innerHTML = milestoneHtml;
            }

            var transNar = document.getElementById('hvacTransitionNarrative');
            if (transNar) {
                var annualSav = tco.traditional.annualOpex - tco.dlc.annualOpex;
                var phasedSavingsNote = annualSav > 0 ?
                    'Phased deployment begins generating partial savings from Year 1 (est. 30% of full savings = ' + fmt(annualSav * 0.3) + '/yr), ' +
                    'ramping to 70% by Year 3 and 100% by Year 5. ' : '';
                transNar.innerHTML =
                    '<div class="hvac-narrative-paragraph"><strong>Transition Strategy:</strong> Recommended 3-phase deployment over 5 years for ' + inputs.load + ' MW facility in ' + region.label + '. ' +
                    'Phase 1 (Year 0-1) focuses on CDU infrastructure, piping, and controls for ' + fmt(phase1Capex) + '. ' +
                    'Phase 2 (Year 2-3) expands DLC coverage to high-density racks for ' + fmt(phase2Capex) + '. ' +
                    'Phase 3 (Year 4-5) completes migration and decommissions legacy chillers for ' + fmt(phase3Capex) + '.</div>' +
                    '<div class="hvac-narrative-paragraph">' + phasedSavingsNote +
                    'Phased approach adds ' + fmt(tco.phasedOverhead) + ' in integration overhead but reduces maximum downtime to ' + tco.downtimeHoursPhased + ' hours ' +
                    '(spread across phases) vs ' + tco.downtimeHoursFull + ' hours for full cutover. ' +
                    'Workforce training budget of ' + fmt(trainingCost) + ' covers liquid cooling certification, leak detection protocols, and emergency procedures -- ' +
                    'this is ' + ((trainingCost / totalTransition) * 100).toFixed(1) + '% of total transition cost.</div>';
            }

            // ========== Panel 4: Monte Carlo ==========
            var monteKPIs = document.getElementById('hvacMonteKPIs');
            if (monteKPIs) {
                monteKPIs.innerHTML =
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value">' + fmt(mc.mean) + '</div><div class="hvac-kpi-label">Mean Annual Savings</div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value" style="color:#ef4444;">' + fmt(mc.p5) + '</div><div class="hvac-kpi-label">P5 (Conservative)</div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value">' + fmt(mc.p50) + '</div><div class="hvac-kpi-label">P50 (Median) <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">P50 — Median</div><div class="td">50th percentile — the most likely savings outcome from Monte Carlo simulation.</div></span></span></div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value" style="color:#22c55e;">' + fmt(mc.p95) + '</div><div class="hvac-kpi-label">P95 (Optimistic)</div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value">' + fmt(mc.stdDev) + '</div><div class="hvac-kpi-label">Std Deviation <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Standard Deviation</div><div class="td">Spread of savings outcomes. Higher = more uncertainty in financial projections.</div></span></span></div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value">' + ((mc.stdDev / mc.mean) * 100).toFixed(1) + '%</div><div class="hvac-kpi-label">Coefficient of Variation <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Coefficient of Variation</div><div class="td">Std dev / mean ratio. Measures relative uncertainty.</div><span class="tf">CV &lt; 0.3: Low risk &middot; CV &gt; 0.5: High</span></span></span></div></div>';
            }

            // Tail Risk KPIs
            var monteTailKPIs = document.getElementById('hvacMonteTailKPIs');
            if (monteTailKPIs) {
                var cv = mc.stdDev / mc.mean;
                var confClass = cv < 0.12 ? 'hvac-confidence-high' : cv < 0.20 ? 'hvac-confidence-med' : 'hvac-confidence-low';
                var confLabel = cv < 0.12 ? 'HIGH' : cv < 0.20 ? 'MODERATE' : 'LOW';
                monteTailKPIs.innerHTML =
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value" style="color:#f87171;">' + fmt(mc.p1) + '</div><div class="hvac-kpi-label">P1 (Worst-Case Tail) <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">P1 — Worst Case</div><div class="td">The worst 1% of simulated scenarios. Your downside risk floor.</div></span></span></div><div class="hvac-kpi-sublabel">1st percentile scenario</div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value" style="color:#fb923c;">' + fmt(mc.cvar95) + '</div><div class="hvac-kpi-label">CVaR at 95%</div><div class="hvac-kpi-sublabel">Expected shortfall (avg of worst 5%)</div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value" style="color:' + (mc.probNegativeROI > 0.05 ? '#ef4444' : mc.probNegativeROI > 0 ? '#f59e0b' : '#22c55e') + ';">' + (mc.probNegativeROI * 100).toFixed(2) + '%</div><div class="hvac-kpi-label">Prob. of Negative Savings <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Prob. Negative Savings</div><div class="td">Percentage of Monte Carlo runs where DLC costs MORE than traditional.</div><span class="tf">Good: &lt;5% &middot; Acceptable: &lt;15%</span></span></span></div><div class="hvac-kpi-sublabel">' + Math.round(mc.probNegativeROI * 10000) + ' of 10,000 scenarios</div></div>' +
                    '<div class="hvac-kpi-card"><div class="hvac-kpi-value" style="color:' + (mc.probBreakEven >= 0.9 ? '#22c55e' : mc.probBreakEven >= 0.7 ? '#f59e0b' : '#ef4444') + ';">' + (mc.probBreakEven * 100).toFixed(1) + '%</div><div class="hvac-kpi-label">Break-Even Probability</div><div class="hvac-kpi-sublabel">Savings exceed ' + fmt(mc.annualCapexRecovery) + '/yr<span class="' + confClass + ' hvac-confidence-badge">' + confLabel + '</span></div></div>';
            }

            drawMonteHistogram(document.getElementById('hvacMonteChart'), mc);

            // Enhanced Tornado bars (bidirectional with $ values)
            var tornadoBars = document.getElementById('hvacTornadoBars');
            if (tornadoBars) {
                var sensItems = sensitivity.items;
                var maxHalf = 0;
                sensItems.forEach(function(item) {
                    var absUp = Math.abs(item.upside);
                    var absDn = Math.abs(item.downside);
                    if (absUp > maxHalf) maxHalf = absUp;
                    if (absDn > maxHalf) maxHalf = absDn;
                });

                var html = '<div class="hvac-tornado-header"><span><i class="fas fa-chart-bar" style="margin-right:6px;"></i>Sensitivity Tornado Chart</span>' +
                    '<span style="font-size:0.72rem;color:#94a3b8;">Baseline: ' + fmt(sensitivity.baseSavings) + '/yr</span></div>';

                sensItems.forEach(function(item) {
                    var upPct = maxHalf > 0 ? (Math.abs(item.upside) / maxHalf) * 50 : 0;
                    var dnPct = maxHalf > 0 ? (Math.abs(item.downside) / maxHalf) * 50 : 0;
                    var posColor = item.upside >= 0 ? '#22c55e' : '#ef4444';
                    var negColor = item.downside >= 0 ? '#22c55e' : '#ef4444';

                    html += '<div class="hvac-sensitivity-bar" style="margin-bottom:0.6rem;">' +
                        '<div class="hvac-sensitivity-label" style="min-width:120px;">' + item.label + '</div>' +
                        '<div class="hvac-tornado-val-left">' + (item.downside >= 0 ? '+' : '') + fmt(item.downside) + '</div>' +
                        '<div class="hvac-tornado-track">' +
                            '<div class="hvac-tornado-baseline"></div>' +
                            '<div class="hvac-tornado-fill-neg" style="width:' + dnPct.toFixed(1) + '%;background:' + negColor + ';opacity:0.7;"></div>' +
                            '<div class="hvac-tornado-fill-pos" style="width:' + upPct.toFixed(1) + '%;background:' + posColor + ';opacity:0.7;"></div>' +
                        '</div>' +
                        '<div class="hvac-tornado-val-right">' + (item.upside >= 0 ? '+' : '') + fmt(item.upside) + '</div>' +
                    '</div>';
                });
                html += '<div style="display:flex;justify-content:center;gap:1.5rem;margin-top:0.5rem;font-size:0.72rem;color:#64748b;">' +
                    '<span style="color:#ef4444;">&#9632; Downside</span>' +
                    '<span style="color:#94a3b8;">| Baseline |</span>' +
                    '<span style="color:#22c55e;">&#9632; Upside</span></div>';
                tornadoBars.innerHTML = html;
            }

            var monteNar = document.getElementById('hvacMonteNarrative');
            if (monteNar) {
                var topDriver = sensitivity.items[0];
                var cv = mc.stdDev / mc.mean;
                var uncertaintyLevel = cv < 0.12 ? 'low' : cv < 0.20 ? 'moderate' : 'high';
                var narHtml = '<div class="hvac-narrative-paragraph"><strong>Statistical Summary:</strong> Monte Carlo simulation with 10,000 iterations ' +
                    '(load \u00B115%, rate \u00B115%, PUE \u00B15%) shows median annual DLC savings of ' + fmt(mc.p50) +
                    ' with a 90% confidence interval of [' + fmt(mc.p5) + ', ' + fmt(mc.p95) + ']. ' +
                    'The interquartile range (IQR) is ' + fmt(mc.iqr) + ' and coefficient of variation is ' + (cv * 100).toFixed(1) +
                    '%, indicating <strong>' + uncertaintyLevel + ' uncertainty</strong> in the savings projection.</div>';
                narHtml += '<div class="hvac-narrative-paragraph"><strong>Tail Risk:</strong> The worst-case scenario (P1) yields ' + fmt(mc.p1) +
                    ' in annual savings, while the expected shortfall (CVaR-95) -- the average of the worst 5% of outcomes -- is ' + fmt(mc.cvar95) + '. ';
                if (mc.probNegativeROI > 0.01) {
                    narHtml += 'There is a ' + (mc.probNegativeROI * 100).toFixed(1) + '% probability of negative annual savings, which warrants risk mitigation. ';
                } else if (mc.probNegativeROI > 0) {
                    narHtml += 'Only ' + (mc.probNegativeROI * 100).toFixed(2) + '% of scenarios show negative savings, indicating robust downside protection. ';
                } else {
                    narHtml += 'No scenarios produced negative savings, indicating very strong downside protection at current parameters. ';
                }
                narHtml += 'Break-even probability (savings > capex recovery of ' + fmt(mc.annualCapexRecovery) + '/yr) is ' +
                    (mc.probBreakEven * 100).toFixed(1) + '%.</div>';
                narHtml += '<div class="hvac-narrative-paragraph"><strong>Key Sensitivity Drivers:</strong> ' + topDriver.label + ' is the dominant variable with a total swing of ' +
                    fmt(topDriver.totalSwing) + ' (upside: ' + (topDriver.upside >= 0 ? '+' : '') + fmt(topDriver.upside) +
                    ', downside: ' + (topDriver.downside >= 0 ? '+' : '') + fmt(topDriver.downside) + '). ';
                if (sensitivity.items.length > 1) {
                    narHtml += sensitivity.items[1].label + ' follows with ' + fmt(sensitivity.items[1].totalSwing) + ' swing. ';
                }
                narHtml += 'To reduce projection uncertainty, focus on securing favorable ' + topDriver.label.toLowerCase() + ' terms and locking in long-term contracts.</div>';
                monteNar.innerHTML = narHtml;
            }
        }

        // === MODE TOGGLE ===
        window.hvacSetMode = function(mode) {
            var freeBtn = document.querySelector('.hvac-btn-free');
            var proBtn = document.querySelector('.hvac-btn-pro');
            var container = document.getElementById('hvacProContainer');

            if (mode === 'pro') {
                if (!isAuthenticated) {
                    hvacShowLogin();
                    return;
                }
                proMode = true;
                if (freeBtn) { freeBtn.classList.remove('active'); }
                if (proBtn) { proBtn.classList.add('active'); }
                if (container) { container.classList.add('visible'); }
                updateHvacProPanels();
            } else {
                proMode = false;
                if (freeBtn) { freeBtn.classList.add('active'); }
                if (proBtn) { proBtn.classList.remove('active'); }
                if (container) { container.classList.remove('visible'); }
            }
        };

        // === PANEL LOCK/UNLOCK ===
        function unlockPanels() {
            document.querySelectorAll('.hvac-pro-panel.gated').forEach(function(p) {
                p.classList.remove('gated');
                var overlay = p.querySelector('.hvac-gate-overlay');
                if (overlay) overlay.style.display = 'none';
            });
        }
        function lockPanels() {
            document.querySelectorAll('.hvac-pro-panel').forEach(function(p) {
                p.classList.add('gated');
                var overlay = p.querySelector('.hvac-gate-overlay');
                if (overlay) overlay.style.display = '';
            });
        }

        // === AUTH ===
        function checkAuth() {
            try {
                var sess = JSON.parse(localStorage.getItem('rz_premium_session'));
                if (sess && sess.tier === 'pro' && new Date(sess.expires) > new Date()) {
                    isAuthenticated = true;
                    unlockPanels();
                    return true;
                }
            } catch(e) {}
            isAuthenticated = false;
            return false;
        }

        window.hvacShowLogin = function() {
            document.getElementById('hvacLoginOverlay').classList.add('visible');
        };
        window.hvacHideLogin = function() {
            document.getElementById('hvacLoginOverlay').classList.remove('visible');
            document.getElementById('hvacLoginError').style.display = 'none';
        };
        window.hvacDoLogin = function() {
            var email = document.getElementById('hvacLoginEmail').value.trim();
            var pass = document.getElementById('hvacLoginPass').value;
            if (email === 'demo@resistancezero.com' && pass === 'demo2026') {
                var session = { email: email, tier: 'pro', expires: new Date(Date.now() + 30*24*60*60*1000).toISOString() };
                localStorage.setItem('rz_premium_session', JSON.stringify(session));
                isAuthenticated = true;
                unlockPanels();
                hvacHideLogin();
                hvacSetMode('pro');
                window.dispatchEvent(new CustomEvent('rz-auth-change', { detail: session }));
            } else {
                document.getElementById('hvacLoginError').style.display = 'block';
            }
        };

        // === RESET ===
        window.hvacReset = function() {
            var loadSlider = document.getElementById('loadSlider');
            var rateSlider = document.getElementById('rateSlider');
            var regionSelect = document.getElementById('hvacRegionSelect');
            if (loadSlider) { loadSlider.value = 10; }
            if (rateSlider) { rateSlider.value = 10; }
            if (regionSelect) { regionSelect.value = 'virginia'; }
            // Trigger refresh
            if (loadSlider) loadSlider.dispatchEvent(new Event('input'));
            if (proMode) updateHvacProPanels();
        };

        // === PDF EXPORT ===
        window.hvacExportPDF = function() {
            var w = window.open('', '_blank');
            if (!w) { alert('Please allow pop-ups for this site to export PDF.'); return; }
            w.document.write('<p style="font-family:sans-serif;text-align:center;margin-top:40vh;">Generating report...</p>');
            var loadSlider = document.getElementById('loadSlider');
            var rateSlider = document.getElementById('rateSlider');
            var regionSelect = document.getElementById('hvacRegionSelect');
            var inputs = {
                load: parseInt(loadSlider.value),
                rate: parseInt(rateSlider.value) / 100,
                region: regionSelect.value
            };
            var region = HVAC_REGIONS[inputs.region];
            var tco = hvacCalcTCO(inputs);
            var mc = proMode ? runHvacMonteCarlo(inputs) : null;
            var sensitivity = proMode ? runHvacSensitivity(inputs) : null;
            var narrativeParagraphs = generateHvacNarrative(inputs, inputs.region, mc, sensitivity);
            var today = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });

            // SVG chart generators for PDF
            function waterfallSVG(tco) {
                var W = 600, H = 300, pad = 60;
                var items = [
                    { label: 'Trad Capex', value: tco.traditional.capex, color: '#ef4444' },
                    { label: 'Trad Opex', value: tco.traditional.npv10yr - tco.traditional.capex, color: '#f87171' },
                    { label: 'Hybrid Capex', value: tco.hybrid.capex, color: '#f59e0b' },
                    { label: 'Hybrid Opex', value: tco.hybrid.npv10yr - tco.hybrid.capex, color: '#fbbf24' },
                    { label: 'DLC Capex', value: tco.dlc.capex, color: '#22c55e' },
                    { label: 'DLC Opex', value: tco.dlc.npv10yr - tco.dlc.capex, color: '#4ade80' }
                ];
                var maxVal = 0;
                items.forEach(function(it) { if (it.value > maxVal) maxVal = it.value; });
                maxVal *= 1.15;
                var chartW = W - pad * 2, chartH = H - 100;
                var barW = chartW / items.length;
                var svg = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ' + W + ' ' + H + '" style="width:100%;max-width:600px;">';
                svg += '<text x="' + W/2 + '" y="20" font-size="13" fill="#1e3a5f" text-anchor="middle" font-weight="bold" font-family="Inter,sans-serif">10-Year TCO Waterfall (NPV @ 8%)</text>';
                items.forEach(function(item, i) {
                    var x = pad + i * barW + 4;
                    var barH = (item.value / maxVal) * chartH;
                    var y = 40 + chartH - barH;
                    svg += '<rect x="' + x + '" y="' + y + '" width="' + (barW - 8) + '" height="' + barH + '" fill="' + item.color + '" rx="3"/>';
                    svg += '<text x="' + (x + (barW-8)/2) + '" y="' + (y - 4) + '" font-size="9" fill="#1f2937" text-anchor="middle" font-family="Inter,sans-serif">' + fmt(item.value) + '</text>';
                    svg += '<text x="' + (x + (barW-8)/2) + '" y="' + (H - 20) + '" font-size="8" fill="#64748b" text-anchor="middle" font-family="Inter,sans-serif" transform="rotate(-20,' + (x+(barW-8)/2) + ',' + (H-20) + ')">' + item.label + '</text>';
                });
                svg += '</svg>';
                return svg;
            }

            function histogramSVG(mc) {
                if (!mc) return '';
                var W = 600, H = 250, pad = 50;
                var numBins = 30;
                var range = mc.max - mc.min;
                var binWidth = range / numBins;
                var bins = new Array(numBins).fill(0);
                mc.results.forEach(function(v) {
                    var idx = Math.min(Math.floor((v - mc.min) / binWidth), numBins - 1);
                    bins[idx]++;
                });
                var maxBin = Math.max.apply(null, bins);
                var chartW = W - pad * 2, chartH = H - 80;
                var barW = chartW / numBins;

                var svg = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ' + W + ' ' + H + '" style="width:100%;max-width:600px;">';
                svg += '<text x="' + W/2 + '" y="20" font-size="13" fill="#1e3a5f" text-anchor="middle" font-weight="bold" font-family="Inter,sans-serif">Monte Carlo Distribution (10K iterations)</text>';
                bins.forEach(function(count, i) {
                    var x = pad + i * barW;
                    var barH = (count / maxBin) * chartH;
                    var y = 40 + chartH - barH;
                    svg += '<rect x="' + x + '" y="' + y + '" width="' + (barW - 1) + '" height="' + barH + '" fill="#3b82f6" opacity="0.6"/>';
                });
                function addLine(val, label, color) {
                    var x = pad + ((val - mc.min) / range) * chartW;
                    svg += '<line x1="' + x + '" y1="35" x2="' + x + '" y2="' + (40 + chartH) + '" stroke="' + color + '" stroke-width="2" stroke-dasharray="4,4"/>';
                    svg += '<text x="' + x + '" y="' + (H - 10) + '" font-size="9" fill="' + color + '" text-anchor="middle" font-family="Inter,sans-serif">' + label + ': ' + fmt(val) + '</text>';
                }
                addLine(mc.p1, 'P1', '#991b1b');
                addLine(mc.p5, 'P5', '#dc2626');
                addLine(mc.p50, 'P50', '#d97706');
                addLine(mc.p95, 'P95', '#16a34a');
                svg += '</svg>';
                return svg;
            }

            function tornadoSVG(sensitivity) {
                if (!sensitivity) return '';
                var W = 600, H = 40 + sensitivity.items.length * 40;
                var pad = { left: 130, right: 70, top: 30 };
                var chartW = W - pad.left - pad.right;
                var maxHalf = 0;
                sensitivity.items.forEach(function(item) {
                    var absUp = Math.abs(item.upside);
                    var absDn = Math.abs(item.downside);
                    if (absUp > maxHalf) maxHalf = absUp;
                    if (absDn > maxHalf) maxHalf = absDn;
                });
                var svg = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ' + W + ' ' + H + '" style="width:100%;max-width:600px;">';
                svg += '<text x="' + W/2 + '" y="18" font-size="13" fill="#1e3a5f" text-anchor="middle" font-weight="bold" font-family="Inter,sans-serif">Sensitivity Tornado (Baseline: ' + fmt(sensitivity.baseSavings) + '/yr)</text>';
                var midX = pad.left + chartW / 2;
                svg += '<line x1="' + midX + '" y1="' + pad.top + '" x2="' + midX + '" y2="' + (H - 5) + '" stroke="#94a3b8" stroke-width="1" stroke-dasharray="3,3"/>';
                sensitivity.items.forEach(function(item, i) {
                    var y = pad.top + i * 40 + 8;
                    var barH = 22;
                    svg += '<text x="' + (pad.left - 8) + '" y="' + (y + barH / 2 + 4) + '" font-size="10" fill="#374151" text-anchor="end" font-family="Inter,sans-serif">' + item.label + '</text>';
                    // Downside bar (left of baseline)
                    var dnW = maxHalf > 0 ? (Math.abs(item.downside) / maxHalf) * (chartW / 2) : 0;
                    var dnColor = item.downside >= 0 ? '#16a34a' : '#dc2626';
                    svg += '<rect x="' + (midX - dnW) + '" y="' + y + '" width="' + dnW + '" height="' + barH + '" fill="' + dnColor + '" opacity="0.7" rx="2"/>';
                    svg += '<text x="' + (midX - dnW - 4) + '" y="' + (y + barH / 2 + 4) + '" font-size="9" fill="' + dnColor + '" text-anchor="end" font-family="Inter,sans-serif">' + fmt(item.downside) + '</text>';
                    // Upside bar (right of baseline)
                    var upW = maxHalf > 0 ? (Math.abs(item.upside) / maxHalf) * (chartW / 2) : 0;
                    var upColor = item.upside >= 0 ? '#16a34a' : '#dc2626';
                    svg += '<rect x="' + midX + '" y="' + y + '" width="' + upW + '" height="' + barH + '" fill="' + upColor + '" opacity="0.7" rx="2"/>';
                    svg += '<text x="' + (midX + upW + 4) + '" y="' + (y + barH / 2 + 4) + '" font-size="9" fill="' + upColor + '" text-anchor="start" font-family="Inter,sans-serif">+' + fmt(item.upside) + '</text>';
                });
                svg += '</svg>';
                return svg;
            }

            var html = '<!DOCTYPE html><html><head><meta charset="UTF-8"><title>HVAC Cooling Architecture Report</title>' +
            '<style>' +
                '@page { size: A4; margin: 20mm; }' +
                'body { font-family: "Segoe UI", Arial, sans-serif; color: #1f2937; line-height: 1.6; max-width: 800px; margin: 0 auto; padding: 20px; }' +
                'h1 { color: #1e3a5f; font-size: 22px; border-bottom: 3px solid #3b82f6; padding-bottom: 8px; }' +
                'h2 { color: #1e3a5f; font-size: 16px; margin-top: 24px; border-bottom: 2px solid #e2e8f0; padding-bottom: 4px; }' +
                'h3 { color: #374151; font-size: 14px; }' +
                '.header-meta { display: flex; justify-content: space-between; color: #6b7280; font-size: 11px; margin-bottom: 20px; }' +
                '.score-hero { text-align: center; padding: 20px; background: linear-gradient(135deg, #eff6ff, #dbeafe); border-radius: 12px; margin: 16px 0; }' +
                '.score-hero .score { font-size: 36px; font-weight: 800; color: #3b82f6; }' +
                '.score-hero .label { color: #6b7280; font-size: 13px; }' +
                'table { width: 100%; border-collapse: collapse; margin: 12px 0; font-size: 12px; }' +
                'th { background: #f8fafc; color: #1e3a5f; padding: 8px 12px; text-align: left; border-bottom: 2px solid #e2e8f0; }' +
                'td { padding: 8px 12px; border-bottom: 1px solid #f1f5f9; color: #1f2937; }' +
                'tr:nth-child(even) td { background: #fafbfc; }' +
                '.narrative { background: #eff6ff; border-left: 4px solid #3b82f6; padding: 14px 16px; margin: 16px 0; border-radius: 0 8px 8px 0; font-size: 13px; color: #374151; line-height: 1.7; }' +
                '.narrative p { margin: 0 0 10px 0; } .narrative p:last-child { margin-bottom: 0; }' +
                '.kpi-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin: 12px 0; }' +
                '.kpi-grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin: 12px 0; }' +
                '.kpi-card { text-align: center; padding: 10px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0; }' +
                '.kpi-value { font-size: 16px; font-weight: 800; color: #3b82f6; }' +
                '.kpi-label { font-size: 10px; color: #6b7280; margin-top: 2px; }' +
                '.kpi-sub { font-size: 9px; color: #9ca3af; margin-top: 1px; }' +
                '.footer { margin-top: 30px; padding-top: 16px; border-top: 1px solid #e2e8f0; font-size: 10px; color: #9ca3af; text-align: center; }' +
                '.badge-good { color: #16a34a; } .badge-warn { color: #d97706; } .badge-bad { color: #dc2626; }' +
                '.section-note { font-size: 11px; color: #6b7280; font-style: italic; margin: 4px 0 8px; }' +
            '</style></head><body>';

            html += '<h1>HVAC Cooling Architecture Analysis</h1>';
            html += '<div class="header-meta"><span>Generated: ' + today + '</span><span>Region: ' + region.label + '</span><span>Facility: ' + inputs.load + ' MW @ $' + inputs.rate.toFixed(2) + '/kWh</span></div>';

            // Summary hero
            html += '<div class="score-hero">';
            html += '<div class="score">' + fmt(tco.savingsDLC10yr) + '</div>';
            html += '<div class="label">10-Year NPV Savings (DLC vs Traditional)</div>';
            html += '<div style="margin-top:8px;font-size:12px;color:#6b7280;">Payback: ' + tco.paybackDLC.toFixed(1) + ' years | IRR: ' + (tco.irrDLC * 100).toFixed(1) + '% | CO2 Offset: ' + Math.round(tco.carbonOffsetDLC).toLocaleString() + ' tons/yr</div>';
            html += '</div>';

            // TCO Table
            html += '<h2>10-Year Total Cost of Ownership</h2>';
            html += '<table><tr><th>Architecture</th><th>CAPEX</th><th>Annual Energy</th><th>Annual Maint.</th><th>10-Year NPV</th><th>PUE</th></tr>';
            ['traditional', 'hybrid', 'dlc'].forEach(function(arch) {
                var r = tco[arch];
                var label = arch === 'traditional' ? 'Traditional Chiller' : arch === 'hybrid' ? 'Hybrid DLC' : 'Warm-Water DLC';
                html += '<tr><td><strong>' + label + '</strong></td><td>' + fmt(r.capex) + '</td><td>' + fmt(r.annualEnergy) + '</td><td>' + fmt(r.annualMaint) + '</td><td>' + fmt(r.npv10yr) + '</td><td>' + r.pue.toFixed(2) + '</td></tr>';
            });
            html += '</table>';

            // Energy & Environmental
            html += '<h3>Energy & Environmental Impact</h3>';
            html += '<div class="kpi-grid-4">';
            html += '<div class="kpi-card"><div class="kpi-value">' + fmt(tco.annualEnergySavingsDLC) + '</div><div class="kpi-label">Annual Energy Savings <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">DLC Annual Energy Savings</div><div class="td">Yearly electricity savings from DLC vs traditional air cooling, primarily from reduced fan power and improved heat transfer.</div></span></span></div><div class="kpi-sub">' + Math.round(tco.energySavingsDLC_kWh).toLocaleString() + ' kWh/yr</div></div>';
            html += '<div class="kpi-card"><div class="kpi-value badge-good">' + Math.round(tco.carbonOffsetDLC).toLocaleString() + '</div><div class="kpi-label">CO2 Offset (tons/yr) <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">CO2 Emissions Avoided</div><div class="td">Annual carbon dioxide reduction from DLC energy savings, based on regional grid carbon intensity.</div></span></span></div></div>';
            html += '<div class="kpi-card"><div class="kpi-value">' + (tco.waterSavingsDLC / 1e6).toFixed(1) + 'M</div><div class="kpi-label">Water Savings (gal/yr) <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Water Savings</div><div class="td">Annual water consumption reduction — DLC eliminates evaporative cooling tower water use.</div><span class="tf">Traditional: 1.8L/kWh &middot; DLC: near zero</span></span></span></div></div>';
            html += '<div class="kpi-card"><div class="kpi-value">$' + tco.lifecycleCostPerKW_dlc.toFixed(0) + '</div><div class="kpi-label">DLC Lifecycle $/kW <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">DLC Lifecycle Cost/kW</div><div class="td">Total lifecycle cost per kW for direct liquid cooling. Higher initial but lower operating.</div></span></span></div><div class="kpi-sub">vs $' + tco.lifecycleCostPerKW_trad.toFixed(0) + ' traditional</div></div>';
            html += '</div>';

            html += waterfallSVG(tco);

            // Regional Risk
            html += '<h2>Regional Risk Assessment</h2>';
            html += '<table><tr><th>Region</th><th>Temp</th><th>RH</th><th>Free Hrs</th><th>Risk</th><th>PUE</th><th>TRL</th><th>Supply</th></tr>';
            Object.keys(HVAC_REGIONS).forEach(function(key) {
                var r = HVAC_REGIONS[key];
                var isSelected = key === inputs.region;
                html += '<tr' + (isSelected ? ' style="background:#eff6ff;font-weight:600;"' : '') + '>';
                html += '<td>' + r.label + (isSelected ? ' *' : '') + '</td><td>' + r.temp + '\u00B0C</td><td>' + r.humidity + '%</td><td>' + r.freeHours.toLocaleString() + '</td>';
                html += '<td class="' + (r.riskScore >= 6 ? 'badge-bad' : r.riskScore >= 3 ? 'badge-warn' : 'badge-good') + '">' + r.riskScore.toFixed(1) + '</td>';
                html += '<td>' + r.pueDLC.toFixed(2) + '</td><td>TRL ' + r.trl + '</td><td>' + r.supplyChain.toFixed(1) + '</td></tr>';
            });
            html += '</table>';

            // Transition Planning
            html += '<h2>Transition Planning</h2>';
            var phase1 = tco.dlc.capex * 0.4;
            var phase2 = tco.dlc.capex * 0.35;
            var phase3 = tco.dlc.capex * 0.25;
            var training = tco.retrainingCost;
            html += '<table><tr><th>Phase</th><th>Timeline</th><th>Investment</th><th>Focus</th></tr>';
            html += '<tr><td>Phase 1</td><td>Year 0-1</td><td>' + fmt(phase1) + '</td><td>CDU infrastructure, piping, controls</td></tr>';
            html += '<tr><td>Phase 2</td><td>Year 2-3</td><td>' + fmt(phase2) + '</td><td>High-density rack DLC expansion</td></tr>';
            html += '<tr><td>Phase 3</td><td>Year 4-5</td><td>' + fmt(phase3) + '</td><td>Full migration, legacy decommission</td></tr>';
            html += '<tr><td>Training</td><td>Ongoing</td><td>' + fmt(training) + '</td><td>Liquid cooling certification, procedures</td></tr>';
            html += '</table>';

            html += '<h3>Operational Impact</h3>';
            html += '<div class="kpi-grid-4">';
            html += '<div class="kpi-card"><div class="kpi-value">' + tco.downtimeHoursPhased + ' hrs</div><div class="kpi-label">Downtime (Phased) <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Phased Deployment Downtime</div><div class="td">Estimated downtime for hall-by-hall DLC rollout, minimizing disruption.</div></span></span></div></div>';
            html += '<div class="kpi-card"><div class="kpi-value badge-warn">' + tco.downtimeHoursFull + ' hrs</div><div class="kpi-label">Downtime (Full Cutover) <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Full Cutover Downtime</div><div class="td">Estimated downtime for complete one-time DLC migration. Higher risk but faster.</div></span></span></div></div>';
            html += '<div class="kpi-card"><div class="kpi-value">' + fmt(tco.phasedDeploymentCost) + '</div><div class="kpi-label">Phased Cost (+12%) <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Phased Deployment Cost</div><div class="td">Cost of phased DLC rollout — higher due to repeated mobilization but lower risk.</div></span></span></div></div>';
            html += '<div class="kpi-card"><div class="kpi-value">' + fmt(tco.fullDeploymentCost) + '</div><div class="kpi-label">Full Deploy Cost <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Full Deployment Cost</div><div class="td">Cost of one-time full DLC deployment — lower total but higher risk and downtime.</div></span></span></div></div>';
            html += '</div>';

            if (proMode && mc) {
                // Monte Carlo
                html += '<h2>Monte Carlo Simulation (10,000 iterations)</h2>';
                html += '<div class="kpi-grid">';
                html += '<div class="kpi-card"><div class="kpi-value">' + fmt(mc.mean) + '</div><div class="kpi-label">Mean Annual Savings <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Mean Annual Savings</div><div class="td">Average annual savings from Monte Carlo simulation across all scenarios (typically 10,000 runs).</div></span></span></div></div>';
                html += '<div class="kpi-card"><div class="kpi-value badge-bad">' + fmt(mc.p5) + '</div><div class="kpi-label">P5 (Conservative) <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">P5 — Conservative Estimate</div><div class="td">5th percentile savings — 95% of simulated scenarios produce savings above this value.</div><span class="tf">Low-end estimate for conservative financial planning</span></span></span></div></div>';
                html += '<div class="kpi-card"><div class="kpi-value badge-good">' + fmt(mc.p95) + '</div><div class="kpi-label">P95 (Optimistic) <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">P95 — Optimistic Estimate</div><div class="td">95th percentile — only 5% of scenarios produce savings this high or above.</div></span></span></div></div>';
                html += '</div>';

                html += '<h3>Tail Risk & Break-Even</h3>';
                html += '<div class="kpi-grid-4">';
                html += '<div class="kpi-card"><div class="kpi-value badge-bad">' + fmt(mc.p1) + '</div><div class="kpi-label">P1 (Worst-Case) <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">P1 — Worst Case</div><div class="td">The worst 1% of simulated scenarios. Your downside risk floor.</div></span></span></div></div>';
                html += '<div class="kpi-card"><div class="kpi-value">' + fmt(mc.cvar95) + '</div><div class="kpi-label">CVaR at 95% <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Conditional Value at Risk (95%)</div><div class="td">Average loss in the worst 5% of scenarios. Key metric for risk-adjusted investment decisions.</div></span></span></div><div class="kpi-sub">Expected shortfall</div></div>';
                html += '<div class="kpi-card"><div class="kpi-value">' + (mc.probNegativeROI * 100).toFixed(2) + '%</div><div class="kpi-label">Prob. Negative Savings <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Prob. Negative Savings</div><div class="td">Percentage of runs where DLC costs MORE than traditional cooling.</div><span class="tf">Good: &lt;5% &middot; Acceptable: &lt;15%</span></span></span></div></div>';
                html += '<div class="kpi-card"><div class="kpi-value badge-good">' + (mc.probBreakEven * 100).toFixed(1) + '%</div><div class="kpi-label">Break-Even Probability <span class="kpi-tooltip">?<span class="kpi-tip"><div class="tt">Break-Even Probability</div><div class="td">Percentage of scenarios where DLC achieves positive NPV within the analysis period.</div><span class="tf">Target: >90% for investment approval</span></span></span></div></div>';
                html += '</div>';

                html += histogramSVG(mc);

                // Sensitivity Tornado
                html += '<h2>Sensitivity Analysis</h2>';
                html += '<table><tr><th>Variable</th><th>Downside</th><th>Upside</th><th>Total Swing</th><th>Weight</th></tr>';
                sensitivity.items.forEach(function(s) {
                    html += '<tr><td>' + s.label + '</td><td class="badge-bad">' + fmt(s.downside) + '</td><td class="badge-good">+' + fmt(s.upside) + '</td><td>' + fmt(s.totalSwing) + '</td><td>' + (s.pct * 100).toFixed(0) + '%</td></tr>';
                });
                html += '</table>';
                html += tornadoSVG(sensitivity);
            }

            // Narrative (multi-paragraph)
            html += '<h2>Comprehensive Analysis</h2>';
            html += '<div class="narrative">';
            narrativeParagraphs.forEach(function(p) {
                html += '<p>' + p + '</p>';
            });
            html += '</div>';

            html += '<div class="footer">';
            html += '<p>HVAC Cooling Architecture Report | ResistanceZero.com | ' + today + '</p>';
            html += '<p>Model: HVAC-TCO-v2.0 | Discount Rate: 8% | Monte Carlo: 10K iterations | Sources: ASHRAE TC 9.9, Uptime Institute 2024, Nvidia Rubin Thermal Specs, DCD 2025</p>';
            html += '<p style="font-style:italic;">Generated client-side — no data transmitted to any server</p>';
            html += '</div>';

        html+='</body></html>';

            w.document.open();
            w.document.write(html);
            w.document.close();
            setTimeout(function() { w.print(); }, 600);
        };

        // === TOOLTIP POSITIONING ===
        function initTooltips() {
            document.querySelectorAll('.tooltip-trigger').forEach(function(trigger) {
                var content = trigger.querySelector('.tooltip-content');
                if (!content) return;

                trigger.addEventListener('mouseenter', function(e) {
                    var rect = trigger.getBoundingClientRect();
                    content.style.top = (rect.bottom + 8) + 'px';
                    content.style.left = Math.max(10, Math.min(rect.left - 120, window.innerWidth - 280)) + 'px';
                    content.classList.add('visible');
                });
                trigger.addEventListener('mouseleave', function() {
                    content.classList.remove('visible');
                });
                trigger.addEventListener('click', function(e) {
                    e.stopPropagation();
                    content.classList.toggle('visible');
                });
            });

            document.addEventListener('click', function() {
                document.querySelectorAll('.tooltip-content.visible').forEach(function(tc) {
                    tc.classList.remove('visible');
                });
            });
        }

        // === HOOK EVENTS ===
        function init() {
            checkAuth();
            initTooltips();

            var loadSlider = document.getElementById('loadSlider');
            var rateSlider = document.getElementById('rateSlider');
            var regionSelect = document.getElementById('hvacRegionSelect');

            if (loadSlider) {
                loadSlider.addEventListener('input', function() {
                    if (proMode) updateHvacProPanels();
                });
            }
            if (rateSlider) {
                rateSlider.addEventListener('input', function() {
                    if (proMode) updateHvacProPanels();
                });
            }
            if (regionSelect) {
                regionSelect.addEventListener('change', function() {
                    if (proMode) updateHvacProPanels();
                });
            }

            // Listen for auth changes from other tabs/articles
            window.addEventListener('rz-auth-change', function() {
                checkAuth();
                if (isAuthenticated && proMode) updateHvacProPanels();
            });
            window.addEventListener('storage', function(e) {
                if (e.key === 'rz_premium_session') {
                    checkAuth();
                    if (isAuthenticated && proMode) updateHvacProPanels();
                }
            });

            // Resize handler for pro charts
            window.addEventListener('resize', function() {
                if (proMode) updateHvacProPanels();
            });
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    })();
    </script>

<!-- ═══ Feature 22: Reading Progress Bar ═══ -->
<script>
(function() {
    var bar = document.getElementById('scrollProgress');
    if (!bar) return;
    var ticking = false;
    function updateProgress() {
        var scrollTop = window.scrollY || document.documentElement.scrollTop;
        var docHeight = document.documentElement.scrollHeight - window.innerHeight;
        var pct = docHeight > 0 ? (scrollTop / docHeight) * 100 : 0;
        bar.style.width = Math.min(pct, 100) + '%';
        ticking = false;
    }
    window.addEventListener('scroll', function() {
        if (!ticking) { requestAnimationFrame(updateProgress); ticking = true; }
    }, { passive: true });
    updateProgress();
})();
</script>

<!-- ═══ Feature 23: TOC Sidebar ═══ -->
<script>
(function() {
    // Find H2s with IDs first, then fallback to auto-generating IDs
    var sections = document.querySelectorAll('.article-body h2[id], .article-content h2[id]');
    if (!sections.length) {
        var allH2s = document.querySelectorAll('.article-body h2, .article-content h2');
        allH2s.forEach(function(h2, i) {
            if (!h2.id) h2.id = 'toc-section-' + (i + 1);
        });
        sections = document.querySelectorAll('.article-body h2[id], .article-content h2[id]');
    }
    if (!sections.length) return;

    var sidebarList = document.getElementById('tocSidebarList');
    var mobileList = document.getElementById('tocMobileList');
    var sidebar = document.getElementById('tocSidebar');
    var tocToggle = document.getElementById('tocMobileToggle');
    var tocDrawer = document.getElementById('tocMobileDrawer');
    var tocBackdrop = document.getElementById('tocMobileBackdrop');
    var tocClose = document.getElementById('tocDrawerClose');

    var tocData = [];
    sections.forEach(function(h2, i) {
        var id = h2.getAttribute('id');
        var numMatch = id.match(/\d+/);
        var num = numMatch ? numMatch[0] : String(i + 1);
        var text = h2.textContent.replace(/^\s*\d+[\.\s]*/, '').trim();
        tocData.push({ id: id, num: num, text: text });
    });

    function buildList(container, isMobile) {
        tocData.forEach(function(item) {
            var li = document.createElement('li');
            if (!isMobile) li.className = 'toc-sidebar-item';
            var a = document.createElement('a');
            a.href = '#' + item.id;
            a.setAttribute('data-section', item.id);
            if (isMobile) {
                a.textContent = item.num + '. ' + item.text;
            } else {
                a.className = 'toc-sidebar-link';
                a.innerHTML = '<span class="toc-sidebar-num">' + item.num + '</span>' + item.text;
            }
            a.addEventListener('click', function(e) {
                e.preventDefault();
                var target = document.getElementById(item.id);
                if (target) window.scrollTo({ top: target.offsetTop - 80, behavior: 'smooth' });
                if (isMobile) closeMobileDrawer();
            });
            li.appendChild(a);
            container.appendChild(li);
        });
    }

    buildList(sidebarList, false);
    buildList(mobileList, true);

    var currentSection = null;
    var observer = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry) {
            if (entry.isIntersecting) {
                currentSection = entry.target.getAttribute('id');
                highlightActive(currentSection);
            }
        });
    }, { rootMargin: '-80px 0px -70% 0px', threshold: 0 });

    sections.forEach(function(s) { observer.observe(s); });

    function highlightActive(sectionId) {
        sidebarList.querySelectorAll('.toc-sidebar-link').forEach(function(a) {
            a.classList.toggle('active', a.getAttribute('data-section') === sectionId);
        });
        mobileList.querySelectorAll('a').forEach(function(a) {
            a.classList.toggle('active', a.getAttribute('data-section') === sectionId);
        });
    }

    var articleContent = document.querySelector('.article-content');
    if (articleContent && sidebar) {
        var sidebarObserver = new IntersectionObserver(function(entries) {
            entries.forEach(function(entry) {
                sidebar.classList.toggle('visible', entry.isIntersecting);
            });
        }, { rootMargin: '0px', threshold: 0.01 });
        sidebarObserver.observe(articleContent);
    }

    function openMobileDrawer() {
        tocDrawer.classList.add('active');
        tocBackdrop.classList.add('active');
        document.body.style.overflow = 'hidden';
    }
    function closeMobileDrawer() {
        tocDrawer.classList.remove('active');
        tocBackdrop.classList.remove('active');
        document.body.style.overflow = '';
    }

    if (tocToggle) tocToggle.addEventListener('click', openMobileDrawer);
    if (tocClose) tocClose.addEventListener('click', closeMobileDrawer);
    if (tocBackdrop) tocBackdrop.addEventListener('click', closeMobileDrawer);
})();
</script>

<!-- ═══ Feature 21: Global Search ═══ -->
<script>
(function() {
    var searchBtn = document.getElementById('navSearchBtn');
    var overlay = document.getElementById('searchOverlay');
    var modal = document.getElementById('searchModal');
    var input = document.getElementById('searchInput');
    var resultsEl = document.getElementById('searchResults');
    var previewEl = document.getElementById('searchPreview');
    var chipsEl = document.getElementById('searchChips');
    var fuse = null;
    var searchData = null;
    var focusedIdx = -1;
    var activeFilter = 'all';
    var lastResults = [];
    var RECENT_KEY = 'rz-search-recent';

    function getRecent() {
        try { return JSON.parse(localStorage.getItem(RECENT_KEY)) || []; }
        catch(e) { return []; }
    }
    function saveRecent(query) {
        if (!query || query.length < 2) return;
        var arr = getRecent().filter(function(q) { return q !== query; });
        arr.unshift(query);
        if (arr.length > 3) arr = arr.slice(0, 3);
        try { localStorage.setItem(RECENT_KEY, JSON.stringify(arr)); } catch(e) {}
    }
    function clearRecent() {
        try { localStorage.removeItem(RECENT_KEY); } catch(e) {}
    }

    function renderRecent() {
        var recent = getRecent();
        if (!recent.length) {
            resultsEl.innerHTML = '<div class="search-empty">Type to search across all content</div>';
            return;
        }
        var html = '<div class="search-recent"><div class="search-recent-header">'
            + '<span class="search-recent-label">Recent</span>'
            + '<button class="search-recent-clear" id="clearRecent">Clear</button></div>';
        recent.forEach(function(q) {
            html += '<div class="search-recent-item" data-query="' + q.replace(/"/g, '&quot;') + '">'
                + '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>'
                + '<span>' + q + '</span></div>';
        });
        html += '</div>';
        resultsEl.innerHTML = html;
        var clearBtn = document.getElementById('clearRecent');
        if (clearBtn) clearBtn.addEventListener('click', function() { clearRecent(); renderRecent(); });
        resultsEl.querySelectorAll('.search-recent-item').forEach(function(el) {
            el.addEventListener('click', function() {
                input.value = el.getAttribute('data-query');
                input.dispatchEvent(new Event('input'));
            });
        });
    }

    function openSearch() {
        overlay.classList.add('active');
        modal.classList.add('active');
        input.value = '';
        input.focus();
        focusedIdx = -1;
        activeFilter = 'all';
        lastResults = [];
        updateChips();
        hidePreview();
        renderRecent();
        if (!searchData) {
            fetch('search-index.json')
                .then(function(r) { return r.json(); })
                .then(function(data) {
                    searchData = data;
                    fuse = new Fuse(data, {
                        keys: [
                            { name: 'title', weight: 0.4 },
                            { name: 'description', weight: 0.25 },
                            { name: 'keywords', weight: 0.25 },
                            { name: 'category', weight: 0.1 }
                        ],
                        threshold: 0.35,
                        includeScore: true,
                        includeMatches: true,
                        minMatchCharLength: 2
                    });
                })
                .catch(function() {});
        }
    }

    function closeSearch() {
        overlay.classList.remove('active');
        modal.classList.remove('active');
        input.blur();
        hidePreview();
    }

    function getIconClass(cat) {
        cat = (cat || '').toLowerCase();
        if (cat === 'calculator') return 'calc';
        if (cat === 'tool') return 'tool';
        if (cat === 'policy') return 'policy';
        if (cat === 'sustainability') return 'sustainability';
        if (cat === 'geopolitics') return 'geopolitics';
        if (cat === 'analysis') return 'analysis';
        if (cat === 'leadership') return 'leadership';
        if (cat === 'business') return 'business';
        return '';
    }

    function getIconLabel(item) {
        if (item.url && item.url.indexOf('article-') === 0) {
            return item.url.replace('article-', '').replace('.html', '').padStart(2, '0');
        }
        var cat = (item.category || '').toLowerCase();
        if (cat === 'calculator') return '&#9889;';
        if (cat === 'tool') return '&#9881;';
        if (cat === 'geopolitics') return '&#9733;';
        return '&#9733;';
    }

    function getCatFilter(cat) {
        cat = (cat || '').toLowerCase();
        if (cat === 'calculator') return 'calculators';
        if (cat === 'tool') return 'tools';
        return 'articles';
    }

    function highlightText(text, matches, key) {
        if (!matches || !matches.length) return text;
        var found = null;
        for (var i = 0; i < matches.length; i++) {
            if (matches[i].key === key) { found = matches[i]; break; }
        }
        if (!found || !found.indices || !found.indices.length) return text;
        var indices = found.indices.sort(function(a, b) { return a[0] - b[0]; });
        var result = '';
        var last = 0;
        indices.forEach(function(pair) {
            var start = pair[0], end = pair[1];
            if (start > last) result += text.substring(last, start);
            result += '<mark class="search-highlight">' + text.substring(start, end + 1) + '</mark>';
            last = end + 1;
        });
        if (last < text.length) result += text.substring(last);
        return result;
    }

    function filterResults(results) {
        if (activeFilter === 'all') return results;
        return results.filter(function(r) {
            return getCatFilter(r.item.category) === activeFilter;
        });
    }

    function renderResults(results) {
        var filtered = filterResults(results);
        if (!filtered.length) {
            resultsEl.innerHTML = '<div class="search-empty">No results found</div>';
            focusedIdx = -1;
            hidePreview();
            return;
        }
        var html = '';
        filtered.slice(0, 8).forEach(function(r, i) {
            var item = r.item;
            var iconCls = getIconClass(item.category);
            var titleHtml = highlightText(item.title, r.matches, 'title');
            var descHtml = highlightText(item.description, r.matches, 'description');
            html += '<a href="' + item.url + '" class="search-result-item" data-idx="' + i + '">'
                + '<div class="search-result-icon ' + iconCls + '">' + getIconLabel(item) + '</div>'
                + '<div class="search-result-info">'
                + '<div class="search-result-category">' + (item.category || '') + '</div>'
                + '<div class="search-result-title">' + titleHtml + '</div>'
                + '<div class="search-result-desc">' + descHtml + '</div>'
                + '</div></a>';
        });
        resultsEl.innerHTML = html;
        focusedIdx = -1;
        attachHoverListeners(filtered);
    }

    function attachHoverListeners(filtered) {
        resultsEl.querySelectorAll('.search-result-item').forEach(function(el) {
            var idx = parseInt(el.getAttribute('data-idx'), 10);
            el.addEventListener('mouseenter', function() { showPreview(filtered[idx], el); });
            el.addEventListener('mouseleave', function() { hidePreview(); });
            el.addEventListener('click', function() { saveRecent(input.value.trim()); });
        });
    }

    function showPreview(r, anchorEl) {
        if (!previewEl || !r) return;
        var item = r.item;
        var imgHtml = item.image ? '<img class="search-preview-img" src="' + item.image + '" alt="">' : '';
        var timeHtml = item.readingTime ? '<div class="search-preview-badge"><svg viewBox="0 0 24 24" width="10" height="10" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>' + item.readingTime + ' min</div>' : '';
        previewEl.innerHTML = imgHtml
            + '<div class="search-preview-text">'
            + '<div class="search-preview-cat">' + (item.category || '') + '</div>'
            + '<div class="search-preview-title">' + item.title + '</div>'
            + '<div class="search-preview-desc">' + item.description + '</div>'
            + timeHtml
            + '</div>';
        // Position tooltip to the right of the modal
        var modalRect = modal.getBoundingClientRect();
        var itemRect = anchorEl.getBoundingClientRect();
        var tipLeft = modalRect.right + 10;
        var tipTop = itemRect.top;
        // If no space on right, show on left
        if (tipLeft + 270 > window.innerWidth) {
            tipLeft = modalRect.left - 270;
        }
        // Keep within viewport vertically
        if (tipTop + 100 > window.innerHeight) {
            tipTop = window.innerHeight - 110;
        }
        previewEl.style.left = tipLeft + 'px';
        previewEl.style.top = tipTop + 'px';
        previewEl.classList.add('visible');
    }

    function hidePreview() {
        if (!previewEl) return;
        previewEl.innerHTML = '';
        previewEl.classList.remove('visible');
    }

    function updateChips() {
        if (!chipsEl) return;
        chipsEl.querySelectorAll('.search-chip').forEach(function(chip) {
            chip.classList.toggle('active', chip.getAttribute('data-filter') === activeFilter);
        });
    }

    if (chipsEl) {
        chipsEl.addEventListener('click', function(e) {
            var chip = e.target.closest('.search-chip');
            if (!chip) return;
            activeFilter = chip.getAttribute('data-filter');
            updateChips();
            if (lastResults.length) renderResults(lastResults);
        });
    }

    function updateFocus() {
        var items = resultsEl.querySelectorAll('.search-result-item');
        items.forEach(function(el, i) {
            el.classList.toggle('focused', i === focusedIdx);
            if (i === focusedIdx) {
                el.scrollIntoView({ block: 'nearest' });
                var idx = parseInt(el.getAttribute('data-idx'), 10);
                var filtered = filterResults(lastResults);
                if (filtered[idx]) showPreview(filtered[idx], el);
            }
        });
    }

    if (searchBtn) searchBtn.addEventListener('click', openSearch);
    if (overlay) overlay.addEventListener('click', closeSearch);

    document.addEventListener('keydown', function(e) {
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
            e.preventDefault();
            if (modal.classList.contains('active')) closeSearch();
            else openSearch();
            return;
        }
        if (!modal.classList.contains('active')) return;
        if (e.key === 'Escape') { closeSearch(); return; }
        var items = resultsEl.querySelectorAll('.search-result-item');
        if (e.key === 'ArrowDown') {
            e.preventDefault();
            focusedIdx = Math.min(focusedIdx + 1, items.length - 1);
            updateFocus();
        } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            focusedIdx = Math.max(focusedIdx - 1, 0);
            updateFocus();
        } else if (e.key === 'Enter' && focusedIdx >= 0 && items[focusedIdx]) {
            e.preventDefault();
            saveRecent(input.value.trim());
            items[focusedIdx].click();
        }
    });

    if (input) {
        input.addEventListener('input', function() {
            var query = input.value.trim();
            if (query.length < 2 || !fuse) {
                lastResults = [];
                focusedIdx = -1;
                hidePreview();
                if (query.length === 0) { renderRecent(); }
                else { resultsEl.innerHTML = '<div class="search-empty">Type to search across all content</div>'; }
                return;
            }
            var results = fuse.search(query);
            lastResults = results;
            renderResults(results);
        });
    }
})();
</script>
<script src="auth.js"></script>
<script src="rz-tracker.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-banner hidden" id="cookieBanner">
    <p>We use cookies for analytics to improve your experience. <a href="privacy.html">Learn more</a></p>
    <div class="cookie-actions">
        <button class="cookie-accept" id="cookieAccept">Accept</button>
        <button class="cookie-decline" id="cookieDecline">Decline</button>
    </div>
</div>

<!-- Scroll to Top -->
<button class="scroll-top-btn" id="scrollTopBtn" aria-label="Scroll to top">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"/></svg>
</button>

<script>
(function(){
    // Cookie Banner
    var cb = document.getElementById('cookieBanner');
    var consent = localStorage.getItem('rz_cookie_consent');
    if (!consent && cb) {
        cb.classList.remove('hidden');
    }
    var acceptBtn = document.getElementById('cookieAccept');
    var declineBtn = document.getElementById('cookieDecline');
    if (acceptBtn) acceptBtn.addEventListener('click', function(){
        localStorage.setItem('rz_cookie_consent', 'accepted');
        cb.classList.add('hidden');
    });
    if (declineBtn) declineBtn.addEventListener('click', function(){
        localStorage.setItem('rz_cookie_consent', 'declined');
        cb.classList.add('hidden');
        // Disable GA
        window['ga-disable-G-GED7FX8RTV'] = true;
    });

    // Scroll to Top
    var sBtn = document.getElementById('scrollTopBtn');
    if (sBtn) {
        var ticking = false;
        window.addEventListener('scroll', function(){
            if (!ticking) {
                window.requestAnimationFrame(function(){
                    if (window.scrollY > 500) {
                        sBtn.classList.add('visible');
                    } else {
                        sBtn.classList.remove('visible');
                    }
                    ticking = false;
                });
                ticking = true;
            }
        });
        sBtn.addEventListener('click', function(){
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
    }
})();
</script>

</body>
</html>
