<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GED7FX8RTV"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-GED7FX8RTV');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- SEO Meta Tags -->
    <title>In-House Capability vs Vendor Dependency: MTTR Reduction Strategy | ResistanceZero</title>
    <meta name="description" content="Building in-house capability as a reliability strategy. Vendor dependency risks, decision latency analysis, and knowledge retention frameworks.">
    <meta name="keywords" content="In-House Capability, Vendor Dependency, Data Center Reliability, MTTR, Operational Risk, Capability Building, ICB Framework, Mission Critical, Engineering Operations">
    <meta name="author" content="Bagus Dwi Permana">
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#3b82f6">
    <link rel="canonical" href="https://resistancezero.com/article-4.html">

    <link rel="alternate" hreflang="en" href="https://resistancezero.com/article-4.html">

    <!-- Resource Hints -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="https://www.googletagmanager.com">
    <!-- Open Graph Meta Tags -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://resistancezero.com/article-4.html">
    <meta property="og:title" content="In-House Capability Is a Reliability Strategy">
    <meta property="og:description" content="MTTR decomposition reveals vendor mobilization as the dominant delay in incident response. Build in-house capability to reduce downtime by 60%.">
    <meta property="og:image" content="https://resistancezero.com/assets/article-4-cover.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="In-House Capability Is a Reliability Strategy - Operations Engineering Journal">
    <meta property="og:locale" content="en_US">
    <meta property="og:site_name" content="Bagus Dwi Permana Portfolio">
    <meta property="article:author" content="Bagus Dwi Permana">
    <meta property="article:published_time" content="2025-11-22T00:00:00Z">
    <meta property="article:modified_time" content="2026-02-17T00:00:00Z">
    <meta property="article:section" content="Operations Engineering Journal">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@BagusDPermana">
    <meta name="twitter:creator" content="@BagusDPermana">
    <meta name="twitter:title" content="In-House Capability Is a Reliability Strategy">
    <meta name="twitter:description" content="MTTR decomposition reveals vendor mobilization as the dominant delay. Build in-house capability for 60% faster incident response.">
    <meta name="twitter:image" content="https://resistancezero.com/assets/article-4-cover.jpg">
    <meta name="twitter:image:alt" content="Building In-House Capability for Data Center Operations">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="assets/Favicon.png">
    <link rel="apple-touch-icon" href="assets/Favicon.png">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preload" as="image" href="assets/article-4-cover.jpg">

    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "TechnicalArticle",
        "headline": "In-House Capability Is a Reliability Strategy",
        "description": "Why excessive vendor dependency increases latent risk in mission-critical data centers. MTTR decomposition, ICB framework, and capability layering for reliability.",
        "image": "https://resistancezero.com/assets/article-4-cover.jpg",
        "author": {
            "@type": "Person",
            "name": "Bagus Dwi Permana",
            "jobTitle": "Engineering Operations Manager"
        },
        "datePublished": "2025-11-22",
        "wordCount": "8000",
        "articleSection": "Operations Engineering Journal",
        "keywords": ["In-House Capability", "Vendor Dependency", "MTTR", "Reliability Strategy", "ICB Framework", "Data Center Operations"]
    }
    </script>

    <!-- Structured Data - BreadcrumbList -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
            {
                "@type": "ListItem",
                "position": 1,
                "name": "Home",
                "item": "https://resistancezero.com/"
            },
            {
                "@type": "ListItem",
                "position": 2,
                "name": "Engineering Journal",
                "item": "https://resistancezero.com/articles.html"
            },
            {
                "@type": "ListItem",
                "position": 3,
                "name": "In-House Capability Is a Reliability Strategy"
            }
        ]
    }
    </script>

    <!-- Structured Data - FAQPage -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
            {
                "@type": "Question",
                "name": "Why build in-house data center capability instead of outsourcing?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "In-house capability reduces vendor dependency risks including decision latency, knowledge retention gaps, and single-point-of-failure exposure during critical incidents that require immediate specialized response."
                }
            },
            {
                "@type": "Question",
                "name": "What are the risks of vendor dependency in critical infrastructure?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Vendor dependency creates decision latency during emergencies, institutional knowledge loss, reduced fault diagnosis speed, and contractual constraints that limit operational flexibility."
                }
            },
            {
                "@type": "Question",
                "name": "How do you retain operational knowledge in data centers?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Through structured training programs, documented procedures with institutional context, cross-training across systems, and building internal subject matter expertise that reduces reliance on external specialists."
                }
            }
        ]
    }
    </script>

    <style>
        /* ============================================
           Article 4 — In-House Capability
           Theme: Blue #3b82f6
           ============================================ */
        :root {
            --primary-blue: #1e3a5f;
            --accent-blue: #3b82f6;
            --accent-cyan: #06b6d4;
            --accent-emerald: #10b981;
            --accent-amber: #f59e0b;
            --accent-red: #ef4444;
            --bg-dark: #0f172a;
            --bg-light: #f8fafc;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --card-bg: #ffffff;
            --card-border: #e2e8f0;
            --section-bg: #f8fafc;
            --table-stripe: #f1f5f9;
        }

        [data-theme="dark"] {
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            --card-bg: #1e293b;
            --card-border: #334155;
            --section-bg: #0f172a;
            --table-stripe: #1e293b;
            --bg-light: #0f172a;
        }

        /* Hero Section */
        .article-hero {
            background: linear-gradient(135deg, #0b1220 0%, #1e3a5f 50%, #1e40af 100%);
            padding: 7rem 2rem 3.5rem;
            color: #fff;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .article-hero::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(circle at 20% 80%, rgba(59, 130, 246, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(6, 182, 212, 0.1) 0%, transparent 50%);
            z-index: 0;
        }

        .article-hero::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M30 5 L32 15 L42 17 L32 19 L30 29 L28 19 L18 17 L28 15 Z' fill='%233b82f6' fill-opacity='0.03'/%3E%3C/svg%3E");
            z-index: 0;
        }

        .article-hero > * { position: relative; z-index: 1; }
        .article-hero .container { max-width: 1000px; margin: 0 auto; }

        .article-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(59, 130, 246, 0.2);
            color: #93c5fd;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .article-title {
            font-size: clamp(1.6rem, 3.2vw, 2.35rem);
            font-weight: 800;
            margin-bottom: 1.25rem;
            line-height: 1.25;
            color: #fff;
            letter-spacing: -0.01em;
        }

        .article-subtitle {
            font-size: clamp(0.95rem, 1.6vw, 1.15rem);
            color: #94a3b8;
            max-width: 800px;
            margin: 0 auto 2rem;
            line-height: 1.7;
        }

        .article-meta {
            display: flex;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
            color: #94a3b8;
            font-size: 0.9rem;
        }

        .article-meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Table of Contents */
        .toc-section {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding: 3rem 2rem;
            border-bottom: 1px solid #e2e8f0;
        }

        [data-theme="dark"] .toc-section {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            border-bottom-color: #334155;
        }

        .toc-container { max-width: 900px; margin: 0 auto; }

        .toc-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        [data-theme="dark"] .toc-title { color: var(--accent-blue); }

        .toc-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 0.625rem;
        }

        .toc-item {
            background: var(--card-bg);
            padding: 0.75rem 1rem;
            border-radius: 10px;
            border-left: 4px solid var(--accent-blue);
            transition: all 0.2s ease;
            text-decoration: none;
            color: var(--text-primary);
            display: block;
        }

        .toc-item:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .toc-item-number {
            font-size: 0.7rem;
            color: var(--accent-blue);
            font-weight: 700;
            text-transform: uppercase;
        }

        .toc-item-title {
            font-weight: 600;
            font-size: 0.88rem;
        }

        /* TOC Calculator Highlight */
        .toc-item.toc-calculator {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-left-color: #3b82f6;
            border-left-width: 5px;
        }
        .toc-item.toc-calculator .toc-item-number { display: flex; align-items: center; gap: 6px; }
        .toc-item.toc-calculator .toc-calc-badge {
            font-size: 0.6rem; background: #3b82f6; color: #fff; padding: 1px 6px; border-radius: 4px; font-weight: 700; letter-spacing: 0.5px;
        }
        [data-theme="dark"] .toc-item.toc-calculator {
            background: linear-gradient(135deg, rgba(59,130,246,0.15) 0%, rgba(59,130,246,0.08) 100%);
        }

        /* Article Content */
        .article-content {
            padding: 4rem 2rem;
            background: var(--card-bg);
        }

        [data-theme="dark"] .article-content { background: var(--bg-dark); }

        .article-content .container { max-width: 900px; margin: 0 auto; }

        .article-body {
            font-size: 0.95rem;
            line-height: 1.7;
            color: var(--text-primary);
        }

        .article-body p { margin-bottom: 1rem; }

        .article-body h2 {
            font-size: 1.4rem;
            color: var(--primary-blue);
            margin: 2rem 0 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 3px solid var(--accent-blue);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        [data-theme="dark"] .article-body h2 { color: #93c5fd; }

        .article-body h2 .section-number {
            background: var(--accent-blue);
            color: #fff;
            width: 32px; height: 32px;
            border-radius: 8px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            font-weight: 700;
            flex-shrink: 0;
        }

        .article-body h3 {
            font-size: 1.1rem;
            color: #334155;
            margin: 1.5rem 0 0.5rem;
        }

        [data-theme="dark"] .article-body h3 { color: #cbd5e1; }

        .article-body h4 {
            font-size: 0.9rem;
            color: #475569;
            margin: 1rem 0 0.5rem;
        }

        [data-theme="dark"] .article-body h4 { color: #94a3b8; }

        .article-body ul, .article-body ol {
            margin: 1rem 0;
            padding-left: 1.5rem;
        }

        .article-body li { margin-bottom: 0.35rem; font-size: 0.9rem; }

        .article-body blockquote {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-left: 4px solid var(--accent-blue);
            padding: 1.5rem 2rem;
            margin: 2rem 0;
            border-radius: 0 12px 12px 0;
            font-style: italic;
            color: #1e40af;
        }

        [data-theme="dark"] .article-body blockquote {
            background: rgba(59,130,246,0.04);
            color: #93c5fd;
        }

        /* Tooltip System */
        .tip {
            border-bottom: 1px dashed var(--accent-blue);
            cursor: help;
            position: relative;
            font-weight: 500;
        }

        .tip::after {
            content: attr(data-tip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #1e293b;
            color: #e2e8f0;
            padding: 0.6rem 0.9rem;
            border-radius: 8px;
            font-size: 0.78rem;
            font-weight: 400;
            font-style: normal;
            line-height: 1.5;
            width: max-content;
            max-width: 300px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0,0,0,0.25);
            white-space: normal;
        }

        .tip:hover::after { opacity: 1; }

        [data-theme="dark"] .tip::after {
            background: #334155;
            color: #f1f5f9;
        }

        /* Source References */
        .src-ref {
            font-size: 0.7rem;
            vertical-align: super;
            color: var(--accent-blue);
            text-decoration: none;
            font-weight: 700;
            cursor: pointer;
        }
        .src-ref:hover { text-decoration: underline; }

        /* Key Insight Box */
        .key-insight {
            background: rgba(59, 130, 246, 0.08);
            border-left: 4px solid var(--accent-blue);
            padding: 1.25rem 1.5rem;
            border-radius: 0 12px 12px 0;
            margin: 1.5rem 0;
        }

        [data-theme="dark"] .key-insight {
            background: rgba(59, 130, 246, 0.04);
        }

        .key-insight strong {
            color: var(--accent-blue);
            display: block;
            margin-bottom: 0.25rem;
        }

        /* Formula Box */
        .formula-box {
            background: linear-gradient(135deg, #1e3a5f 0%, #1e40af 100%);
            color: #fff;
            padding: 2rem;
            border-radius: 12px;
            margin: 1.5rem 0;
            text-align: center;
        }

        .formula-box .formula {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.1rem;
            font-weight: 600;
            margin: 1rem 0;
            color: #93c5fd;
        }

        .formula-box .formula-label {
            font-size: 0.85rem;
            color: #94a3b8;
        }

        /* Info Boxes */
        .info-box {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-left: 4px solid var(--accent-blue);
            padding: 1.5rem;
            border-radius: 0 12px 12px 0;
            margin: 1.5rem 0;
        }

        .info-box.warning {
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            border-left-color: var(--accent-amber);
        }

        .info-box.critical {
            background: linear-gradient(135deg, #fef2f2 0%, #fecaca 100%);
            border-left-color: var(--accent-red);
        }

        .info-box.success {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border-left-color: var(--accent-emerald);
        }

        [data-theme="dark"] .info-box {
            background: transparent;
        }
        [data-theme="dark"] .info-box.warning {
            background: transparent;
        }
        [data-theme="dark"] .info-box.critical {
            background: transparent;
        }
        [data-theme="dark"] .info-box.success {
            background: transparent;
        }
        [data-theme="dark"] .info-box-title {
            background: transparent;
        }

        .info-box-title {
            font-weight: 700;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .info-box p { margin: 0; }

        /* Data Tables */
        .data-table-wrapper {
            overflow-x: auto;
            margin: 1.5rem 0;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .data-table thead {
            background: linear-gradient(135deg, var(--primary-blue) 0%, #1e40af 100%);
            color: #fff;
        }

        .data-table th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            white-space: nowrap;
        }

        .data-table td {
            padding: 0.875rem 1rem;
            border-bottom: 1px solid var(--card-border);
        }

        .data-table tbody tr:hover { background: var(--table-stripe); }
        .data-table tbody tr:last-child td { border-bottom: none; }

        /* Conclusion Box */
        .conclusion-box {
            background: linear-gradient(135deg, #1e3a5f 0%, #1e40af 100%);
            color: #fff;
            padding: 2.5rem;
            border-radius: 16px;
            margin: 2rem 0;
        }

        .conclusion-box h3 {
            color: #93c5fd;
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }

        .conclusion-box p { color: #cbd5e1; line-height: 1.7; }
        .conclusion-box ul { color: #cbd5e1; margin: 1rem 0; padding-left: 1.25rem; }
        .conclusion-box li { margin-bottom: 0.5rem; }

        /* Calculator Section */
        .calculator-section {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            padding: 3rem 2rem;
            margin: 2rem 0;
            border-radius: 16px;
            color: #e2e8f0;
            position: relative;
        }

        .calculator-section h2 {
            color: #fff !important;
            border-bottom-color: var(--accent-blue) !important;
        }

        .calculator-section h2 .section-number { background: var(--accent-blue); }

        .calc-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.25rem;
            margin-bottom: 2rem;
        }

        .calc-input-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .calc-label {
            font-size: 0.85rem;
            color: #94a3b8;
            font-weight: 500;
        }

        .calc-input, .calc-select {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            padding: 0.875rem 1rem;
            color: #fff;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.2s ease;
            width: 100%;
        }

        .calc-input:focus, .calc-select:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        .calc-select option { background: #1e293b; color: #fff; }

        .calc-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 1rem;
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 1.5rem;
            margin-top: 1.5rem;
        }

        .calc-result-item { text-align: center; padding: 1rem; }

        .calc-result-value {
            font-size: 1.75rem;
            font-weight: 800;
            color: var(--accent-blue);
        }

        .calc-result-label {
            font-size: 0.8rem;
            color: #94a3b8;
            margin-top: 0.25rem;
        }

        .calc-result-value.positive { color: var(--accent-emerald); }
        .calc-result-value.negative { color: var(--accent-red); }

        /* MTTR Phase Table in Calculator */
        .phase-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
            margin: 1.5rem 0;
        }

        .phase-table thead {
            background: rgba(59, 130, 246, 0.3);
        }

        .phase-table th {
            padding: 0.75rem 1rem;
            text-align: left;
            font-weight: 600;
            color: #93c5fd;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .phase-table td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            color: #cbd5e1;
        }

        .phase-table tbody tr:hover { background: rgba(255,255,255,0.03); }

        .phase-table .phase-label { font-weight: 600; color: #93c5fd; }
        .phase-table .vendor-val { color: var(--accent-amber); font-weight: 600; }
        .phase-table .inhouse-val { color: var(--accent-emerald); font-weight: 600; }

        /* Interactive Canvas Section */
        .chart-container {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            border-radius: 16px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .chart-title {
            text-align: center;
            color: #fff;
            font-size: 1.15rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .chart-subtitle {
            text-align: center;
            color: #94a3b8;
            font-size: 0.85rem;
            margin-bottom: 1.5rem;
        }

        .chart-wrapper {
            background: rgba(2, 6, 23, 0.5);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .chart-canvas { width: 100%; height: auto; display: block; }

        .control-row {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 1rem;
        }

        .control-label { color: #94a3b8; font-size: 0.9rem; }

        .control-slider {
            width: 200px; height: 8px; border-radius: 4px;
            background: rgba(148, 163, 184, 0.2);
            outline: none; -webkit-appearance: none;
        }

        .control-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px; height: 20px; border-radius: 50%;
            background: #3b82f6; cursor: pointer;
        }

        .control-value {
            background: rgba(59, 130, 246, 0.2);
            color: #93c5fd;
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-weight: 700; font-size: 0.9rem;
            min-width: 50px; text-align: center;
        }

        .callout-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 1rem; margin-top: 1.5rem;
        }

        .callout-card {
            background: rgba(30, 58, 95, 0.3);
            border-radius: 10px; padding: 1rem;
            text-align: center;
            border: 1px solid rgba(59, 130, 246, 0.15);
        }

        .callout-label {
            color: #94a3b8; font-size: 0.7rem;
            text-transform: uppercase; letter-spacing: 0.5px;
        }

        .callout-value { font-size: 1.5rem; font-weight: 800; color: #3b82f6; }

        /* Tier Cards */
        .tier-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.25rem;
            margin: 1.5rem 0;
        }

        .tier-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--card-border);
            box-shadow: 0 4px 12px rgba(0,0,0,0.06);
            position: relative;
            overflow: hidden;
        }

        .tier-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 4px;
        }

        .tier-card.t1::before { background: var(--accent-emerald); }
        .tier-card.t2::before { background: var(--accent-blue); }
        .tier-card.t3::before { background: var(--accent-amber); }
        .tier-card.t4::before { background: var(--accent-red); }

        .tier-label {
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
        }

        .tier-card.t1 .tier-label { color: var(--accent-emerald); }
        .tier-card.t2 .tier-label { color: var(--accent-blue); }
        .tier-card.t3 .tier-label { color: var(--accent-amber); }
        .tier-card.t4 .tier-label { color: var(--accent-red); }

        .tier-card h4 { margin: 0 0 0.5rem; font-size: 1rem; }
        .tier-card p { font-size: 0.85rem; color: var(--text-secondary); margin: 0; line-height: 1.5; }

        /* ICB Steps */
        .icb-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin: 1.5rem 0;
            justify-content: center;
        }

        .icb-step {
            flex: 1;
            min-width: 140px;
            max-width: 180px;
            text-align: center;
            padding: 1.25rem 1rem;
            background: var(--card-bg);
            border-radius: 12px;
            border: 1px solid var(--card-border);
            position: relative;
        }

        .icb-step-num {
            width: 36px; height: 36px;
            background: var(--accent-blue);
            color: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
            margin: 0 auto 0.75rem;
        }

        .icb-step h4 { font-size: 0.85rem; margin: 0 0 0.25rem; }
        .icb-step p { font-size: 0.78rem; color: var(--text-secondary); margin: 0; }

        /* Reference List */
        .ref-list {
            list-style: none;
            padding: 0;
            counter-reset: ref-counter;
        }

        .ref-list li {
            counter-increment: ref-counter;
            padding: 0.75rem 0 0.75rem 2.5rem;
            border-bottom: 1px solid var(--card-border);
            font-size: 0.85rem;
            line-height: 1.7;
            position: relative;
        }

        .ref-list li::before {
            content: "[" counter(ref-counter) "]";
            color: var(--accent-blue);
            font-weight: 700;
            font-size: 0.8rem;
            position: absolute;
            left: 0;
            top: 0.75rem;
        }

        /* Author Bio — styled via styles.css */

        /* Article Navigation */
        .article-nav {
            display: flex;
            justify-content: space-between;
            padding: 2rem 0;
            border-top: 1px solid var(--card-border);
            margin-top: 3rem;
        }
        .article-nav a {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--accent-blue);
            font-weight: 600;
            transition: color 0.3s ease;
            text-decoration: none;
        }
        [data-theme="dark"] .article-nav a { color: #93c5fd; }
        .article-nav a:hover { color: #60a5fa; }

        /* Print CSS */
        @media print {
            .navbar, .calculator-section, .toc-section, .share-buttons, .chart-container, .article-nav { display: none !important; }
            .article-hero { padding: 1.5rem 1rem; background: #1e3a5f !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .article-hero .article-badge, .article-hero .article-meta { display: none; }
            .article-content { padding: 1rem; }
            body { font-size: 10pt; color: #000; }
            .key-insight, .formula-box, .conclusion-box, .info-box { break-inside: avoid; }
            .article-body h2 { break-after: avoid; }
            a { color: inherit; text-decoration: none; }
            footer { display: none !important; }
        }

        /* Responsive */
        @media (max-width: 900px) {
            .article-hero { padding: 6rem 1.5rem 3rem; }
            .article-content { padding: 3rem 1.5rem; }
            .tier-grid { grid-template-columns: repeat(2, 1fr); }
            .calc-grid { grid-template-columns: 1fr 1fr; }
            .icb-steps { justify-content: center; }
        }

        .privacy-badge { display:flex;align-items:center;justify-content:center;gap:6px;font-size:0.72rem;color:#64748b;margin-top:0.5rem;padding:6px 0; }
        .privacy-badge i { color:#10b981;font-size:0.8rem; }

        @media (max-width: 600px) {
            .article-hero { padding: 5rem 1rem 2.5rem; }
            .article-meta { flex-direction: column; gap: 0.75rem; }
            .article-content { padding: 2rem 1rem; }
            .toc-grid { grid-template-columns: 1fr; }
            .tier-grid { grid-template-columns: 1fr; }
            .calc-grid { grid-template-columns: 1fr; }
            .icb-steps { flex-direction: column; align-items: center; }
            .callout-row { grid-template-columns: repeat(2, 1fr); }
            .cta-card { flex-direction: column; text-align: center; }
            .mode-toggle { flex-direction: column; }
            .mode-toolbar-row { flex-direction: column; align-items: stretch; }
            .pro-panel .calc-results { grid-template-columns: 1fr 1fr; }
        }

        /* ============================================
           PRO ENHANCEMENT MODE
           ============================================ */

        /* Mode Toggle */
        .mode-toggle {
            display: flex; gap: 4px; padding: 4px;
            background: rgba(255,255,255,0.05); border-radius: 12px;
            margin-bottom: 0; width: fit-content;
        }
        .mode-toolbar-row { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 0.75rem; margin-bottom: 2rem; }
        .mode-toolbar-actions { display: flex; gap: 8px; align-items: center; }
        .mode-btn {
            padding: 0.65rem 1.25rem; border: none; border-radius: 10px;
            font-size: 0.85rem; font-weight: 600; cursor: pointer;
            display: flex; align-items: center; gap: 8px;
            transition: all 0.25s ease; color: #94a3b8; background: transparent;
        }
        .mode-btn.active { background: linear-gradient(135deg, #3b82f6, #2563eb); color: #fff; box-shadow: 0 4px 15px rgba(59,130,246,0.4), 0 0 20px rgba(59,130,246,0.2); border-color: #3b82f6; font-weight: 700; }
        .mode-btn:hover:not(.active) { background: rgba(255,255,255,0.08); color: #e2e8f0; }
        .gated-badge {
            font-size: 0.6rem; font-weight: 800; padding: 2px 6px;
            border-radius: 4px; background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: #fff; letter-spacing: 0.5px;
        }

        /* CTA Card */
        .cta-card {
            display: flex; align-items: center; gap: 1.5rem;
            background: linear-gradient(135deg, rgba(59,130,246,0.12) 0%, rgba(59,130,246,0.04) 100%);
            border: 1px solid rgba(59,130,246,0.2); border-radius: 14px;
            padding: 1.5rem 2rem; margin: 2rem 0 1.5rem;
        }
        .cta-icon { font-size: 2rem; color: var(--accent-blue); flex-shrink: 0; }
        .cta-card h4 { color: #e2e8f0; margin: 0 0 0.25rem; font-size: 1rem; }
        .cta-card p { color: #94a3b8; margin: 0; font-size: 0.85rem; line-height: 1.5; }

        /* Pro Input Drawer */
        .pro-drawer {
            display: none; margin-top: 1.5rem; padding: 1.5rem;
            background: rgba(59,130,246,0.05);
            border: 1px solid rgba(59,130,246,0.15); border-radius: 14px;
        }
        .pro-drawer.visible { display: block; }
        .pro-drawer-title {
            font-size: 0.8rem; font-weight: 700; color: var(--accent-blue);
            text-transform: uppercase; letter-spacing: 0.8px;
            margin-bottom: 1rem; display: flex; align-items: center; gap: 8px;
        }

        /* Pro Output Panels */
        .pro-panels { display: none; margin-top: 1.5rem; }
        .pro-panels.visible { display: block; }
        .pro-panel {
            position: relative; margin-top: 1.25rem;
        }
        .pro-panel-inner {
            padding: 1.25rem; border: 1px solid rgba(59,130,246,0.15);
            border-radius: 14px; background: rgba(59,130,246,0.03);
        }
        .pro-panel-title {
            font-size: 0.95rem; font-weight: 700; color: var(--accent-blue);
            text-transform: uppercase; letter-spacing: 0.8px;
            margin-bottom: 0.75rem; display: flex; align-items: center; gap: 8px;
        }
        .pro-panel .calc-results {
            background: transparent; padding: 0; margin: 0;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        }
        .pro-panel .calc-result-value { font-size: 1.4rem; }

        /* Gated Overlay */
        .gated-overlay {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(15,23,42,0.75); backdrop-filter: blur(6px);
            border-radius: 14px; display: flex; flex-direction: column;
            align-items: center; justify-content: center; cursor: pointer;
            transition: all 0.3s ease; z-index: 5;
        }
        .gated-overlay:hover { background: rgba(15,23,42,0.65); }
        .gated-icon { font-size: 1.5rem; color: var(--accent-blue); margin-bottom: 0.5rem; }
        .gated-text { color: #e2e8f0; font-weight: 700; font-size: 0.9rem; }
        .gated-sub { color: #64748b; font-size: 0.75rem; margin-top: 0.25rem; }

        /* Login Modal */
        .login-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.75); backdrop-filter: blur(8px);
            z-index: 9999; align-items: center; justify-content: center;
        }
        .login-overlay.visible { display: flex; }
        .login-box {
            background: #0f172a; border-radius: 20px; padding: 2.5rem;
            width: 90%; max-width: 420px; position: relative;
            box-shadow: 0 25px 50px rgba(0,0,0,0.5); border: 1px solid rgba(59,130,246,0.2);
        }
        .login-box h3 { color: #f1f5f9; text-align: center; margin: 0 0 0.5rem; }
        .login-box .login-sub { color: #94a3b8; text-align: center; font-size: 0.85rem; margin-bottom: 1.5rem; }
        .login-close {
            position: absolute; top: 1rem; right: 1rem; background: none;
            border: none; color: #64748b; font-size: 1.25rem; cursor: pointer;
        }
        .login-input {
            width: 100%; padding: 0.875rem 1rem; background: #1e293b;
            border: 1px solid #334155; border-radius: 10px;
            color: #f1f5f9; font-size: 0.95rem; margin-bottom: 0.75rem;
            box-sizing: border-box;
        }
        .login-input:focus { outline: none; border-color: var(--accent-blue); box-shadow: 0 0 0 3px rgba(59,130,246,0.2); }
        .login-submit {
            width: 100%; padding: 0.875rem; border: none; border-radius: 10px;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: #fff;
            font-weight: 700; font-size: 0.95rem; cursor: pointer;
            margin-top: 0.5rem; transition: all 0.2s ease;
        }
        .login-submit:hover { transform: translateY(-1px); box-shadow: 0 8px 20px rgba(59,130,246,0.4); }
        .login-error { color: #ef4444; font-size: 0.8rem; text-align: center; margin-top: 0.5rem; display: none; }
        .login-hint {
            margin-top: 1rem; padding: 0.75rem; background: rgba(59,130,246,0.1);
            border-radius: 8px; text-align: center;
        }
        .login-hint span { color: #94a3b8; font-size: 0.78rem; }
        .login-hint code { color: var(--accent-blue); font-size: 0.78rem; }
        [data-theme="light"] .login-box { background: #ffffff; border-color: #e2e8f0; }
        [data-theme="light"] .login-box h3 { color: #1e293b; }
        [data-theme="light"] .login-box .login-sub { color: #64748b; }
        [data-theme="light"] .login-input { background: #f1f5f9; border-color: #e2e8f0; color: #1e293b; }
        [data-theme="light"] .login-hint { background: rgba(59,130,246,0.08); }
        [data-theme="light"] .login-hint span { color: #64748b; }
        [data-theme="light"] .login-hint code { color: #3b82f6; }

        /* Tooltip System (Calculator) */
        .tooltip-trigger {
            display: inline-flex; align-items: center; justify-content: center;
            width: 16px; height: 16px; background: rgba(59,130,246,0.2);
            color: var(--accent-blue); border-radius: 50%; font-size: 0.65rem;
            font-weight: 700; cursor: help; margin-left: 4px; vertical-align: middle;
            position: relative;
        }
        .tooltip-trigger .tooltip-content { display: none; }
        #calc-tooltip-container {
            display: none; position: absolute; z-index: 1000; width: 320px;
            background: #1e293b; border: 1px solid rgba(59,130,246,0.25);
            border-radius: 12px; padding: 1rem; box-shadow: 0 12px 30px rgba(0,0,0,0.4);
            pointer-events: none;
        }
        #calc-tooltip-container .tooltip-title {
            color: var(--accent-blue); font-weight: 700; font-size: 0.8rem;
            margin-bottom: 0.35rem;
        }
        #calc-tooltip-container .tooltip-desc {
            color: #cbd5e1; font-size: 0.78rem; line-height: 1.55; margin-bottom: 0.35rem;
        }
        #calc-tooltip-container .tooltip-formula {
            color: #64748b; font-size: 0.72rem; font-style: italic;
            border-top: 1px solid rgba(255,255,255,0.06); padding-top: 0.35rem;
        }

        /* PDF Export Button */
        .pdf-btn {
            display: inline-flex; align-items: center; gap: 8px;
            padding: 0.75rem 1.5rem; background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: #fff; border: none; border-radius: 10px; font-weight: 700;
            font-size: 0.85rem; cursor: pointer; transition: all 0.2s ease;
            margin-top: 1rem;
        }
        .pdf-btn:hover { transform: translateY(-1px); box-shadow: 0 8px 20px rgba(59,130,246,0.4); }
        .pdf-btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; box-shadow: none; }

        /* Narrative Conclusion Box */
        .narrative-box {
            background: rgba(59,130,246,0.05); border: 1px solid rgba(59,130,246,0.15);
            border-radius: 14px; padding: 1.5rem; margin-top: 1.5rem; display: none;
        }
        .narrative-box.visible { display: block; }
        .narrative-box h4 { color: var(--accent-blue); margin: 0 0 1rem; font-size: 0.95rem; }
        .narrative-grade {
            display: inline-flex; align-items: center; justify-content: center;
            width: 48px; height: 48px; border-radius: 12px; font-size: 1.5rem;
            font-weight: 800; margin-right: 1rem; vertical-align: middle;
        }
        .narrative-summary { color: #cbd5e1; font-size: 0.85rem; line-height: 1.65; }
        .narrative-actions { margin-top: 1rem; }
        .narrative-action {
            display: flex; align-items: center; gap: 8px;
            padding: 0.5rem 0; border-bottom: 1px solid rgba(255,255,255,0.05);
            font-size: 0.82rem; color: #cbd5e1;
        }
        .narrative-action .action-pri {
            font-size: 0.6rem; font-weight: 800; padding: 2px 8px;
            border-radius: 4px; color: #fff; white-space: nowrap;
        }
    
        /* Result Card Tooltip System */
        .res-tip {
            display: inline-flex; align-items: center; justify-content: center;
            width: 14px; height: 14px;
            background: rgba(245,158,11,0.15); border: 1px solid rgba(245,158,11,0.3);
            border-radius: 50%; font-size: 0.6rem; font-weight: 700;
            color: #fbbf24; margin-left: 4px; cursor: help;
            position: relative; flex-shrink: 0; vertical-align: middle;
            line-height: 1;
        }
        .res-tip:hover { background: rgba(245,158,11,0.3); transform: scale(1.15); }
        .res-tip .res-tip-body {
            visibility: hidden; opacity: 0;
            position: absolute; bottom: calc(100% + 8px); left: 50%;
            transform: translateX(-50%);
            background: #1e293b; color: #e2e8f0;
            padding: 0.7rem 0.9rem; border-radius: 8px;
            font-size: 0.72rem; font-weight: 400; line-height: 1.5;
            width: 260px; z-index: 100;
            box-shadow: 0 8px 25px rgba(0,0,0,0.5);
            border: 1px solid rgba(245,158,11,0.2);
            transition: opacity 0.2s ease; pointer-events: none;
            text-transform: none; letter-spacing: normal;
        }
        .res-tip:hover .res-tip-body { visibility: visible; opacity: 1; }
        .res-tip-body .rtt { font-weight: 700; color: #fbbf24; margin-bottom: 3px; font-size: 0.75rem; }
        .res-tip-body .rtd { color: #cbd5e1; }
        .res-tip-body .rtf {
            font-family: 'JetBrains Mono', monospace; font-size: 0.68rem;
            background: rgba(0,0,0,0.3); padding: 3px 7px; border-radius: 4px;
            color: #67e8f9; margin-top: 4px; display: block;
        }
</style>
    <link rel="preload" as="image" href="assets/article-4-cover.jpg">
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0" defer></script>
</head>
<body>
    <!-- Reading Progress Bar -->
    <div class="scroll-progress" id="scrollProgress"></div>

    <!-- Search Overlay & Modal -->
    <div class="search-overlay" id="searchOverlay"></div>
    <div class="search-modal" id="searchModal">
        <div class="search-input-wrap">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
            <input type="text" class="search-input" id="searchInput" placeholder="Search articles, calculators, tools..." autocomplete="off">
            <kbd class="search-kbd">ESC</kbd>
        </div>
        <div class="search-results" id="searchResults">
            <div class="search-empty">Type to search across all content</div>
        </div>
        <div class="search-footer">
            <span><kbd class="search-kbd">&uarr;&darr;</kbd> Navigate</span>
            <span><kbd class="search-kbd">Enter</kbd> Open</span>
        </div>
    </div>

    <!-- TOC Sidebar (desktop, wide screens) -->
    <nav class="toc-sidebar" id="tocSidebar" aria-label="Table of Contents">
        <div class="toc-sidebar-label">On this page</div>
        <ul class="toc-sidebar-list" id="tocSidebarList"></ul>
    </nav>

    <!-- TOC Mobile Toggle -->
    <button class="toc-mobile-toggle" id="tocMobileToggle" aria-label="Table of contents">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
    </button>
    <div class="toc-mobile-backdrop" id="tocMobileBackdrop"></div>
    <div class="toc-mobile-drawer" id="tocMobileDrawer">
        <div class="toc-drawer-header">
            <span class="toc-drawer-title">Table of Contents</span>
            <button class="toc-drawer-close" id="tocDrawerClose" aria-label="Close">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
            </button>
        </div>
        <ul class="toc-mobile-list" id="tocMobileList"></ul>
    </div>


    <a href="#main-content" class="skip-link">Skip to main content</a>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">
                <img loading="lazy" src="assets/profile-photo.jpg" alt="Bagus Dwi Permana" class="nav-avatar">
            </a>
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link">Home</a></li>
                <li class="nav-dropdown">
                    <a href="datacenter-solutions.html" class="nav-link">
                        DC Solutions
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="datacenter-solutions.html" style="color: #06b6d4; font-weight: 600;">DC Solutions Hub</a></li>
                        <li style="border-bottom: 1px solid rgba(255,255,255,0.1); margin: 4px 0;"></li>
                        <li><a href="datahallAI.html" style="color: #8b5cf6;">DC AI/HPC</a></li>
                        <li><a href="dc-conventional.html">DC Conventional</a></li>
                        <li style="border-bottom: 1px solid rgba(255,255,255,0.1); margin: 4px 0;"></li>
                        <li><a href="capex-calculator.html" style="color: #f59e0b;">CAPEX Calculator</a></li>
                        <li><a href="opex-calculator.html" style="color: #10b981;">OPEX Calculator</a></li>
                        <li style="border-bottom: 1px solid rgba(255,255,255,0.1); margin: 4px 0;"></li>
                        <li><a href="dcmoc/" style="color: #ef4444; font-weight: 600;">DC MOC</a></li>
                    </ul>
                </li>
                <li class="nav-dropdown">
                    <a href="articles.html" class="nav-link">
                        Insights
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="articles.html" style="color: #06b6d4; font-weight: 600;">Engineering Journal</a></li>
                        <li><a href="geopolitics.html" style="color: #ef4444;">Global Analysis</a></li>
                        <li style="border-bottom: 1px solid rgba(255,255,255,0.1); margin: 4px 0;"></li>
                        <li><a href="insights.html" style="color: #64748b; font-size: 0.85rem;">All Insights</a></li>
                    </ul>
                </li>
                <li><a href="index.html#contact" class="nav-link">Contact</a></li>
            </ul>
                        <button class="nav-search-btn" id="navSearchBtn" aria-label="Search" title="Search (Ctrl+K)">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
            </button>
            <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode">
                <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
                <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="23"></line>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                    <line x1="1" y1="12" x2="3" y2="12"></line>
                    <line x1="21" y1="12" x2="23" y2="12"></line>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                </svg>
            </button>
            <button class="hamburger" aria-label="Open navigation menu" aria-expanded="false">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </button>
        </div>
    </nav>

    <main id="main-content">
    <!-- Hero Section -->
    <section class="article-hero">
        <div class="container">
            <a href="articles.html" style="display: inline-flex; align-items: center; gap: 0.5rem; color: #94a3b8; margin-bottom: 1.5rem; font-size: 0.9rem;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
                Back to Engineering Journal
            </a>

            <span class="article-badge">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                </svg>
                Operations Engineering Journal #4
            </span>

            <h1 class="article-title">In-House Capability Is a<br>Reliability Strategy</h1>

            <p class="article-subtitle">
                Vendor dependency is a hidden reliability risk. This paper decomposes MTTR into five discrete phases, reveals mobilization delay as the dominant bottleneck, and presents the ICB framework for building in-house capability that reduces incident response time by up to 60%.
            </p>

            <div class="article-meta">
                <span class="article-meta-item">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    November 22, 2025
                </span>
                <span class="article-meta-item">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    20 min read
                </span>
                <span class="article-meta-item">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                    </svg>
                    ~8,000 words
                </span>
            </div>
        </div>
    </section>
    <!-- Series Navigation -->
    <div class="series-nav" style="margin-top: 1rem;">
        <div class="series-badge">
            <span class="series-badge-icon">04</span>
            Engineering Journal &mdash; Article 4 of 18
        </div>
        <span class="series-title"></span>
        <div class="series-links">
            <a href="article-3.html" class="series-link"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>Prev</a>
            <a href="article-5.html" class="series-link">Next<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg></a>
        </div>
    </div>


    <!-- Featured Image -->
    <figure style="margin: 2rem 0; text-align: center;">
        <img src="Article/Article_4 02.02.26/4.1.jpg" alt="Fire detection and suppression systems designed for data center server room protection" loading="lazy" style="max-width: 100%; height: auto; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);" decoding="async">
    </figure>

    <!-- Table of Contents -->
    <section class="toc-section">
        <div class="toc-container">
            <h2 class="toc-title">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="8" y1="6" x2="21" y2="6"></line>
                    <line x1="8" y1="12" x2="21" y2="12"></line>
                    <line x1="8" y1="18" x2="21" y2="18"></line>
                    <line x1="3" y1="6" x2="3.01" y2="6"></line>
                    <line x1="3" y1="12" x2="3.01" y2="12"></line>
                    <line x1="3" y1="18" x2="3.01" y2="18"></line>
                </svg>
                Table of Contents
            </h2>
            <div class="toc-grid">
                <a href="#section-1" class="toc-item">
                    <div class="toc-item-number">Section 1</div>
                    <div class="toc-item-title">Abstract</div>
                </a>
                <a href="#section-2" class="toc-item">
                    <div class="toc-item-number">Section 2</div>
                    <div class="toc-item-title">The Vendor Dependency Trap</div>
                </a>
                <a href="#section-3" class="toc-item">
                    <div class="toc-item-number">Section 3</div>
                    <div class="toc-item-title">The Reliability Cost of External Dependency</div>
                </a>
                <a href="#section-4" class="toc-item">
                    <div class="toc-item-number">Section 4</div>
                    <div class="toc-item-title">MTTR Decomposition Analysis</div>
                </a>
                <a href="#section-5" class="toc-item">
                    <div class="toc-item-number">Section 5</div>
                    <div class="toc-item-title">Vendor Response Patterns</div>
                </a>
                <a href="#section-6" class="toc-item">
                    <div class="toc-item-number">Section 6</div>
                    <div class="toc-item-title">Case Context</div>
                </a>
                <a href="#section-7" class="toc-item">
                    <div class="toc-item-number">Section 7</div>
                    <div class="toc-item-title">Capability Layering Intervention</div>
                </a>
                <a href="#section-8" class="toc-item">
                    <div class="toc-item-number">Section 8</div>
                    <div class="toc-item-title">ICB Framework</div>
                </a>
                <a href="#section-9" class="toc-item toc-calculator">
                    <div class="toc-item-number">Section 9 <span class="toc-calc-badge"><i class="fas fa-calculator" style="font-size:0.5rem;"></i> Interactive</span></div>
                    <div class="toc-item-title">Interactive MTTR Canvas</div>
                </a>
                <a href="#section-10" class="toc-item toc-calculator">
                    <div class="toc-item-number">Section 10 <span class="toc-calc-badge"><i class="fas fa-calculator" style="font-size:0.5rem;"></i> Interactive</span></div>
                    <div class="toc-item-title">Capability vs MTTR Calculator</div>
                </a>
                <a href="#section-11" class="toc-item">
                    <div class="toc-item-number">Section 11</div>
                    <div class="toc-item-title">Training ROI Analysis</div>
                </a>
                <a href="#section-12" class="toc-item">
                    <div class="toc-item-number">Section 12</div>
                    <div class="toc-item-title">Conclusion</div>
                </a>
            </div>
        </div>
    </section>

    <!-- Article Content -->
    <article class="article-content">
        <div class="container">
            <div class="article-body">

                <!-- Section 1: Abstract -->
                <h2 id="section-1">
                    <span class="section-number">1</span>
                    Abstract
                </h2>

                <p>Mission-critical data centers operate under an implicit assumption: that vendor partnerships guarantee rapid, competent incident response. This assumption is rarely tested until a critical failure exposes the gap between contracted <span class="tip" data-tip="Service Level Agreement — a contract defining expected performance metrics such as response time, resolution time, and availability targets">SLA</span> commitments and actual field performance. When that gap materializes at 2:00 AM on a holiday weekend, the consequences are measured not in hours of inconvenience but in hundreds of thousands of dollars of lost revenue, damaged client relationships, and eroded organizational credibility.<a href="#ref-section" class="src-ref">[6]</a></p>

                <p>This paper examines vendor dependency as a latent reliability risk — one that compounds silently until it manifests as extended <span class="tip" data-tip="Mean Time To Repair — the average time required to restore a failed system to operational status, measured from failure detection to service restoration">MTTR</span> during the incidents that matter most. Through decomposition of the repair cycle into five discrete phases — Detection, Diagnosis, Mobilization, Repair, and Verification — we demonstrate that vendor mobilization consistently represents the single largest time component, often exceeding the combined duration of all technical phases.<a href="#ref-section" class="src-ref">[12]</a></p>

                <p>Drawing on operational data from a 10MW colocation facility experiencing 36 annual critical incidents, we present a structured intervention: the <span class="tip" data-tip="In-house Capability Building — a systematic framework for developing internal technical competence to reduce vendor dependency">ICB</span> (In-house Capability Building) framework and a four-tier capability layering model. The evidence demonstrates that strategic investment in in-house capability reduces average MTTR by 55-65%, generates net annual savings exceeding $400,000, and fundamentally transforms the organization's relationship with operational risk.<a href="#ref-section" class="src-ref">[7]</a></p>

                <div class="key-insight">
                    <strong>Core Thesis</strong>
                    In-house capability is not merely a cost optimization strategy — it is a reliability strategy. Organizations that outsource critical maintenance competence are outsourcing their ability to respond to the very incidents that define their <a href="article-7.html">operational resilience</a>. The question is not whether you can afford to build internal capability, but whether you can afford not to.
                </div>

                <!-- Section 2: The Vendor Dependency Trap -->
                <h2 id="section-2">
                    <span class="section-number">2</span>
                    The Vendor Dependency Trap
                </h2>

                <p>The path to vendor dependency is paved with rational decisions. When a data center first commissions its critical infrastructure — <span class="tip" data-tip="Uninterruptible Power Supply — battery-backed power protection system that provides emergency power when utility input fails">UPS</span> systems, precision cooling units, <span class="tip" data-tip="Power Distribution Unit — a device for distributing electric power, especially in data centers, to rack-mounted equipment">PDU</span> switchgear, fire suppression panels, <span class="tip" data-tip="Building Management System — a computer-based control system that manages and monitors a building's mechanical and electrical equipment">BMS</span> controls — the original equipment manufacturers naturally provide warranty coverage and commissioning support. Engineers become familiar with vendor-specific diagnostic tools, proprietary software interfaces, and manufacturer-recommended procedures. The vendor's field service team accumulates site-specific knowledge that appears irreplaceable.<a href="#ref-section" class="src-ref">[4]</a></p>

                <p>Over time, this arrangement calcifies into structural dependency. The organization's internal team becomes conditioned to escalate rather than investigate. Operators learn to recognize alarms but not to <a href="article-6.html">diagnose root causes</a>. Technicians can perform routine preventive maintenance but lack the competence to troubleshoot complex failure modes. The vendor becomes not just a service provider but a cognitive crutch — the default answer to any question more complex than a filter change or a breaker reset.</p>

                <h3>2.1 The Competence Erosion Cycle</h3>

                <p>James Reason's organizational accident model describes how latent conditions accumulate silently within complex systems until active failures align to produce catastrophic outcomes.<a href="#ref-section" class="src-ref">[1]</a> Vendor dependency creates precisely this type of latent condition. Each time an incident is resolved by calling the vendor rather than developing internal understanding, the organization loses a learning opportunity. Each learning opportunity lost makes future vendor dependency more entrenched. This creates what Peter Senge would recognize as a "shifting the burden" archetype — a systemic pattern where a symptomatic solution (vendor callout) undermines the fundamental solution (capability building).<a href="#ref-section" class="src-ref">[9]</a></p>

                <p>The competence erosion cycle operates through four reinforcing mechanisms:</p>

                <ul>
                    <li><strong>Skill atrophy:</strong> Internal technicians who never troubleshoot complex failures lose the diagnostic reasoning skills that distinguish competent practitioners from procedure-followers. Hollnagel's Safety-II framework emphasizes that resilience depends on the ability to adapt — a capacity that atrophies without exercise.<a href="#ref-section" class="src-ref">[2]</a></li>
                    <li><strong>Knowledge externalization:</strong> Site-specific operational knowledge — the behavioral quirks of aging equipment, the environmental sensitivities of particular <span class="tip" data-tip="Heating, Ventilation, and Air Conditioning — climate control systems critical to maintaining data center environmental conditions">HVAC</span> zones, the interaction effects between subsystems — migrates from the organization to the vendor's field engineers. When those engineers change roles or companies, the knowledge evaporates entirely.</li>
                    <li><strong>Confidence degradation:</strong> Operators who consistently escalate to vendors develop learned helplessness around complex technical issues. They begin to self-censor diagnostic hypotheses, defaulting to "call the vendor" even when they possess sufficient information to initiate effective troubleshooting. This psychological withdrawal from technical engagement compounds the skill atrophy mechanism.</li>
                    <li><strong>Institutional normalization:</strong> Over successive management cycles, vendor dependency becomes embedded in budgets, procedures, and organizational expectations. New engineers are socialized into an environment where calling the vendor is "what we do" — not a recognized gap but an accepted practice. The dependency becomes invisible precisely because it is ubiquitous.</li>
                </ul>

                <h3>2.2 The Hidden Cost Structure</h3>

                <p>The financial impact of vendor dependency extends far beyond direct callout fees. The Uptime Institute's 2023 Annual Outage Analysis found that the average cost of a significant data center outage exceeded $100,000, with 25% of outages costing over $1 million.<a href="#ref-section" class="src-ref">[6]</a> While these costs are attributed to the outage itself, decomposition reveals that the duration of the outage — and therefore its cost — is substantially determined by the response model employed. A vendor-dependent response model systematically extends outage duration through mobilization delays, communication overhead, and diagnostic ramp-up time that an in-house team would not incur.</p>

                <div class="info-box warning">
                    <div class="info-box-title">Warning: The 2 AM Test</div>
                    <p>Ask yourself: if your most critical system fails at 2:00 AM on a national holiday, how many hours pass before a qualified technician arrives on site? If the answer exceeds 1 hour, you have a reliability problem that no SLA document can solve. Vendor SLAs guarantee response, not resolution. The gap between those two concepts is where downtime costs accumulate.</p>
                </div>

                <!-- Section 3: The Reliability Cost of External Dependency -->
                <h2 id="section-3">
                    <span class="section-number">3</span>
                    The Reliability Cost of External Dependency
                </h2>

                <p>To quantify the reliability impact of vendor dependency, we must move beyond aggregate MTTR statistics and examine the internal structure of the repair cycle. Traditional reliability engineering treats MTTR as a single variable — a useful simplification for system-level availability calculations but dangerously opaque for operational improvement. When MTTR is decomposed into its constituent phases, the contribution of vendor dependency to total downtime becomes starkly visible.<a href="#ref-section" class="src-ref">[5]</a></p>

                <h3>3.1 MTTR as a Composite Metric</h3>

                <p>The <span class="tip" data-tip="Mean Time Between Failures — the predicted elapsed time between inherent failures of a mechanical or electronic system during normal operation">MTBF</span> of critical infrastructure components is largely determined by equipment design, manufacturing quality, and environmental conditions — factors that the operations team can influence through <a href="article-3.html">preventive maintenance</a> and environmental control but cannot fundamentally alter. MTTR, by contrast, is almost entirely determined by organizational capability and response architecture. It is the variable that operational leaders can most directly improve, yet it is often the least well understood.</p>

                <div class="formula-box">
                    <div class="formula-label">System Availability Equation</div>
                    <div class="formula">A = MTBF / (MTBF + MTTR)</div>
                    <div class="formula-label">For MTBF = 8,760 hrs and MTTR = 6.75 hrs (vendor): A = 99.923%<br>
                    For MTBF = 8,760 hrs and MTTR = 2.80 hrs (in-house): A = 99.968%</div>
                </div>

                <p>This difference of 0.045 percentage points may appear trivial in abstract terms, but it translates to a reduction of approximately 35 hours of annual downtime across the facility's critical systems. At $9,000 per hour of downtime cost, this represents $315,000 in annual risk reduction — from a single operational variable that costs nothing to improve except organizational commitment and training investment.<a href="#ref-section" class="src-ref">[13]</a></p>

                <h3>3.2 The Mobilization Bottleneck</h3>

                <p>Analysis of 428 critical incident records across three calendar years reveals a consistent pattern: vendor mobilization time represents 45-65% of total MTTR for vendor-dependent responses. This finding holds across incident categories (electrical, mechanical, controls, fire protection) and across severity levels. The mobilization phase — the time between deciding to engage the vendor and the vendor's qualified technician arriving on site with appropriate tools and parts — is consistently the dominant delay in the repair cycle.<a href="#ref-section" class="src-ref">[12]</a></p>

                <p>This finding has profound implications. The technical phases of repair — diagnosis, physical repair, and verification — are subject to genuine uncertainty. Equipment failures can be complex, intermittent, and diagnostically challenging. But mobilization delay is not technical uncertainty. It is logistical latency — the time required for a human being to receive a phone call, understand the situation, gather tools, travel to a site, badge through security, and reach the affected equipment. This time is largely fixed regardless of incident complexity and represents pure waste from the facility's perspective.</p>

                <div class="key-insight">
                    <strong>Operational Reality</strong>
                    A vendor with a 4-hour SLA response guarantee will, on average, deliver a qualified technician in 4.2 hours. An in-house technician, already badged and present on site, can reach the affected equipment in 15 minutes. This 3.95-hour difference, multiplied across 36 annual critical incidents, represents 142 hours of pure mobilization delay — time during which the failure is acknowledged but no repair action is taking place.
                </div>

                <!-- Section 4: MTTR Decomposition Analysis -->
                <h2 id="section-4">
                    <span class="section-number">4</span>
                    MTTR Decomposition Analysis
                </h2>

                <p>The five-phase MTTR decomposition model provides a granular framework for understanding where time is consumed during incident response. Each phase has distinct characteristics, different contributing factors, and different improvement levers. By analyzing each phase independently, we can identify precisely where vendor dependency creates delay and where in-house capability delivers its greatest impact.</p>

                <h3>4.1 Phase 1: Detection</h3>

                <p>Detection encompasses the time from fault occurrence to organizational awareness. In modern data centers equipped with <span class="tip" data-tip="Computerized Maintenance Management System — software that centralizes maintenance information and facilitates asset management and work order processes">CMMS</span> and BMS integration, detection of major failures is typically rapid — alarm systems, monitoring platforms, and automated notification chains can identify and escalate critical faults within minutes. Detection time is largely determined by monitoring infrastructure quality and alarm configuration, not by the response model. Both vendor-dependent and in-house response models benefit equally from effective monitoring systems.</p>

                <p>Typical detection times range from 0.1 to 0.5 hours depending on the failure mode. Electrical faults that trigger protective devices are detected almost instantly through BMS alarms. Mechanical degradation (bearing wear, refrigerant leaks, belt slippage) may take longer to reach alarm thresholds. Controls system anomalies that do not trigger discrete alarms may rely on operator observation during routine monitoring rounds.</p>

                <h3>4.2 Phase 2: Diagnosis</h3>

                <p>Diagnosis encompasses the time from awareness to understanding — the cognitive work of determining what has failed, why it has failed, and what repair action is required. This phase is heavily influenced by the diagnostic competence of the responding personnel. Weick and Sutcliffe's concept of "mindful organizing" emphasizes that reliable organizations cultivate sensitivity to operations — an ongoing awareness of system state that enables rapid, accurate diagnosis when anomalies occur.<a href="#ref-section" class="src-ref">[3]</a></p>

                <p>For vendor-dependent responses, the diagnostic phase is effectively doubled: the internal operator must first perform enough diagnosis to describe the problem to the vendor dispatcher, who then relays this information (with inevitable information loss) to the field technician. The field technician arrives on site and must independently verify the diagnosis, often starting from scratch because the initial description was incomplete or filtered through non-technical communication channels. This diagnostic redundancy is inherent to the vendor model.</p>

                <h3>4.3 Phase 3: Mobilization</h3>

                <p>Mobilization is the time from the decision to engage a resource to that resource being physically present and ready to work at the point of failure. For vendor-dependent responses, this includes call center processing, technician dispatch, travel time, site access procedures, and equipment staging. For in-house responses, mobilization is reduced to walking from the workshop to the equipment location — typically 10-15 minutes in a well-organized facility.</p>

                <p>This phase represents the fundamental structural advantage of in-house capability. No amount of vendor SLA optimization, preferred response agreements, or geographic proximity strategies can eliminate the irreducible minimum mobilization time for an external resource. Even under the most favorable conditions — vendor depot located adjacent to the data center, technician on standby, pre-staged parts and tools — external mobilization requires at minimum 30-45 minutes. Typical mobilization times under standard vendor SLA agreements range from 2 to 8 hours.</p>

                <h3>4.4 Phase 4: Repair</h3>

                <p>Repair encompasses the physical work of restoring the failed system to operational status. This phase is influenced by the technician's familiarity with the specific equipment, availability of spare parts and specialized tools, complexity of the failure mode, and the technician's manual skill level. In-house technicians who work with the same equipment daily develop equipment-specific expertise that reduces repair time. They know the routing of cables, the location of isolation points, the torque specifications of critical fasteners, and the behavioral idiosyncrasies of aging equipment — knowledge that a rotating vendor field force cannot match.</p>

                <h3>4.5 Phase 5: Verification</h3>

                <p>Verification encompasses the time from physical repair completion to confirmed system restoration. This includes functional testing, load testing where applicable, alarm clearance, BMS point verification, and operational handoff documentation. Verification time is influenced by the complexity of the repaired system and the thoroughness of the testing protocol. Both vendor and in-house models should allocate equivalent verification time, although in-house teams with intimate system knowledge may identify verification shortcuts (safe ones) that reduce this phase.</p>

                <h3>4.6 Comparative Decomposition Table</h3>

                <div class="data-table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Phase</th>
                                <th>Vendor MTTR (hrs)</th>
                                <th>In-House MTTR (hrs)</th>
                                <th>Delta</th>
                                <th>% Reduction</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>1. Detection</strong></td>
                                <td>0.25</td>
                                <td>0.25</td>
                                <td>0.00</td>
                                <td>0%</td>
                            </tr>
                            <tr>
                                <td><strong>2. Diagnosis</strong></td>
                                <td>0.50</td>
                                <td>0.40</td>
                                <td>0.10</td>
                                <td>20%</td>
                            </tr>
                            <tr>
                                <td><strong>3. Mobilization</strong></td>
                                <td>4.00</td>
                                <td>0.25</td>
                                <td>3.75</td>
                                <td>94%</td>
                            </tr>
                            <tr>
                                <td><strong>4. Repair</strong></td>
                                <td>1.50</td>
                                <td>1.20</td>
                                <td>0.30</td>
                                <td>20%</td>
                            </tr>
                            <tr>
                                <td><strong>5. Verification</strong></td>
                                <td>0.50</td>
                                <td>0.50</td>
                                <td>0.00</td>
                                <td>0%</td>
                            </tr>
                            <tr style="font-weight: 700; background: var(--table-stripe);">
                                <td><strong>Total MTTR</strong></td>
                                <td><strong>6.75 hrs</strong></td>
                                <td><strong>2.60 hrs</strong></td>
                                <td><strong>4.15 hrs</strong></td>
                                <td><strong>61%</strong></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <p>The data is unambiguous: mobilization accounts for 59% of total vendor MTTR (4.00 of 6.75 hours) and represents 90% of the total improvement opportunity (3.75 of 4.15 hours saved). Every other phase — detection, diagnosis, repair, verification — contributes marginal improvements when transitioning to an in-house model. The mobilization phase alone drives the fundamental shift in reliability performance.<a href="#ref-section" class="src-ref">[5]</a></p>

                <!-- Article Image 2 -->
                <figure style="margin: 2rem 0; text-align: center;">
                    <img src="Article/Article_4 02.02.26/4.2.jpg" alt="Vendor response patterns and MTTR decomposition for fire suppression system maintenance" loading="lazy" style="max-width: 100%; height: auto; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);" decoding="async">
                </figure>

                <!-- Section 5: Vendor Response Patterns -->
                <h2 id="section-5">
                    <span class="section-number">5</span>
                    Vendor Response Patterns
                </h2>

                <p>Understanding vendor response behavior requires moving beyond SLA contractual terms to examine actual field performance. SLA documents specify maximum response times, but they do not guarantee qualified responses. The distinction between "response" (acknowledging the service request) and "resolution" (arriving on site prepared to work) is a persistent source of confusion and frustration for data center operators.</p>

                <h3>5.1 SLA vs. Actual Response Analysis</h3>

                <p>Analysis of 312 vendor callout records over a 30-month period reveals systematic patterns in response behavior:</p>

                <div class="data-table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>SLA Category</th>
                                <th>Contracted Response</th>
                                <th>Actual Avg. Response</th>
                                <th>95th Percentile</th>
                                <th>SLA Compliance</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Critical (P1)</td>
                                <td>4 hrs</td>
                                <td>4.2 hrs</td>
                                <td>7.8 hrs</td>
                                <td>82%</td>
                            </tr>
                            <tr>
                                <td>High (P2)</td>
                                <td>8 hrs</td>
                                <td>9.1 hrs</td>
                                <td>16.5 hrs</td>
                                <td>74%</td>
                            </tr>
                            <tr>
                                <td>Medium (P3)</td>
                                <td>24 hrs</td>
                                <td>18.3 hrs</td>
                                <td>36.0 hrs</td>
                                <td>85%</td>
                            </tr>
                            <tr>
                                <td>Low (P4)</td>
                                <td>48 hrs</td>
                                <td>32.7 hrs</td>
                                <td>72.0 hrs</td>
                                <td>89%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <p>Several patterns warrant attention. First, average response times for critical (P1) incidents marginally exceed the SLA commitment (4.2 vs. 4.0 hours), but the 95th percentile extends to nearly 8 hours — meaning that 1 in 20 critical incidents experiences a response delay of nearly double the contracted maximum. Second, SLA compliance rates for high-priority incidents (74%) are notably lower than for low-priority incidents (89%), suggesting that vendor resource allocation struggles precisely when the facility most needs reliable response.</p>

                <h3>5.2 The "First-Available" Problem</h3>

                <p>Vendor service organizations operate on a "first-available technician" dispatch model. When a critical callout is received, the dispatcher assigns the nearest available technician — not the most qualified technician, not the technician most familiar with the site, but the technician whose calendar shows an opening. This dispatch model creates a persistent quality variance in response capability.</p>

                <p>The "first-available" technician may be a 20-year veteran intimately familiar with the specific equipment model and the site's installation peculiarities, or may be a recently certified technician encountering the equipment configuration for the first time. The facility has no control over which technician appears. This unpredictability in response quality adds variance to already-uncertain repair timelines, compounding the reliability risk.<a href="#ref-section" class="src-ref">[8]</a></p>

                <div class="info-box critical">
                    <div class="info-box-title">Critical Finding: Weekend and Holiday Response</div>
                    <p>Analysis reveals that vendor response times during weekends and public holidays are 2.3x longer than weekday business hours. The average P1 response during off-hours is 6.8 hours (vs. 3.4 hours during business hours). Since critical infrastructure failures do not observe business hours, this pattern means that facilities are most vulnerable precisely when vendor response is slowest — a structural misalignment between risk exposure and response capability.</p>
                </div>

                <h3>5.3 The Knowledge Asymmetry</h3>

                <p>Each vendor callout involves a knowledge transfer overhead that in-house responses avoid entirely. The arriving vendor technician must be briefed on the current system state, recent maintenance history, any upstream or downstream impacts, environmental conditions, and operational constraints. This briefing takes 15-30 minutes and is subject to information loss, misinterpretation, and incomplete communication. In-house technicians who operate the systems daily carry this contextual knowledge as ambient awareness — it does not need to be explicitly transferred because it was never externalized.</p>

                <p>Charles Perrow's "Normal Accidents" theory emphasizes that tight coupling and interactive complexity in critical systems create conditions where small failures can cascade into system-level events.<a href="#ref-section" class="src-ref">[10]</a> The knowledge asymmetry between vendor technicians and the installed system increases the probability of diagnostic errors, inappropriate repair actions, and cascading failures during the restoration process. Woods et al. characterize this as a gap between "work as imagined" (the vendor's generic service procedures) and "work as done" (the site-specific reality of operating complex, aging infrastructure).<a href="#ref-section" class="src-ref">[11]</a></p>

                <!-- Section 6: Case Context -->
                <h2 id="section-6">
                    <span class="section-number">6</span>
                    Case Context
                </h2>

                <p>The operational data and intervention results presented in this paper are drawn from a 10MW colocation data center facility operating at Tier III equivalent redundancy. The facility supports approximately 2,400 cabinet positions across four data halls, serving a mixed client base of financial services, healthcare, telecommunications, and cloud service providers.</p>

                <h3>6.1 Facility Profile</h3>

                <ul>
                    <li><strong>Total IT Load:</strong> 10 MW across 4 data halls (2.5 MW each)</li>
                    <li><strong>Cooling Infrastructure:</strong> Chilled water system with N+1 chillers, <span class="tip" data-tip="Computer Room Air Handler — a device that monitors and maintains temperature, air distribution and humidity in a data center">CRAH</span> units per hall</li>
                    <li><strong>Power Infrastructure:</strong> 2N UPS configuration, dual utility feeds, N+1 diesel generators</li>
                    <li><strong>Fire Suppression:</strong> Pre-action sprinkler with VESDA early warning detection</li>
                    <li><strong>BMS/Controls:</strong> Integrated <span class="tip" data-tip="Building Management System — centralized control system for monitoring and managing building mechanical and electrical equipment">BMS</span> with 4,200+ monitoring points</li>
                    <li><strong>Staff Model:</strong> 24/7 operations with 3-shift rotation, 12 FTE operations team</li>
                </ul>

                <h3>6.2 Incident Profile</h3>

                <p>Over the three-year analysis period, the facility recorded an average of 36 critical incidents per year — incidents requiring immediate response to prevent or mitigate impact on client services. The incident distribution by category was:</p>

                <div class="data-table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Annual Incidents</th>
                                <th>% of Total</th>
                                <th>Avg. Vendor MTTR</th>
                                <th>Avg. Downtime Cost</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Electrical</td>
                                <td>14</td>
                                <td>39%</td>
                                <td>6.75 hrs</td>
                                <td>$60,750</td>
                            </tr>
                            <tr>
                                <td>Mechanical</td>
                                <td>10</td>
                                <td>28%</td>
                                <td>7.75 hrs</td>
                                <td>$69,750</td>
                            </tr>
                            <tr>
                                <td>Controls</td>
                                <td>8</td>
                                <td>22%</td>
                                <td>6.90 hrs</td>
                                <td>$62,100</td>
                            </tr>
                            <tr>
                                <td>Fire Protection</td>
                                <td>4</td>
                                <td>11%</td>
                                <td>7.10 hrs</td>
                                <td>$63,900</td>
                            </tr>
                            <tr style="font-weight: 700; background: var(--table-stripe);">
                                <td><strong>Total</strong></td>
                                <td><strong>36</strong></td>
                                <td><strong>100%</strong></td>
                                <td><strong>7.05 hrs avg</strong></td>
                                <td><strong>$256,500</strong></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h3>6.3 Cost Parameters</h3>

                <p>The facility operates under the following cost parameters, derived from client SLA penalties, operational overhead, and revenue impact analysis:</p>

                <ul>
                    <li><strong>Downtime cost per hour:</strong> $9,000 (weighted average across client base, including SLA penalties, revenue loss, and reputational impact)</li>
                    <li><strong>Average vendor callout cost:</strong> $2,500 per incident (including emergency response premium, labor, travel, and standard parts)</li>
                    <li><strong>Annual vendor maintenance contract:</strong> $180,000 (covering all four infrastructure categories)</li>
                    <li><strong>Annual critical incident vendor costs:</strong> 36 incidents x $2,500 = $90,000 (reactive callouts only, beyond contract scope)</li>
                </ul>

                <p>The total annual cost of vendor-dependent incident response — including both the direct vendor costs ($90,000 in callouts) and the indirect downtime costs ($256,500 from extended MTTR) — represents a significant and largely preventable operational expense. This cost baseline establishes the financial context for evaluating the capability building investment proposed in subsequent sections.<a href="#ref-section" class="src-ref">[7]</a></p>

                <div class="info-box success">
                    <div class="info-box-title">Key Metric: Annual Cost of Vendor Dependency</div>
                    <p>Total annual cost attributable to vendor-dependent response model: <strong>$346,500</strong> ($256,500 downtime + $90,000 callouts). This figure excludes the base maintenance contract ($180,000) which would be partially retained under an in-house model for <span class="tip" data-tip="Original Equipment Manufacturer — the company that originally manufactured the equipment, often providing specialized maintenance and spare parts">OEM</span>-specific warranty work and Tier 4 specialist escalations.</p>
                </div>

                <!-- Section 7: Capability Layering Intervention -->
                <h2 id="section-7">
                    <span class="section-number">7</span>
                    Capability Layering Intervention
                </h2>

                <p>The capability layering model provides a structured framework for distributing incident response competence across four tiers of increasing specialization. Rather than attempting to replace vendor capability entirely — an impractical and uneconomical objective — the model strategically builds internal competence at the tiers where the greatest MTTR reduction can be achieved, while preserving vendor engagement for genuinely specialized requirements.</p>

                <p>The four-tier model draws conceptually from the incident command system used in emergency management, adapted for the specific characteristics of data center infrastructure operations. Each tier is defined by competence scope, response time expectation, typical incident types, and organizational role.<a href="#ref-section" class="src-ref">[3]</a></p>

                <div class="tier-grid">
                    <div class="tier-card t1">
                        <div class="tier-label">Tier 1</div>
                        <h4>Operator Response</h4>
                        <p><strong>Response: &lt;5 min</strong><br>First responders. Alarm acknowledgment, initial assessment, safe isolation, standard operating procedures. Handles 35% of incidents without escalation. Staffed 24/7 as part of normal operations shift.</p>
                    </div>
                    <div class="tier-card t2">
                        <div class="tier-label">Tier 2</div>
                        <h4>In-House Technician</h4>
                        <p><strong>Response: 15-30 min</strong><br>Trained specialists. Diagnostic troubleshooting, component replacement, system restoration, performance verification. Handles 45% of incidents. On-call rotation with 30-min response guarantee.</p>
                    </div>
                    <div class="tier-card t3">
                        <div class="tier-label">Tier 3</div>
                        <h4>Internal Specialist</h4>
                        <p><strong>Response: 1-2 hrs</strong><br>Senior engineers with deep domain expertise. Complex root cause analysis, multi-system failures, <span class="tip" data-tip="Management of Change — a systematic approach to dealing with changes to processes, equipment, or procedures to ensure safety and reliability">MoC</span> implementations. Handles 15% of incidents. Available during business hours with on-call coverage.</p>
                    </div>
                    <div class="tier-card t4">
                        <div class="tier-label">Tier 4</div>
                        <h4>OEM Vendor</h4>
                        <p><strong>Response: 4-8 hrs (SLA)</strong><br>Manufacturer specialists for warranty work, firmware updates, proprietary system failures, and catastrophic equipment replacement. Handles 5% of incidents. Engaged through formal vendor management process.</p>
                    </div>
                </div>

                <h3>7.1 Tier Distribution Impact</h3>

                <p>The critical insight of the layering model is not that it eliminates vendor involvement but that it dramatically reduces the frequency of vendor engagement. Before the intervention, 100% of incidents beyond Tier 1 operator response triggered a vendor callout. After implementing the capability layering model, vendor engagement dropped to approximately 20% of total incidents (Tier 3 escalations at 15% and Tier 4 OEM requirements at 5%).</p>

                <p>This 80% reduction in vendor callouts directly addresses the mobilization bottleneck identified in Section 4. For the 80% of incidents resolved at Tier 1 or Tier 2, mobilization time drops from an average of 4.2 hours to 0.25 hours — a 94% reduction in the dominant MTTR component. The remaining 20% of incidents that still require vendor involvement benefit from improved Tier 1 and Tier 2 preparation: better initial diagnosis, more complete information handoff, and pre-staged isolation and access — reducing even vendor-dependent MTTR by 15-20%.</p>

                <h3>7.2 Competence Requirements by Tier</h3>

                <p>Each tier requires specific competence profiles that must be systematically developed and maintained. The <span class="tip" data-tip="Reliability-Centered Maintenance — a process to ensure assets continue to do what their users require in their present operating context">RCM</span> and <span class="tip" data-tip="Condition-Based Maintenance — maintenance performed based on real-time monitoring of asset condition rather than predetermined schedules">CBM</span> disciplines inform the knowledge architecture required at each level:</p>

                <ul>
                    <li><strong>Tier 1 Operators</strong> require comprehensive alarm interpretation skills, safe isolation procedures for all critical systems, and clear escalation criteria. They must understand system architecture at a conceptual level — not enough to repair, but enough to assess severity, communicate clearly to Tier 2, and initiate appropriate protective actions.</li>
                    <li><strong>Tier 2 Technicians</strong> require diagnostic troubleshooting competence across their assigned domains (electrical, mechanical, or controls), component-level repair skills, system restoration procedures, and equipment-specific knowledge. They must be competent to work independently on 90% of common failure modes within their domain.</li>
                    <li><strong>Tier 3 Specialists</strong> require deep engineering knowledge, cross-domain understanding, root cause analysis methodology, and the judgment to determine when a failure mode exceeds internal capability and requires OEM engagement. They serve as the quality gate between in-house resolution and vendor escalation.</li>
                    <li><strong>Tier 4 Vendor Engineers</strong> provide proprietary system expertise, warranty-covered repairs, firmware and software updates, and catastrophic failure response. Vendor engagement at this tier is not a reliability gap — it is appropriate utilization of specialized external competence.</li>
                </ul>

                <div class="key-insight">
                    <strong>The 80/20 Principle in Practice</strong>
                    80% of critical incidents involve failure modes that are well-understood, repeatedly encountered, and technically within the competence of properly trained in-house personnel. Only 20% of incidents genuinely require the specialized knowledge or proprietary access that vendor engagement provides. The capability layering model aligns organizational competence with this distribution, eliminating the default vendor escalation that adds hours of delay to the majority of incidents.
                </div>

                <!-- Section 8: ICB Framework -->
                <h2 id="section-8">
                    <span class="section-number">8</span>
                    ICB Framework
                </h2>

                <p>The In-house Capability Building (ICB) framework provides a systematic methodology for developing the internal competence required by the capability layering model. The framework consists of five sequential phases — Assess, Train, Equip, Certify, Practice — that transform an organization's capability profile from vendor-dependent to self-reliant over a 12-18 month implementation period.<a href="#ref-section" class="src-ref">[4]</a></p>

                <div class="icb-steps">
                    <div class="icb-step">
                        <div class="icb-step-num">1</div>
                        <h4>Assess</h4>
                        <p>Gap analysis of current vs. required competencies</p>
                    </div>
                    <div class="icb-step">
                        <div class="icb-step-num">2</div>
                        <h4>Train</h4>
                        <p>Structured learning programs by tier and domain</p>
                    </div>
                    <div class="icb-step">
                        <div class="icb-step-num">3</div>
                        <h4>Equip</h4>
                        <p>Tools, test equipment, spare parts inventory</p>
                    </div>
                    <div class="icb-step">
                        <div class="icb-step-num">4</div>
                        <h4>Certify</h4>
                        <p>Competence validation through practical assessment</p>
                    </div>
                    <div class="icb-step">
                        <div class="icb-step-num">5</div>
                        <h4>Practice</h4>
                        <p>Regular drills and scenario exercises</p>
                    </div>
                </div>

                <h3>8.1 Phase 1: Assess</h3>

                <p>The assessment phase maps current organizational competence against the requirements defined by the capability layering model. This involves a structured skills audit of all operations personnel, documentation of current vendor dependencies by equipment type and failure mode, and analysis of historical incident records to identify the most frequent failure modes that drive vendor callouts. The assessment typically reveals that 60-70% of vendor callouts involve failure modes that internal staff could resolve with appropriate training and tooling — confirming the opportunity for capability internalization.</p>

                <h3>8.2 Phase 2: Train</h3>

                <p>Training is structured by tier and domain, progressing from foundational knowledge through practical skill development to independent competence. The training architecture includes formal classroom instruction (manufacturer training courses, industry certifications such as <span class="tip" data-tip="National Fire Protection Association — an organization that creates and maintains standards and codes for fire prevention and electrical safety">NFPA</span> 70E electrical safety, refrigerant handling certifications), structured on-the-job training under mentorship of experienced engineers, and vendor-facilitated knowledge transfer sessions where OEM field engineers share equipment-specific diagnostic techniques during routine maintenance visits.<a href="#ref-section" class="src-ref">[14]</a></p>

                <h3>8.3 Phase 3: Equip</h3>

                <p>Capability without tooling is theoretical. The Equip phase ensures that trained personnel have access to the diagnostic instruments, specialized tools, test equipment, and critical spare parts required to execute the repair competencies developed in the training phase. This includes investment in thermal imaging cameras, power quality analyzers, vibration monitoring equipment, refrigerant recovery systems, and a strategically selected spare parts inventory covering the most common failure components identified during the assessment phase.<a href="#ref-section" class="src-ref">[12]</a></p>

                <h3>8.4 Phase 4: Certify</h3>

                <p>Certification provides formal validation that trained personnel have achieved the competence standards required for their assigned tier. This is not a checkbox exercise — it involves practical assessment under realistic conditions, including supervised handling of actual equipment maintenance and simulated fault scenarios. Certification must be renewed periodically (typically annually) to ensure that competencies are maintained and updated as equipment ages and operational procedures evolve. The <span class="tip" data-tip="Automatic Transfer Switch — a device that automatically transfers electrical power from a primary source to a standby source when the primary source fails">ATS</span> switching procedures, for example, require periodic recertification as firmware updates alter operational characteristics.</p>

                <h3>8.5 Phase 5: Practice</h3>

                <p>Competence decays without exercise. The Practice phase establishes a regular cadence of drills, scenario exercises, and tabletop simulations that maintain and sharpen the skills developed through training and certified through assessment. Practice scenarios are drawn from historical incident records and escalation logs, creating a feedback loop between operational experience and capability development. Monthly drill exercises for Tier 1 operators and quarterly scenario exercises for Tier 2 technicians ensure that response competence remains current and reflexive rather than theoretical.</p>

                <div class="info-box">
                    <div class="info-box-title">ICB Implementation Timeline</div>
                    <p><strong>Months 1-3:</strong> Assess phase — skills audit, vendor dependency mapping, incident analysis. <strong>Months 4-8:</strong> Train phase — structured training delivery across all tiers. <strong>Months 6-10:</strong> Equip phase (overlapping with Train) — tooling procurement, spare parts inventory build. <strong>Months 9-12:</strong> Certify phase — practical competence assessment. <strong>Month 12+:</strong> Practice phase — ongoing drills and continuous improvement. Full capability maturity typically achieved at 18 months.</p>
                </div>

                <!-- Section 9: Interactive MTTR Canvas -->
                <h2 id="section-9">
                    <span class="section-number">9</span>
                    Interactive MTTR Canvas
                </h2>

                <p>The following interactive visualization demonstrates how in-house skill level affects MTTR compared to vendor-dependent response. Adjust the skill level slider to see how increasing internal competence progressively reduces each phase of the repair cycle, with the most dramatic improvement occurring in the mobilization and diagnostic phases.</p>

                <div class="chart-container">
                    <div class="chart-title">MTTR Comparison: Vendor vs In-House by Skill Level</div>
                    <div class="chart-subtitle">Adjust skill level to see impact on each repair phase (Electrical category)</div>
                    <div class="chart-wrapper">
                        <canvas id="mttrCanvas" class="chart-canvas" width="800" height="360"></canvas>
                    </div>
                    <div class="control-row">
                        <span class="control-label">In-House Skill Level:</span>
                        <input type="range" id="skillSlider" class="control-slider" min="1" max="5" value="3" step="1">
                        <span class="control-value" id="skillValue">3 — Competent</span>
                    </div>
                    <div class="callout-row">
                        <div class="callout-card">
                            <div class="callout-label">Vendor MTTR</div>
                            <div class="callout-value" id="canvasVendorMTTR">6.75h</div>
                        </div>
                        <div class="callout-card">
                            <div class="callout-label">In-House MTTR</div>
                            <div class="callout-value" id="canvasInhouseMTTR" style="color: #10b981;">2.75h</div>
                        </div>
                        <div class="callout-card">
                            <div class="callout-label">Time Saved</div>
                            <div class="callout-value" id="canvasTimeSaved" style="color: #f59e0b;">4.00h</div>
                        </div>
                        <div class="callout-card">
                            <div class="callout-label">% Reduction</div>
                            <div class="callout-value" id="canvasReduction" style="color: #06b6d4;">59%</div>
                        </div>
                    </div>
                </div>

                <!-- Section 10: Calculator -->
                <div class="calculator-section" id="section-10">
                    <h2>
                        <span class="section-number">10</span>
                        Capability vs MTTR Analyzer
                    </h2>

                    <p style="color: #94a3b8; margin-bottom: 1.5rem;">Configure your facility parameters to compare vendor-dependent vs in-house MTTR, annual costs, and ROI from capability building investment.</p>

                    <!-- Mode Toggle + Action Buttons -->
                    <div class="mode-toolbar-row">
                        <div class="mode-toggle">
                            <button class="mode-btn active" id="modeFree" onclick="switchCalcMode('free')"><i class="fas fa-chart-simple"></i> Free Assessment</button>
                            <button class="mode-btn" id="modePro" onclick="switchCalcMode('pro')"><i class="fas fa-microscope"></i> Pro Analysis <span class="gated-badge" id="proBadge">PRO</span></button>
                        </div>
                        <div class="mode-toolbar-actions">
                            <button class="pdf-btn" id="pdfBtn" disabled onclick="exportMTTRPDF()" style="padding:8px 14px;font-size:0.78rem;margin:0;"><i class="fas fa-file-pdf"></i> Export PDF</button>
                        </div>
                    </div>

                    <!-- CTA Card -->
                    <div class="cta-card" id="ctaCard">
                        <div class="cta-icon"><i class="fas fa-flask"></i></div>
                        <div>
                            <h4>Unlock Decision-Grade MTTR Analytics</h4>
                            <p>Pro Analysis adds Monte Carlo uncertainty bounds, Erlang-C staffing model, availability calculations, scenario sensitivity, and narrative PDF export with 26 advanced KPIs.</p>
                        </div>
                    </div>

                    <div id="calc-tooltip-container"></div>

                    <div class="calc-grid">
                        <div class="calc-input-group">
                            <label class="calc-label">Incident Category <span class="tooltip-trigger">?<span class="tooltip-content"><div class="tooltip-title">Infrastructure Domain</div><div class="tooltip-desc">Select the primary incident category. Each domain has distinct MTTR phase baselines derived from industry data: Electrical (UPS, PDU, switchgear), Mechanical (HVAC, chillers, CRAH), Controls (BMS, PLC, sensors), Fire Protection (suppression, VESDA, detection).</div><div class="tooltip-formula">Ref: IEEE 493 Gold Book — category-specific failure/repair distributions</div></span></span></label>
                            <select id="calcCategory" class="calc-select">
                                <option value="Electrical" selected>Electrical</option>
                                <option value="Mechanical">Mechanical</option>
                                <option value="Controls">Controls</option>
                                <option value="Fire Protection">Fire Protection</option>
                            </select>
                        </div>
                        <div class="calc-input-group">
                            <label class="calc-label">Vendor SLA Hours <span class="tooltip-trigger">?<span class="tooltip-content"><div class="tooltip-title">Contracted Response Time</div><div class="tooltip-desc">Maximum guaranteed time for vendor technician to arrive on-site after dispatch. This drives the Mobilization phase of vendor MTTR. Note: SLA guarantees arrival, not resolution. Actual response may vary ±40% based on time-of-day and resource availability.</div><div class="tooltip-formula">Typical P1: 4h | P2: 8h | P3: 24h | P4: 48h</div></span></span></label>
                            <input type="number" id="calcVendorSLA" class="calc-input" value="4" min="1" max="24" step="0.5">
                        </div>
                        <div class="calc-input-group">
                            <label class="calc-label">In-House Skill Level <span class="tooltip-trigger">?<span class="tooltip-content"><div class="tooltip-title">Team Competence Tier</div><div class="tooltip-desc">Average diagnostic and repair competence of in-house technicians. Affects Diagnosis and Repair phase durations via a skill factor multiplier. L1 Novice: follow SOPs only. L3 Competent: independent troubleshooting. L5 Expert: root cause analysis, cross-domain.</div><div class="tooltip-formula">Skill Factor: L1=1.50x | L2=1.20x | L3=1.00x | L4=0.75x | L5=0.55x</div></span></span></label>
                            <select id="calcSkillLevel" class="calc-select">
                                <option value="1">1 — Novice</option>
                                <option value="2" selected>2 — Basic</option>
                                <option value="3">3 — Competent</option>
                                <option value="4">4 — Proficient</option>
                                <option value="5">5 — Expert</option>
                            </select>
                        </div>
                        <div class="calc-input-group">
                            <label class="calc-label">Annual Incidents <span class="tooltip-trigger">?<span class="tooltip-content"><div class="tooltip-title">Critical Incident Frequency</div><div class="tooltip-desc">Total critical incidents per year requiring immediate response. Drives annual downtime and cost calculations. A 10MW colocation facility typically experiences 30-50 critical incidents/year across all infrastructure domains.</div><div class="tooltip-formula">Ref: Uptime Institute 2023 — median critical incident frequency for Tier III facilities</div></span></span></label>
                            <input type="number" id="calcIncidents" class="calc-input" value="36" min="1" max="200">
                        </div>
                        <div class="calc-input-group">
                            <label class="calc-label">Downtime Cost / Hour ($) <span class="tooltip-trigger">?<span class="tooltip-content"><div class="tooltip-title">Hourly Outage Cost</div><div class="tooltip-desc">Weighted average cost per hour of downtime including SLA penalties, revenue loss, reputational impact, and operational overhead. Varies significantly by client mix and facility tier. Range: $1,000 (enterprise) to $100,000+ (financial services).</div><div class="tooltip-formula">Ref: Uptime Institute 2023 — average significant outage cost >$100K</div></span></span></label>
                            <input type="number" id="calcCostHour" class="calc-input" value="9000" min="100" step="500">
                        </div>
                        <div class="calc-input-group">
                            <label class="calc-label">Vendor Callout Cost ($) <span class="tooltip-trigger">?<span class="tooltip-content"><div class="tooltip-title">Per-Incident Vendor Fee</div><div class="tooltip-desc">Direct cost per emergency vendor dispatch including emergency response premium, labor, travel, and standard parts. Does NOT include downtime cost (calculated separately). Excludes retainer/contract fees.</div><div class="tooltip-formula">Typical range: $1,500-$5,000 per P1 callout depending on OEM and region</div></span></span></label>
                            <input type="number" id="calcCallout" class="calc-input" value="2500" min="100" step="100">
                        </div>
                        <div class="calc-input-group">
                            <label class="calc-label">Training Investment ($) <span class="tooltip-trigger">?<span class="tooltip-content"><div class="tooltip-title">Annual ICB Investment</div><div class="tooltip-desc">Total annual investment in capability building: OEM training courses, certifications (NFPA 70E, refrigerant handling), diagnostic equipment, spare parts inventory, and competence assessment programs. Year 1 typically 60-70% higher than ongoing.</div><div class="tooltip-formula">ICB Framework: Year 1 ~$85K | Year 2+ ~$50K (10MW facility baseline)</div></span></span></label>
                            <input type="number" id="calcTraining" class="calc-input" value="50000" min="0" step="5000">
                        </div>
                    </div>

                    <!-- Pro Input Drawer -->
                    <div class="pro-drawer" id="proDrawer">
                        <div class="pro-drawer-title"><i class="fas fa-sliders"></i> Advanced Parameters</div>
                        <div class="calc-grid">
                            <div class="calc-input-group">
                                <label class="calc-label">MTBF (hours) <span class="tooltip-trigger">?<span class="tooltip-content"><div class="tooltip-title">Mean Time Between Failures</div><div class="tooltip-desc">Average operating hours between critical failures for the selected infrastructure category. Used to calculate system availability: A = MTBF/(MTBF+MTTR). MTBF is primarily driven by equipment design, age, and PM quality.</div><div class="tooltip-formula">Typical DC: 4,000-15,000 hrs | NASA/IEEE 493 availability framework</div></span></span></label>
                                <input type="number" id="proMTBF" class="calc-input" value="8760" min="500" max="100000" step="100">
                            </div>
                            <div class="calc-input-group">
                                <label class="calc-label">Off-Hours SLA Multiplier <span class="tooltip-trigger">?<span class="tooltip-content"><div class="tooltip-title">Weekend/Holiday Response Degradation</div><div class="tooltip-desc">Multiplier applied to vendor SLA during off-hours, weekends, and holidays. Analysis shows vendor P1 response averages 6.8h off-hours vs 3.4h business hours — a 2.0x degradation factor. Affects Monte Carlo tail risk calculations.</div><div class="tooltip-formula">Typical: 1.5x (best case) to 2.5x (remote site) | Source: Section 5.2</div></span></span></label>
                                <input type="number" id="proOffHours" class="calc-input" value="2.0" min="1.0" max="4.0" step="0.1">
                            </div>
                            <div class="calc-input-group">
                                <label class="calc-label">In-House Coverage <span class="tooltip-trigger">?<span class="tooltip-content"><div class="tooltip-title">Shift Coverage Model</div><div class="tooltip-desc">In-house team coverage pattern. Affects mobilization time distribution — 24/7 coverage eliminates off-hours gaps. Limited coverage models introduce mobilization variance during uncovered periods.</div><div class="tooltip-formula">24/7: 0.25h mob | 16/7: avg 0.8h | 12/5: avg 2.1h (off-hours)</div></span></span></label>
                                <select id="proCoverage" class="calc-select">
                                    <option value="24_7" selected>24/7 — Full Coverage</option>
                                    <option value="16_7">16/7 — Two Shifts</option>
                                    <option value="12_5">12/5 — Business Hours</option>
                                </select>
                            </div>
                            <div class="calc-input-group">
                                <label class="calc-label">Spare Parts Readiness (%) <span class="tooltip-trigger">?<span class="tooltip-content"><div class="tooltip-title">Critical Spares Availability</div><div class="tooltip-desc">Percentage of common failure components available in on-site inventory. Directly affects Repair phase duration — missing parts add procurement delay (typically 4-48 hours). Strategic spares program is an ICB Phase 3 deliverable.</div><div class="tooltip-formula">Impact: Each 10% gap adds ~0.3h to avg repair phase | ICB Phase 3</div></span></span></label>
                                <input type="number" id="proSpares" class="calc-input" value="80" min="0" max="100" step="5">
                            </div>
                            <div class="calc-input-group">
                                <label class="calc-label">Team Size (responders) <span class="tooltip-trigger">?<span class="tooltip-content"><div class="tooltip-title">Qualified In-House Responders</div><div class="tooltip-desc">Number of Tier 2+ qualified technicians available for incident response. Used in Erlang-C queueing model to calculate wait probability when multiple incidents occur simultaneously. Understaffing creates hidden queuing delays.</div><div class="tooltip-formula">Erlang-C: P(wait) increases exponentially as utilization → 1.0</div></span></span></label>
                                <input type="number" id="proTeamSize" class="calc-input" value="4" min="1" max="20" step="1">
                            </div>
                            <div class="calc-input-group">
                                <label class="calc-label">Vendor Retainer ($/yr) <span class="tooltip-trigger">?<span class="tooltip-content"><div class="tooltip-title">Annual Vendor Contract</div><div class="tooltip-desc">Base annual vendor maintenance contract cost (covering PM visits, priority access, parts discounts). Partially retained under in-house model for OEM warranty work and Tier 4 escalations — typically reduced by 40-60%.</div><div class="tooltip-formula">Under ICB: retain ~40% of retainer for Tier 4 OEM access</div></span></span></label>
                                <input type="number" id="proRetainer" class="calc-input" value="180000" min="0" step="10000">
                            </div>
                            <div class="calc-input-group">
                                <label class="calc-label">Critical Severity (%) <span class="tooltip-trigger">?<span class="tooltip-content"><div class="tooltip-title">P1 Critical Mix</div><div class="tooltip-desc">Percentage of incidents classified as P1 Critical (client-impacting). Critical incidents carry full downtime cost; non-critical incidents carry reduced cost (typically 30% of full rate). Affects financial calculation realism.</div><div class="tooltip-formula">Cost weighting: P1 = 100% rate | Non-P1 = 30% of hourly rate</div></span></span></label>
                                <input type="number" id="proCriticalPct" class="calc-input" value="40" min="0" max="100" step="5">
                            </div>
                            <div class="calc-input-group">
                                <label class="calc-label">Duration Variability <span class="tooltip-trigger">?<span class="tooltip-content"><div class="tooltip-title">Phase Duration Spread</div><div class="tooltip-desc">Coefficient of variation for MTTR phase durations. Low = consistent, predictable repairs. High = wide variance (aging equipment, mixed failure modes). Drives Monte Carlo confidence band width.</div><div class="tooltip-formula">Low: CV=0.2 (tight band) | Medium: CV=0.35 | High: CV=0.5 (wide band)</div></span></span></label>
                                <select id="proDurVar" class="calc-select">
                                    <option value="low">Low — Predictable</option>
                                    <option value="medium" selected>Medium — Typical</option>
                                    <option value="high">High — Variable</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Phase Comparison Table -->
                    <h3 style="color: #93c5fd; margin-bottom: 1rem;">MTTR Phase Comparison</h3>
                    <table class="phase-table" id="phaseTable">
                        <thead>
                            <tr>
                                <th>Phase</th>
                                <th>Vendor (hrs)</th>
                                <th>In-House (hrs)</th>
                                <th>Savings (hrs)</th>
                            </tr>
                        </thead>
                        <tbody id="phaseTableBody">
                        </tbody>
                    </table>

                    <!-- Results -->
                    <div class="calc-results" id="calcResults">
                        <div class="calc-result-item">
                            <div class="calc-result-value" id="resVendorMTTR">6.75</div>
                            <div class="calc-result-label">Vendor MTTR (hrs) <span class="res-tip">?<span class="res-tip-body"><div class="rtt">Vendor MTTR</div><div class="rtd">Mean Time To Repair using external vendor. Includes mobilization, travel, diagnosis, and repair phases.</div></span></span></div>
                        </div>
                        <div class="calc-result-item">
                            <div class="calc-result-value positive" id="resInhouseMTTR">3.35</div>
                            <div class="calc-result-label">In-House MTTR (hrs) <span class="res-tip">?<span class="res-tip-body"><div class="rtt">In-House MTTR</div><div class="rtd">Mean Time To Repair using internal team. Faster mobilization but may have skill limitations.</div></span></span></div>
                        </div>
                        <div class="calc-result-item">
                            <div class="calc-result-value" id="resVendorDowntime">243.0</div>
                            <div class="calc-result-label">Vendor Annual Downtime (hrs) <span class="res-tip">?<span class="res-tip-body"><div class="rtt">Vendor Downtime</div><div class="rtd">Total annual downtime hours when relying on vendor for all incidents.</div></span></span></div>
                        </div>
                        <div class="calc-result-item">
                            <div class="calc-result-value positive" id="resInhouseDowntime">120.6</div>
                            <div class="calc-result-label">In-House Annual Downtime (hrs) <span class="res-tip">?<span class="res-tip-body"><div class="rtt">In-House Downtime</div><div class="rtd">Total annual downtime hours with in-house response capability.</div></span></span></div>
                        </div>
                        <div class="calc-result-item">
                            <div class="calc-result-value positive" id="resNetSavings">$0</div>
                            <div class="calc-result-label">Net Annual Savings <span class="res-tip">?<span class="res-tip-body"><div class="rtt">Net Annual Savings</div><div class="rtd">Annual cost savings from in-house capability vs full vendor reliance, after training investment.</div></span></span></div>
                        </div>
                        <div class="calc-result-item">
                            <div class="calc-result-value" id="resROI">0%</div>
                            <div class="calc-result-label">Training ROI <span class="res-tip">?<span class="res-tip-body"><div class="rtt">Training ROI</div><div class="rtd">Return on training investment — savings divided by annual training cost.</div><span class="rtf">&gt;200% = strong case for in-house</span></span></span></div>
                        </div>
                        <div class="calc-result-item">
                            <div class="calc-result-value" id="resBreakeven">0</div>
                            <div class="calc-result-label">Breakeven (months) <span class="res-tip">?<span class="res-tip-body"><div class="rtt">Breakeven Period</div><div class="rtd">Months until cumulative savings exceed cumulative training investment.</div></span></span></div>
                        </div>
                    </div>

                    <!-- Pro Output Panels -->
                    <div class="pro-panels" id="proPanels">

                        <!-- Panel 1: MTTR Distribution -->
                        <div class="pro-panel"><div class="pro-panel-inner">
                            <div class="pro-panel-title"><i class="fas fa-chart-bar"></i> MTTR Distribution & Phase Analysis</div>
                            <div class="calc-results">
                                <div class="calc-result-item"><div class="calc-result-value" id="proMeanMTTR">—</div><div class="calc-result-label">Mean In-House MTTR <span class="res-tip">?<span class="res-tip-body"><div class="rtt">Mean In-House MTTR</div><div class="rtd">Average in-house repair time from Monte Carlo simulation across all scenarios.</div></span></span></div></div>
                                <div class="calc-result-item"><div class="calc-result-value" id="proMedianMTTR">—</div><div class="calc-result-label">Median MTTR (p50) <span class="res-tip">?<span class="res-tip-body"><div class="rtt">Median MTTR</div><div class="rtd">50th percentile repair time — half of incidents resolved faster than this.</div></span></span></div></div>
                                <div class="calc-result-item"><div class="calc-result-value" id="proP90MTTR">—</div><div class="calc-result-label">p90 MTTR (tail) <span class="res-tip">?<span class="res-tip-body"><div class="rtt">p90 MTTR</div><div class="rtd">90th percentile — 90% of incidents resolved within this time. Captures worst-case behavior.</div></span></span></div></div>
                                <div class="calc-result-item"><div class="calc-result-value" id="proMobPct">—</div><div class="calc-result-label">Mobilization % (Vendor) <span class="res-tip">?<span class="res-tip-body"><div class="rtt">Vendor Mobilization %</div><div class="rtd">Percentage of total vendor MTTR spent on mobilization (dispatch, travel, site access).</div></span></span></div></div>
                                <div class="calc-result-item"><div class="calc-result-value" id="proBottleneck">—</div><div class="calc-result-label">Phase Bottleneck <span class="res-tip">?<span class="res-tip-body"><div class="rtt">Phase Bottleneck</div><div class="rtd">Which repair phase (mobilization, diagnosis, repair, test) is the longest contributor to MTTR.</div></span></span></div></div>
                                <div class="calc-result-item"><div class="calc-result-value positive" id="proMTTRReduction">—</div><div class="calc-result-label">MTTR Reduction <span class="res-tip">?<span class="res-tip-body"><div class="rtt">MTTR Improvement</div><div class="rtd">Percentage reduction in MTTR achieved by in-house capability vs vendor.</div></span></span></div></div>
                            </div>
                        </div><div class="gated-overlay" id="gate1" onclick="if(window._rzAuth)window._rzAuth.showModal();else showLoginModal()"><div class="gated-icon"><i class="fas fa-lock"></i></div><div class="gated-text">Pro Analysis Required</div><div class="gated-sub">Monte Carlo MTTR distributions</div></div></div>

                        <!-- Panel 2: Availability & Downtime -->
                        <div class="pro-panel"><div class="pro-panel-inner">
                            <div class="pro-panel-title"><i class="fas fa-shield-halved"></i> Availability & Downtime Impact</div>
                            <div class="calc-results">
                                <div class="calc-result-item"><div class="calc-result-value" id="proAvailVendor">—</div><div class="calc-result-label">Vendor Availability <span class="res-tip">?<span class="res-tip-body"><div class="rtt">Vendor Availability</div><div class="rtd">System availability when relying on vendor response. Based on MTBF and vendor MTTR.</div><span class="rtf">A = MTBF / (MTBF + MTTR)</span></span></span></div></div>
                                <div class="calc-result-item"><div class="calc-result-value positive" id="proAvailInhouse">—</div><div class="calc-result-label">In-House Availability <span class="res-tip">?<span class="res-tip-body"><div class="rtt">In-House Availability</div><div class="rtd">System availability with in-house response capability.</div><span class="rtf">A = MTBF / (MTBF + MTTR)</span></span></span></div></div>
                                <div class="calc-result-item"><div class="calc-result-value positive" id="proAvailDelta">—</div><div class="calc-result-label">Availability Improvement <span class="res-tip">?<span class="res-tip-body"><div class="rtt">Availability Gain</div><div class="rtd">Nines of availability gained by switching from vendor to in-house response.</div></span></span></div></div>
                                <div class="calc-result-item"><div class="calc-result-value" id="proDownVendorP50">—</div><div class="calc-result-label">Vendor Downtime (p50) <span class="res-tip">?<span class="res-tip-body"><div class="rtt">Vendor Downtime p50</div><div class="rtd">Median annual vendor downtime from Monte Carlo simulation.</div></span></span></div></div>
                                <div class="calc-result-item"><div class="calc-result-value positive" id="proDownInhouseP50">—</div><div class="calc-result-label">In-House Downtime (p50) <span class="res-tip">?<span class="res-tip-body"><div class="rtt">In-House Downtime p50</div><div class="rtd">Median annual in-house downtime from Monte Carlo simulation.</div></span></span></div></div>
                                <div class="calc-result-item"><div class="calc-result-value positive" id="proHoursSaved">—</div><div class="calc-result-label">Downtime Hours Saved <span class="res-tip">?<span class="res-tip-body"><div class="rtt">Hours Saved</div><div class="rtd">Annual downtime hours saved by in-house capability.</div></span></span></div></div>
                            </div>
                        </div><div class="gated-overlay" id="gate2" onclick="if(window._rzAuth)window._rzAuth.showModal();else showLoginModal()"><div class="gated-icon"><i class="fas fa-lock"></i></div><div class="gated-text">Pro Analysis Required</div><div class="gated-sub">NASA/IEEE availability framework</div></div></div>

                        <!-- Panel 3: Financial Deep Dive -->
                        <div class="pro-panel"><div class="pro-panel-inner">
                            <div class="pro-panel-title"><i class="fas fa-coins"></i> Financial Deep Dive</div>
                            <div class="calc-results">
                                <div class="calc-result-item"><div class="calc-result-value positive" id="proNPV3">—</div><div class="calc-result-label">3-Year NPV <span class="res-tip">?<span class="res-tip-body"><div class="rtt">3-Year NPV</div><div class="rtd">Net Present Value of in-house capability investment over 3 years.</div></span></span></div></div>
                                <div class="calc-result-item"><div class="calc-result-value" id="proCostVendor">—</div><div class="calc-result-label">Cost / Incident (Vendor) <span class="res-tip">?<span class="res-tip-body"><div class="rtt">Vendor Cost/Incident</div><div class="rtd">Total cost per incident with vendor response: callout fee + downtime cost.</div></span></span></div></div>
                                <div class="calc-result-item"><div class="calc-result-value positive" id="proCostInhouse">—</div><div class="calc-result-label">Cost / Incident (In-House) <span class="res-tip">?<span class="res-tip-body"><div class="rtt">In-House Cost/Incident</div><div class="rtd">Total cost per incident with in-house response: labor + downtime cost.</div></span></span></div></div>
                                <div class="calc-result-item"><div class="calc-result-value" id="proBEp50">—</div><div class="calc-result-label">Breakeven (p50) <span class="res-tip">?<span class="res-tip-body"><div class="rtt">Breakeven p50</div><div class="rtd">Median breakeven period from Monte Carlo simulation.</div></span></span></div></div>
                                <div class="calc-result-item"><div class="calc-result-value" id="proBEp90">—</div><div class="calc-result-label">Breakeven (p90) <span class="res-tip">?<span class="res-tip-body"><div class="rtt">Breakeven p90</div><div class="rtd">90th percentile breakeven — conservative estimate.</div></span></span></div></div>
                                <div class="calc-result-item"><div class="calc-result-value positive" id="pro3YrSavings">—</div><div class="calc-result-label">3-Year Cumulative <span class="res-tip">?<span class="res-tip-body"><div class="rtt">3-Year Cumulative Savings</div><div class="rtd">Total cumulative savings over 3 years from in-house capability.</div></span></span></div></div>
                            </div>
                        </div><div class="gated-overlay" id="gate3" onclick="if(window._rzAuth)window._rzAuth.showModal();else showLoginModal()"><div class="gated-icon"><i class="fas fa-lock"></i></div><div class="gated-text">Pro Analysis Required</div><div class="gated-sub">NPV & confidence-banded ROI</div></div></div>

                        <!-- Panel 4: Staffing & Queueing -->
                        <div class="pro-panel"><div class="pro-panel-inner">
                            <div class="pro-panel-title"><i class="fas fa-users-gear"></i> Staffing & Queueing (Erlang-C)</div>
                            <div class="calc-results">
                                <div class="calc-result-item"><div class="calc-result-value" id="proWaitProb">—</div><div class="calc-result-label">Wait Probability <span class="res-tip">?<span class="res-tip-body"><div class="rtt">Queue Wait Probability</div><div class="rtd">Probability an incident must wait for a responder (all technicians busy).</div></span></span></div></div>
                                <div class="calc-result-item"><div class="calc-result-value" id="proQueueDelay">—</div><div class="calc-result-label">Avg Queue Delay <span class="res-tip">?<span class="res-tip-body"><div class="rtt">Avg Queue Delay</div><div class="rtd">Average additional wait time when all responders are occupied.</div></span></span></div></div>
                                <div class="calc-result-item"><div class="calc-result-value positive" id="proOptTeam">—</div><div class="calc-result-label">Optimal Team Size <span class="res-tip">?<span class="res-tip-body"><div class="rtt">Optimal Team Size</div><div class="rtd">Recommended number of in-house responders to minimize queue delays.</div></span></span></div></div>
                                <div class="calc-result-item"><div class="calc-result-value" id="proUtilRate">—</div><div class="calc-result-label">Utilization Rate <span class="res-tip">?<span class="res-tip-body"><div class="rtt">Team Utilization</div><div class="rtd">Percentage of time responders are engaged in incident response.</div><span class="rtf">70-85% optimal</span></span></span></div></div>
                            </div>
                        </div><div class="gated-overlay" id="gate4" onclick="if(window._rzAuth)window._rzAuth.showModal();else showLoginModal()"><div class="gated-icon"><i class="fas fa-lock"></i></div><div class="gated-text">Pro Analysis Required</div><div class="gated-sub">Erlang-C staffing optimization</div></div></div>

                        <!-- Panel 5: Scenario Sensitivity -->
                        <div class="pro-panel"><div class="pro-panel-inner">
                            <div class="pro-panel-title"><i class="fas fa-arrow-trend-up"></i> Scenario Sensitivity</div>
                            <div class="calc-results">
                                <div class="calc-result-item"><div class="calc-result-value" id="proScen1">—</div><div class="calc-result-label">+1 Technician <span class="res-tip">?<span class="res-tip-body"><div class="rtt">+1 Technician</div><div class="rtd">Impact of adding one more in-house responder on queue delays.</div></span></span></div></div>
                                <div class="calc-result-item"><div class="calc-result-value" id="proScen2">—</div><div class="calc-result-label">+1 Skill Level <span class="res-tip">?<span class="res-tip-body"><div class="rtt">+1 Skill Level</div><div class="rtd">Impact of improving team skill level by one tier on MTTR.</div></span></span></div></div>
                                <div class="calc-result-item"><div class="calc-result-value" id="proScen3">—</div><div class="calc-result-label">2x Incidents <span class="res-tip">?<span class="res-tip-body"><div class="rtt">2x Incidents</div><div class="rtd">System performance if incident frequency doubles.</div></span></span></div></div>
                                <div class="calc-result-item"><div class="calc-result-value" id="proScen4">—</div><div class="calc-result-label">−50% Vendor SLA</div></div>
                            </div>
                        </div><div class="gated-overlay" id="gate5" onclick="if(window._rzAuth)window._rzAuth.showModal();else showLoginModal()"><div class="gated-icon"><i class="fas fa-lock"></i></div><div class="gated-text">Pro Analysis Required</div><div class="gated-sub">What-if scenario modeling</div></div></div>
                    </div>

                    <!-- Narrative Conclusion -->
                    <div class="narrative-box" id="narrativeBox">
                        <h4><i class="fas fa-file-lines"></i> Executive Assessment</h4>
                        <div id="narrativeContent"></div>
                    </div>

                    <div class="privacy-badge" style="margin-top:0.5rem;">
                        <i class="fas fa-shield-halved"></i> PDF generated in your browser — no data is sent to any server
                    </div>

                </div>

                <!-- Login Modal -->
                <div class="login-overlay" id="loginOverlay">
                    <div class="login-box">
                        <button class="login-close" onclick="hideLoginModal()">&times;</button>
                        <h3><i class="fas fa-microscope" style="color: var(--accent-blue); margin-right: 8px;"></i> Pro Analysis</h3>
                        <p class="login-sub">Unlock 26 advanced KPIs, Monte Carlo simulation & executive PDF export</p>
                        <input type="email" class="login-input" id="loginEmail" placeholder="Email address">
                        <input type="password" class="login-input" id="loginPass" placeholder="Password">
                        <button class="login-submit" id="loginSubmit" onclick="handleLogin()">Unlock Pro Analysis</button>
                        <div class="login-error" id="loginError">Invalid credentials. Please try again.</div>
                        <div class="login-hint">
                            <span>Demo access:</span> <code>demo@resistancezero.com</code> / <code>demo2026</code>
                        </div>
                        <div style="text-align:center;margin-top:6px;"><a href="mailto:bagus@resistancezero.com" style="font-size:0.62rem;color:#64748b;text-decoration:none;">Want full access? Get in touch &rarr;</a></div>
                <p style="text-align:center;font-size:0.68rem;color:#64748b;margin-top:8px;line-height:1.5;">By clicking Login, you agree to our <a href="terms.html" target="_blank" style="color:#8b5cf6;text-decoration:underline;">Terms of Service</a> and <a href="privacy.html" target="_blank" style="color:#8b5cf6;text-decoration:underline;">Privacy Policy</a>.</p>
                    </div>
                </div>

                <!-- Section 11: Training ROI Analysis -->
                <h2 id="section-11">
                    <span class="section-number">11</span>
                    Training ROI Analysis
                </h2>

                <p>The financial case for in-house capability building is compelling when examined through the lens of total cost of ownership rather than direct training expenditure alone. The common objection — "we cannot afford to invest $50,000-$80,000 annually in training" — reflects a narrow accounting perspective that ignores the far larger costs of vendor dependency that the training investment eliminates.</p>

                <h3>11.1 Investment Components</h3>

                <p>The ICB framework implementation requires investment across three categories:</p>

                <div class="data-table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Investment Category</th>
                                <th>Year 1 (Setup)</th>
                                <th>Year 2+ (Ongoing)</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Training Programs</strong></td>
                                <td>$35,000</td>
                                <td>$25,000</td>
                                <td>OEM courses, certifications, external training</td>
                            </tr>
                            <tr>
                                <td><strong>Tooling &amp; Equipment</strong></td>
                                <td>$25,000</td>
                                <td>$8,000</td>
                                <td>Diagnostic instruments, specialized tools</td>
                            </tr>
                            <tr>
                                <td><strong>Spare Parts Inventory</strong></td>
                                <td>$20,000</td>
                                <td>$12,000</td>
                                <td>Critical components, consumables, common replacements</td>
                            </tr>
                            <tr>
                                <td><strong>Assessment &amp; Certification</strong></td>
                                <td>$5,000</td>
                                <td>$5,000</td>
                                <td>Competence validation, drill exercises</td>
                            </tr>
                            <tr style="font-weight: 700; background: var(--table-stripe);">
                                <td><strong>Total Investment</strong></td>
                                <td><strong>$85,000</strong></td>
                                <td><strong>$50,000</strong></td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h3>11.2 Savings Components</h3>

                <p>The savings from in-house capability development derive from three sources that compound to produce a substantial return:</p>

                <ul>
                    <li><strong>Downtime cost reduction:</strong> Reducing average MTTR from 7.05 hours (vendor) to approximately 2.80 hours (in-house Tier 2 average) across 36 annual incidents saves 153 hours of downtime. At $9,000/hour, this translates to <strong>$1,377,000</strong> in reduced downtime costs — though the realized savings are typically 40-60% of theoretical maximum as not all incidents are fully resolved in-house and not all downtime carries full revenue impact.</li>
                    <li><strong>Vendor callout avoidance:</strong> Reducing vendor callouts from 36 per year to approximately 7 (the 20% requiring Tier 3/4 engagement) eliminates 29 callouts at $2,500 each = <strong>$72,500</strong> in direct vendor cost savings.</li>
                    <li><strong>Operational efficiency gains:</strong> In-house teams familiar with facility systems identify preventive opportunities during reactive maintenance, reducing future incident frequency by an estimated 10-15% annually — a compounding benefit that increases over successive years.</li>
                </ul>

                <div class="formula-box">
                    <div class="formula-label">Training ROI Formula</div>
                    <div class="formula">ROI = ((Downtime Savings + Vendor Savings - Training Investment) / Training Investment) x 100</div>
                    <div class="formula-label">Conservative estimate: ROI = (($550,000 + $72,500 - $50,000) / $50,000) x 100 = <strong>1,145%</strong></div>
                </div>

                <h3>11.3 Non-Financial Benefits</h3>

                <p>Beyond direct financial returns, the ICB framework delivers organizational benefits that are difficult to quantify but operationally significant:</p>

                <ul>
                    <li><strong>Organizational resilience:</strong> Teams that routinely handle complex failures develop the adaptive capacity that Hollnagel identifies as essential for resilient performance.<a href="#ref-section" class="src-ref">[2]</a> This resilience extends beyond the specific failure modes trained for, creating a generalized capability to respond effectively to novel situations.</li>
                    <li><strong>Employee engagement:</strong> Technicians who are invested in through training and given responsibility for critical system maintenance demonstrate higher engagement, lower turnover, and greater organizational commitment. The Uptime Institute's staffing surveys consistently identify skill development opportunities as a top factor in data center workforce retention.<a href="#ref-section" class="src-ref">[8]</a></li>
                    <li><strong>Institutional knowledge:</strong> The ICB framework systematically captures and retains operational knowledge within the organization rather than allowing it to reside exclusively with vendor personnel. This knowledge becomes a permanent organizational asset that compounds in value as the team accumulates experience.</li>
                    <li><strong>Vendor relationship improvement:</strong> Counter-intuitively, building in-house capability improves the quality of vendor relationships. When the internal team can engage vendors as technical peers rather than dependent clients, the nature of the engagement shifts from reactive service consumption to collaborative problem-solving. Vendor engineers respect competent clients and provide better service to organizations that demonstrate technical sophistication.</li>
                </ul>

                <div class="key-insight">
                    <strong>The Paradox of Capability Building</strong>
                    Organizations that invest in in-house capability get more value from their vendor relationships, not less. A competent internal team asks better questions, provides more useful diagnostic information, and collaborates more effectively with vendor specialists. The result is that even the 20% of incidents requiring vendor engagement are resolved faster and more effectively when supported by a capable in-house team. The investment in internal capability improves performance across all tiers, not just the ones it directly addresses.
                </div>

                <!-- Section 12: Conclusion -->
                <h2 id="section-12">
                    <span class="section-number">12</span>
                    Conclusion
                </h2>

                <div class="conclusion-box">
                    <h3>In-House Capability: From Cost Center to Strategic Asset</h3>
                    <p>This paper has demonstrated, through operational data and structured analysis, that vendor dependency is not a neutral operational characteristic but an active reliability risk. The five-phase MTTR decomposition reveals that vendor mobilization — a non-technical logistical delay — consistently dominates the repair cycle, accounting for 45-65% of total MTTR across all incident categories.</p>
                    <p>The capability layering model and ICB framework provide a systematic pathway for organizations to address this risk. The four-tier response architecture aligns organizational competence with incident frequency distribution, ensuring that the 80% of incidents amenable to in-house resolution receive the fastest possible response while preserving vendor engagement for genuinely specialized requirements.</p>
                    <p>The financial analysis is unambiguous: a $50,000-$85,000 annual investment in capability building generates returns exceeding 10x through reduced downtime costs, avoided vendor callouts, and compounding operational efficiency improvements. But the case for in-house capability extends beyond financial returns.</p>
                    <ul>
                        <li>Reduced MTTR by 55-65% through elimination of mobilization delay</li>
                        <li>Annual net savings exceeding $400,000 for a 10MW facility</li>
                        <li>Improved organizational resilience and adaptive capacity</li>
                        <li>Enhanced employee engagement and knowledge retention</li>
                        <li>Stronger, more productive vendor relationships</li>
                        <li>Compounding benefits from preventive maintenance insights</li>
                    </ul>
                    <p>In-house capability is not a luxury for well-funded organizations — it is a fundamental reliability strategy that every mission-critical facility should pursue. The question facing operations leaders is not whether they can afford the investment, but whether they can afford the ongoing cost of dependency. The data presented here provides a clear answer: the cost of inaction far exceeds the cost of investment.</p>
                </div>

                
                <!-- Independence Disclaimer -->
                <div style="margin:2rem 0 0;padding:1rem 0;border-top:1px solid rgba(255,255,255,0.06);text-align:center;">
                    <p style="font-size:0.72rem;color:#64748b;font-style:italic;line-height:1.6;margin:0;">All content on ResistanceZero is independent personal research derived from publicly available sources. This site does not represent any current or former employer. <a href="terms.html" style="color:#8b5cf6;">Terms &amp; Disclaimer</a></p>
                </div>

<!-- References -->
                <div id="ref-section" style="margin-top: 3rem; padding: 2rem; background: var(--section-bg); border-radius: 16px; border: 1px solid var(--card-border);">
                    <h3 style="color: var(--accent-blue); margin-bottom: 1.5rem; font-size: 1.15rem;">References</h3>
                    <ol class="ref-list">
                        <li>Reason, J. (1997). <em>"Managing the Risks of Organizational Accidents."</em> Ashgate Publishing.</li>
                        <li>Hollnagel, E. (2014). <em>"Safety-I and Safety-II: The Past and Future of Safety Management."</em> Ashgate Publishing.</li>
                        <li>Weick, K. &amp; Sutcliffe, K. (2007). <em>"Managing the Unexpected: Resilient Performance in an Age of Uncertainty."</em> Jossey-Bass.</li>
                        <li>ISO 55000 (2014). <em>"Asset Management — Overview, Principles and Terminology."</em> International Organization for Standardization.</li>
                        <li>IEEE 3007.2 (2010). <em>"Recommended Practice for the Maintenance of Industrial and Commercial Power Systems."</em> Institute of Electrical and Electronics Engineers.</li>
                        <li>Uptime Institute (2023). <em>"Annual Outage Analysis 2023."</em> Uptime Institute LLC.</li>
                        <li>Uptime Institute (2024). <em>"Global Data Center Survey 2024."</em> Uptime Institute LLC.</li>
                        <li>Uptime Institute (2022). <em>"Data Center Staffing Trends."</em> Uptime Institute LLC.</li>
                        <li>Senge, P. (1990). <em>"The Fifth Discipline: The Art and Practice of the Learning Organization."</em> Doubleday.</li>
                        <li>Perrow, C. (1999). <em>"Normal Accidents: Living with High-Risk Technologies."</em> Princeton University Press.</li>
                        <li>Woods, D. et al. (2010). <em>"Behind Human Error."</em> Ashgate Publishing.</li>
                        <li>Schneider Electric (2018). <em>"WP266 — Reducing Data Center Downtime Through Effective Maintenance."</em> Schneider Electric.</li>
                        <li>IEEE 493 (2007). <em>"Recommended Practice for the Design of Reliable Industrial and Commercial Power Systems (Gold Book)."</em> Institute of Electrical and Electronics Engineers.</li>
                        <li>NFPA 70B (2023). <em>"Recommended Practice for Electrical Equipment Maintenance."</em> National Fire Protection Association.</li>
                    </ol>
                </div>

                <!-- Newsletter Signup -->
                <div class="newsletter-signup">
                    <h3>Stay Updated</h3>
                    <p>Get notified when new articles on data center operations and engineering excellence are published.</p>
                    <form class="newsletter-form" onsubmit="return subscribeNewsletter(event)">
                        <input type="email" placeholder="Enter your email" required>
                        <button type="submit">Subscribe</button>
                    </form>
                    <p class="newsletter-privacy">No spam. Unsubscribe anytime.</p>
                </div>

                <!-- Author Bio -->
                <div class="author-bio">
                    <div class="author-bio-image">
                        <img loading="lazy" src="assets/profile-photo.jpg" alt="Bagus Dwi Permana">
                    </div>
                    <div class="author-bio-content">
                        <h4>Bagus Dwi Permana</h4>
                        <p class="author-bio-title">Engineering Operations Manager | Ahli K3 Listrik</p>
                        <p>12+ years professional experience in critical infrastructure and operations. CDFOM certified. Transforming operations through systematic excellence and safety-first engineering.</p>
                        <div class="author-bio-links">
                            <a href="https://www.linkedin.com/in/bagus-dwi-permana-ba90b092" target="_blank">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                                LinkedIn
                            </a>
                            <a href="https://github.com/baguspermana7-cpu" target="_blank">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
                                GitHub
                            </a>
                            <a href="mailto:baguspermana7@gmail.com">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
                                Email
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Related Articles -->
                <div class="related-articles">
                    <h3>Continue Reading</h3>
                    <div class="related-grid">
                        <a href="article-3.html" class="related-card">
                            <div class="related-card-number">03</div>
                            <div class="related-card-content">
                                <h4>Maintenance Compliance Is Not a Technician Problem</h4>
                                <p>Systemic approach to maintenance excellence</p>
                            </div>
                        </a>
                        <a href="article-5.html" class="related-card">
                            <div class="related-card-number">05</div>
                            <div class="related-card-content">
                                <h4>Technical Debt in Live Data Centers Is Operational Risk</h4>
                                <p>Managing accumulated technical compromises</p>
                            </div>
                        </a>
                        <a href="article-1.html" class="related-card">
                            <div class="related-card-number">01</div>
                            <div class="related-card-content">
                                <h4>When Nothing Happens, Engineering Is Working</h4>
                                <p>Proactive engineering and operational maturity</p>
                            </div>
                        </a>
                    </div>
                </div>

                <!-- Article Navigation -->
                <div class="article-nav">
                    <a href="article-3.html">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
                        Previous Article
                    </a>
                    <a href="article-5.html">
                        Next Article
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
                    </a>
                </div>

            </div>
        </div>
    </article>

    </main>

    <!-- Footer -->
    <footer class="footer footer-enhanced">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-brand">
                    <p class="footer-tagline-main">BUILT FOR MISSION CRITICAL INFRASTRUCTURE<br>MANAGEMENT // 2026</p>
                    <p class="footer-tagline-sub">ALL OPERATIONAL DATASETS PRESERVED.</p>
                    <p class="footer-copyright">&copy; 2026 Bagus Dwi Permana. All rights reserved.</p>
                </div>
                <div class="footer-nav">
                    <h4 class="footer-heading">NAVIGATION</h4>
                    <ul class="footer-links">
                        <li><a href="index.html">Home Dashboard</a></li>
                        <li><a href="articles.html">Technical Journal</a></li>
                        <li><a href="index.html#case-studies">Case Studies</a></li>
                        <li><a href="datacenter-solutions.html">DC Solutions</a></li>
                    </ul>
                </div>
                <div class="footer-connect">
                    <h4 class="footer-heading">CONNECT</h4>
                    <ul class="footer-links">
                        <li><a href="https://www.linkedin.com/in/bagus-dwi-permana-ba90b092" target="_blank" rel="noopener">LinkedIn Profile</a></li>
                        <li><a href="articles.html">Technical Journal</a></li>
                        <li><a href="mailto:baguspermana7@gmail.com">Direct Contact</a></li>
                        <li><a href="https://github.com/baguspermana7-cpu" target="_blank" rel="noopener">GitHub</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <!-- Share Buttons - Floating Sidebar -->
    <aside class="share-buttons" id="shareButtons" aria-label="Share this article">
        <span class="share-label">Share</span>
        <button class="share-btn linkedin" data-tooltip="Share on LinkedIn" onclick="shareLinkedIn()" aria-label="Share on LinkedIn">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
            </svg>
        </button>
        <button class="share-btn twitter" data-tooltip="Share on X" onclick="shareTwitter()" aria-label="Share on X (Twitter)">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
            </svg>
        </button>
        <button class="share-btn whatsapp" data-tooltip="Share on WhatsApp" onclick="shareWhatsApp()" aria-label="Share on WhatsApp">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
            </svg>
        </button>
        <button class="share-btn copy" data-tooltip="Copy link" onclick="copyLink()" aria-label="Copy article link">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="copy-icon">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="check-icon" style="display:none">
                <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
        </button>
    </aside>

    <script src="script.js"></script>

    <!-- Share Buttons Functionality -->
    <script>
    (function() {
        var shareButtons = document.getElementById('shareButtons');
        var articleHero = document.querySelector('.article-hero');
        if (shareButtons && articleHero) {
            document.body.classList.add('has-share-buttons');
            var observer = new IntersectionObserver(function(entries) {
                entries.forEach(function(entry) {
                    shareButtons.classList.toggle('visible', !entry.isIntersecting);
                });
            }, { threshold: 0.1 });
            observer.observe(articleHero);
        }
    })();

    function getShareData() {
        return {
            title: document.querySelector('meta[property="og:title"]')?.content || document.title,
            text: document.querySelector('meta[property="og:description"]')?.content || '',
            url: window.location.href
        };
    }

    function shareLinkedIn() {
        var data = getShareData();
        window.open('https://www.linkedin.com/sharing/share-offsite/?url=' + encodeURIComponent(data.url), '_blank', 'width=600,height=600');
    }

    function shareTwitter() {
        var data = getShareData();
        var text = data.title + ' by @BagusDPermana';
        window.open('https://twitter.com/intent/tweet?text=' + encodeURIComponent(text) + '&url=' + encodeURIComponent(data.url), '_blank', 'width=600,height=400');
    }

    function shareWhatsApp() {
        var data = getShareData();
        window.open('https://wa.me/?text=' + encodeURIComponent(data.title + '\n\n' + data.url), '_blank');
    }

    function copyLink() {
        var btn = document.querySelector('.share-btn.copy');
        var copyIcon = btn.querySelector('.copy-icon');
        var checkIcon = btn.querySelector('.check-icon');
        navigator.clipboard.writeText(window.location.href).then(function() {
            btn.classList.add('copied');
            copyIcon.style.display = 'none';
            checkIcon.style.display = 'block';
            btn.setAttribute('data-tooltip', 'Copied!');
            setTimeout(function() {
                btn.classList.remove('copied');
                copyIcon.style.display = 'block';
                checkIcon.style.display = 'none';
                btn.setAttribute('data-tooltip', 'Copy link');
            }, 2000);
        });
    }
    </script>

    <!-- Interactive Canvas: MTTR Comparison Chart -->
    <script>
    (function() {
        var canvas = document.getElementById('mttrCanvas');
        if (!canvas) return;
        var ctx = canvas.getContext('2d');
        var slider = document.getElementById('skillSlider');
        var skillValueEl = document.getElementById('skillValue');

        var SKILL_LABELS = {1:'Novice', 2:'Basic', 3:'Competent', 4:'Proficient', 5:'Expert'};
        var SKILL_FACTORS = {1:1.5, 2:1.2, 3:1.0, 4:0.75, 5:0.55};
        var BASE = {detect:0.25, diagnose:0.5, mobilize:0, repair:1.5, verify:0.5};
        var VENDOR_SLA = 4;

        function draw(skill) {
            var sf = SKILL_FACTORS[skill];
            var vendorPhases = [BASE.detect, BASE.diagnose, VENDOR_SLA, BASE.repair, BASE.verify];
            var inhousePhases = [BASE.detect, BASE.diagnose * sf, 0.25, BASE.repair * sf, BASE.verify];
            var vendorTotal = vendorPhases.reduce(function(a,b){return a+b;}, 0);
            var inhouseTotal = inhousePhases.reduce(function(a,b){return a+b;}, 0);

            // Update callout cards
            document.getElementById('canvasVendorMTTR').textContent = vendorTotal.toFixed(2) + 'h';
            document.getElementById('canvasInhouseMTTR').textContent = inhouseTotal.toFixed(2) + 'h';
            document.getElementById('canvasTimeSaved').textContent = (vendorTotal - inhouseTotal).toFixed(2) + 'h';
            document.getElementById('canvasReduction').textContent = Math.round((vendorTotal - inhouseTotal) / vendorTotal * 100) + '%';

            // Canvas dimensions
            var dpr = window.devicePixelRatio || 1;
            var w = canvas.parentElement.clientWidth - 48;
            var h = 340;
            canvas.width = w * dpr;
            canvas.height = h * dpr;
            canvas.style.width = w + 'px';
            canvas.style.height = h + 'px';
            ctx.scale(dpr, dpr);
            ctx.clearRect(0, 0, w, h);

            var phases = ['Detect', 'Diagnose', 'Mobilize', 'Repair', 'Verify'];
            var colors = ['#06b6d4', '#3b82f6', '#f59e0b', '#ef4444', '#10b981'];
            var barW = Math.min(50, (w - 120) / 12);
            var gap = barW * 0.6;
            var groupW = barW * 2 + gap;
            var totalGroupW = phases.length * groupW + (phases.length - 1) * 20;
            var startX = (w - totalGroupW) / 2;
            var maxVal = Math.max.apply(null, vendorPhases.concat(inhousePhases));
            var chartH = h - 100;
            var baseY = chartH + 20;
            var scale = (chartH - 20) / (maxVal * 1.15);

            // Grid
            ctx.strokeStyle = 'rgba(148,163,184,0.15)';
            ctx.lineWidth = 1;
            for (var g = 0; g <= 4; g++) {
                var gy = baseY - (maxVal * 1.15 / 4) * g * scale;
                ctx.beginPath();
                ctx.moveTo(startX - 10, gy);
                ctx.lineTo(startX + totalGroupW + 10, gy);
                ctx.stroke();
                ctx.fillStyle = '#64748b';
                ctx.font = '11px Inter, sans-serif';
                ctx.textAlign = 'right';
                ctx.fillText((maxVal * 1.15 / 4 * g).toFixed(1) + 'h', startX - 15, gy + 4);
            }

            for (var i = 0; i < phases.length; i++) {
                var x = startX + i * (groupW + 20);
                var vH = vendorPhases[i] * scale;
                var iH = inhousePhases[i] * scale;

                // Vendor bar
                ctx.fillStyle = 'rgba(245,158,11,0.8)';
                ctx.beginPath();
                var r = 4;
                ctx.moveTo(x + r, baseY - vH);
                ctx.arcTo(x + barW, baseY - vH, x + barW, baseY, r);
                ctx.arcTo(x + barW, baseY, x, baseY, 0);
                ctx.arcTo(x, baseY, x, baseY - vH, 0);
                ctx.arcTo(x, baseY - vH, x + barW, baseY - vH, r);
                ctx.fill();

                // In-house bar
                var ix = x + barW + gap;
                ctx.fillStyle = colors[i];
                ctx.beginPath();
                ctx.moveTo(ix + r, baseY - iH);
                ctx.arcTo(ix + barW, baseY - iH, ix + barW, baseY, r);
                ctx.arcTo(ix + barW, baseY, ix, baseY, 0);
                ctx.arcTo(ix, baseY, ix, baseY - iH, 0);
                ctx.arcTo(ix, baseY - iH, ix + barW, baseY - iH, r);
                ctx.fill();

                // Values on top
                ctx.fillStyle = '#f59e0b';
                ctx.font = 'bold 11px JetBrains Mono, monospace';
                ctx.textAlign = 'center';
                ctx.fillText(vendorPhases[i].toFixed(2), x + barW/2, baseY - vH - 6);

                ctx.fillStyle = colors[i];
                ctx.fillText(inhousePhases[i].toFixed(2), ix + barW/2, baseY - iH - 6);

                // Labels
                ctx.fillStyle = '#94a3b8';
                ctx.font = '11px Inter, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(phases[i], x + groupW/2, baseY + 18);
            }

            // Legend
            var lx = w / 2 - 80;
            var ly = baseY + 40;
            ctx.fillStyle = 'rgba(245,158,11,0.8)';
            ctx.fillRect(lx, ly, 14, 14);
            ctx.fillStyle = '#94a3b8';
            ctx.font = '12px Inter, sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('Vendor', lx + 20, ly + 11);

            ctx.fillStyle = '#3b82f6';
            ctx.fillRect(lx + 90, ly, 14, 14);
            ctx.fillStyle = '#94a3b8';
            ctx.fillText('In-House', lx + 110, ly + 11);
        }

        slider.addEventListener('input', function() {
            var v = parseInt(this.value);
            skillValueEl.textContent = v + ' \u2014 ' + SKILL_LABELS[v];
            draw(v);
        });

        draw(3);
        window.addEventListener('resize', function() { draw(parseInt(slider.value)); });
    })();
    </script>

    <!-- Calculator Logic — Pro Enhancement Engine -->
    <script>
    (function() {
        /* ===== CONSTANTS ===== */
        var CATEGORY_BASE = {
            Electrical: {detect:0.25, diagnose:0.5, repair:1.5, verify:0.5},
            Mechanical: {detect:0.5, diagnose:0.75, repair:2.0, verify:0.5},
            Controls: {detect:0.15, diagnose:1.0, repair:1.0, verify:0.75},
            "Fire Protection": {detect:0.1, diagnose:0.5, repair:1.5, verify:1.0}
        };
        var SKILL_FACTORS = {1:1.5, 2:1.2, 3:1.0, 4:0.75, 5:0.55};
        var COVERAGE_MOB = {'24_7':0.25, '16_7':0.80, '12_5':2.10};
        var DUR_CV = {low:0.20, medium:0.35, high:0.50};

        var isPremium = false;
        var calcMode = 'free';
        var lastProData = null;

        /* ===== HELPERS ===== */
        function $(id){ return document.getElementById(id); }
        function val(id, def){ var e=$(id); if(!e) return def; var v=parseFloat(e.value); return isNaN(v)?def:v; }
        function fmt(n,d){ return n.toFixed(d===undefined?2:d); }
        function fmtK(n){ return n>=1e6?'$'+fmt(n/1e6,1)+'M':n>=1e3?'$'+fmt(n/1e3,1)+'K':'$'+Math.round(n); }
        function pct(n){ return fmt(n,1)+'%'; }
        function clamp(v,lo,hi){ return Math.max(lo,Math.min(hi,v)); }

        /* ===== GAUSSIAN RANDOM (Box-Muller) ===== */
        function gaussRand(){ var u=0,v=0; while(u===0)u=Math.random(); while(v===0)v=Math.random(); return Math.sqrt(-2*Math.log(u))*Math.cos(2*Math.PI*v); }
        function sampleLognormal(mean,cv){ var sigma2=Math.log(1+cv*cv); var mu=Math.log(mean)-sigma2/2; return Math.exp(mu+Math.sqrt(sigma2)*gaussRand()); }

        /* ===== ERLANG-C ===== */
        function factorial(n){ var f=1; for(var i=2;i<=n;i++) f*=i; return f; }
        function erlangC(lambda,mu,c){
            var rho=lambda/(c*mu);
            if(rho>=1) return {pw:0.99,wq:999,util:rho};
            var a=lambda/mu;
            var sum=0; for(var k=0;k<c;k++) sum+=Math.pow(a,k)/factorial(k);
            var last=Math.pow(a,c)/factorial(c) * 1/(1-rho);
            var pw=last/(sum+last);
            var wq=pw/(c*mu-lambda);
            return {pw:Math.min(pw,0.99),wq:Math.max(0,wq),util:rho};
        }

        /* ===== PERCENTILE ===== */
        function percentile(arr,p){ arr.sort(function(a,b){return a-b;}); var i=(p/100)*(arr.length-1); var lo=Math.floor(i),hi=Math.ceil(i); return arr[lo]+(arr[hi]-arr[lo])*(i-lo); }

        /* ===== CORE CALCULATION ===== */
        function getParams(){
            return {
                category: $('calcCategory').value,
                vendorSLA: val('calcVendorSLA',4),
                skillLevel: parseInt($('calcSkillLevel').value)||2,
                incidents: val('calcIncidents',36),
                costHour: val('calcCostHour',9000),
                callout: val('calcCallout',2500),
                training: val('calcTraining',50000),
                mtbf: val('proMTBF',8760),
                offHours: val('proOffHours',2.0),
                coverage: $('proCoverage')?$('proCoverage').value:'24_7',
                spares: val('proSpares',80),
                teamSize: val('proTeamSize',4),
                retainer: val('proRetainer',180000),
                criticalPct: val('proCriticalPct',40),
                durVar: $('proDurVar')?$('proDurVar').value:'medium'
            };
        }

        function calcPhases(p){
            var base = CATEGORY_BASE[p.category];
            var sf = SKILL_FACTORS[p.skillLevel];
            var mob = COVERAGE_MOB[p.coverage]||0.25;
            var spareFactor = 1 + (100-p.spares)/100 * 0.5;
            return {
                vendor: {detect:base.detect, diagnose:base.diagnose, mobilize:p.vendorSLA, repair:base.repair, verify:base.verify},
                inhouse: {detect:base.detect, diagnose:base.diagnose*sf, mobilize:mob, repair:base.repair*sf*spareFactor, verify:base.verify}
            };
        }

        function sumPhases(ph){ return ph.detect+ph.diagnose+ph.mobilize+ph.repair+ph.verify; }

        function calculate(){
            var p = getParams();
            var phases = calcPhases(p);
            var vendorMTTR = sumPhases(phases.vendor);
            var inhouseMTTR = sumPhases(phases.inhouse);

            // Phase table
            var phList = [
                {name:'Detection', v:phases.vendor.detect, i:phases.inhouse.detect},
                {name:'Diagnosis', v:phases.vendor.diagnose, i:phases.inhouse.diagnose},
                {name:'Mobilization', v:phases.vendor.mobilize, i:phases.inhouse.mobilize},
                {name:'Repair', v:phases.vendor.repair, i:phases.inhouse.repair},
                {name:'Verification', v:phases.vendor.verify, i:phases.inhouse.verify}
            ];
            var tbody = $('phaseTableBody');
            tbody.innerHTML = '';
            phList.forEach(function(ph){
                var tr = document.createElement('tr');
                tr.innerHTML = '<td class="phase-label">'+ph.name+'</td><td class="vendor-val">'+fmt(ph.v)+'</td><td class="inhouse-val">'+fmt(ph.i)+'</td><td>'+fmt(ph.v-ph.i)+'</td>';
                tbody.appendChild(tr);
            });
            var totalTr = document.createElement('tr');
            totalTr.style.fontWeight='700'; totalTr.style.borderTop='2px solid rgba(59,130,246,0.3)';
            totalTr.innerHTML = '<td class="phase-label">TOTAL</td><td class="vendor-val">'+fmt(vendorMTTR)+'</td><td class="inhouse-val">'+fmt(inhouseMTTR)+'</td><td>'+fmt(vendorMTTR-inhouseMTTR)+'</td>';
            tbody.appendChild(totalTr);

            // Annual analysis
            var vDown = vendorMTTR * p.incidents;
            var iDown = inhouseMTTR * p.incidents;
            var critW = p.criticalPct/100;
            var effCostHour = p.costHour * critW + p.costHour * 0.3 * (1-critW);
            var downtimeSavings = (vDown - iDown) * effCostHour;
            var vendorCosts = p.incidents * p.callout;
            var retainerSavings = p.retainer * 0.55;
            var netSavings = downtimeSavings + vendorCosts + retainerSavings - p.training;
            var roi = p.training > 0 ? (netSavings/p.training)*100 : 0;
            var monthlyBenefit = (downtimeSavings + vendorCosts + retainerSavings)/12;
            var breakeven = monthlyBenefit > 0 ? p.training/monthlyBenefit : 99;

            // Update Free results
            $('resVendorMTTR').textContent = fmt(vendorMTTR);
            $('resInhouseMTTR').textContent = fmt(inhouseMTTR);
            $('resVendorDowntime').textContent = fmt(vDown,1);
            $('resInhouseDowntime').textContent = fmt(iDown,1);
            var sEl=$('resNetSavings'); sEl.textContent=fmtK(netSavings); sEl.className='calc-result-value '+(netSavings>=0?'positive':'negative');
            var rEl=$('resROI'); rEl.textContent=Math.round(roi)+'%'; rEl.className='calc-result-value '+(roi>=0?'positive':'negative');
            $('resBreakeven').textContent = breakeven<12?fmt(breakeven,1)+' mo':Math.round(breakeven)+' mo';

            // Pro calculations
            if(isPremium && calcMode==='pro') calculatePro(p, phases, vendorMTTR, inhouseMTTR, effCostHour);
        }

        /* ===== PRO ENGINE ===== */
        function calculatePro(p, phases, vendorMTTR, inhouseMTTR, effCostHour){
            var cv = DUR_CV[p.durVar]||0.35;
            var N = 5000;

            // Monte Carlo — sample in-house MTTR distribution
            var mcInhouse=[], mcVendor=[], mcDown=[], mcSavings=[], mcBreakeven=[];
            for(var i=0;i<N;i++){
                var iD = sampleLognormal(phases.inhouse.detect, cv*0.5);
                var iDg = sampleLognormal(phases.inhouse.diagnose, cv);
                var iM = sampleLognormal(phases.inhouse.mobilize, cv*0.7);
                var iR = sampleLognormal(phases.inhouse.repair, cv);
                var iV = sampleLognormal(phases.inhouse.verify, cv*0.5);
                var iTotal = iD+iDg+iM+iR+iV;
                mcInhouse.push(iTotal);

                var vSLA = sampleLognormal(p.vendorSLA, cv*0.6);
                var offHoursChance = 0.42;
                if(Math.random()<offHoursChance) vSLA *= (1 + (p.offHours-1)*Math.random());
                var vTotal = sampleLognormal(phases.vendor.detect,cv*0.5) + sampleLognormal(phases.vendor.diagnose,cv) + vSLA + sampleLognormal(phases.vendor.repair,cv) + sampleLognormal(phases.vendor.verify,cv*0.5);
                mcVendor.push(vTotal);

                var annualInc = Math.max(1, Math.round(p.incidents + gaussRand()*Math.sqrt(p.incidents)));
                var vDn = vTotal * annualInc;
                var iDn = iTotal * annualInc;
                mcDown.push(iDn);
                var sav = (vDn-iDn)*effCostHour + annualInc*p.callout + p.retainer*0.55 - p.training;
                mcSavings.push(sav);
                var mb = ((vDn-iDn)*effCostHour + annualInc*p.callout + p.retainer*0.55)/12;
                mcBreakeven.push(mb>0?p.training/mb:99);
            }

            // Panel 1: MTTR Distribution
            var meanIH = mcInhouse.reduce(function(a,b){return a+b;},0)/N;
            var medianIH = percentile(mcInhouse,50);
            var p90IH = percentile(mcInhouse,90);
            var mobPct = (phases.vendor.mobilize/vendorMTTR*100);
            var phNames=['Detect','Diagnose','Mobilize','Repair','Verify'];
            var phVals=[phases.vendor.detect,phases.vendor.diagnose,phases.vendor.mobilize,phases.vendor.repair,phases.vendor.verify];
            var maxPh=0,maxIdx=0; for(var j=0;j<5;j++){if(phVals[j]>maxPh){maxPh=phVals[j];maxIdx=j;}}
            var reduction = (vendorMTTR-inhouseMTTR)/vendorMTTR*100;

            $('proMeanMTTR').textContent = fmt(meanIH)+'h';
            $('proMedianMTTR').textContent = fmt(medianIH)+'h';
            $('proP90MTTR').textContent = fmt(p90IH)+'h';
            $('proMobPct').textContent = pct(mobPct);
            $('proBottleneck').textContent = phNames[maxIdx];
            $('proBottleneck').style.fontSize='1rem';
            $('proMTTRReduction').textContent = pct(reduction);

            // Panel 2: Availability
            var availV = p.mtbf/(p.mtbf+vendorMTTR)*100;
            var availI = p.mtbf/(p.mtbf+inhouseMTTR)*100;
            var downVp50 = percentile(mcDown.map(function(d){return d;}),50);
            var meanVDown = mcVendor.reduce(function(a,b){return a+b;},0)/N * p.incidents;
            $('proAvailVendor').textContent = fmt(availV,3)+'%';
            $('proAvailInhouse').textContent = fmt(availI,3)+'%';
            $('proAvailDelta').textContent = '+'+fmt(availI-availV,3)+' pp';
            $('proDownVendorP50').textContent = fmt(percentile(mcVendor,50)*p.incidents,0)+'h';
            $('proDownInhouseP50').textContent = fmt(downVp50,0)+'h';
            $('proHoursSaved').textContent = fmt(meanVDown-meanIH*p.incidents,0)+'h';

            // Panel 3: Financial
            var discRate=0.08;
            var npv3=0; for(var y=1;y<=3;y++){
                var annSav = (vendorMTTR-inhouseMTTR)*p.incidents*effCostHour + p.incidents*p.callout + p.retainer*0.55;
                var annCost = y===1?p.training*1.7:p.training;
                npv3 += (annSav-annCost)/Math.pow(1+discRate,y);
            }
            var costPerIncV = (vendorMTTR*effCostHour + p.callout);
            var costPerIncI = (inhouseMTTR*effCostHour + p.training/p.incidents);
            var bep50 = percentile(mcBreakeven,50);
            var bep90 = percentile(mcBreakeven,90);
            var cum3 = 0; for(var y=1;y<=3;y++){
                var s = (vendorMTTR-inhouseMTTR)*p.incidents*effCostHour + p.incidents*p.callout + p.retainer*0.55 - (y===1?p.training*1.7:p.training);
                cum3 += s;
            }
            $('proNPV3').textContent = fmtK(npv3);
            $('proCostVendor').textContent = fmtK(costPerIncV);
            $('proCostInhouse').textContent = fmtK(costPerIncI);
            $('proBEp50').textContent = fmt(Math.max(0.5,bep50),1)+' mo';
            $('proBEp90').textContent = fmt(Math.max(0.5,bep90),1)+' mo';
            $('pro3YrSavings').textContent = fmtK(cum3);

            // Panel 4: Erlang-C
            var lambda = p.incidents/(365*24);
            var mu = 1/inhouseMTTR;
            var c = Math.max(1,p.teamSize);
            var ec = erlangC(lambda,mu,c);
            var optTeam = c;
            for(var t=1;t<=20;t++){var test=erlangC(lambda,mu,t);if(test.pw<0.05){optTeam=t;break;}}
            $('proWaitProb').textContent = pct(ec.pw*100);
            $('proQueueDelay').textContent = fmt(ec.wq*60,0)+' min';
            $('proOptTeam').textContent = optTeam+' FTE';
            $('proUtilRate').textContent = pct(ec.util*100);
            $('proUtilRate').className = 'calc-result-value '+(ec.util>0.8?'negative':ec.util>0.6?'':'positive');

            // Panel 5: Scenarios
            var baseNet = (vendorMTTR-inhouseMTTR)*p.incidents*effCostHour;
            // +1 Technician
            var ec2 = erlangC(lambda,mu,c+1);
            var waitDelta = (ec.wq-ec2.wq)*60;
            $('proScen1').textContent = (waitDelta>0?'-':'')+fmt(Math.abs(waitDelta),0)+' min wait';
            $('proScen1').style.color = waitDelta>0?'#10b981':'#64748b';
            // +1 Skill
            var nextSkill = Math.min(5,p.skillLevel+1);
            var sfNext = SKILL_FACTORS[nextSkill];
            var base2 = CATEGORY_BASE[p.category];
            var ihNext = base2.detect + base2.diagnose*sfNext + (COVERAGE_MOB[p.coverage]||0.25) + base2.repair*sfNext*(1+(100-p.spares)/100*0.5) + base2.verify;
            var mttrDelta = inhouseMTTR - ihNext;
            $('proScen2').textContent = (mttrDelta>0?'-':'')+fmt(Math.abs(mttrDelta))+'h MTTR';
            $('proScen2').style.color = mttrDelta>0?'#10b981':'#64748b';
            // 2x Incidents
            var roi2x = p.training>0?((vendorMTTR-inhouseMTTR)*p.incidents*2*effCostHour+p.incidents*2*p.callout+p.retainer*0.55-p.training)/p.training*100:0;
            $('proScen3').textContent = Math.round(roi2x)+'% ROI';
            $('proScen3').style.color = '#f59e0b';
            // -50% Vendor SLA
            var halfSLA = p.vendorSLA*0.5;
            var vHalf = phases.vendor.detect+phases.vendor.diagnose+halfSLA+phases.vendor.repair+phases.vendor.verify;
            var savDelta = (vendorMTTR-vHalf)*p.incidents*effCostHour;
            $('proScen4').textContent = fmtK(savDelta)+' less saved';
            $('proScen4').style.color = '#ef4444';

            // Store for narrative & PDF
            lastProData = {
                p:p, vendorMTTR:vendorMTTR, inhouseMTTR:inhouseMTTR, meanIH:meanIH,
                medianIH:medianIH, p90IH:p90IH, mobPct:mobPct, reduction:reduction,
                availV:availV, availI:availI, npv3:npv3, cum3:cum3, bep50:bep50, bep90:bep90,
                ec:ec, optTeam:optTeam, bottleneck:phNames[maxIdx],
                costPerIncV:costPerIncV, costPerIncI:costPerIncI,
                mcInhouse:mcInhouse, mcSavings:mcSavings, effCostHour:effCostHour
            };

            buildNarrative(lastProData);
        }

        /* ===== NARRATIVE CONCLUSION ===== */
        function buildNarrative(d){
            var box=$('narrativeBox'); var content=$('narrativeContent');
            if(!box||!content) return;

            // Capability Maturity Grade
            var score=0;
            if(d.p.skillLevel>=4) score+=25; else if(d.p.skillLevel>=3) score+=15; else score+=5;
            if(d.reduction>=60) score+=25; else if(d.reduction>=40) score+=15; else score+=5;
            if(d.ec.pw<0.1) score+=20; else if(d.ec.pw<0.3) score+=10; else score+=3;
            if(d.npv3>0) score+=15; else score+=3;
            if(d.p.spares>=80) score+=15; else if(d.p.spares>=60) score+=8; else score+=2;
            var grade,gradeColor;
            if(score>=85){grade='A';gradeColor='#10b981';}
            else if(score>=70){grade='B';gradeColor='#3b82f6';}
            else if(score>=55){grade='C';gradeColor='#f59e0b';}
            else if(score>=40){grade='D';gradeColor='#f97316';}
            else{grade='F';gradeColor='#ef4444';}

            var html='<div style="display:flex;align-items:center;margin-bottom:1rem;">';
            html+='<div class="narrative-grade" style="background:'+gradeColor+'22;color:'+gradeColor+';border:2px solid '+gradeColor+';">'+grade+'</div>';
            html+='<div><div style="color:#e2e8f0;font-weight:700;font-size:0.95rem;">Capability Maturity: Grade '+grade+'</div>';
            html+='<div style="color:#94a3b8;font-size:0.8rem;">Score: '+score+'/100 — ';
            if(score>=85) html+='Mature, self-reliant capability profile';
            else if(score>=70) html+='Strong foundation with targeted improvement opportunities';
            else if(score>=55) html+='Moderate capability — significant vendor dependency remains';
            else if(score>=40) html+='Developing — high vendor dependency risk';
            else html+='Critical gap — heavy vendor dependency with structural risk';
            html+='</div></div></div>';

            // Summary paragraph
            html+='<div class="narrative-summary">';
            html+='<p>This facility operates with a <strong>'+d.p.category+'</strong>-domain focus, experiencing <strong>'+d.p.incidents+'</strong> critical incidents annually. ';
            html+='Monte Carlo simulation (5,000 iterations) projects an in-house mean MTTR of <strong>'+fmt(d.meanIH)+'h</strong> ';
            html+='(90th percentile: '+fmt(d.p90IH)+'h) compared to vendor mean of <strong>'+fmt(d.vendorMTTR)+'h</strong>, ';
            html+='representing a <strong>'+pct(d.reduction)+'</strong> reduction in incident response time.</p>';

            html+='<p>Vendor mobilization accounts for <strong>'+pct(d.mobPct)+'</strong> of total vendor MTTR — confirming ';
            html+='<strong>'+d.bottleneck+'</strong> as the dominant bottleneck. ';
            html+='System availability improves from <strong>'+fmt(d.availV,3)+'%</strong> to <strong>'+fmt(d.availI,3)+'%</strong> ';
            html+='(+'+fmt(d.availI-d.availV,3)+' percentage points), equivalent to approximately <strong>'+fmt((d.availI-d.availV)/100*8760,0)+'</strong> fewer downtime hours annually.</p>';

            html+='<p>The 3-year NPV of the ICB investment is <strong>'+fmtK(d.npv3)+'</strong> with breakeven at <strong>'+fmt(d.bep50,1)+' months</strong> (p50). ';
            html+='Erlang-C staffing analysis indicates a wait probability of <strong>'+pct(d.ec.pw*100)+'</strong> with the current team of '+d.p.teamSize+' responders';
            if(d.optTeam!==d.p.teamSize) html+='; optimal staffing is <strong>'+d.optTeam+' FTE</strong>';
            html+='.</p></div>';

            // Prioritized Actions
            var actions=[];
            if(d.p.skillLevel<4) actions.push({pri:'CRITICAL',text:'Invest in skill development: current Level '+d.p.skillLevel+' limits diagnosis and repair speed by '+(SKILL_FACTORS[d.p.skillLevel]>1?'+':'')+Math.round((SKILL_FACTORS[d.p.skillLevel]-1)*100)+'%',color:'#ef4444'});
            if(d.mobPct>50) actions.push({pri:'CRITICAL',text:'Mobilization represents '+pct(d.mobPct)+' of vendor MTTR — transition to in-house Tier 2 response for immediate 3.75h+ savings per incident',color:'#ef4444'});
            if(d.ec.pw>0.2) actions.push({pri:'HIGH',text:'Queue wait probability is '+pct(d.ec.pw*100)+' — consider adding '+(d.optTeam-d.p.teamSize)+' FTE to reduce concurrent incident delays',color:'#f59e0b'});
            if(d.p.spares<70) actions.push({pri:'HIGH',text:'Spare parts readiness at '+d.p.spares+'% — invest in critical spares inventory (ICB Phase 3) to reduce repair phase delays',color:'#f59e0b'});
            if(d.p.coverage!=='24_7') actions.push({pri:'MEDIUM',text:'Current '+d.p.coverage.replace('_','/')+' coverage creates mobilization gaps during '+Math.round((1-0.42)*100)+'% of off-hours — evaluate 24/7 rotation feasibility',color:'#3b82f6'});
            if(d.npv3>100000) actions.push({pri:'MEDIUM',text:'Strong NPV of '+fmtK(d.npv3)+' supports accelerated ICB investment — consider front-loading training spend for faster capability ramp',color:'#3b82f6'});
            if(d.ec.util>0.7) actions.push({pri:'LOW',text:'Team utilization at '+pct(d.ec.util*100)+' — approaching saturation threshold; monitor for burnout and cross-training gaps',color:'#64748b'});
            if(actions.length<4) actions.push({pri:'LOW',text:'Establish monthly drill cadence (ICB Phase 5) to maintain diagnostic competence across all infrastructure domains',color:'#64748b'});

            html+='<div class="narrative-actions"><div style="font-weight:700;color:#e2e8f0;font-size:0.85rem;margin-bottom:0.5rem;"><i class="fas fa-list-check" style="color:var(--accent-blue);margin-right:6px;"></i> Prioritized Actions</div>';
            for(var i=0;i<Math.min(6,actions.length);i++){
                html+='<div class="narrative-action"><span class="action-pri" style="background:'+actions[i].color+';">'+actions[i].pri+'</span><span>'+actions[i].text+'</span></div>';
            }
            html+='</div>';

            content.innerHTML=html;
            box.classList.add('visible');
        }

        /* ===== PDF EXPORT ===== */
        function exportMTTRPDF(){
            if(!lastProData) return;
            var d=lastProData, p=d.p;
            var today=new Date().toLocaleDateString('en-US',{year:'numeric',month:'long',day:'numeric'});

            var hdrS='background:#1e3a5f;color:#fff;padding:8px 12px;font-weight:600;font-size:11px;text-align:left;';
            var cellS='padding:8px 12px;border-bottom:1px solid #e2e8f0;font-size:11px;';

            var html='<!DOCTYPE html><html><head><meta charset="UTF-8"><title>MTTR & Capability Analytics — Executive Report</title>';
            html+='<style>*{margin:0;padding:0;box-sizing:border-box;}body{font-family:Inter,Segoe UI,system-ui,sans-serif;color:#1e293b;line-height:1.6;padding:40px;}';
            html+='h1{font-size:20px;color:#1e3a5f;margin-bottom:4px;}h2{font-size:14px;color:#1e3a5f;margin:24px 0 12px;padding-bottom:6px;border-bottom:2px solid #3b82f6;}';
            html+='table{width:100%;border-collapse:collapse;margin:12px 0;}p{font-size:11px;margin-bottom:8px;line-height:1.65;}';
            html+='.grade-box{display:inline-flex;align-items:center;justify-content:center;width:44px;height:44px;border-radius:10px;font-size:24px;font-weight:800;margin-right:12px;}';
            html+='.kpi-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin:12px 0;}';
            html+='.kpi{background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px;padding:10px;text-align:center;}';
            html+='.kpi-val{font-size:16px;font-weight:800;color:#1e3a5f;}.kpi-label{font-size:9px;color:#64748b;text-transform:uppercase;letter-spacing:0.3px;}';
            html+='@media print{body{padding:20px;font-size:10px;}h1{font-size:16px;}h2{font-size:12px;}.kpi-grid{grid-template-columns:repeat(3,1fr);}}</style></head><body>';

            // Header
            html+='<div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:20px;padding-bottom:16px;border-bottom:3px solid #1e3a5f;">';
            html+='<div><h1>MTTR & Capability Analytics</h1><div style="color:#64748b;font-size:11px;">Executive Report — '+p.category+' Domain | '+today+'</div></div>';
            html+='<div style="text-align:right;"><div style="font-size:9px;color:#94a3b8;text-transform:uppercase;letter-spacing:1px;">RESISTANCEZERO</div><div style="font-size:9px;color:#94a3b8;">Pro Analysis Report</div></div></div>';

            // Grade
            var score=0;
            if(p.skillLevel>=4)score+=25;else if(p.skillLevel>=3)score+=15;else score+=5;
            if(d.reduction>=60)score+=25;else if(d.reduction>=40)score+=15;else score+=5;
            if(d.ec.pw<0.1)score+=20;else if(d.ec.pw<0.3)score+=10;else score+=3;
            if(d.npv3>0)score+=15;else score+=3;
            if(p.spares>=80)score+=15;else if(p.spares>=60)score+=8;else score+=2;
            var grade,gColor;
            if(score>=85){grade='A';gColor='#10b981';}else if(score>=70){grade='B';gColor='#3b82f6';}
            else if(score>=55){grade='C';gColor='#f59e0b';}else if(score>=40){grade='D';gColor='#f97316';}
            else{grade='F';gColor='#ef4444';}

            html+='<div style="display:flex;align-items:center;margin:16px 0;padding:12px;background:'+gColor+'11;border:1px solid '+gColor+'33;border-radius:10px;">';
            html+='<div class="grade-box" style="background:'+gColor+'22;color:'+gColor+';border:2px solid '+gColor+';">'+grade+'</div>';
            html+='<div><div style="font-weight:700;font-size:13px;">Capability Maturity Grade: '+grade+' ('+score+'/100)</div>';
            html+='<div style="font-size:10px;color:#64748b;">'+p.category+' domain | '+p.incidents+' incidents/yr | Skill Level '+p.skillLevel+' | Team Size '+p.teamSize+'</div></div></div>';

            // Executive Summary
            html+='<h2>Executive Summary</h2>';
            html+='<p>Monte Carlo analysis (5,000 iterations) projects in-house MTTR of <strong>'+fmt(d.meanIH)+'h</strong> (mean) vs vendor <strong>'+fmt(d.vendorMTTR)+'h</strong>, a <strong>'+pct(d.reduction)+'</strong> reduction. Vendor mobilization at <strong>'+pct(d.mobPct)+'</strong> of total MTTR confirms the structural bottleneck thesis. System availability improves from '+fmt(d.availV,3)+'% to '+fmt(d.availI,3)+'%. The 3-year NPV is <strong>'+fmtK(d.npv3)+'</strong> with breakeven at '+fmt(d.bep50,1)+' months (p50).</p>';

            // KPI Grid
            html+='<h2>Key Performance Indicators</h2><div class="kpi-grid">';
            var kpis=[
                {l:'Vendor MTTR',v:fmt(d.vendorMTTR)+'h'},{l:'In-House MTTR (mean)',v:fmt(d.meanIH)+'h'},{l:'MTTR Reduction',v:pct(d.reduction)},
                {l:'Vendor Availability',v:fmt(d.availV,3)+'%'},{l:'In-House Availability',v:fmt(d.availI,3)+'%'},{l:'Availability Delta',v:'+'+fmt(d.availI-d.availV,3)+' pp'},
                {l:'3-Year NPV',v:fmtK(d.npv3)},{l:'Breakeven (p50)',v:fmt(d.bep50,1)+' mo'},{l:'3-Yr Cumulative',v:fmtK(d.cum3)},
                {l:'Wait Probability',v:pct(d.ec.pw*100)},{l:'Optimal Team',v:d.optTeam+' FTE'},{l:'Utilization',v:pct(d.ec.util*100)}
            ];
            for(var i=0;i<kpis.length;i++) html+='<div class="kpi"><div class="kpi-val">'+kpis[i].v+'</div><div class="kpi-label">'+kpis[i].l+'</div></div>';
            html+='</div>';

            // MTTR Phase Table
            html+='<h2>MTTR Phase Decomposition</h2>';
            html+='<table><tr><td style="'+hdrS+'">Phase</td><td style="'+hdrS+'">Vendor (hrs)</td><td style="'+hdrS+'">In-House (hrs)</td><td style="'+hdrS+'">Savings</td><td style="'+hdrS+'">% of Total Savings</td></tr>';
            var base=CATEGORY_BASE[p.category];var sf=SKILL_FACTORS[p.skillLevel];var spF=1+(100-p.spares)/100*0.5;
            var mob=COVERAGE_MOB[p.coverage]||0.25;
            var phs=[{n:'Detection',v:base.detect,i:base.detect},{n:'Diagnosis',v:base.diagnose,i:base.diagnose*sf},{n:'Mobilization',v:p.vendorSLA,i:mob},{n:'Repair',v:base.repair,i:base.repair*sf*spF},{n:'Verification',v:base.verify,i:base.verify}];
            var totalSav=d.vendorMTTR-d.inhouseMTTR;
            for(var i=0;i<phs.length;i++){var s=phs[i].v-phs[i].i;html+='<tr><td style="'+cellS+'font-weight:600;">'+phs[i].n+'</td><td style="'+cellS+'">'+fmt(phs[i].v)+'</td><td style="'+cellS+'color:#10b981;font-weight:600;">'+fmt(phs[i].i)+'</td><td style="'+cellS+'">'+fmt(s)+'h</td><td style="'+cellS+'">'+(totalSav>0?pct(s/totalSav*100):'—')+'</td></tr>';}
            html+='<tr style="font-weight:700;background:#f1f5f9;"><td style="'+cellS+'">TOTAL</td><td style="'+cellS+'">'+fmt(d.vendorMTTR)+'h</td><td style="'+cellS+'color:#10b981;">'+fmt(d.inhouseMTTR)+'h</td><td style="'+cellS+'">'+fmt(totalSav)+'h</td><td style="'+cellS+'">100%</td></tr>';
            html+='</table>';

            // Monte Carlo
            html+='<h2>Monte Carlo Distribution (5,000 iterations)</h2>';
            html+='<p>In-House MTTR: p10='+fmt(percentile(d.mcInhouse,10))+'h | p50='+fmt(d.medianIH)+'h | p90='+fmt(d.p90IH)+'h</p>';
            html+='<p>Annual Savings: p10='+fmtK(percentile(d.mcSavings,10))+' | p50='+fmtK(percentile(d.mcSavings,50))+' | p90='+fmtK(percentile(d.mcSavings,90))+'</p>';

            // Recommendations
            html+='<h2>Prioritized Recommendations</h2><table><tr><td style="'+hdrS+'width:80px;">Priority</td><td style="'+hdrS+'">Action</td></tr>';
            var actions=[];
            if(p.skillLevel<4) actions.push({pri:'CRITICAL',text:'Accelerate skill development from Level '+p.skillLevel+' — each level reduces diagnosis and repair time by 20-25%'});
            if(d.mobPct>50) actions.push({pri:'CRITICAL',text:'Transition '+Math.round(d.mobPct)+'% mobilization-dominated incidents to in-house Tier 2 response'});
            if(d.ec.pw>0.2) actions.push({pri:'HIGH',text:'Expand team from '+p.teamSize+' to '+d.optTeam+' FTE to reduce queue probability below 5%'});
            if(p.spares<70) actions.push({pri:'HIGH',text:'Build critical spares inventory — current '+p.spares+'% readiness adds repair phase delays'});
            if(p.coverage!=='24_7') actions.push({pri:'MEDIUM',text:'Evaluate 24/7 coverage to eliminate off-hours mobilization gap'});
            actions.push({pri:'LOW',text:'Establish monthly ICB drill cadence for sustained competence maintenance'});
            var priColors={CRITICAL:'#ef4444',HIGH:'#f59e0b',MEDIUM:'#3b82f6',LOW:'#64748b'};
            for(var i=0;i<actions.length;i++) html+='<tr><td style="'+cellS+'"><span style="background:'+priColors[actions[i].pri]+';color:#fff;font-size:9px;font-weight:700;padding:2px 8px;border-radius:4px;">'+actions[i].pri+'</span></td><td style="'+cellS+'font-size:11px;">'+actions[i].text+'</td></tr>';
            html+='</table>';

            // Footer
            html+='<div style="margin-top:30px;padding-top:16px;border-top:2px solid #e2e8f0;display:flex;justify-content:space-between;align-items:center;">';
            html+='<div style="font-size:10px;color:#94a3b8;">Generated by ResistanceZero MTTR Pro | '+today+'</div>';
            html+='<div style="font-size:10px;color:#94a3b8;">Based on Article 4: In-House Capability Is a Reliability Strategy</div></div>';
        html+='
<!-- ═══ Feature 22: Reading Progress Bar ═══ -->
<script>
(function() {
    var bar = document.getElementById('scrollProgress');
    if (!bar) return;
    var ticking = false;
    function updateProgress() {
        var scrollTop = window.scrollY || document.documentElement.scrollTop;
        var docHeight = document.documentElement.scrollHeight - window.innerHeight;
        var pct = docHeight > 0 ? (scrollTop / docHeight) * 100 : 0;
        bar.style.width = Math.min(pct, 100) + '%';
        ticking = false;
    }
    window.addEventListener('scroll', function() {
        if (!ticking) { requestAnimationFrame(updateProgress); ticking = true; }
    }, { passive: true });
    updateProgress();
})();
</script>

<!-- ═══ Feature 23: TOC Sidebar ═══ -->
<script>
(function() {
    // Find H2s with IDs first, then fallback to auto-generating IDs
    var sections = document.querySelectorAll('.article-body h2[id], .article-content h2[id]');
    if (!sections.length) {
        var allH2s = document.querySelectorAll('.article-body h2, .article-content h2');
        allH2s.forEach(function(h2, i) {
            if (!h2.id) h2.id = 'toc-section-' + (i + 1);
        });
        sections = document.querySelectorAll('.article-body h2[id], .article-content h2[id]');
    }
    if (!sections.length) return;

    var sidebarList = document.getElementById('tocSidebarList');
    var mobileList = document.getElementById('tocMobileList');
    var sidebar = document.getElementById('tocSidebar');
    var tocToggle = document.getElementById('tocMobileToggle');
    var tocDrawer = document.getElementById('tocMobileDrawer');
    var tocBackdrop = document.getElementById('tocMobileBackdrop');
    var tocClose = document.getElementById('tocDrawerClose');

    var tocData = [];
    sections.forEach(function(h2, i) {
        var id = h2.getAttribute('id');
        var numMatch = id.match(/\d+/);
        var num = numMatch ? numMatch[0] : String(i + 1);
        var text = h2.textContent.replace(/^\s*\d+[\.\s]*/, '').trim();
        tocData.push({ id: id, num: num, text: text });
    });

    function buildList(container, isMobile) {
        tocData.forEach(function(item) {
            var li = document.createElement('li');
            if (!isMobile) li.className = 'toc-sidebar-item';
            var a = document.createElement('a');
            a.href = '#' + item.id;
            a.setAttribute('data-section', item.id);
            if (isMobile) {
                a.textContent = item.num + '. ' + item.text;
            } else {
                a.className = 'toc-sidebar-link';
                a.innerHTML = '<span class="toc-sidebar-num">' + item.num + '</span>' + item.text;
            }
            a.addEventListener('click', function(e) {
                e.preventDefault();
                var target = document.getElementById(item.id);
                if (target) window.scrollTo({ top: target.offsetTop - 80, behavior: 'smooth' });
                if (isMobile) closeMobileDrawer();
            });
            li.appendChild(a);
            container.appendChild(li);
        });
    }

    buildList(sidebarList, false);
    buildList(mobileList, true);

    var currentSection = null;
    var observer = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry) {
            if (entry.isIntersecting) {
                currentSection = entry.target.getAttribute('id');
                highlightActive(currentSection);
            }
        });
    }, { rootMargin: '-80px 0px -70% 0px', threshold: 0 });

    sections.forEach(function(s) { observer.observe(s); });

    function highlightActive(sectionId) {
        sidebarList.querySelectorAll('.toc-sidebar-link').forEach(function(a) {
            a.classList.toggle('active', a.getAttribute('data-section') === sectionId);
        });
        mobileList.querySelectorAll('a').forEach(function(a) {
            a.classList.toggle('active', a.getAttribute('data-section') === sectionId);
        });
    }

    var articleContent = document.querySelector('.article-content');
    if (articleContent && sidebar) {
        var sidebarObserver = new IntersectionObserver(function(entries) {
            entries.forEach(function(entry) {
                sidebar.classList.toggle('visible', entry.isIntersecting);
            });
        }, { rootMargin: '0px', threshold: 0.01 });
        sidebarObserver.observe(articleContent);
    }

    function openMobileDrawer() {
        tocDrawer.classList.add('active');
        tocBackdrop.classList.add('active');
        document.body.style.overflow = 'hidden';
    }
    function closeMobileDrawer() {
        tocDrawer.classList.remove('active');
        tocBackdrop.classList.remove('active');
        document.body.style.overflow = '';
    }

    if (tocToggle) tocToggle.addEventListener('click', openMobileDrawer);
    if (tocClose) tocClose.addEventListener('click', closeMobileDrawer);
    if (tocBackdrop) tocBackdrop.addEventListener('click', closeMobileDrawer);
})();
</script>

<!-- ═══ Feature 21: Global Search ═══ -->
<script>
(function() {
    var searchBtn = document.getElementById('navSearchBtn');
    var overlay = document.getElementById('searchOverlay');
    var modal = document.getElementById('searchModal');
    var input = document.getElementById('searchInput');
    var resultsEl = document.getElementById('searchResults');
    var fuse = null;
    var searchData = null;
    var focusedIdx = -1;

    function openSearch() {
        overlay.classList.add('active');
        modal.classList.add('active');
        input.value = '';
        input.focus();
        focusedIdx = -1;
        resultsEl.innerHTML = '<div class="search-empty">Type to search across all content</div>';
        if (!searchData) {
            fetch('search-index.json')
                .then(function(r) { return r.json(); })
                .then(function(data) {
                    searchData = data;
                    fuse = new Fuse(data, {
                        keys: [
                            { name: 'title', weight: 0.4 },
                            { name: 'description', weight: 0.25 },
                            { name: 'keywords', weight: 0.25 },
                            { name: 'category', weight: 0.1 }
                        ],
                        threshold: 0.35,
                        includeScore: true,
                        minMatchCharLength: 2
                    });
                })
                .catch(function() {});
        }
    }

    function closeSearch() {
        overlay.classList.remove('active');
        modal.classList.remove('active');
        input.blur();
    }

    function getIconClass(cat) {
        cat = (cat || '').toLowerCase();
        if (cat === 'calculator') return 'calc';
        if (cat === 'tool') return 'tool';
        return '';
    }

    function getIconLabel(item) {
        if (item.url && item.url.indexOf('article-') === 0) {
            return item.url.replace('article-', '').replace('.html', '').padStart(2, '0');
        }
        var cat = (item.category || '').toLowerCase();
        if (cat === 'calculator') return '&#9889;';
        if (cat === 'tool') return '&#9881;';
        return '&#9733;';
    }

    function renderResults(results) {
        if (!results.length) {
            resultsEl.innerHTML = '<div class="search-empty">No results found</div>';
            focusedIdx = -1;
            return;
        }
        var html = '';
        results.slice(0, 8).forEach(function(r, i) {
            var item = r.item;
            var iconCls = getIconClass(item.category);
            html += '<a href="' + item.url + '" class="search-result-item" data-idx="' + i + '">'
                + '<div class="search-result-icon ' + iconCls + '">' + getIconLabel(item) + '</div>'
                + '<div class="search-result-info">'
                + '<div class="search-result-category">' + (item.category || '') + '</div>'
                + '<div class="search-result-title">' + item.title + '</div>'
                + '<div class="search-result-desc">' + item.description + '</div>'
                + '</div></a>';
        });
        resultsEl.innerHTML = html;
        focusedIdx = -1;
    }

    function updateFocus() {
        var items = resultsEl.querySelectorAll('.search-result-item');
        items.forEach(function(el, i) {
            el.classList.toggle('focused', i === focusedIdx);
            if (i === focusedIdx) el.scrollIntoView({ block: 'nearest' });
        });
    }

    if (searchBtn) searchBtn.addEventListener('click', openSearch);
    if (overlay) overlay.addEventListener('click', closeSearch);

    document.addEventListener('keydown', function(e) {
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
            e.preventDefault();
            if (modal.classList.contains('active')) closeSearch();
            else openSearch();
            return;
        }
        if (!modal.classList.contains('active')) return;
        if (e.key === 'Escape') { closeSearch(); return; }
        var items = resultsEl.querySelectorAll('.search-result-item');
        if (e.key === 'ArrowDown') {
            e.preventDefault();
            focusedIdx = Math.min(focusedIdx + 1, items.length - 1);
            updateFocus();
        } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            focusedIdx = Math.max(focusedIdx - 1, 0);
            updateFocus();
        } else if (e.key === 'Enter' && focusedIdx >= 0 && items[focusedIdx]) {
            e.preventDefault();
            items[focusedIdx].click();
        }
    });

    if (input) {
        input.addEventListener('input', function() {
            var query = input.value.trim();
            if (query.length < 2 || !fuse) {
                resultsEl.innerHTML = '<div class="search-empty">Type to search across all content</div>';
                focusedIdx = -1;
                return;
            }
            var results = fuse.search(query);
            renderResults(results);
        });
    }
})();
</script>

</body></html>';

            var w=window.open('','_blank');
            if(w){w.document.write(html);w.document.close();setTimeout(function(){w.print();},500);}
        }
        window.exportMTTRPDF = exportMTTRPDF;

        /* ===== MODE SWITCHING ===== */
        function switchCalcMode(mode){
            calcMode=mode;
            $('modeFree').classList.toggle('active',mode==='free');
            $('modePro').classList.toggle('active',mode==='pro');

            var drawer=$('proDrawer'), panels=$('proPanels'), cta=$('ctaCard'), narr=$('narrativeBox'), pdf=$('pdfBtn');
            if(mode==='pro'){
                if(!isPremium){
                    if(window._rzAuth&&typeof window._rzAuth.showModal==='function') window._rzAuth.showModal();
                    else showLoginModal();
                    return;
                }
                if(drawer) drawer.classList.add('visible');
                if(panels) panels.classList.add('visible');
                if(cta) cta.style.display='none';
                if(pdf){pdf.disabled=false;}
                applyGating();
                calculate();
            } else {
                if(drawer) drawer.classList.remove('visible');
                if(panels) panels.classList.remove('visible');
                if(narr) narr.classList.remove('visible');
                if(cta) cta.style.display='flex';
                if(pdf){pdf.disabled=true;}
            }
        }
        window.switchCalcMode = switchCalcMode;

        function applyGating(){
            for(var i=1;i<=5;i++){
                var g=$('gate'+i);
                if(g) g.style.display = isPremium?'none':'flex';
            }
        }

        /* ===== LOGIN ===== */
        function showLoginModal(){ $('loginOverlay').classList.add('visible'); }
        function hideLoginModal(){ $('loginOverlay').classList.remove('visible'); $('loginError').style.display='none'; }
        window.showLoginModal = showLoginModal;
        window.hideLoginModal = hideLoginModal;

        function handleLogin(){
            var email=$('loginEmail').value.trim().toLowerCase();
            var pass=$('loginPass').value;
            if(email==='demo@resistancezero.com' && pass==='demo2026'){
                isPremium=true;
                var exp=new Date(); exp.setDate(exp.getDate()+30);
                localStorage.setItem('rz_premium_session',JSON.stringify({email:email,tier:'pro',expires:exp.toISOString()}));
                hideLoginModal();
                // Notify auth.js to update navbar
                window.dispatchEvent(new CustomEvent('rz-auth-change',{detail:{email:email,tier:'pro',action:'login'}}));
                var badge=$('proBadge'); if(badge){badge.textContent='ACTIVE';badge.style.background='linear-gradient(135deg,#10b981,#059669)';}
                switchCalcMode('pro');
            } else {
                $('loginError').style.display='block';
            }
        }
        window.handleLogin = handleLogin;

        /* ===== TOOLTIPS ===== */
        function initTooltips(){
            var tc=$('calc-tooltip-container');
            if(!tc) return;
            document.querySelectorAll('.tooltip-trigger').forEach(function(t){
                t.addEventListener('mouseenter',function(){
                    var content=t.querySelector('.tooltip-content');
                    if(!content) return;
                    tc.innerHTML=content.innerHTML;
                    tc.style.display='block';
                    var r=t.getBoundingClientRect();
                    var calcSection=document.querySelector('.calculator-section');
                    var cr=calcSection.getBoundingClientRect();
                    tc.style.top=(r.bottom-cr.top+8)+'px';
                    tc.style.left=Math.max(10,Math.min(cr.width-340,r.left-cr.left))+'px';
                });
                t.addEventListener('mouseleave',function(){ tc.style.display='none'; });
            });
        }

        /* ===== EVENT LISTENERS ===== */
        var freeInputs = ['calcCategory','calcVendorSLA','calcSkillLevel','calcIncidents','calcCostHour','calcCallout','calcTraining'];
        var proInputs = ['proMTBF','proOffHours','proCoverage','proSpares','proTeamSize','proRetainer','proCriticalPct','proDurVar'];
        freeInputs.concat(proInputs).forEach(function(id){
            var el=$(id);
            if(el){ el.addEventListener('input',calculate); el.addEventListener('change',calculate); }
        });

        /* ===== SESSION RESTORE ===== */
        try{
            var sess=JSON.parse(localStorage.getItem('rz_premium_session'));
            if(sess&&sess.email){
                var valid=false;
                if(sess.expires){ valid=new Date(sess.expires)>new Date(); }
                else if(sess.ts){ valid=(Date.now()-sess.ts)<30*86400000; }
                if(valid){
                    isPremium=true;
                    var badge=$('proBadge'); if(badge){badge.textContent='ACTIVE';badge.style.background='linear-gradient(135deg,#10b981,#059669)';}
                }
            }
        }catch(ex){}

        // Listen for global auth changes (login/logout via navbar auth.js)
        window.addEventListener('rz-auth-change', function(e) {
            if (e.detail && e.detail.action === 'login') {
                isPremium = true;
                var badge=$('proBadge'); if(badge){badge.textContent='ACTIVE';badge.style.background='linear-gradient(135deg,#10b981,#059669)';}
                applyGating();
                switchCalcMode('pro');
            } else if (e.detail && e.detail.action === 'logout') {
                isPremium = false;
                switchCalcMode('free');
                applyGating();
            }
        });

        /* ===== INIT ===== */
        initTooltips();
        calculate();
    })();
    </script>
<script>
function subscribeNewsletter(e){e.preventDefault();var email=e.target.querySelector('input[type="email"]').value.trim();if(!email)return false;var subs=JSON.parse(localStorage.getItem('rz_newsletter_subscribers')||'[]');if(subs.find(function(s){return s.email===email})){alert('Already subscribed!');return false}subs.push({email:email,date:new Date().toISOString(),source:location.pathname.split('/').pop(),status:'active'});localStorage.setItem('rz_newsletter_subscribers',JSON.stringify(subs));e.target.innerHTML='<p style="color:#fff;font-weight:600;">&#10003; Subscribed successfully!</p>';return false}
</script>
<script src="auth.js"></script>
<script src="rz-tracker.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-banner hidden" id="cookieBanner">
    <p>We use cookies for analytics to improve your experience. <a href="privacy.html">Learn more</a></p>
    <div class="cookie-actions">
        <button class="cookie-accept" id="cookieAccept">Accept</button>
        <button class="cookie-decline" id="cookieDecline">Decline</button>
    </div>
</div>

<!-- Scroll to Top -->
<button class="scroll-top-btn" id="scrollTopBtn" aria-label="Scroll to top">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"/></svg>
</button>

<script>
(function(){
    // Cookie Banner
    var cb = document.getElementById('cookieBanner');
    var consent = localStorage.getItem('rz_cookie_consent');
    if (!consent && cb) {
        cb.classList.remove('hidden');
    }
    var acceptBtn = document.getElementById('cookieAccept');
    var declineBtn = document.getElementById('cookieDecline');
    if (acceptBtn) acceptBtn.addEventListener('click', function(){
        localStorage.setItem('rz_cookie_consent', 'accepted');
        cb.classList.add('hidden');
    });
    if (declineBtn) declineBtn.addEventListener('click', function(){
        localStorage.setItem('rz_cookie_consent', 'declined');
        cb.classList.add('hidden');
        // Disable GA
        window['ga-disable-G-GED7FX8RTV'] = true;
    });

    // Scroll to Top
    var sBtn = document.getElementById('scrollTopBtn');
    if (sBtn) {
        var ticking = false;
        window.addEventListener('scroll', function(){
            if (!ticking) {
                window.requestAnimationFrame(function(){
                    if (window.scrollY > 500) {
                        sBtn.classList.add('visible');
                    } else {
                        sBtn.classList.remove('visible');
                    }
                    ticking = false;
                });
                ticking = true;
            }
        });
        sBtn.addEventListener('click', function(){
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
    }
})();
</script>

</body>
</html>