<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GED7FX8RTV"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-GED7FX8RTV');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- SEO Meta Tags -->
    <title>Data Center CAPEX Calculator | Construction Cost Estimator</title>
    <meta name="description" content="Data Center CAPEX Calculator for construction cost estimation. Calculate comprehensive capital expenditure with detailed breakdown of electrical, cooling, civil, and infrastructure costs.">
    <meta name="keywords" content="Data Center CAPEX, Construction Cost Calculator, Data Center Cost, Tier III Cost, UPS Cost, Generator Cost, Cooling System Cost">
    <meta name="author" content="Bagus Dwi Permana">
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#0066cc">
    <link rel="canonical" href="https://resistancezero.com/capex-calculator.html">

    <!-- Open Graph Meta Tags -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://resistancezero.com/capex-calculator.html">
    <meta property="og:title" content="Data Center CAPEX Calculator">
    <meta property="og:description" content="Construction cost estimation with detailed breakdown of all infrastructure components.">
    <meta property="og:image" content="https://resistancezero.com/assets/capex-og.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="509">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Data Center CAPEX Calculator">
    <meta name="twitter:description" content="Construction cost estimation with infrastructure breakdown.">
    <meta name="twitter:image" content="https://resistancezero.com/assets/capex-og.jpg">

    <!-- WebApplication Schema -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Data Center CAPEX Calculator",
        "applicationCategory": "FinanceApplication",
        "description": "Calculate comprehensive data center construction costs with detailed breakdown of electrical, cooling, civil, UPS, generator, fire suppression, and infrastructure components.",
        "url": "https://resistancezero.com/capex-calculator.html",
        "operatingSystem": "Web Browser",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "featureList": [
            "IT load capacity sizing (100 kW - 100 MW)",
            "Multiple cooling types (Air, In-Row, RDHX, DLC)",
            "Redundancy configurations (N, N+1, 2N, 2N+1)",
            "Seismic zone adjustments",
            "Building type cost factors",
            "Fire suppression system options",
            "UPS and generator configurations",
            "Location factor adjustments"
        ],
        "creator": {
            "@type": "Person",
            "name": "Bagus Dwi Permana",
            "jobTitle": "Engineering Operations Manager",
            "url": "https://resistancezero.com/"
        }
    }
    </script>

    <link rel="icon" type="image/png" href="assets/Favicon.png">
    <link rel="apple-touch-icon" href="assets/Favicon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 50%, #3a7ca5 100%);
            --secondary-gradient: linear-gradient(135deg, #2d5a87 0%, #1e3a5f 100%);
            --dark-blue: #1e3a5f;
            --medium-blue: #2d5a87;
            --light-blue: #4a90b8;
            --accent-gold: #f59e0b;
            --accent-amber: #fbbf24;
            --accent-emerald: #10b981;
            --accent-cyan: #06b6d4;
            --accent-purple: #8b5cf6;
            --accent-red: #ef4444;
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-tertiary: #e9ecef;
            --text-primary: #212529;
            --text-secondary: #495057;
            --text-muted: #6c757d;
            --glass-bg: rgba(255, 255, 255, 0.85);
            --glass-bg-dark: rgba(30, 58, 95, 0.95);
            --glass-border: rgba(30, 58, 95, 0.1);
            --glass-blur: blur(20px);
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 8px 30px rgba(0, 0, 0, 0.12);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        /* Background */
        .page-background {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 0;
            background:
                radial-gradient(ellipse at top right, rgba(245, 158, 11, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at bottom left, rgba(59, 130, 246, 0.05) 0%, transparent 50%),
                linear-gradient(rgba(30, 58, 95, 0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(30, 58, 95, 0.02) 1px, transparent 1px);
            background-size: 100% 100%, 100% 100%, 50px 50px, 50px 50px;
        }

        /* Navigation */
        .navbar {
            position: fixed;
            top: 0; left: 0; right: 0;
            z-index: 1000;
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            border-bottom: 1px solid var(--glass-border);
            box-shadow: var(--shadow-md);
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            color: var(--dark-blue);
        }

        .nav-logo {
            width: 44px; height: 44px;
            background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
            color: white;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }

        .nav-title { font-weight: 700; font-size: 1.1rem; color: var(--dark-blue); }
        .nav-subtitle { font-size: 0.75rem; color: var(--text-muted); }

        .nav-links { display: flex; gap: 1.5rem; align-items: center; }

        .nav-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            padding: 8px 0;
            transition: color 0.3s;
        }

        .nav-link:hover { color: var(--dark-blue); }

        .nav-back {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: var(--primary-gradient);
            border: none;
            border-radius: 8px;
            color: white;
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(30, 58, 95, 0.25);
        }

        .nav-back:hover { transform: translateY(-2px); }

        /* Main Content */
        .main-content {
            position: relative;
            z-index: 10;
            padding-top: 80px;
        }

        /* Hero */
        .hero {
            padding: 3rem 2rem 2rem;
            text-align: center;
            max-width: 900px;
            margin: 0 auto;
        }

        .hero-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(245, 158, 11, 0.05));
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 50px;
            font-size: 0.8rem;
            color: var(--accent-gold);
            font-weight: 600;
            margin-bottom: 1.5rem;
        }

        .hero h1 {
            font-size: clamp(2rem, 4vw, 2.8rem);
            font-weight: 800;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
        }

        .hero p {
            font-size: 1.1rem;
            color: var(--text-secondary);
            max-width: 700px;
            margin: 0 auto;
        }

        /* Brief Section */
        .brief-section {
            max-width: 860px;
            margin: -0.5rem auto 2rem;
            padding: 0 2rem;
        }

        .brief-card {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.04), rgba(30, 58, 95, 0.06));
            border: 1px solid rgba(245, 158, 11, 0.15);
            border-radius: 16px;
            padding: 1.5rem 2rem;
            position: relative;
            overflow: hidden;
        }

        .brief-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, #f59e0b, #d97706);
            border-radius: 4px 0 0 4px;
        }

        .brief-hero-img {
            width: 100%;
            border-radius: 12px;
            margin-bottom: 1.25rem;
            border: 1px solid rgba(245, 158, 11, 0.12);
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .brief-lead {
            font-size: 1.05rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
            line-height: 1.5;
        }

        .brief-body {
            font-size: 0.92rem;
            color: var(--text-secondary);
            line-height: 1.7;
            margin-bottom: 0.75rem;
        }

        .brief-stats {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(0,0,0,0.06);
        }

        .brief-stat {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .brief-stat i {
            color: var(--accent-gold);
            font-size: 0.75rem;
        }

        .brief-note {
            font-size: 0.8rem;
            color: var(--text-muted);
            font-style: italic;
            margin-top: 0.5rem;
        }

        @media (max-width: 768px) {
            .brief-section { padding: 0 1rem; }
            .brief-card { padding: 1.25rem 1.25rem 1.25rem 1.5rem; }
            .brief-stats { gap: 1rem; }
        }

        /* Calculator Container */
        .calculator-section {
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .simulator-container {
            display: grid;
            grid-template-columns: 1.2fr 1fr;
            gap: 2rem;
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 2.5rem;
            box-shadow: var(--shadow-lg);
        }

        @media (max-width: 1024px) {
            .simulator-container {
                grid-template-columns: 1fr;
            }
        }

        .simulator-inputs {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        @media (max-width: 600px) {
            .input-row {
                grid-template-columns: 1fr;
            }
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .input-label {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-label i {
            color: var(--accent-gold);
        }

        /* Tooltip Styles - Fixed positioning to escape overflow */
        .tooltip-trigger {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 50%;
            font-size: 10px;
            color: var(--accent-gold);
            cursor: help;
            margin-left: auto;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .tooltip-trigger:hover {
            background: rgba(245, 158, 11, 0.2);
            transform: scale(1.1);
        }

        /* Global tooltip container */
        #tooltip-container {
            position: fixed;
            width: 320px;
            max-width: calc(100vw - 40px);
            padding: 16px;
            background: linear-gradient(135deg, #1e3a5f, #2d5a87);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.5);
            z-index: 999999;
            pointer-events: none;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.15s ease;
            color: white;
            font-size: 12px;
            line-height: 1.5;
        }

        #tooltip-container.visible {
            opacity: 1;
            visibility: visible;
        }

        #tooltip-container .tooltip-title {
            font-size: 13px;
            font-weight: 700;
            color: #fbbf24;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        #tooltip-container .tooltip-desc {
            color: rgba(255,255,255,0.9);
            margin-bottom: 10px;
        }

        #tooltip-container .tooltip-table {
            width: 100%;
            font-size: 11px;
            border-collapse: collapse;
        }

        #tooltip-container .tooltip-table th {
            text-align: left;
            color: rgba(255,255,255,0.6);
            padding: 4px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        #tooltip-container .tooltip-table td {
            padding: 4px 0;
        }

        #tooltip-container .tooltip-table td:last-child {
            text-align: right;
            color: #22d3ee;
        }

        /* Hide inline tooltip content */
        .tooltip-trigger .tooltip-content {
            display: none;
        }

        .tooltip-title {
            font-size: 12px;
            font-weight: 700;
            color: var(--accent-amber);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .tooltip-desc {
            font-size: 11px;
            color: rgba(255,255,255,0.9);
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .tooltip-table {
            width: 100%;
            font-size: 10px;
            border-collapse: collapse;
        }

        .tooltip-table th {
            text-align: left;
            color: rgba(255,255,255,0.6);
            font-weight: 500;
            padding: 4px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .tooltip-table td {
            padding: 4px 0;
            color: white;
        }

        .tooltip-table td:last-child {
            text-align: right;
            font-family: 'JetBrains Mono', monospace;
            color: var(--accent-cyan);
        }

        .tooltip-impact {
            margin-top: 10px;
            padding: 8px;
            background: rgba(245, 158, 11, 0.15);
            border-radius: 6px;
            font-size: 10px;
            color: var(--accent-amber);
        }

        .input-field {
            background: var(--bg-secondary);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 14px 16px;
            color: var(--text-primary);
            font-size: 1rem;
            font-family: 'JetBrains Mono', monospace;
            transition: all 0.3s;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--accent-gold);
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.15);
        }

        select.input-field {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%236c757d' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            padding-right: 40px;
        }

        .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .radio-option {
            flex: 1;
            min-width: 80px;
        }

        .radio-option input {
            display: none;
        }

        .radio-option label {
            display: block;
            padding: 10px 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            text-align: center;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .radio-option label small {
            display: block;
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-top: 2px;
        }

        .radio-option input:checked + label {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.15), rgba(251, 191, 36, 0.1));
            border-color: var(--accent-gold);
            color: var(--accent-gold);
        }

        .radio-option label:hover {
            border-color: var(--accent-gold);
        }

        /* Cost Results */
        .simulator-results {
            background: linear-gradient(135deg, var(--dark-blue), var(--medium-blue));
            border-radius: 20px;
            padding: 2rem;
            color: white;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255,255,255,0.15);
        }

        .results-title {
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .results-total {
            text-align: right;
        }

        .total-label {
            font-size: 0.75rem;
            color: rgba(255,255,255,0.7);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .total-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent-amber);
            font-family: 'JetBrains Mono', monospace;
            text-shadow: 0 0 20px rgba(251, 191, 36, 0.3);
        }

        .cost-breakdown {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 320px;
            overflow-y: auto;
            padding-right: 8px;
        }

        .cost-breakdown::-webkit-scrollbar {
            width: 4px;
        }

        .cost-breakdown::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
        }

        .cost-breakdown::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
        }

        .cost-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.08);
        }

        .cost-name {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.85rem;
        }

        .cost-icon {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
        }

        .cost-bar-container {
            flex: 1;
            margin: 0 12px;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .cost-bar {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .cost-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            font-weight: 600;
            min-width: 80px;
            text-align: right;
        }

        .cost-percent {
            font-size: 0.7rem;
            color: rgba(255,255,255,0.6);
            min-width: 35px;
            text-align: right;
        }

        /* Metrics Display */
        .per-kw-display {
            margin-top: 1.5rem;
            padding: 1rem;
            background: rgba(251, 191, 36, 0.15);
            border: 1px solid rgba(251, 191, 36, 0.3);
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .per-kw-label {
            font-size: 0.85rem;
            color: rgba(255,255,255,0.8);
        }

        .per-kw-value {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--accent-amber);
            font-family: 'JetBrains Mono', monospace;
        }

        .metrics-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1rem;
        }

        .metric-box {
            background: rgba(255,255,255,0.08);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
        }

        .metric-label {
            font-size: 0.7rem;
            color: rgba(255,255,255,0.6);
            text-transform: uppercase;
            margin-bottom: 4px;
            letter-spacing: 0.5px;
        }

        .metric-value {
            font-size: 1.3rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }

        .metric-value.tier { color: #a78bfa; }
        .metric-value.pue { color: #22d3ee; }
        .metric-value.uptime { color: #34d399; }
        .metric-value.energy { color: #fbbf24; }

        /* Footer */
        .footer {
            background: var(--dark-blue);
            color: white;
            text-align: center;
            padding: 2rem;
            margin-top: 3rem;
        }

        .footer p {
            opacity: 0.8;
            font-size: 0.9rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-links { display: none; }
            .calculator-section { padding: 1rem; }
            .simulator-container { padding: 1.5rem; }
            #compareGrid { grid-template-columns: 1fr !important; }
            #deltaColumn { flex-direction: row !important; width: 100%; justify-content: center !important; }
        }
    </style>
</head>
<body>
    <div class="page-background"></div>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-brand">
                <div class="nav-logo">CAPEX</div>
                <div>
                    <div class="nav-title">CAPEX Calculator</div>
                    <div class="nav-subtitle">Capital Expenditure Analysis</div>
                </div>
            </a>
            <div class="nav-links">
                <a href="datacenter-solutions.html" class="nav-link">DC Solutions</a>
                <a href="datahallAI.html" class="nav-link" style="color: #8b5cf6;">DC AI/HPC</a>
                <a href="dc-conventional.html" class="nav-link">DC Conventional</a>
                <a href="opex-calculator.html" class="nav-link" style="color: #10b981;">OPEX Calc</a>
                <a href="index.html" class="nav-back">
                    <i class="fas fa-arrow-left"></i>
                    Portfolio
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Hero -->
        <section class="hero">
            <div class="hero-badge">
                <i class="fas fa-calculator"></i>
                Capital Expenditure Analysis
            </div>
            <h1>Data Center CAPEX Calculator</h1>
            <p>Calculate comprehensive construction costs with detailed breakdown of electrical, cooling, civil, and infrastructure components</p>
        </section>

        <!-- Brief -->
        <section class="brief-section">
            <div class="brief-card">
                <img src="assets/capex-og.jpg" alt="Data Center CAPEX Calculator â€” capital expenditure breakdown for construction, electrical, cooling, and infrastructure" class="brief-hero-img" loading="eager">
                <p class="brief-lead">Building a data center is not a spreadsheet exercise &mdash; it's a bet worth millions where every wrong assumption compounds.</p>
                <p class="brief-body">A 10 MW facility can swing between $80M and $200M+ depending on cooling architecture, redundancy tier, seismic zone, and dozens of other variables most cost models quietly ignore. This calculator won't replace a detailed engineering estimate &mdash; but it will give you a defensible starting point in under 60 seconds. Adjust IT load, pick your cooling strategy, set your redundancy level, and watch how each decision moves the total. Use it to sanity-check vendor quotes, benchmark across regions, or build a rough business case before the first shovel hits the ground.</p>
                <div class="brief-stats">
                    <span class="brief-stat"><i class="fas fa-sliders-h"></i> 12+ configurable variables</span>
                    <span class="brief-stat"><i class="fas fa-globe-americas"></i> Location factor adjustments</span>
                    <span class="brief-stat"><i class="fas fa-layer-group"></i> Tier I &ndash; IV redundancy</span>
                    <span class="brief-stat"><i class="fas fa-snowflake"></i> 4 cooling architectures</span>
                </div>
                <p class="brief-note">General-purpose estimate &mdash; actual costs depend on site-specific engineering, local regulations, and procurement strategy. Need a deeper analysis? Let's talk.</p>
            </div>
        </section>

        <!-- Calculator -->
        <section class="calculator-section">
            <!-- Mode Tabs -->
            <div id="capexModeTabs" style="display:flex;gap:0.5rem;margin-bottom:1.5rem;flex-wrap:wrap;max-width:1400px;margin-left:auto;margin-right:auto;">
                <button type="button" class="capex-mode-btn active" data-mode="simple" onclick="switchCapexMode('simple')" style="padding:0.6rem 1.2rem;border-radius:10px;border:1px solid rgba(245,158,11,0.4);background:rgba(245,158,11,0.15);color:#f59e0b;cursor:pointer;font-weight:600;font-size:0.9rem;font-family:inherit;transition:all 0.3s;">
                    <i class="fas fa-sliders-h" style="margin-right:6px;"></i>Simple
                </button>
                <button type="button" class="capex-mode-btn" data-mode="advanced" onclick="switchCapexMode('advanced')" style="padding:0.6rem 1.2rem;border-radius:10px;border:1px solid rgba(255,255,255,0.15);background:transparent;color:#94a3b8;cursor:pointer;font-weight:500;font-size:0.9rem;font-family:inherit;transition:all 0.3s;">
                    <i class="fas fa-cogs" style="margin-right:6px;"></i>Advanced
                </button>
            </div>

            <div class="simulator-container">
                <!-- Input Side -->
                <div class="simulator-inputs">
                    <div class="input-row">
                        <div class="input-group">
                            <label class="input-label">
                                <i class="fas fa-bolt"></i> IT Load (kW)
                                <span class="tooltip-trigger">?
                                    <div class="tooltip-content">
                                        <div class="tooltip-title"><i class="fas fa-bolt"></i> IT Load (kW)</div>
                                        <div class="tooltip-desc">Total power consumption of all IT equipment including servers, storage arrays, and network devices.</div>
                                        <table class="tooltip-table">
                                            <tr><th>Category</th><th>Range</th></tr>
                                            <tr><td>Small / Edge</td><td>100-500 kW</td></tr>
                                            <tr><td>Medium</td><td>500-2,000 kW</td></tr>
                                            <tr><td>Large</td><td>2-10 MW</td></tr>
                                            <tr><td>Hyperscale</td><td>10+ MW</td></tr>
                                        </table>
                                    </div>
                                </span>
                            </label>
                            <input type="number" class="input-field" id="itLoad" value="1000" min="100" max="100000">
                        </div>
                        <div class="input-group">
                            <label class="input-label">
                                <i class="fas fa-gas-pump"></i> Fuel Autonomy (hours)
                                <span class="tooltip-trigger">?
                                    <div class="tooltip-content">
                                        <div class="tooltip-title"><i class="fas fa-gas-pump"></i> Fuel Autonomy</div>
                                        <div class="tooltip-desc">Duration generators can operate without refueling during utility power outage.</div>
                                        <table class="tooltip-table">
                                            <tr><th>Tier Level</th><th>Typical Hours</th></tr>
                                            <tr><td>Minimum</td><td>8 hours</td></tr>
                                            <tr><td>Standard</td><td>24 hours</td></tr>
                                            <tr><td>Tier III</td><td>48 hours</td></tr>
                                            <tr><td>Mission Critical</td><td>72+ hours</td></tr>
                                        </table>
                                    </div>
                                </span>
                            </label>
                            <input type="number" class="input-field" id="fuelHours" value="48" min="8" max="168">
                        </div>
                    </div>

                    <div class="input-row">
                        <div class="input-group">
                            <label class="input-label">
                                <i class="fas fa-building"></i> Building Type
                                <span class="tooltip-trigger">?
                                    <div class="tooltip-content">
                                        <div class="tooltip-title"><i class="fas fa-building"></i> Building Type</div>
                                        <div class="tooltip-desc">The type of structure affects construction costs significantly. Purpose-built facilities are optimized for data centers.</div>
                                        <table class="tooltip-table">
                                            <tr><th>Type</th><th>Cost Factor</th></tr>
                                            <tr><td>Warehouse Conversion</td><td>0.70x (lowest)</td></tr>
                                            <tr><td>Modular / Prefab</td><td>0.85x</td></tr>
                                            <tr><td>Purpose-Built</td><td>1.00x (baseline)</td></tr>
                                            <tr><td>High-Rise Multi-Story</td><td>1.40x (highest)</td></tr>
                                        </table>
                                    </div>
                                </span>
                            </label>
                            <select class="input-field" id="buildingType">
                                <option value="warehouse">Warehouse Conversion (0.70x)</option>
                                <option value="modular">Modular / Prefab (0.85x)</option>
                                <option value="purpose" selected>Purpose-Built (1.00x)</option>
                                <option value="highrise">High-Rise Multi-Story (1.40x)</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label class="input-label">
                                <i class="fas fa-mountain"></i> Seismic Zone
                                <span class="tooltip-trigger">?
                                    <div class="tooltip-content">
                                        <div class="tooltip-title"><i class="fas fa-mountain"></i> Seismic Zone</div>
                                        <div class="tooltip-desc">Earthquake risk zones require additional structural reinforcement. Indonesia is typically Zone 2-4.</div>
                                        <table class="tooltip-table">
                                            <tr><th>Zone</th><th>Cost Impact</th></tr>
                                            <tr><td>Zone 0 - No Risk</td><td>+0%</td></tr>
                                            <tr><td>Zone 1 - Low</td><td>+3%</td></tr>
                                            <tr><td>Zone 2 - Moderate</td><td>+6%</td></tr>
                                            <tr><td>Zone 3 - High</td><td>+10%</td></tr>
                                            <tr><td>Zone 4 - Very High</td><td>+15%</td></tr>
                                        </table>
                                    </div>
                                </span>
                            </label>
                            <select class="input-field" id="seismicZone">
                                <option value="zone0">Zone 0 - No Seismic Risk</option>
                                <option value="zone1">Zone 1 - Low Risk</option>
                                <option value="zone2" selected>Zone 2 - Moderate Risk</option>
                                <option value="zone3">Zone 3 - High Risk</option>
                                <option value="zone4">Zone 4 - Very High Risk</option>
                            </select>
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="input-label">
                            <i class="fas fa-server"></i> Rack Density
                            <span class="tooltip-trigger">?
                                <div class="tooltip-content">
                                    <div class="tooltip-title"><i class="fas fa-server"></i> Rack Density</div>
                                    <div class="tooltip-desc">Power consumption per rack affects cooling requirements and infrastructure costs. AI/HPC racks require specialized cooling.</div>
                                    <table class="tooltip-table">
                                        <tr><th>Density</th><th>Cooling Needs</th></tr>
                                        <tr><td>Standard (5-7 kW)</td><td>Air cooling adequate</td></tr>
                                        <tr><td>Medium (10-15 kW)</td><td>Enhanced airflow</td></tr>
                                        <tr><td>High (20-30 kW)</td><td>In-row or RDHX required</td></tr>
                                        <tr><td>AI/HPC (50-100 kW)</td><td>Direct liquid cooling</td></tr>
                                    </table>
                                </div>
                            </span>
                        </label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" name="rackType" id="rackStd" value="standard" checked>
                                <label for="rackStd">Standard<small>5-7 kW</small></label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="rackType" id="rackMid" value="medium">
                                <label for="rackMid">Medium<small>10-15 kW</small></label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="rackType" id="rackHigh" value="high">
                                <label for="rackHigh">High Density<small>20-30 kW</small></label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="rackType" id="rackAI" value="ai">
                                <label for="rackAI">AI/HPC<small>50-100 kW</small></label>
                            </div>
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="input-label">
                            <i class="fas fa-snowflake"></i> Cooling Type
                            <span class="tooltip-trigger">?
                                <div class="tooltip-content">
                                    <div class="tooltip-title"><i class="fas fa-snowflake"></i> Cooling Type</div>
                                    <div class="tooltip-desc">Cooling technology affects both CAPEX and operational efficiency. Higher density requires more advanced cooling.</div>
                                    <table class="tooltip-table">
                                        <tr><th>Type</th><th>Best For</th></tr>
                                        <tr><td>Air (CRAC/CRAH)</td><td>Standard &lt;10 kW/rack</td></tr>
                                        <tr><td>In-Row Precision</td><td>Medium 10-20 kW/rack</td></tr>
                                        <tr><td>RDHX (Rear Door)</td><td>High 20-40 kW/rack</td></tr>
                                        <tr><td>DLC (Direct Liquid)</td><td>AI/HPC 50+ kW/rack</td></tr>
                                    </table>
                                </div>
                            </span>
                        </label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" name="coolingType" id="coolAir" value="air" checked>
                                <label for="coolAir">Air<small>CRAC/CRAH</small></label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="coolingType" id="coolInrow" value="inrow">
                                <label for="coolInrow">In-Row<small>Precision</small></label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="coolingType" id="coolRDHX" value="rdhx">
                                <label for="coolRDHX">RDHX<small>Rear Door</small></label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="coolingType" id="coolLiquid" value="liquid">
                                <label for="coolLiquid">DLC<small>Direct Liquid</small></label>
                            </div>
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="input-label">
                            <i class="fas fa-shield-alt"></i> Redundancy
                            <span class="tooltip-trigger">?
                                <div class="tooltip-content">
                                    <div class="tooltip-title"><i class="fas fa-shield-alt"></i> Redundancy Level</div>
                                    <div class="tooltip-desc">Higher redundancy = higher uptime but significantly more cost. 2N doubles infrastructure.</div>
                                    <table class="tooltip-table">
                                        <tr><th>Level</th><th>Uptime SLA</th></tr>
                                        <tr><td>N (Basic)</td><td>99.671% (~28.8hr/yr)</td></tr>
                                        <tr><td>N+1 (Standard)</td><td>99.982% (~1.6hr/yr)</td></tr>
                                        <tr><td>2N (Full)</td><td>99.995% (~26min/yr)</td></tr>
                                        <tr><td>2N+1 (Premium)</td><td>99.9995% (~2.6min/yr)</td></tr>
                                    </table>
                                </div>
                            </span>
                        </label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" name="redundancy" id="redN" value="n">
                                <label for="redN">N<small>Basic</small></label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="redundancy" id="redN1" value="n1" checked>
                                <label for="redN1">N+1<small>Standard</small></label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="redundancy" id="red2N" value="2n">
                                <label for="red2N">2N<small>Full</small></label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="redundancy" id="red2N1" value="2n1">
                                <label for="red2N1">2N+1<small>Premium</small></label>
                            </div>
                        </div>
                    </div>

                    <div class="input-row">
                        <div class="input-group">
                            <label class="input-label">
                                <i class="fas fa-fire-extinguisher"></i> Fire Suppression
                                <span class="tooltip-trigger">?
                                    <div class="tooltip-content">
                                        <div class="tooltip-title"><i class="fas fa-fire-extinguisher"></i> Fire Suppression</div>
                                        <div class="tooltip-desc">Clean agent fire suppression systems that don't damage IT equipment.</div>
                                        <table class="tooltip-table">
                                            <tr><th>Agent</th><th>Notes</th></tr>
                                            <tr><td>FM200/HFC-227ea</td><td>Common, being phased out</td></tr>
                                            <tr><td>Novec 1230</td><td>Low GWP, safest choice</td></tr>
                                            <tr><td>Inergen (IG-541)</td><td>Inert gas, unlimited</td></tr>
                                            <tr><td>Nitrogen Inerting</td><td>For sealed rooms</td></tr>
                                            <tr><td>Water Mist</td><td>Green alternative</td></tr>
                                        </table>
                                    </div>
                                </span>
                            </label>
                            <select class="input-field" id="fireType">
                                <option value="fm200">FM200 / HFC-227ea</option>
                                <option value="novec" selected>Novec 1230</option>
                                <option value="inergen">Inergen (IG-541)</option>
                                <option value="n2">Nitrogen Inerting</option>
                                <option value="water">Water Mist</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label class="input-label">
                                <i class="fas fa-bell"></i> Fire Alarm System
                                <span class="tooltip-trigger">?
                                    <div class="tooltip-content">
                                        <div class="tooltip-title"><i class="fas fa-bell"></i> Fire Alarm System</div>
                                        <div class="tooltip-desc">Early detection is critical for data centers. VESDA provides earliest warning.</div>
                                        <table class="tooltip-table">
                                            <tr><th>Type</th><th>Detection Time</th></tr>
                                            <tr><td>Conventional</td><td>Late stage smoke</td></tr>
                                            <tr><td>Addressable</td><td>Point location ID</td></tr>
                                            <tr><td>VESDA</td><td>Pre-combustion</td></tr>
                                            <tr><td>Hybrid</td><td>Best of both</td></tr>
                                        </table>
                                    </div>
                                </span>
                            </label>
                            <select class="input-field" id="alarmType">
                                <option value="conventional">Conventional</option>
                                <option value="addressable" selected>Addressable</option>
                                <option value="vesda">VESDA (Aspirating)</option>
                                <option value="hybrid">Hybrid VESDA + Addressable</option>
                            </select>
                        </div>
                    </div>

                    <div class="input-row">
                        <div class="input-group">
                            <label class="input-label">
                                <i class="fas fa-battery-full"></i> UPS Type
                                <span class="tooltip-trigger">?
                                    <div class="tooltip-content">
                                        <div class="tooltip-title"><i class="fas fa-battery-full"></i> UPS Type</div>
                                        <div class="tooltip-desc">Uninterruptible Power Supply provides backup during generator startup (10-15 seconds).</div>
                                        <table class="tooltip-table">
                                            <tr><th>Type</th><th>Best For</th></tr>
                                            <tr><td>Standalone</td><td>Small, fixed capacity</td></tr>
                                            <tr><td>Modular</td><td>Scalable, N+1 within</td></tr>
                                            <tr><td>Distributed/Rack</td><td>Edge, distributed</td></tr>
                                            <tr><td>Rotary UPS</td><td>Ultra-reliable, diesel</td></tr>
                                        </table>
                                    </div>
                                </span>
                            </label>
                            <select class="input-field" id="upsType">
                                <option value="standalone">Standalone</option>
                                <option value="modular" selected>Modular</option>
                                <option value="distributed">Distributed / Rack</option>
                                <option value="rotary">Rotary UPS</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label class="input-label">
                                <i class="fas fa-plug"></i> Generator Type
                                <span class="tooltip-trigger">?
                                    <div class="tooltip-content">
                                        <div class="tooltip-title"><i class="fas fa-plug"></i> Generator Type</div>
                                        <div class="tooltip-desc">Backup power generation fuel type affects maintenance and sustainability.</div>
                                        <table class="tooltip-table">
                                            <tr><th>Fuel</th><th>Notes</th></tr>
                                            <tr><td>Diesel</td><td>Standard, reliable</td></tr>
                                            <tr><td>Natural Gas</td><td>Lower emissions</td></tr>
                                            <tr><td>Dual Fuel</td><td>Flexibility</td></tr>
                                            <tr><td>HVO/Biodiesel</td><td>90% lower CO2</td></tr>
                                        </table>
                                    </div>
                                </span>
                            </label>
                            <select class="input-field" id="genType">
                                <option value="diesel" selected>Diesel</option>
                                <option value="gas">Natural Gas</option>
                                <option value="dualfuel">Dual Fuel</option>
                                <option value="hvo">HVO / Biodiesel</option>
                            </select>
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="input-label">
                            <i class="fas fa-map-marker-alt"></i> Location Factor
                            <span class="tooltip-trigger">?
                                <div class="tooltip-content">
                                    <div class="tooltip-title"><i class="fas fa-map-marker-alt"></i> Location Factor</div>
                                    <div class="tooltip-desc">Regional cost multiplier based on labor rates, materials, and logistics costs.</div>
                                    <table class="tooltip-table">
                                        <tr><th>Region</th><th>Multiplier</th></tr>
                                        <tr><td>India</td><td>0.55x (lowest)</td></tr>
                                        <tr><td>SE Asia (Indonesia)</td><td>0.65x</td></tr>
                                        <tr><td>China</td><td>0.70x</td></tr>
                                        <tr><td>USA (baseline)</td><td>1.00x</td></tr>
                                        <tr><td>Europe</td><td>1.15x (highest)</td></tr>
                                    </table>
                                </div>
                            </span>
                        </label>
                        <select class="input-field" id="locationFactor">
                            <option value="sea">Southeast Asia - Indonesia, Malaysia (0.65x)</option>
                            <option value="india">India (0.55x)</option>
                            <option value="china">China (0.70x)</option>
                            <option value="japan">Japan / Korea (1.10x)</option>
                            <option value="australia">Australia (1.05x)</option>
                            <option value="europe">Europe (1.15x)</option>
                            <option value="usa" selected>USA (1.00x)</option>
                        </select>
                    </div>

                    <!-- â•â•â• ADVANCED MODE SECTIONS (hidden by default) â•â•â• -->
                    <div id="advancedInputs" style="display:none;flex-direction:column;gap:1.5rem;">

                        <!-- A. Year & City/Market -->
                        <div style="border-top:1px solid rgba(245,158,11,0.2);padding-top:1.5rem;margin-top:0.5rem;">
                            <div style="font-size:0.8rem;font-weight:700;color:#f59e0b;text-transform:uppercase;letter-spacing:1px;margin-bottom:1rem;display:flex;align-items:center;gap:8px;">
                                <i class="fas fa-calendar-alt"></i> Year & Market Location
                            </div>
                            <div class="input-row">
                                <div class="input-group">
                                    <label class="input-label">
                                        <i class="fas fa-calendar"></i> Projection Year
                                        <span class="tooltip-trigger">?
                                            <div class="tooltip-content">
                                                <div class="tooltip-title"><i class="fas fa-calendar"></i> Year Escalation</div>
                                                <div class="tooltip-desc">Cost escalation based on industry trends. 7% CAGR 2020-2025 (T&T), decelerating as supply chains normalize.</div>
                                                <table class="tooltip-table">
                                                    <tr><th>Year</th><th>Multiplier</th></tr>
                                                    <tr><td>2025 (baseline)</td><td>1.000x</td></tr>
                                                    <tr><td>2026</td><td>1.060x (+6.0%)</td></tr>
                                                    <tr><td>2027</td><td>1.115x (+5.5%)</td></tr>
                                                    <tr><td>2028</td><td>1.165x (+4.5%)</td></tr>
                                                    <tr><td>2029</td><td>1.210x (+3.8%)</td></tr>
                                                    <tr><td>2030</td><td>1.250x (+3.3%)</td></tr>
                                                </table>
                                                <div class="tooltip-impact">Sources: JLL 2026 Outlook, Turner & Townsend DCCI 2025, Avid Solutions 2026-2030 projections</div>
                                            </div>
                                        </span>
                                    </label>
                                    <select class="input-field" id="projYear">
                                        <option value="2025" selected>2025 (Baseline)</option>
                                        <option value="2026">2026 (+6.0%)</option>
                                        <option value="2027">2027 (+5.2%)</option>
                                        <option value="2028">2028 (+4.5%)</option>
                                        <option value="2029">2029 (+3.9%)</option>
                                        <option value="2030">2030 (+3.3%)</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label class="input-label">
                                        <i class="fas fa-city"></i> City / Market
                                        <span class="tooltip-trigger">?
                                            <div class="tooltip-content">
                                                <div class="tooltip-title"><i class="fas fa-city"></i> City-Specific $/W Cost</div>
                                                <div class="tooltip-desc">Construction cost per watt based on specific metro area. Replaces generic Location Factor when selected.</div>
                                                <table class="tooltip-table">
                                                    <tr><th>City</th><th>$/W (2025)</th></tr>
                                                    <tr><td>Tokyo</td><td>$15.20</td></tr>
                                                    <tr><td>Singapore</td><td>$14.53</td></tr>
                                                    <tr><td>Silicon Valley</td><td>$13.30</td></tr>
                                                    <tr><td>Dallas, TX</td><td>$14.30</td></tr>
                                                    <tr><td>Mumbai</td><td>$6.64</td></tr>
                                                </table>
                                                <div class="tooltip-impact">Sources: Turner & Townsend DCCI 2025, Cushman & Wakefield Cost Guide 2025</div>
                                            </div>
                                        </span>
                                    </label>
                                    <select class="input-field" id="cityMarket">
                                        <option value="none">-- Use Location Factor above --</option>
                                        <optgroup label="Americas">
                                            <option value="silicon_valley">Silicon Valley â€” $13.30/W</option>
                                            <option value="new_jersey">New Jersey / NYC â€” $12.90/W</option>
                                            <option value="virginia">Virginia / NOVA â€” $13.40/W</option>
                                            <option value="dallas">Dallas, TX â€” $14.30/W</option>
                                            <option value="phoenix">Phoenix, AZ â€” $13.40/W</option>
                                            <option value="chicago">Chicago, IL â€” $13.20/W</option>
                                            <option value="san_antonio">San Antonio, TX â€” $9.30/W</option>
                                        </optgroup>
                                        <optgroup label="Europe">
                                            <option value="london">London â€” $12.00/W</option>
                                            <option value="frankfurt">Frankfurt â€” $11.60/W</option>
                                            <option value="amsterdam">Amsterdam â€” $11.80/W</option>
                                            <option value="stockholm">Stockholm â€” $10.50/W</option>
                                        </optgroup>
                                        <optgroup label="Asia Pacific">
                                            <option value="tokyo">Tokyo â€” $15.20/W</option>
                                            <option value="singapore">Singapore â€” $14.53/W</option>
                                            <option value="hong_kong">Hong Kong â€” $13.80/W</option>
                                            <option value="seoul">Seoul â€” $9.50/W</option>
                                            <option value="sydney">Sydney â€” $12.30/W</option>
                                            <option value="malaysia">Malaysia / Johor â€” $11.37/W</option>
                                            <option value="jakarta">Jakarta â€” $11.21/W</option>
                                            <option value="mumbai">Mumbai â€” $6.64/W</option>
                                            <option value="bangkok">Bangkok â€” $8.50/W</option>
                                        </optgroup>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- B. Front-of-Meter / Utility Interconnection -->
                        <div style="border-top:1px solid rgba(59,130,246,0.2);padding-top:1.5rem;">
                            <div style="font-size:0.8rem;font-weight:700;color:#3b82f6;text-transform:uppercase;letter-spacing:1px;margin-bottom:1rem;display:flex;align-items:center;gap:8px;">
                                <i class="fas fa-plug"></i> Front-of-Meter / Utility
                            </div>
                            <div class="input-group" style="margin-bottom:1rem;">
                                <label style="display:flex;align-items:center;gap:10px;cursor:pointer;font-size:0.9rem;font-weight:500;color:var(--text-secondary);">
                                    <input type="checkbox" id="includeFOM" style="width:18px;height:18px;accent-color:#3b82f6;cursor:pointer;">
                                    Include Front-of-Meter Costs
                                    <span class="tooltip-trigger">?
                                        <div class="tooltip-content">
                                            <div class="tooltip-title"><i class="fas fa-plug"></i> Front-of-Meter</div>
                                            <div class="tooltip-desc">Costs for grid interconnection, substation, transformer, switchgear â€” typically borne by data center operator per utility agreement.</div>
                                            <div class="tooltip-impact">Per Mark Lewis (VP Engineering): "Don't forget front-of-meter â€” transformer, substation, switchgear, and utility's 9% return on investment."</div>
                                        </div>
                                    </span>
                                </label>
                            </div>
                            <div id="fomInputs" style="display:none;flex-direction:column;gap:1rem;">
                                <div class="input-row">
                                    <div class="input-group">
                                        <label class="input-label"><i class="fas fa-industry"></i> Substation Type</label>
                                        <select class="input-field" id="substationType">
                                            <option value="shared">Shared Utility ($0.5-1.5M)</option>
                                            <option value="dedicated_33kv" selected>Dedicated 33kV ($3-5M)</option>
                                            <option value="dedicated_132kv">Dedicated 132kV+ ($5-10M+)</option>
                                        </select>
                                    </div>
                                    <div class="input-group">
                                        <label class="input-label"><i class="fas fa-bolt"></i> Transformer Lead Time</label>
                                        <select class="input-field" id="transformerLead">
                                            <option value="standard" selected>Standard (18-24 mo)</option>
                                            <option value="extended">Extended (24-36 mo, +15%)</option>
                                            <option value="emergency">Emergency (expedited, +30%)</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="input-group">
                                    <label class="input-label"><i class="fas fa-percentage"></i> Utility Rate of Return: <span id="utilRateVal" style="color:#3b82f6;font-family:'JetBrains Mono',monospace;">9%</span></label>
                                    <input type="range" id="utilityRate" min="7" max="12" value="9" step="0.5" style="width:100%;accent-color:#3b82f6;">
                                </div>
                            </div>
                        </div>

                        <!-- C. Vendor & Market Factors -->
                        <div style="border-top:1px solid rgba(139,92,246,0.2);padding-top:1.5rem;">
                            <div style="font-size:0.8rem;font-weight:700;color:#8b5cf6;text-transform:uppercase;letter-spacing:1px;margin-bottom:1rem;display:flex;align-items:center;gap:8px;">
                                <i class="fas fa-handshake"></i> Vendor & Market Factors
                            </div>
                            <div class="input-row">
                                <div class="input-group">
                                    <label class="input-label">
                                        <i class="fas fa-chart-line"></i> Market Conditions
                                        <span class="tooltip-trigger">?
                                            <div class="tooltip-content">
                                                <div class="tooltip-title"><i class="fas fa-chart-line"></i> Market Conditions</div>
                                                <div class="tooltip-desc">Current supply-demand dynamics affect pricing. Seller's market = contractors charge premiums due to high demand.</div>
                                                <table class="tooltip-table">
                                                    <tr><th>Condition</th><th>Impact</th></tr>
                                                    <tr><td>Buyer's Market</td><td>-5% (overcapacity)</td></tr>
                                                    <tr><td>Balanced</td><td>0% (baseline)</td></tr>
                                                    <tr><td>Seller's Market</td><td>+10% (high demand)</td></tr>
                                                </table>
                                            </div>
                                        </span>
                                    </label>
                                    <select class="input-field" id="marketCondition">
                                        <option value="buyer">Buyer's Market (-5%)</option>
                                        <option value="balanced" selected>Balanced (0%)</option>
                                        <option value="seller">Seller's Market (+10%)</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label class="input-label">
                                        <i class="fas fa-truck"></i> Delivery Method
                                        <span class="tooltip-trigger">?
                                            <div class="tooltip-content">
                                                <div class="tooltip-title"><i class="fas fa-truck"></i> Delivery Method</div>
                                                <div class="tooltip-desc">Project delivery approach affects cost structure and timeline.</div>
                                                <table class="tooltip-table">
                                                    <tr><th>Method</th><th>Impact</th></tr>
                                                    <tr><td>Design-Bid-Build</td><td>Baseline</td></tr>
                                                    <tr><td>Design-Build</td><td>-3% (integrated)</td></tr>
                                                    <tr><td>Modular-Prefab</td><td>-8% (factory-built)</td></tr>
                                                    <tr><td>EPC Turnkey</td><td>+5% (single source)</td></tr>
                                                </table>
                                            </div>
                                        </span>
                                    </label>
                                    <select class="input-field" id="deliveryMethod">
                                        <option value="dbb" selected>Design-Bid-Build (baseline)</option>
                                        <option value="db">Design-Build (-3%)</option>
                                        <option value="modular">Modular-Prefab (-8%)</option>
                                        <option value="epc">EPC Turnkey (+5%)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="input-group" style="margin-top:1rem;">
                                <label class="input-label">
                                    <i class="fas fa-hard-hat"></i> Contractor Availability
                                    <span class="tooltip-trigger">?
                                        <div class="tooltip-content">
                                            <div class="tooltip-title"><i class="fas fa-hard-hat"></i> Contractor Availability</div>
                                            <div class="tooltip-desc">Labor market tightness. Per Matt Pacione: location-specific labor costs drive significant variance.</div>
                                            <table class="tooltip-table">
                                                <tr><th>Availability</th><th>Premium</th></tr>
                                                <tr><td>High Availability</td><td>+0%</td></tr>
                                                <tr><td>Normal</td><td>+3%</td></tr>
                                                <tr><td>Tight Market</td><td>+8%</td></tr>
                                            </table>
                                        </div>
                                    </span>
                                </label>
                                <select class="input-field" id="contractorAvail">
                                    <option value="high">High Availability (+0%)</option>
                                    <option value="normal" selected>Normal (+3%)</option>
                                    <option value="tight">Tight Market (+8%)</option>
                                </select>
                            </div>
                        </div>

                        <!-- D. Professional Fees & Soft Costs -->
                        <div style="border-top:1px solid rgba(16,185,129,0.2);padding-top:1.5rem;">
                            <div style="font-size:0.8rem;font-weight:700;color:#10b981;text-transform:uppercase;letter-spacing:1px;margin-bottom:1rem;display:flex;align-items:center;gap:8px;">
                                <i class="fas fa-file-invoice-dollar"></i> Professional Fees & Soft Costs
                            </div>
                            <div class="input-row">
                                <div class="input-group">
                                    <label class="input-label"><i class="fas fa-drafting-compass"></i> Design & Engineering: <span id="designFeeVal" style="color:#10b981;font-family:'JetBrains Mono',monospace;">8%</span></label>
                                    <input type="range" id="designFee" min="5" max="12" value="8" step="0.5" style="width:100%;accent-color:#10b981;">
                                </div>
                                <div class="input-group">
                                    <label class="input-label"><i class="fas fa-tasks"></i> Project Management: <span id="pmFeeVal" style="color:#10b981;font-family:'JetBrains Mono',monospace;">5%</span></label>
                                    <input type="range" id="pmFee" min="3" max="8" value="5" step="0.5" style="width:100%;accent-color:#10b981;">
                                </div>
                            </div>
                            <div class="input-group" style="margin-top:1rem;">
                                <label class="input-label"><i class="fas fa-exclamation-triangle"></i> Contingency: <span id="contingencyVal" style="color:#10b981;font-family:'JetBrains Mono',monospace;">10%</span></label>
                                <input type="range" id="contingencyAdv" min="5" max="20" value="10" step="1" style="width:100%;accent-color:#10b981;">
                            </div>
                        </div>

                    </div>
                    <!-- â•â•â• END ADVANCED MODE â•â•â• -->
                </div>

                <!-- Results Side -->
                <div class="simulator-results">
                    <div class="results-header">
                        <span class="results-title"><i class="fas fa-chart-pie"></i> Cost Breakdown <span id="advInfoBadge" style="display:none;font-size:0.65rem;background:rgba(245,158,11,0.2);color:#fbbf24;padding:2px 8px;border-radius:6px;font-weight:500;margin-left:6px;"></span></span>
                        <div class="results-total">
                            <div class="total-label">Total CAPEX <span class="tooltip-trigger" style="font-size: 0.7rem;">?
                                <div class="tooltip-content">
                                    <div class="tooltip-title"><i class="fas fa-dollar-sign"></i> Total CAPEX</div>
                                    <div class="tooltip-desc">Capital Expenditure - Total upfront investment required to build the data center including construction, equipment, and commissioning.</div>
                                </div>
                            </span></div>
                            <div class="total-value" id="totalCost">$12,500,000</div>
                        </div>
                    </div>

                    <div class="cost-breakdown" id="costBreakdown">
                        <!-- Cost items populated by JS -->
                    </div>

                    <div class="per-kw-display">
                        <span class="per-kw-label">Cost per kW IT Load <span class="tooltip-trigger" style="font-size: 0.7rem;">?
                            <div class="tooltip-content">
                                <div class="tooltip-title"><i class="fas fa-calculator"></i> Cost per kW</div>
                                <div class="tooltip-desc">Industry benchmark metric: Total CAPEX divided by IT Load capacity. Typical ranges: $8,000-15,000/kW for Tier III, $15,000-25,000/kW for Tier IV.</div>
                            </div>
                        </span></span>
                        <span class="per-kw-value" id="perKwCost">$12,500/kW</span>
                    </div>

                    <div class="metrics-row">
                        <div class="metric-box">
                            <div class="metric-label">Tier Classification <span class="tooltip-trigger" style="font-size: 0.6rem;">?
                                <div class="tooltip-content">
                                    <div class="tooltip-title"><i class="fas fa-layer-group"></i> Uptime Tier</div>
                                    <div class="tooltip-desc">Uptime Institute classification based on redundancy level: Tier I (N) = 99.671%, Tier II = 99.741%, Tier III (N+1) = 99.982%, Tier IV (2N) = 99.995%.</div>
                                </div>
                            </span></div>
                            <div class="metric-value tier" id="tierClass">Tier III</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-label">Estimated PUE <span class="tooltip-trigger" style="font-size: 0.6rem;">?
                                <div class="tooltip-content">
                                    <div class="tooltip-title"><i class="fas fa-leaf"></i> Power Usage Effectiveness</div>
                                    <div class="tooltip-desc">PUE = Total Facility Power Ã· IT Equipment Power. Industry average: 1.55. Efficient DC: 1.2-1.4. Best-in-class: &lt;1.2. Lower is better.</div>
                                </div>
                            </span></div>
                            <div class="metric-value pue" id="pueValue">1.45</div>
                        </div>
                    </div>

                    <div class="metrics-row">
                        <div class="metric-box">
                            <div class="metric-label">Expected Uptime <span class="tooltip-trigger" style="font-size: 0.6rem;">?
                                <div class="tooltip-content">
                                    <div class="tooltip-title"><i class="fas fa-clock"></i> Expected Uptime</div>
                                    <div class="tooltip-desc">Percentage of time the facility is expected to be operational per year. 99.982% = ~1.6 hours downtime/year. 99.995% = ~26 minutes/year.</div>
                                </div>
                            </span></div>
                            <div class="metric-value uptime" id="uptimeValue">99.982%</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-label">Annual Energy <span class="tooltip-trigger" style="font-size: 0.6rem;">?
                                <div class="tooltip-content">
                                    <div class="tooltip-title"><i class="fas fa-plug"></i> Annual Energy Cost</div>
                                    <div class="tooltip-desc">Estimated yearly electricity cost based on IT Load Ã— PUE Ã— 8,760 hours Ã— electricity rate. This is an OPEX cost, not included in CAPEX.</div>
                                </div>
                            </span></div>
                            <div class="metric-value energy" id="energyCost">$1.2M</div>
                        </div>
                    </div>

                    <!-- Action Toolbar -->
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:0.5rem;margin-top:1.25rem;">
                        <button onclick="saveScenarioA()" id="btnSaveA" style="padding:11px 8px;border-radius:10px;border:1px solid rgba(251,191,36,0.5);background:linear-gradient(135deg,rgba(251,191,36,0.2),rgba(245,158,11,0.1));color:#fbbf24;cursor:pointer;font-weight:600;font-size:0.82rem;font-family:inherit;transition:all 0.3s;display:flex;align-items:center;justify-content:center;gap:6px;">
                            <i class="fas fa-bookmark"></i> Save Scenario A
                        </button>
                        <button onclick="exportPDF()" style="padding:11px 8px;border-radius:10px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.06);color:rgba(255,255,255,0.75);cursor:pointer;font-weight:500;font-size:0.82rem;font-family:inherit;transition:all 0.3s;display:flex;align-items:center;justify-content:center;gap:6px;">
                            <i class="fas fa-file-pdf"></i> Export PDF
                        </button>
                    </div>
                    <!-- Saved indicator -->
                    <div id="savedIndicator" style="display:none;margin-top:0.5rem;padding:8px 12px;border-radius:8px;background:rgba(16,185,129,0.12);border:1px solid rgba(16,185,129,0.3);font-size:0.75rem;color:#34d399;text-align:center;">
                        <i class="fas fa-check-circle" style="margin-right:4px;"></i> Scenario A saved â€” change inputs above to create Scenario B, then scroll down to compare
                    </div>
                </div>
            </div>

            <!-- â•â•â• COMPARE MODE: Side-by-side cards â•â•â• -->
            <div id="comparePanel" style="display:none;max-width:1400px;margin:2rem auto 0;padding:0 2rem;">
                <div style="background:var(--glass-bg);backdrop-filter:var(--glass-blur);border:1px solid var(--glass-border);border-radius:20px;padding:2rem;box-shadow:var(--shadow-lg);">
                    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:1.5rem;">
                        <h3 style="font-size:1.1rem;font-weight:700;color:var(--dark-blue);display:flex;align-items:center;gap:8px;margin:0;">
                            <i class="fas fa-columns" style="color:#f59e0b;"></i> Scenario Comparison
                        </h3>
                        <div style="display:flex;gap:0.5rem;">
                            <button onclick="exportPDF()" style="padding:7px 14px;border-radius:8px;border:1px solid var(--glass-border);background:var(--bg-secondary);color:var(--text-secondary);cursor:pointer;font-size:0.8rem;font-family:inherit;font-weight:500;display:flex;align-items:center;gap:4px;">
                                <i class="fas fa-file-pdf"></i> Export with Compare
                            </button>
                            <button onclick="clearComparison()" style="padding:7px 14px;border-radius:8px;border:1px solid rgba(239,68,68,0.3);background:rgba(239,68,68,0.05);color:#ef4444;cursor:pointer;font-size:0.8rem;font-family:inherit;font-weight:500;display:flex;align-items:center;gap:4px;">
                                <i class="fas fa-times"></i> Clear
                            </button>
                        </div>
                    </div>
                    <div style="display:grid;grid-template-columns:1fr auto 1fr;gap:1.5rem;align-items:stretch;" id="compareGrid">
                        <div id="scenarioACard" style="background:linear-gradient(135deg,#1e3a5f,#2d5a87);border-radius:16px;padding:1.5rem;color:white;"></div>
                        <div id="deltaColumn" style="display:flex;flex-direction:column;align-items:center;justify-content:center;padding:1rem 0.5rem;gap:0.75rem;min-width:90px;"></div>
                        <div id="scenarioBCard" style="background:linear-gradient(135deg,#1a4731,#2d6a4f);border-radius:16px;padding:1.5rem;color:white;"></div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2026 Bagus Dwi Permana. Data Center CAPEX Calculator.</p>
        <p style="margin-top: 0.5rem; font-size: 0.8rem;">Comprehensive capital expenditure estimation for data center construction.</p>
    </footer>

    <script>
        // Cost Simulator Logic
        const costFactors = {
            building: { base: 800, label: 'Building & Civil', icon: 'fa-building', color: '#64748b' },
            seismic: { base: 100, label: 'Seismic Protection', icon: 'fa-mountain', color: '#78716c' },
            electrical: { base: 1200, label: 'Electrical (MV/LV)', icon: 'fa-bolt', color: '#3b82f6' },
            ups: { base: 600, label: 'UPS Systems', icon: 'fa-battery-full', color: '#8b5cf6' },
            generator: { base: 400, label: 'Generator & Fuel', icon: 'fa-gas-pump', color: '#f59e0b' },
            cooling: { base: 700, label: 'Cooling Systems', icon: 'fa-snowflake', color: '#06b6d4' },
            fireSuppression: { base: 150, label: 'Fire Suppression', icon: 'fa-fire-extinguisher', color: '#ef4444' },
            fireAlarm: { base: 80, label: 'Fire Alarm System', icon: 'fa-bell', color: '#f97316' },
            bms: { base: 120, label: 'BMS / DCIM', icon: 'fa-desktop', color: '#10b981' },
            network: { base: 250, label: 'Network Infra', icon: 'fa-network-wired', color: '#a855f7' },
            security: { base: 80, label: 'Security Systems', icon: 'fa-shield-alt', color: '#6366f1' },
            commissioning: { base: 200, label: 'Commissioning', icon: 'fa-clipboard-check', color: '#14b8a6' }
        };

        const redundancyMultipliers = { n: 1.0, n1: 1.25, '2n': 1.85, '2n1': 2.1 };
        const coolingMultipliers = { air: 1.0, inrow: 1.2, rdhx: 1.35, liquid: 1.6 };
        const rackMultipliers = { standard: 1.0, medium: 1.1, high: 1.3, ai: 1.6 };
        const buildingMultipliers = { warehouse: 0.7, modular: 0.85, purpose: 1.0, highrise: 1.4 };
        const seismicMultipliers = { zone0: 0.2, zone1: 1.0, zone2: 2.5, zone3: 5.0, zone4: 8.0 };
        const fireSuppressionMultipliers = { fm200: 1.0, novec: 1.3, inergen: 1.2, n2: 1.8, water: 0.6 };
        const fireAlarmMultipliers = { conventional: 0.6, addressable: 1.0, vesda: 1.8, hybrid: 2.2 };
        const upsMultipliers = { standalone: 0.9, modular: 1.0, distributed: 1.2, rotary: 1.5 };
        const genMultipliers = { diesel: 1.0, gas: 1.15, dualfuel: 1.3, hvo: 1.2 };
        const locationMultipliers = { sea: 0.65, india: 0.55, china: 0.7, japan: 1.1, australia: 1.05, europe: 1.15, usa: 1.0 };

        // â•â•â• ADVANCED MODE DATA â•â•â•
        // City-specific cost per Watt ($/W, 2025 baseline)
        // Sources: Turner & Townsend DCCI 2025, Cushman & Wakefield Cost Guide 2025
        const cityData = {
            silicon_valley: { perW: 13.30, region: 'usa', label: 'Silicon Valley', source: 'T&T 2025' },
            new_jersey:     { perW: 12.90, region: 'usa', label: 'New Jersey/NYC', source: 'C&W 2025' },
            virginia:       { perW: 13.40, region: 'usa', label: 'Virginia/NOVA', source: 'C&W 2025' },
            dallas:         { perW: 14.30, region: 'usa', label: 'Dallas, TX', source: 'C&W 2025' },
            phoenix:        { perW: 13.40, region: 'usa', label: 'Phoenix, AZ', source: 'C&W 2025' },
            chicago:        { perW: 13.20, region: 'usa', label: 'Chicago, IL', source: 'C&W 2025' },
            san_antonio:    { perW:  9.30, region: 'usa', label: 'San Antonio, TX', source: 'C&W 2025' },
            london:         { perW: 12.00, region: 'europe', label: 'London', source: 'T&T 2025' },
            frankfurt:      { perW: 11.60, region: 'europe', label: 'Frankfurt', source: 'T&T 2025' },
            amsterdam:      { perW: 11.80, region: 'europe', label: 'Amsterdam', source: 'Est. T&T' },
            stockholm:      { perW: 10.50, region: 'europe', label: 'Stockholm', source: 'Est. T&T' },
            tokyo:          { perW: 15.20, region: 'japan', label: 'Tokyo', source: 'T&T 2025' },
            singapore:      { perW: 14.53, region: 'sea', label: 'Singapore', source: 'T&T 2025' },
            hong_kong:      { perW: 13.80, region: 'china', label: 'Hong Kong', source: 'Est. T&T' },
            seoul:          { perW:  9.50, region: 'japan', label: 'Seoul', source: 'C&W APAC' },
            sydney:         { perW: 12.30, region: 'australia', label: 'Sydney', source: 'Est. T&T' },
            malaysia:       { perW: 11.37, region: 'sea', label: 'Malaysia/Johor', source: 'T&T 2025' },
            jakarta:        { perW: 11.21, region: 'sea', label: 'Jakarta', source: 'T&T 2025' },
            mumbai:         { perW:  6.64, region: 'india', label: 'Mumbai', source: 'T&T 2025' },
            bangkok:        { perW:  8.50, region: 'sea', label: 'Bangkok', source: 'Est. APAC' }
        };

        // Year escalation multipliers (CAPEX)
        // Sources: JLL 2026 Outlook (6%), T&T DCCI survey, Avid Solutions 2026-2030
        const yearEscalation = {
            '2025': { mult: 1.000, note: 'Baseline (current data)' },
            '2026': { mult: 1.060, note: '+6.0% â€” JLL forecast' },
            '2027': { mult: 1.115, note: '+5.2% â€” T&T trend' },
            '2028': { mult: 1.165, note: '+4.5% â€” supply normalization' },
            '2029': { mult: 1.210, note: '+3.9% â€” market stabilization' },
            '2030': { mult: 1.250, note: '+3.3% â€” historical average' }
        };

        // Front-of-meter costs (USD)
        const substationCosts = {
            shared: { base: 1000000, label: 'Shared Utility' },
            dedicated_33kv: { base: 4000000, label: 'Dedicated 33kV' },
            dedicated_132kv: { base: 7500000, label: 'Dedicated 132kV+' }
        };
        const transformerLeadMult = { standard: 1.0, extended: 1.15, emergency: 1.30 };
        const marketConditionMult = { buyer: 0.95, balanced: 1.0, seller: 1.10 };
        const deliveryMethodMult = { dbb: 1.0, db: 0.97, modular: 0.92, epc: 1.05 };
        const contractorAvailMult = { high: 1.0, normal: 1.03, tight: 1.08 };

        // Current mode
        let capexMode = 'simple';
        let savedScenario = null;

        function switchCapexMode(mode) {
            capexMode = mode;
            document.querySelectorAll('.capex-mode-btn').forEach(btn => {
                const isActive = btn.dataset.mode === mode;
                btn.style.background = isActive ? 'rgba(245,158,11,0.15)' : 'transparent';
                btn.style.borderColor = isActive ? 'rgba(245,158,11,0.4)' : 'rgba(255,255,255,0.15)';
                btn.style.color = isActive ? '#f59e0b' : '#94a3b8';
                btn.style.fontWeight = isActive ? '600' : '500';
                btn.classList.toggle('active', isActive);
            });
            const advPanel = document.getElementById('advancedInputs');
            advPanel.style.display = mode === 'advanced' ? 'flex' : 'none';
            calculateCosts();
            // Re-init tooltips for newly visible elements
            setTimeout(() => initTooltipSystem(), 50);
        }

        // FOM toggle
        document.getElementById('includeFOM').addEventListener('change', function() {
            document.getElementById('fomInputs').style.display = this.checked ? 'flex' : 'none';
            calculateCosts();
        });

        // Slider label updaters
        document.getElementById('utilityRate').addEventListener('input', function() {
            document.getElementById('utilRateVal').textContent = this.value + '%';
            calculateCosts();
        });
        document.getElementById('designFee').addEventListener('input', function() {
            document.getElementById('designFeeVal').textContent = this.value + '%';
            calculateCosts();
        });
        document.getElementById('pmFee').addEventListener('input', function() {
            document.getElementById('pmFeeVal').textContent = this.value + '%';
            calculateCosts();
        });
        document.getElementById('contingencyAdv').addEventListener('input', function() {
            document.getElementById('contingencyVal').textContent = this.value + '%';
            calculateCosts();
        });

        // Advanced mode event listeners
        ['projYear','cityMarket','substationType','transformerLead','marketCondition','deliveryMethod','contractorAvail'].forEach(id => {
            document.getElementById(id).addEventListener('change', calculateCosts);
        });

        const tierMapping = {
            n: { tier: 'Tier I', uptime: '99.671%' },
            n1: { tier: 'Tier II', uptime: '99.741%' },
            '2n': { tier: 'Tier III', uptime: '99.982%' },
            '2n1': { tier: 'Tier IV', uptime: '99.995%' }
        };

        const pueMapping = {
            air: { standard: 1.8, medium: 1.7, high: 1.6, ai: 1.5 },
            inrow: { standard: 1.6, medium: 1.5, high: 1.45, ai: 1.4 },
            rdhx: { standard: 1.45, medium: 1.4, high: 1.35, ai: 1.3 },
            liquid: { standard: 1.3, medium: 1.25, high: 1.2, ai: 1.15 }
        };

        function getSelectedValue(name) {
            const selected = document.querySelector(`input[name="${name}"]:checked`);
            return selected ? selected.value : null;
        }

        function formatCurrency(amount) {
            if (amount >= 1000000000) {
                return '$' + (amount / 1000000000).toFixed(2) + 'B';
            } else if (amount >= 1000000) {
                return '$' + (amount / 1000000).toFixed(2) + 'M';
            } else if (amount >= 1000) {
                return '$' + (amount / 1000).toFixed(0) + 'K';
            }
            return '$' + amount.toFixed(0);
        }

        function calculateCosts() {
            const itLoad = parseInt(document.getElementById('itLoad').value) || 1000;
            const rackType = getSelectedValue('rackType');
            const coolingType = getSelectedValue('coolingType');
            const redundancy = getSelectedValue('redundancy');
            const fuelHours = parseInt(document.getElementById('fuelHours').value) || 48;
            const buildingType = document.getElementById('buildingType').value;
            const seismicZone = document.getElementById('seismicZone').value;
            const fireType = document.getElementById('fireType').value;
            const alarmType = document.getElementById('alarmType').value;
            const upsType = document.getElementById('upsType').value;
            const genType = document.getElementById('genType').value;
            const location = document.getElementById('locationFactor').value;

            const redMult = redundancyMultipliers[redundancy];
            const coolMult = coolingMultipliers[coolingType];
            const rackMult = rackMultipliers[rackType];
            const buildMult = buildingMultipliers[buildingType];
            const seismicMult = seismicMultipliers[seismicZone];
            const fireSupMult = fireSuppressionMultipliers[fireType];
            const alarmMult = fireAlarmMultipliers[alarmType];
            const upsMult = upsMultipliers[upsType];
            const genMult = genMultipliers[genType];
            let locMult = locationMultipliers[location];
            const fuelMult = 1 + (fuelHours - 24) * 0.008;

            // Advanced mode adjustments
            const isAdv = capexMode === 'advanced';
            let yearMult = 1.0, cityLabel = '', yearLabel = '2025';
            let marketMult = 1.0, deliveryMult = 1.0, contractorMult = 1.0;
            let designPct = 0, pmPct = 0, contingencyPct = 5;
            let fomTotal = 0, fomIncluded = false;

            if (isAdv) {
                // Year escalation
                yearLabel = document.getElementById('projYear').value;
                yearMult = yearEscalation[yearLabel].mult;

                // City-specific override
                const cityVal = document.getElementById('cityMarket').value;
                if (cityVal !== 'none' && cityData[cityVal]) {
                    const city = cityData[cityVal];
                    cityLabel = city.label;
                    // City $/W -> derive location multiplier relative to US baseline ~$13/W
                    locMult = city.perW / 13.0;
                }

                // Market factors
                marketMult = marketConditionMult[document.getElementById('marketCondition').value];
                deliveryMult = deliveryMethodMult[document.getElementById('deliveryMethod').value];
                contractorMult = contractorAvailMult[document.getElementById('contractorAvail').value];

                // Professional fees
                designPct = parseFloat(document.getElementById('designFee').value);
                pmPct = parseFloat(document.getElementById('pmFee').value);
                contingencyPct = parseInt(document.getElementById('contingencyAdv').value);

                // Front-of-meter
                fomIncluded = document.getElementById('includeFOM').checked;
                if (fomIncluded) {
                    const subType = document.getElementById('substationType').value;
                    const transLead = document.getElementById('transformerLead').value;
                    const utilRate = parseFloat(document.getElementById('utilityRate').value) / 100;
                    const subCost = substationCosts[subType].base * transformerLeadMult[transLead];
                    const gridConnection = itLoad * 0.001 * 500000; // ~$500K per MW
                    const switchgear = itLoad * 0.001 * 300000; // ~$300K per MW
                    fomTotal = (subCost + gridConnection + switchgear) * (1 + utilRate);
                    fomTotal *= yearMult;
                }
            }

            const costs = {};
            let total = 0;
            const advGlobalMult = isAdv ? yearMult * marketMult * deliveryMult * contractorMult : 1.0;

            for (const [key, factor] of Object.entries(costFactors)) {
                let multiplier = locMult;

                if (key === 'building') {
                    multiplier *= buildMult * rackMult;
                } else if (key === 'seismic') {
                    multiplier *= seismicMult * buildMult;
                } else if (key === 'electrical') {
                    multiplier *= redMult * rackMult;
                } else if (key === 'ups') {
                    multiplier *= redMult * rackMult * upsMult;
                } else if (key === 'generator') {
                    multiplier *= redMult * fuelMult * genMult;
                } else if (key === 'cooling') {
                    multiplier *= coolMult * rackMult;
                } else if (key === 'fireSuppression') {
                    multiplier *= fireSupMult;
                } else if (key === 'fireAlarm') {
                    multiplier *= alarmMult;
                }

                costs[key] = factor.base * itLoad * multiplier * advGlobalMult;
                total += costs[key];
            }

            // Soft costs (advanced)
            let softCosts = {};
            if (isAdv) {
                if (designPct > 0) {
                    softCosts.design = total * (designPct / 100);
                }
                if (pmPct > 0) {
                    softCosts.pm = total * (pmPct / 100);
                }
            }
            const softTotal = Object.values(softCosts).reduce((a, b) => a + b, 0);
            total += softTotal;

            // Contingency
            const contingency = total * (contingencyPct / 100);
            total += contingency;

            // Add FOM
            if (fomIncluded) total += fomTotal;

            // â•â•â• UPDATE UI â•â•â•
            document.getElementById('totalCost').textContent = formatCurrency(total);
            document.getElementById('perKwCost').textContent = formatCurrency(total / itLoad) + '/kW';

            const tierInfo = tierMapping[redundancy];
            document.getElementById('tierClass').textContent = tierInfo.tier;
            document.getElementById('uptimeValue').textContent = tierInfo.uptime;

            const pue = pueMapping[coolingType][rackType];
            document.getElementById('pueValue').textContent = pue.toFixed(2);

            const energyRate = location === 'sea' ? 0.08 : location === 'india' ? 0.07 : location === 'usa' ? 0.10 : 0.12;
            const annualEnergy = itLoad * pue * 8760 * energyRate;
            document.getElementById('energyCost').textContent = formatCurrency(annualEnergy);

            // â•â•â• RENDER BREAKDOWN â•â•â•
            const breakdownEl = document.getElementById('costBreakdown');
            breakdownEl.innerHTML = '';

            // Collect all line items for bar sizing
            const allItems = { ...costs };
            if (softCosts.design) allItems._design = softCosts.design;
            if (softCosts.pm) allItems._pm = softCosts.pm;
            allItems._contingency = contingency;
            if (fomIncluded) allItems._fom = fomTotal;
            const maxCost = Math.max(...Object.values(allItems));

            const sortedCosts = Object.entries(costs).sort((a, b) => b[1] - a[1]);
            for (const [key, cost] of sortedCosts) {
                const factor = costFactors[key];
                const percent = ((cost / total) * 100).toFixed(1);
                const barWidth = (cost / maxCost) * 100;
                breakdownEl.innerHTML += `
                    <div class="cost-item">
                        <div class="cost-name">
                            <div class="cost-icon" style="background: ${factor.color}30; color: ${factor.color};"><i class="fas ${factor.icon}"></i></div>
                            ${factor.label}
                        </div>
                        <div class="cost-bar-container">
                            <div class="cost-bar" style="width: ${barWidth}%; background: ${factor.color};"></div>
                        </div>
                        <span class="cost-value">${formatCurrency(cost)}</span>
                        <span class="cost-percent">${percent}%</span>
                    </div>`;
            }

            // Soft cost rows (advanced)
            if (softCosts.design) {
                breakdownEl.innerHTML += renderExtraRow('fa-drafting-compass', 'Design & Engineering', softCosts.design, '#10b981', maxCost, total);
            }
            if (softCosts.pm) {
                breakdownEl.innerHTML += renderExtraRow('fa-tasks', 'Project Management', softCosts.pm, '#059669', maxCost, total);
            }

            // FOM row
            if (fomIncluded) {
                breakdownEl.innerHTML += renderExtraRow('fa-plug', 'Front-of-Meter / Utility', fomTotal, '#3b82f6', maxCost, total);
            }

            // Contingency row
            breakdownEl.innerHTML += `
                <div class="cost-item" style="opacity: 0.7;">
                    <div class="cost-name">
                        <div class="cost-icon" style="background: rgba(255,255,255,0.2); color: rgba(255,255,255,0.8);"><i class="fas fa-plus-circle"></i></div>
                        Contingency (${contingencyPct}%)
                    </div>
                    <div class="cost-bar-container">
                        <div class="cost-bar" style="width: ${(contingency / maxCost) * 100}%; background: rgba(255,255,255,0.5);"></div>
                    </div>
                    <span class="cost-value">${formatCurrency(contingency)}</span>
                    <span class="cost-percent">${contingencyPct}.0%</span>
                </div>`;

            // Advanced info badge
            const advBadge = document.getElementById('advInfoBadge');
            if (advBadge) {
                if (isAdv) {
                    let info = yearLabel;
                    if (cityLabel) info += ' Â· ' + cityLabel;
                    if (yearMult > 1) info += ' Â· +' + ((yearMult - 1) * 100).toFixed(1) + '% escalation';
                    advBadge.textContent = info;
                    advBadge.style.display = 'inline-block';
                } else {
                    advBadge.style.display = 'none';
                }
            }

            const result = { total, costs, contingency, softCosts, fomTotal, fomIncluded, itLoad, pue, tierInfo, annualEnergy, yearLabel, cityLabel, contingencyPct, designPct, pmPct };
            lastResult = result;
            // Auto-update comparison if saved
            if (savedScenario) renderComparison();
            return result;
        }

        function renderExtraRow(icon, label, cost, color, maxCost, total) {
            return `<div class="cost-item">
                <div class="cost-name">
                    <div class="cost-icon" style="background: ${color}30; color: ${color};"><i class="fas ${icon}"></i></div>
                    ${label}
                </div>
                <div class="cost-bar-container">
                    <div class="cost-bar" style="width: ${(cost / maxCost) * 100}%; background: ${color};"></div>
                </div>
                <span class="cost-value">${formatCurrency(cost)}</span>
                <span class="cost-percent">${((cost / total) * 100).toFixed(1)}%</span>
            </div>`;
        }

        // Event Listeners
        document.getElementById('itLoad').addEventListener('input', calculateCosts);
        document.getElementById('fuelHours').addEventListener('input', calculateCosts);
        document.getElementById('buildingType').addEventListener('change', calculateCosts);
        document.getElementById('seismicZone').addEventListener('change', calculateCosts);
        document.getElementById('fireType').addEventListener('change', calculateCosts);
        document.getElementById('alarmType').addEventListener('change', calculateCosts);
        document.getElementById('upsType').addEventListener('change', calculateCosts);
        document.getElementById('genType').addEventListener('change', calculateCosts);
        document.getElementById('locationFactor').addEventListener('change', calculateCosts);
        document.querySelectorAll('input[type="radio"]').forEach(radio => {
            radio.addEventListener('change', calculateCosts);
        });

        // Last computed result (avoids recalculation in comparison)
        let lastResult = null;

        // Initial calculation
        calculateCosts();
        initTooltipSystem();

        // â•â•â• COMPARE MODE â•â•â•
        function saveScenarioA() {
            if (!lastResult) calculateCosts();
            savedScenario = JSON.parse(JSON.stringify(lastResult));
            document.getElementById('comparePanel').style.display = 'block';
            document.getElementById('savedIndicator').style.display = 'block';
            const btn = document.getElementById('btnSaveA');
            btn.innerHTML = '<i class="fas fa-check-circle"></i> Scenario A Saved';
            btn.style.background = 'linear-gradient(135deg,rgba(16,185,129,0.2),rgba(16,185,129,0.1))';
            btn.style.borderColor = 'rgba(16,185,129,0.5)';
            btn.style.color = '#34d399';
            renderComparison();
            // Scroll to compare
            setTimeout(() => document.getElementById('comparePanel').scrollIntoView({ behavior:'smooth', block:'start' }), 100);
        }

        function clearComparison() {
            savedScenario = null;
            document.getElementById('comparePanel').style.display = 'none';
            document.getElementById('savedIndicator').style.display = 'none';
            const btn = document.getElementById('btnSaveA');
            btn.innerHTML = '<i class="fas fa-bookmark"></i> Save Scenario A';
            btn.style.background = 'linear-gradient(135deg,rgba(251,191,36,0.2),rgba(245,158,11,0.1))';
            btn.style.borderColor = 'rgba(251,191,36,0.5)';
            btn.style.color = '#fbbf24';
        }

        function renderComparison() {
            if (!savedScenario || !lastResult) return;
            const b = lastResult;
            const a = savedScenario;
            const delta = ((b.total - a.total) / a.total * 100);
            const deltaSign = delta >= 0 ? '+' : '';
            const deltaColor = delta > 0 ? '#ef4444' : '#10b981';

            document.getElementById('scenarioACard').innerHTML = renderScenarioCard('A', a, '#fbbf24');
            document.getElementById('scenarioBCard').innerHTML = renderScenarioCard('B', b, '#34d399');

            document.getElementById('deltaColumn').innerHTML = `
                <div style="text-align:center;padding:0.5rem;">
                    <div style="font-size:0.7rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:4px;">Delta</div>
                    <div style="font-size:1.6rem;font-weight:700;color:${deltaColor};font-family:'JetBrains Mono',monospace;">${deltaSign}${delta.toFixed(1)}%</div>
                    <div style="font-size:0.8rem;color:var(--text-secondary);margin-top:4px;">${deltaSign}${formatCurrency(b.total - a.total)}</div>
                </div>
                <div style="width:2px;height:60px;background:linear-gradient(180deg,${deltaColor},transparent);border-radius:1px;"></div>
                <div style="text-align:center;">
                    <div style="font-size:0.7rem;color:var(--text-muted);">$/kW Delta</div>
                    <div style="font-size:0.95rem;font-weight:600;color:${deltaColor};font-family:'JetBrains Mono',monospace;">${deltaSign}${formatCurrency((b.total/b.itLoad) - (a.total/a.itLoad))}</div>
                </div>`;
        }

        function renderScenarioCard(label, data, accent) {
            const topCosts = Object.entries(data.costs).sort((a, b) => b[1] - a[1]).slice(0, 5);
            const maxC = topCosts[0][1];
            let barsHTML = topCosts.map(([key, cost]) => {
                const f = costFactors[key];
                return `<div style="display:flex;align-items:center;gap:8px;margin-bottom:6px;">
                    <span style="font-size:0.7rem;min-width:90px;color:rgba(255,255,255,0.7);">${f.label}</span>
                    <div style="flex:1;height:5px;background:rgba(255,255,255,0.1);border-radius:3px;overflow:hidden;">
                        <div style="width:${(cost/maxC)*100}%;height:100%;background:${f.color};border-radius:3px;"></div>
                    </div>
                    <span style="font-size:0.75rem;font-family:'JetBrains Mono',monospace;min-width:60px;text-align:right;">${formatCurrency(cost)}</span>
                </div>`;
            }).join('');
            let metaInfo = data.tierInfo.tier + ' Â· PUE ' + data.pue;
            if (data.yearLabel !== '2025') metaInfo += ' Â· ' + data.yearLabel;
            if (data.cityLabel) metaInfo += ' Â· ' + data.cityLabel;
            return `
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;padding-bottom:0.75rem;border-bottom:1px solid rgba(255,255,255,0.15);">
                    <span style="font-size:0.85rem;font-weight:600;display:flex;align-items:center;gap:6px;">
                        <span style="width:24px;height:24px;border-radius:6px;background:${accent}30;color:${accent};display:flex;align-items:center;justify-content:center;font-size:0.75rem;font-weight:700;">${label}</span>
                        Scenario ${label}
                    </span>
                    <span style="font-size:0.7rem;color:rgba(255,255,255,0.5);">${metaInfo}</span>
                </div>
                <div style="text-align:center;margin-bottom:1rem;">
                    <div style="font-size:0.7rem;color:rgba(255,255,255,0.6);text-transform:uppercase;letter-spacing:0.5px;">Total CAPEX</div>
                    <div style="font-size:1.8rem;font-weight:700;color:${accent};font-family:'JetBrains Mono',monospace;">${formatCurrency(data.total)}</div>
                    <div style="font-size:0.85rem;color:rgba(255,255,255,0.7);font-family:'JetBrains Mono',monospace;">${formatCurrency(data.total/data.itLoad)}/kW Â· ${data.itLoad.toLocaleString()} kW</div>
                </div>
                <div style="margin-top:0.75rem;">${barsHTML}</div>`;
        }

        // â•â•â• EXPORT PDF â•â•â•
        function exportPDF() {
            const result = calculateCosts();
            const now = new Date();
            const dateStr = now.toLocaleDateString('en-US', { year:'numeric', month:'long', day:'numeric' });
            const sortedCosts = Object.entries(result.costs).sort((a, b) => b[1] - a[1]);

            let rowsHTML = sortedCosts.map(([key, cost]) => {
                const f = costFactors[key];
                return `<tr><td style="padding:8px 12px;border-bottom:1px solid #e5e7eb;">${f.label}</td>
                    <td style="padding:8px 12px;border-bottom:1px solid #e5e7eb;text-align:right;font-family:monospace;">${formatCurrency(cost)}</td>
                    <td style="padding:8px 12px;border-bottom:1px solid #e5e7eb;text-align:right;color:#6b7280;">${((cost/result.total)*100).toFixed(1)}%</td></tr>`;
            }).join('');

            // Add soft costs
            if (result.softCosts.design) {
                rowsHTML += `<tr><td style="padding:8px 12px;border-bottom:1px solid #e5e7eb;">Design & Engineering</td>
                    <td style="padding:8px 12px;border-bottom:1px solid #e5e7eb;text-align:right;font-family:monospace;">${formatCurrency(result.softCosts.design)}</td>
                    <td style="padding:8px 12px;border-bottom:1px solid #e5e7eb;text-align:right;color:#6b7280;">${((result.softCosts.design/result.total)*100).toFixed(1)}%</td></tr>`;
            }
            if (result.softCosts.pm) {
                rowsHTML += `<tr><td style="padding:8px 12px;border-bottom:1px solid #e5e7eb;">Project Management</td>
                    <td style="padding:8px 12px;border-bottom:1px solid #e5e7eb;text-align:right;font-family:monospace;">${formatCurrency(result.softCosts.pm)}</td>
                    <td style="padding:8px 12px;border-bottom:1px solid #e5e7eb;text-align:right;color:#6b7280;">${((result.softCosts.pm/result.total)*100).toFixed(1)}%</td></tr>`;
            }
            if (result.fomIncluded) {
                rowsHTML += `<tr><td style="padding:8px 12px;border-bottom:1px solid #e5e7eb;">Front-of-Meter / Utility</td>
                    <td style="padding:8px 12px;border-bottom:1px solid #e5e7eb;text-align:right;font-family:monospace;">${formatCurrency(result.fomTotal)}</td>
                    <td style="padding:8px 12px;border-bottom:1px solid #e5e7eb;text-align:right;color:#6b7280;">${((result.fomTotal/result.total)*100).toFixed(1)}%</td></tr>`;
            }
            rowsHTML += `<tr style="background:#f9fafb;"><td style="padding:8px 12px;border-bottom:1px solid #e5e7eb;">Contingency (${result.contingencyPct}%)</td>
                <td style="padding:8px 12px;border-bottom:1px solid #e5e7eb;text-align:right;font-family:monospace;">${formatCurrency(result.contingency)}</td>
                <td style="padding:8px 12px;border-bottom:1px solid #e5e7eb;text-align:right;color:#6b7280;">${result.contingencyPct}.0%</td></tr>`;

            // Config summary
            const itLoad = document.getElementById('itLoad').value;
            const redundancy = getSelectedValue('redundancy');
            const coolingType = getSelectedValue('coolingType');
            const rackType = getSelectedValue('rackType');
            let configHTML = `<tr><td style="padding:6px 0;color:#6b7280;">IT Load</td><td style="padding:6px 0;font-weight:600;">${parseInt(itLoad).toLocaleString()} kW</td></tr>
                <tr><td style="padding:6px 0;color:#6b7280;">Redundancy</td><td style="padding:6px 0;font-weight:600;">${redundancy.toUpperCase()}</td></tr>
                <tr><td style="padding:6px 0;color:#6b7280;">Cooling</td><td style="padding:6px 0;font-weight:600;">${coolingType.toUpperCase()}</td></tr>
                <tr><td style="padding:6px 0;color:#6b7280;">Rack Density</td><td style="padding:6px 0;font-weight:600;">${rackType}</td></tr>
                <tr><td style="padding:6px 0;color:#6b7280;">Tier</td><td style="padding:6px 0;font-weight:600;">${result.tierInfo.tier}</td></tr>
                <tr><td style="padding:6px 0;color:#6b7280;">PUE</td><td style="padding:6px 0;font-weight:600;">${result.pue}</td></tr>`;
            if (result.yearLabel !== '2025') configHTML += `<tr><td style="padding:6px 0;color:#6b7280;">Projection Year</td><td style="padding:6px 0;font-weight:600;">${result.yearLabel}</td></tr>`;
            if (result.cityLabel) configHTML += `<tr><td style="padding:6px 0;color:#6b7280;">City/Market</td><td style="padding:6px 0;font-weight:600;">${result.cityLabel}</td></tr>`;

            // Compare section
            let compareHTML = '';
            if (savedScenario) {
                const a = savedScenario;
                const delta = ((result.total - a.total) / a.total * 100);
                const sign = delta >= 0 ? '+' : '';
                compareHTML = `
                <div style="page-break-before:auto;margin-top:30px;">
                    <h2 style="font-size:16px;color:#1e3a5f;border-bottom:2px solid #f59e0b;padding-bottom:8px;margin-bottom:16px;">Scenario Comparison</h2>
                    <table style="width:100%;border-collapse:collapse;font-size:13px;">
                        <tr style="background:#1e3a5f;color:white;"><th style="padding:10px;text-align:left;">Metric</th><th style="padding:10px;text-align:right;">Scenario A</th><th style="padding:10px;text-align:right;">Scenario B</th><th style="padding:10px;text-align:right;">Delta</th></tr>
                        <tr><td style="padding:8px;border-bottom:1px solid #e5e7eb;">Total CAPEX</td><td style="padding:8px;text-align:right;font-family:monospace;">${formatCurrency(a.total)}</td><td style="padding:8px;text-align:right;font-family:monospace;">${formatCurrency(result.total)}</td><td style="padding:8px;text-align:right;color:${delta>0?'#ef4444':'#10b981'};font-weight:600;">${sign}${delta.toFixed(1)}%</td></tr>
                        <tr><td style="padding:8px;border-bottom:1px solid #e5e7eb;">Cost per kW</td><td style="padding:8px;text-align:right;font-family:monospace;">${formatCurrency(a.total/a.itLoad)}/kW</td><td style="padding:8px;text-align:right;font-family:monospace;">${formatCurrency(result.total/result.itLoad)}/kW</td><td style="padding:8px;text-align:right;color:${delta>0?'#ef4444':'#10b981'};font-weight:600;">${sign}${formatCurrency((result.total/result.itLoad)-(a.total/a.itLoad))}</td></tr>
                        <tr><td style="padding:8px;border-bottom:1px solid #e5e7eb;">IT Load</td><td style="padding:8px;text-align:right;">${a.itLoad.toLocaleString()} kW</td><td style="padding:8px;text-align:right;">${result.itLoad.toLocaleString()} kW</td><td style="padding:8px;text-align:right;">â€”</td></tr>
                        <tr><td style="padding:8px;border-bottom:1px solid #e5e7eb;">Tier</td><td style="padding:8px;text-align:right;">${a.tierInfo.tier}</td><td style="padding:8px;text-align:right;">${result.tierInfo.tier}</td><td style="padding:8px;text-align:right;">â€”</td></tr>
                    </table>
                </div>`;
            }

            const printHTML = `<!DOCTYPE html><html><head><meta charset="UTF-8"><title>CAPEX Report â€” ${dateStr}</title>
            <style>@media print{body{-webkit-print-color-adjust:exact;print-color-adjust:exact;}}</style></head>
            <body style="font-family:Arial,Helvetica,sans-serif;max-width:800px;margin:0 auto;padding:40px;color:#1f2937;">
                <div style="display:flex;justify-content:space-between;align-items:center;border-bottom:3px solid #1e3a5f;padding-bottom:16px;margin-bottom:24px;">
                    <div>
                        <h1 style="font-size:22px;color:#1e3a5f;margin:0;">Data Center CAPEX Report</h1>
                        <p style="font-size:12px;color:#6b7280;margin:4px 0 0;">Generated ${dateStr} Â· resistancezero.com</p>
                    </div>
                    <div style="text-align:right;">
                        <div style="font-size:28px;font-weight:700;color:#f59e0b;font-family:monospace;">${formatCurrency(result.total)}</div>
                        <div style="font-size:13px;color:#6b7280;">${formatCurrency(result.total/result.itLoad)}/kW Â· ${result.itLoad.toLocaleString()} kW IT Load</div>
                    </div>
                </div>
                <div style="display:flex;gap:24px;margin-bottom:24px;">
                    <div style="flex:1;">
                        <h2 style="font-size:14px;color:#1e3a5f;border-bottom:2px solid #f59e0b;padding-bottom:6px;margin-bottom:12px;">Configuration</h2>
                        <table style="width:100%;font-size:13px;">${configHTML}</table>
                    </div>
                    <div style="flex:1;">
                        <h2 style="font-size:14px;color:#1e3a5f;border-bottom:2px solid #f59e0b;padding-bottom:6px;margin-bottom:12px;">Key Metrics</h2>
                        <table style="width:100%;font-size:13px;">
                            <tr><td style="padding:6px 0;color:#6b7280;">Total CAPEX</td><td style="padding:6px 0;font-weight:700;color:#f59e0b;font-family:monospace;">${formatCurrency(result.total)}</td></tr>
                            <tr><td style="padding:6px 0;color:#6b7280;">Annual Energy (est.)</td><td style="padding:6px 0;font-weight:600;font-family:monospace;">${formatCurrency(result.annualEnergy)}/yr</td></tr>
                            <tr><td style="padding:6px 0;color:#6b7280;">Uptime SLA</td><td style="padding:6px 0;font-weight:600;">${result.tierInfo.uptime}</td></tr>
                        </table>
                    </div>
                </div>
                <h2 style="font-size:16px;color:#1e3a5f;border-bottom:2px solid #f59e0b;padding-bottom:8px;margin-bottom:16px;">Cost Breakdown</h2>
                <table style="width:100%;border-collapse:collapse;font-size:13px;">
                    <tr style="background:#1e3a5f;color:white;"><th style="padding:10px 12px;text-align:left;">Component</th><th style="padding:10px 12px;text-align:right;">Cost (USD)</th><th style="padding:10px 12px;text-align:right;">Share</th></tr>
                    ${rowsHTML}
                    <tr style="background:#1e3a5f;color:white;font-weight:700;"><td style="padding:10px 12px;">TOTAL</td><td style="padding:10px 12px;text-align:right;font-family:monospace;">${formatCurrency(result.total)}</td><td style="padding:10px 12px;text-align:right;">100%</td></tr>
                </table>
                ${compareHTML}
                <div style="margin-top:40px;padding-top:16px;border-top:1px solid #e5e7eb;font-size:11px;color:#9ca3af;text-align:center;">
                    <p>This report is a general-purpose estimate. Actual costs depend on site-specific engineering, local regulations, and procurement strategy.</p>
                    <p style="margin-top:4px;">Generated by Data Center CAPEX Calculator Â· resistancezero.com Â· &copy; ${now.getFullYear()} Bagus Dwi Permana</p>
                </div>
            </body></html>`;

            const printWindow = window.open('', '_blank');
            printWindow.document.write(printHTML);
            printWindow.document.close();
            printWindow.focus();
            setTimeout(() => printWindow.print(), 500);
        }

        // Global Tooltip System
        function initTooltipSystem() {
            const tooltipEl = document.createElement('div');
            tooltipEl.id = 'tooltip-container';
            document.body.appendChild(tooltipEl);

            document.querySelectorAll('.tooltip-trigger').forEach(trigger => {
                const content = trigger.querySelector('.tooltip-content');
                if (!content) return;

                trigger.addEventListener('mouseenter', () => {
                    tooltipEl.innerHTML = content.innerHTML;

                    const rect = trigger.getBoundingClientRect();
                    const tooltipWidth = 320;
                    const tooltipHeight = tooltipEl.offsetHeight || 200;
                    const padding = 15;

                    let left = rect.right + padding;
                    let top = rect.top + rect.height / 2;

                    if (left + tooltipWidth > window.innerWidth - 20) {
                        left = rect.left - tooltipWidth - padding;
                    }
                    if (left < 20) left = 20;

                    top = top - tooltipHeight / 2;
                    if (top < 20) top = 20;
                    if (top + tooltipHeight > window.innerHeight - 20) {
                        top = window.innerHeight - tooltipHeight - 20;
                    }

                    tooltipEl.style.left = left + 'px';
                    tooltipEl.style.top = top + 'px';
                    tooltipEl.classList.add('visible');
                });

                trigger.addEventListener('mouseleave', () => {
                    tooltipEl.classList.remove('visible');
                });
            });
        }
    </script>
</body>
</html>
